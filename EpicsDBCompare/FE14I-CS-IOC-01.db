# ethercat MASTER.template
# % macro, DEVICE, EtherCAT Master
# % macro, SCAN, poll period
# % macro, name, Object name and gui association name

# % gui, , edmembed, master-embed.edl, P=FE14I-CS-ECAT-01:MASTER
record(longin, "FE14I-CS-ECAT-01:MASTER:CYCLE")
{
  field("DTYP", "asynInt32")
  field("INP",  "@asyn(MASTER0)Cycle")
  field("SCAN", ".1 second")
}

record(longin, "FE14I-CS-ECAT-01:MASTER:MISSED")
{
  field("DTYP", "asynInt32")
  field("INP",  "@asyn(MASTER0)Missed")
  field("SCAN", "I/O Intr")
}

record(longin, "FE14I-CS-ECAT-01:MASTER:WORKINGCOUNTER")
{
  field("DTYP", "asynInt32")
  field("INP",  "@asyn(MASTER0)WorkingCounter")
  field("SCAN", "I/O Intr")
  info("archiver", "1 Monitor")
}

record(mbbi, "FE14I-CS-ECAT-01:MASTER:WCSTATE")
{
  field("DTYP", "asynInt32")
  field("INP",  "@asyn(MASTER0)WcState")
  field("SCAN", "I/O Intr")
  field("ZRVL", "0")
  field("ONVL", "1")
  field("TWVL", "2")
  field("ZRSV", "MAJOR")
  field("ONSV", "MAJOR")
  field("TWSV", "NO_ALARM")
  field("ZRST", "ZERO")
  field("ONST", "INCOMPLETE")
  field("TWST", "COMPLETE")
  info("archiver", "1 Monitor")
}
# ethercat gadc.template
# % macro, DEVICE, EtherCAT slave
# % macro, CHANNEL, ADC channel
# % macro, PORT, asyn port for EtherCAT slave
# % macro, SAMPLES, number of samples in waveform
# % macro, SCAN, polling period
# % macro, MDEL, MDEL for VALUE and INTEGRAL fields
# % macro, INTSCAN, polling period for the INTERRUPT parameter
# % macro, name, name for gui element
# % gui, GT1, edm, AdcControl.edl, DEVICE=FE14I-CS-ADC-02,CHANNEL=1

# % gui, GT1, boyembed, ethercatApp_opi/gadc_embed_box.opi, DEVICE=FE14I-CS-ADC-02, CHANNEL=1, name=GT1
# % gui, GT1, boyembed, ethercatApp_opi/gadc_embed.opi, DEVICE=FE14I-CS-ADC-02, CHANNEL=1, name=GT1
# % gui, GT1, boydetail, ethercatApp_opi/gadc_detail.opi, DEVICE=FE14I-CS-ADC-02, CHANNEL=1, name=GT1

# <GUI tag>, <name>, <type>, <descr>, <PV>
# Where <type> is in <demand|readback|enum|statusbits|command|toggle>
# % gui, GT1, demand, Samples, FE14I-CS-ADC-02:ADC1_SAMPLES
# % gui, GT1, demand, Average, FE14I-CS-ADC-02:ADC1_AVERAGE
# % gui, GT1, readback, Value, FE14I-CS-ADC-02:ADC1_VALUE
# % gui, GT1, readback, Status, FE14I-CS-ADC-02:ADC1_STATE
# % gui, GT1, enum, Retrigger, FE14I-CS-ADC-02:ADC1_RETRIGGER
# % gui, GT1, enum, Enable, FE14I-CS-ADC-02:ADC1_ENABLED
# % gui, GT1, readback, Enabled, FE14I-CS-ADC-02:ADC1_ENABLED_R

record(longout, "FE14I-CS-ADC-02:ADC1_CHANBUFF")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)CHANBUFF")
   field(DOL,  "10000000")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-02:ADC1_INFO")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)INFO")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-02:ADC1_SAMPLES")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)SAMPLES")
}

record(longout, "FE14I-CS-ADC-02:ADC1_OFFSET")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)OFFSET")
}

record(mbbo, "FE14I-CS-ADC-02:ADC1_MODE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)MODE")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "CONTINUOUS")
   field(ONST, "TRIGGERED")
   field(TWST, "GATED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(busy, "FE14I-CS-ADC-02:ADC1_TRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)TRIGGER")
   field(ZNAM, "Done")
   field(ONAM, "Acquire")
   field(VAL,  "0")
}

record(longout, "FE14I-CS-ADC-02:ADC1_CAPTURE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)CAPTURE")
   field(DOL,  "1")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-02:ADC1_AVERAGE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)AVERAGE")
}

record(waveform, "FE14I-CS-ADC-02:ADC1_WAVEFORM")
{
    field(DTYP, "asynInt32ArrayIn")
    field(NELM, "100")
    field(SCAN, "I/O Intr")
    field(FTVL, "LONG")
    field(INP,  "@asyn(AI1_ADC1)WAVEFORM")
}

record(longin, "FE14I-CS-ADC-02:ADC1_BUFFERCOUNT")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC1)BUFFERCOUNT")
   field(SCAN, "1 second")
}

# % archiver 10 Monitor
record(longin, "FE14I-CS-ADC-02:ADC1_VALUE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC1)VALUE")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(ai, "FE14I-CS-ADC-02:ADC1_INTEGRAL")
{
   field(DTYP, "asynFloat64")
   field(INP,  "@asyn(AI1_ADC1)INTEGRAL")
   field(PREC, "3")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(mbbi, "FE14I-CS-ADC-02:ADC1_STATE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC1)STATE")
   field(SCAN, "I/O Intr")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "WAITING")
   field(ONST, "TRIGGERED")
   field(TWST, "DONE")

}

record(bi, "FE14I-CS-ADC-02:ADC1_ENABLED_R")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC1)ENABLED")
   field(SCAN, "I/O Intr")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
}

record(bo, "FE14I-CS-ADC-02:ADC1_ENABLED")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)ENABLED")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(bo, "FE14I-CS-ADC-02:ADC1_RETRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)RETRIGGER")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "1")
}

record(longout, "FE14I-CS-ADC-02:ADC1_INTERRUPT")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC1)INTERRUPT")
   field(SCAN, "I/O Intr")
}

record(longout, "FE14I-CS-ADC-02:ADC1_CLEAR")
{
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn(AI1_ADC1)CLEAR")
}

record(mbbo, "FE14I-CS-ADC-02:FREQ1")
{
   field(DTYP, "Raw Soft Channel")
   field(SCAN, "Passive")
   field(PINI, "YES")
   field(DOL, "0")
   field(ZRST, "200Hz")
   field(ONST, "100Hz")
   field(TWST, "50Hz")
   field(THST, "40Hz")
   field(FRST, "25Hz")
   field(FVST, "20Hz")
   field(SXST, "10Hz")
   field(SVST, "5Hz")
   field(EIST, "4Hz")
   field(NIST, "2Hz")
   field(TEST, "1Hz")
   field(ZRVL, "5")
   field(ONVL, "10")
   field(TWVL, "20")
   field(THVL, "25")
   field(FRVL, "40")
   field(FVVL, "50")
   field(SXVL, "100")
   field(SVVL, "200")
   field(EIVL, "250")
   field(NIVL, "500")
   field(TEVL, "1000")
   field(FLNK, "FE14I-CS-ADC-02:SET_SAMPLES1")
}

record(ao, "FE14I-CS-ADC-02:SET_SAMPLES1")
{
   field(DOL,  "FE14I-CS-ADC-02:FREQ1.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-02:ADC1_SAMPLES PP")
   field(FLNK, "FE14I-CS-ADC-02:SET_AVERAGE1")
}

record(ao, "FE14I-CS-ADC-02:SET_AVERAGE1")
{
   field(DOL,  "FE14I-CS-ADC-02:FREQ1.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-02:ADC1_AVERAGE PP")
}
# ethercat gadc.template
# % macro, DEVICE, EtherCAT slave
# % macro, CHANNEL, ADC channel
# % macro, PORT, asyn port for EtherCAT slave
# % macro, SAMPLES, number of samples in waveform
# % macro, SCAN, polling period
# % macro, MDEL, MDEL for VALUE and INTEGRAL fields
# % macro, INTSCAN, polling period for the INTERRUPT parameter
# % macro, name, name for gui element
# % gui, GT2, edm, AdcControl.edl, DEVICE=FE14I-CS-ADC-02,CHANNEL=2

# % gui, GT2, boyembed, ethercatApp_opi/gadc_embed_box.opi, DEVICE=FE14I-CS-ADC-02, CHANNEL=2, name=GT2
# % gui, GT2, boyembed, ethercatApp_opi/gadc_embed.opi, DEVICE=FE14I-CS-ADC-02, CHANNEL=2, name=GT2
# % gui, GT2, boydetail, ethercatApp_opi/gadc_detail.opi, DEVICE=FE14I-CS-ADC-02, CHANNEL=2, name=GT2

# <GUI tag>, <name>, <type>, <descr>, <PV>
# Where <type> is in <demand|readback|enum|statusbits|command|toggle>
# % gui, GT2, demand, Samples, FE14I-CS-ADC-02:ADC2_SAMPLES
# % gui, GT2, demand, Average, FE14I-CS-ADC-02:ADC2_AVERAGE
# % gui, GT2, readback, Value, FE14I-CS-ADC-02:ADC2_VALUE
# % gui, GT2, readback, Status, FE14I-CS-ADC-02:ADC2_STATE
# % gui, GT2, enum, Retrigger, FE14I-CS-ADC-02:ADC2_RETRIGGER
# % gui, GT2, enum, Enable, FE14I-CS-ADC-02:ADC2_ENABLED
# % gui, GT2, readback, Enabled, FE14I-CS-ADC-02:ADC2_ENABLED_R

record(longout, "FE14I-CS-ADC-02:ADC2_CHANBUFF")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)CHANBUFF")
   field(DOL,  "10000000")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-02:ADC2_INFO")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)INFO")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-02:ADC2_SAMPLES")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)SAMPLES")
}

record(longout, "FE14I-CS-ADC-02:ADC2_OFFSET")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)OFFSET")
}

record(mbbo, "FE14I-CS-ADC-02:ADC2_MODE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)MODE")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "CONTINUOUS")
   field(ONST, "TRIGGERED")
   field(TWST, "GATED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(busy, "FE14I-CS-ADC-02:ADC2_TRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)TRIGGER")
   field(ZNAM, "Done")
   field(ONAM, "Acquire")
   field(VAL,  "0")
}

record(longout, "FE14I-CS-ADC-02:ADC2_CAPTURE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)CAPTURE")
   field(DOL,  "1")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-02:ADC2_AVERAGE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)AVERAGE")
}

record(waveform, "FE14I-CS-ADC-02:ADC2_WAVEFORM")
{
    field(DTYP, "asynInt32ArrayIn")
    field(NELM, "100")
    field(SCAN, "I/O Intr")
    field(FTVL, "LONG")
    field(INP,  "@asyn(AI1_ADC2)WAVEFORM")
}

record(longin, "FE14I-CS-ADC-02:ADC2_BUFFERCOUNT")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC2)BUFFERCOUNT")
   field(SCAN, "1 second")
}

# % archiver 10 Monitor
record(longin, "FE14I-CS-ADC-02:ADC2_VALUE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC2)VALUE")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(ai, "FE14I-CS-ADC-02:ADC2_INTEGRAL")
{
   field(DTYP, "asynFloat64")
   field(INP,  "@asyn(AI1_ADC2)INTEGRAL")
   field(PREC, "3")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(mbbi, "FE14I-CS-ADC-02:ADC2_STATE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC2)STATE")
   field(SCAN, "I/O Intr")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "WAITING")
   field(ONST, "TRIGGERED")
   field(TWST, "DONE")

}

record(bi, "FE14I-CS-ADC-02:ADC2_ENABLED_R")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI1_ADC2)ENABLED")
   field(SCAN, "I/O Intr")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
}

record(bo, "FE14I-CS-ADC-02:ADC2_ENABLED")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)ENABLED")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(bo, "FE14I-CS-ADC-02:ADC2_RETRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)RETRIGGER")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "1")
}

record(longout, "FE14I-CS-ADC-02:ADC2_INTERRUPT")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI1_ADC2)INTERRUPT")
   field(SCAN, "I/O Intr")
}

record(longout, "FE14I-CS-ADC-02:ADC2_CLEAR")
{
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn(AI1_ADC2)CLEAR")
}

record(mbbo, "FE14I-CS-ADC-02:FREQ2")
{
   field(DTYP, "Raw Soft Channel")
   field(SCAN, "Passive")
   field(PINI, "YES")
   field(DOL, "0")
   field(ZRST, "200Hz")
   field(ONST, "100Hz")
   field(TWST, "50Hz")
   field(THST, "40Hz")
   field(FRST, "25Hz")
   field(FVST, "20Hz")
   field(SXST, "10Hz")
   field(SVST, "5Hz")
   field(EIST, "4Hz")
   field(NIST, "2Hz")
   field(TEST, "1Hz")
   field(ZRVL, "5")
   field(ONVL, "10")
   field(TWVL, "20")
   field(THVL, "25")
   field(FRVL, "40")
   field(FVVL, "50")
   field(SXVL, "100")
   field(SVVL, "200")
   field(EIVL, "250")
   field(NIVL, "500")
   field(TEVL, "1000")
   field(FLNK, "FE14I-CS-ADC-02:SET_SAMPLES2")
}

record(ao, "FE14I-CS-ADC-02:SET_SAMPLES2")
{
   field(DOL,  "FE14I-CS-ADC-02:FREQ2.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-02:ADC2_SAMPLES PP")
   field(FLNK, "FE14I-CS-ADC-02:SET_AVERAGE2")
}

record(ao, "FE14I-CS-ADC-02:SET_AVERAGE2")
{
   field(DOL,  "FE14I-CS-ADC-02:FREQ2.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-02:ADC2_AVERAGE PP")
}
# ethercat gadc.template
# % macro, DEVICE, EtherCAT slave
# % macro, CHANNEL, ADC channel
# % macro, PORT, asyn port for EtherCAT slave
# % macro, SAMPLES, number of samples in waveform
# % macro, SCAN, polling period
# % macro, MDEL, MDEL for VALUE and INTEGRAL fields
# % macro, INTSCAN, polling period for the INTERRUPT parameter
# % macro, name, name for gui element
# % gui, GT3, edm, AdcControl.edl, DEVICE=FE14I-CS-ADC-03,CHANNEL=1

# % gui, GT3, boyembed, ethercatApp_opi/gadc_embed_box.opi, DEVICE=FE14I-CS-ADC-03, CHANNEL=1, name=GT3
# % gui, GT3, boyembed, ethercatApp_opi/gadc_embed.opi, DEVICE=FE14I-CS-ADC-03, CHANNEL=1, name=GT3
# % gui, GT3, boydetail, ethercatApp_opi/gadc_detail.opi, DEVICE=FE14I-CS-ADC-03, CHANNEL=1, name=GT3

# <GUI tag>, <name>, <type>, <descr>, <PV>
# Where <type> is in <demand|readback|enum|statusbits|command|toggle>
# % gui, GT3, demand, Samples, FE14I-CS-ADC-03:ADC1_SAMPLES
# % gui, GT3, demand, Average, FE14I-CS-ADC-03:ADC1_AVERAGE
# % gui, GT3, readback, Value, FE14I-CS-ADC-03:ADC1_VALUE
# % gui, GT3, readback, Status, FE14I-CS-ADC-03:ADC1_STATE
# % gui, GT3, enum, Retrigger, FE14I-CS-ADC-03:ADC1_RETRIGGER
# % gui, GT3, enum, Enable, FE14I-CS-ADC-03:ADC1_ENABLED
# % gui, GT3, readback, Enabled, FE14I-CS-ADC-03:ADC1_ENABLED_R

record(longout, "FE14I-CS-ADC-03:ADC1_CHANBUFF")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)CHANBUFF")
   field(DOL,  "10000000")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-03:ADC1_INFO")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)INFO")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-03:ADC1_SAMPLES")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)SAMPLES")
}

record(longout, "FE14I-CS-ADC-03:ADC1_OFFSET")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)OFFSET")
}

record(mbbo, "FE14I-CS-ADC-03:ADC1_MODE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)MODE")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "CONTINUOUS")
   field(ONST, "TRIGGERED")
   field(TWST, "GATED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(busy, "FE14I-CS-ADC-03:ADC1_TRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)TRIGGER")
   field(ZNAM, "Done")
   field(ONAM, "Acquire")
   field(VAL,  "0")
}

record(longout, "FE14I-CS-ADC-03:ADC1_CAPTURE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)CAPTURE")
   field(DOL,  "1")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-03:ADC1_AVERAGE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)AVERAGE")
}

record(waveform, "FE14I-CS-ADC-03:ADC1_WAVEFORM")
{
    field(DTYP, "asynInt32ArrayIn")
    field(NELM, "100")
    field(SCAN, "I/O Intr")
    field(FTVL, "LONG")
    field(INP,  "@asyn(AI2_ADC1)WAVEFORM")
}

record(longin, "FE14I-CS-ADC-03:ADC1_BUFFERCOUNT")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC1)BUFFERCOUNT")
   field(SCAN, "1 second")
}

# % archiver 10 Monitor
record(longin, "FE14I-CS-ADC-03:ADC1_VALUE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC1)VALUE")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(ai, "FE14I-CS-ADC-03:ADC1_INTEGRAL")
{
   field(DTYP, "asynFloat64")
   field(INP,  "@asyn(AI2_ADC1)INTEGRAL")
   field(PREC, "3")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(mbbi, "FE14I-CS-ADC-03:ADC1_STATE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC1)STATE")
   field(SCAN, "I/O Intr")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "WAITING")
   field(ONST, "TRIGGERED")
   field(TWST, "DONE")

}

record(bi, "FE14I-CS-ADC-03:ADC1_ENABLED_R")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC1)ENABLED")
   field(SCAN, "I/O Intr")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
}

record(bo, "FE14I-CS-ADC-03:ADC1_ENABLED")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)ENABLED")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(bo, "FE14I-CS-ADC-03:ADC1_RETRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)RETRIGGER")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "1")
}

record(longout, "FE14I-CS-ADC-03:ADC1_INTERRUPT")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC1)INTERRUPT")
   field(SCAN, "I/O Intr")
}

record(longout, "FE14I-CS-ADC-03:ADC1_CLEAR")
{
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn(AI2_ADC1)CLEAR")
}

record(mbbo, "FE14I-CS-ADC-03:FREQ1")
{
   field(DTYP, "Raw Soft Channel")
   field(SCAN, "Passive")
   field(PINI, "YES")
   field(DOL, "0")
   field(ZRST, "200Hz")
   field(ONST, "100Hz")
   field(TWST, "50Hz")
   field(THST, "40Hz")
   field(FRST, "25Hz")
   field(FVST, "20Hz")
   field(SXST, "10Hz")
   field(SVST, "5Hz")
   field(EIST, "4Hz")
   field(NIST, "2Hz")
   field(TEST, "1Hz")
   field(ZRVL, "5")
   field(ONVL, "10")
   field(TWVL, "20")
   field(THVL, "25")
   field(FRVL, "40")
   field(FVVL, "50")
   field(SXVL, "100")
   field(SVVL, "200")
   field(EIVL, "250")
   field(NIVL, "500")
   field(TEVL, "1000")
   field(FLNK, "FE14I-CS-ADC-03:SET_SAMPLES1")
}

record(ao, "FE14I-CS-ADC-03:SET_SAMPLES1")
{
   field(DOL,  "FE14I-CS-ADC-03:FREQ1.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-03:ADC1_SAMPLES PP")
   field(FLNK, "FE14I-CS-ADC-03:SET_AVERAGE1")
}

record(ao, "FE14I-CS-ADC-03:SET_AVERAGE1")
{
   field(DOL,  "FE14I-CS-ADC-03:FREQ1.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-03:ADC1_AVERAGE PP")
}
# ethercat gadc.template
# % macro, DEVICE, EtherCAT slave
# % macro, CHANNEL, ADC channel
# % macro, PORT, asyn port for EtherCAT slave
# % macro, SAMPLES, number of samples in waveform
# % macro, SCAN, polling period
# % macro, MDEL, MDEL for VALUE and INTEGRAL fields
# % macro, INTSCAN, polling period for the INTERRUPT parameter
# % macro, name, name for gui element
# % gui, GT4, edm, AdcControl.edl, DEVICE=FE14I-CS-ADC-03,CHANNEL=2

# % gui, GT4, boyembed, ethercatApp_opi/gadc_embed_box.opi, DEVICE=FE14I-CS-ADC-03, CHANNEL=2, name=GT4
# % gui, GT4, boyembed, ethercatApp_opi/gadc_embed.opi, DEVICE=FE14I-CS-ADC-03, CHANNEL=2, name=GT4
# % gui, GT4, boydetail, ethercatApp_opi/gadc_detail.opi, DEVICE=FE14I-CS-ADC-03, CHANNEL=2, name=GT4

# <GUI tag>, <name>, <type>, <descr>, <PV>
# Where <type> is in <demand|readback|enum|statusbits|command|toggle>
# % gui, GT4, demand, Samples, FE14I-CS-ADC-03:ADC2_SAMPLES
# % gui, GT4, demand, Average, FE14I-CS-ADC-03:ADC2_AVERAGE
# % gui, GT4, readback, Value, FE14I-CS-ADC-03:ADC2_VALUE
# % gui, GT4, readback, Status, FE14I-CS-ADC-03:ADC2_STATE
# % gui, GT4, enum, Retrigger, FE14I-CS-ADC-03:ADC2_RETRIGGER
# % gui, GT4, enum, Enable, FE14I-CS-ADC-03:ADC2_ENABLED
# % gui, GT4, readback, Enabled, FE14I-CS-ADC-03:ADC2_ENABLED_R

record(longout, "FE14I-CS-ADC-03:ADC2_CHANBUFF")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)CHANBUFF")
   field(DOL,  "10000000")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-03:ADC2_INFO")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)INFO")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-03:ADC2_SAMPLES")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)SAMPLES")
}

record(longout, "FE14I-CS-ADC-03:ADC2_OFFSET")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)OFFSET")
}

record(mbbo, "FE14I-CS-ADC-03:ADC2_MODE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)MODE")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "CONTINUOUS")
   field(ONST, "TRIGGERED")
   field(TWST, "GATED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(busy, "FE14I-CS-ADC-03:ADC2_TRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)TRIGGER")
   field(ZNAM, "Done")
   field(ONAM, "Acquire")
   field(VAL,  "0")
}

record(longout, "FE14I-CS-ADC-03:ADC2_CAPTURE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)CAPTURE")
   field(DOL,  "1")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-03:ADC2_AVERAGE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)AVERAGE")
}

record(waveform, "FE14I-CS-ADC-03:ADC2_WAVEFORM")
{
    field(DTYP, "asynInt32ArrayIn")
    field(NELM, "100")
    field(SCAN, "I/O Intr")
    field(FTVL, "LONG")
    field(INP,  "@asyn(AI2_ADC2)WAVEFORM")
}

record(longin, "FE14I-CS-ADC-03:ADC2_BUFFERCOUNT")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC2)BUFFERCOUNT")
   field(SCAN, "1 second")
}

# % archiver 10 Monitor
record(longin, "FE14I-CS-ADC-03:ADC2_VALUE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC2)VALUE")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(ai, "FE14I-CS-ADC-03:ADC2_INTEGRAL")
{
   field(DTYP, "asynFloat64")
   field(INP,  "@asyn(AI2_ADC2)INTEGRAL")
   field(PREC, "3")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(mbbi, "FE14I-CS-ADC-03:ADC2_STATE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC2)STATE")
   field(SCAN, "I/O Intr")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "WAITING")
   field(ONST, "TRIGGERED")
   field(TWST, "DONE")

}

record(bi, "FE14I-CS-ADC-03:ADC2_ENABLED_R")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI2_ADC2)ENABLED")
   field(SCAN, "I/O Intr")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
}

record(bo, "FE14I-CS-ADC-03:ADC2_ENABLED")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)ENABLED")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(bo, "FE14I-CS-ADC-03:ADC2_RETRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)RETRIGGER")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "1")
}

record(longout, "FE14I-CS-ADC-03:ADC2_INTERRUPT")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI2_ADC2)INTERRUPT")
   field(SCAN, "I/O Intr")
}

record(longout, "FE14I-CS-ADC-03:ADC2_CLEAR")
{
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn(AI2_ADC2)CLEAR")
}

record(mbbo, "FE14I-CS-ADC-03:FREQ2")
{
   field(DTYP, "Raw Soft Channel")
   field(SCAN, "Passive")
   field(PINI, "YES")
   field(DOL, "0")
   field(ZRST, "200Hz")
   field(ONST, "100Hz")
   field(TWST, "50Hz")
   field(THST, "40Hz")
   field(FRST, "25Hz")
   field(FVST, "20Hz")
   field(SXST, "10Hz")
   field(SVST, "5Hz")
   field(EIST, "4Hz")
   field(NIST, "2Hz")
   field(TEST, "1Hz")
   field(ZRVL, "5")
   field(ONVL, "10")
   field(TWVL, "20")
   field(THVL, "25")
   field(FRVL, "40")
   field(FVVL, "50")
   field(SXVL, "100")
   field(SVVL, "200")
   field(EIVL, "250")
   field(NIVL, "500")
   field(TEVL, "1000")
   field(FLNK, "FE14I-CS-ADC-03:SET_SAMPLES2")
}

record(ao, "FE14I-CS-ADC-03:SET_SAMPLES2")
{
   field(DOL,  "FE14I-CS-ADC-03:FREQ2.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-03:ADC2_SAMPLES PP")
   field(FLNK, "FE14I-CS-ADC-03:SET_AVERAGE2")
}

record(ao, "FE14I-CS-ADC-03:SET_AVERAGE2")
{
   field(DOL,  "FE14I-CS-ADC-03:FREQ2.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-03:ADC2_AVERAGE PP")
}
# ethercat gadc.template
# % macro, DEVICE, EtherCAT slave
# % macro, CHANNEL, ADC channel
# % macro, PORT, asyn port for EtherCAT slave
# % macro, SAMPLES, number of samples in waveform
# % macro, SCAN, polling period
# % macro, MDEL, MDEL for VALUE and INTEGRAL fields
# % macro, INTSCAN, polling period for the INTERRUPT parameter
# % macro, name, name for gui element
# % gui, GT5, edm, AdcControl.edl, DEVICE=FE14I-CS-ADC-04,CHANNEL=1

# % gui, GT5, boyembed, ethercatApp_opi/gadc_embed_box.opi, DEVICE=FE14I-CS-ADC-04, CHANNEL=1, name=GT5
# % gui, GT5, boyembed, ethercatApp_opi/gadc_embed.opi, DEVICE=FE14I-CS-ADC-04, CHANNEL=1, name=GT5
# % gui, GT5, boydetail, ethercatApp_opi/gadc_detail.opi, DEVICE=FE14I-CS-ADC-04, CHANNEL=1, name=GT5

# <GUI tag>, <name>, <type>, <descr>, <PV>
# Where <type> is in <demand|readback|enum|statusbits|command|toggle>
# % gui, GT5, demand, Samples, FE14I-CS-ADC-04:ADC1_SAMPLES
# % gui, GT5, demand, Average, FE14I-CS-ADC-04:ADC1_AVERAGE
# % gui, GT5, readback, Value, FE14I-CS-ADC-04:ADC1_VALUE
# % gui, GT5, readback, Status, FE14I-CS-ADC-04:ADC1_STATE
# % gui, GT5, enum, Retrigger, FE14I-CS-ADC-04:ADC1_RETRIGGER
# % gui, GT5, enum, Enable, FE14I-CS-ADC-04:ADC1_ENABLED
# % gui, GT5, readback, Enabled, FE14I-CS-ADC-04:ADC1_ENABLED_R

record(longout, "FE14I-CS-ADC-04:ADC1_CHANBUFF")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)CHANBUFF")
   field(DOL,  "10000000")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-04:ADC1_INFO")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)INFO")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-04:ADC1_SAMPLES")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)SAMPLES")
}

record(longout, "FE14I-CS-ADC-04:ADC1_OFFSET")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)OFFSET")
}

record(mbbo, "FE14I-CS-ADC-04:ADC1_MODE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)MODE")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "CONTINUOUS")
   field(ONST, "TRIGGERED")
   field(TWST, "GATED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(busy, "FE14I-CS-ADC-04:ADC1_TRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)TRIGGER")
   field(ZNAM, "Done")
   field(ONAM, "Acquire")
   field(VAL,  "0")
}

record(longout, "FE14I-CS-ADC-04:ADC1_CAPTURE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)CAPTURE")
   field(DOL,  "1")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-04:ADC1_AVERAGE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)AVERAGE")
}

record(waveform, "FE14I-CS-ADC-04:ADC1_WAVEFORM")
{
    field(DTYP, "asynInt32ArrayIn")
    field(NELM, "100")
    field(SCAN, "I/O Intr")
    field(FTVL, "LONG")
    field(INP,  "@asyn(AI3_ADC1)WAVEFORM")
}

record(longin, "FE14I-CS-ADC-04:ADC1_BUFFERCOUNT")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC1)BUFFERCOUNT")
   field(SCAN, "1 second")
}

# % archiver 10 Monitor
record(longin, "FE14I-CS-ADC-04:ADC1_VALUE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC1)VALUE")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(ai, "FE14I-CS-ADC-04:ADC1_INTEGRAL")
{
   field(DTYP, "asynFloat64")
   field(INP,  "@asyn(AI3_ADC1)INTEGRAL")
   field(PREC, "3")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(mbbi, "FE14I-CS-ADC-04:ADC1_STATE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC1)STATE")
   field(SCAN, "I/O Intr")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "WAITING")
   field(ONST, "TRIGGERED")
   field(TWST, "DONE")

}

record(bi, "FE14I-CS-ADC-04:ADC1_ENABLED_R")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC1)ENABLED")
   field(SCAN, "I/O Intr")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
}

record(bo, "FE14I-CS-ADC-04:ADC1_ENABLED")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)ENABLED")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(bo, "FE14I-CS-ADC-04:ADC1_RETRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)RETRIGGER")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "1")
}

record(longout, "FE14I-CS-ADC-04:ADC1_INTERRUPT")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC1)INTERRUPT")
   field(SCAN, "I/O Intr")
}

record(longout, "FE14I-CS-ADC-04:ADC1_CLEAR")
{
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn(AI3_ADC1)CLEAR")
}

record(mbbo, "FE14I-CS-ADC-04:FREQ1")
{
   field(DTYP, "Raw Soft Channel")
   field(SCAN, "Passive")
   field(PINI, "YES")
   field(DOL, "0")
   field(ZRST, "200Hz")
   field(ONST, "100Hz")
   field(TWST, "50Hz")
   field(THST, "40Hz")
   field(FRST, "25Hz")
   field(FVST, "20Hz")
   field(SXST, "10Hz")
   field(SVST, "5Hz")
   field(EIST, "4Hz")
   field(NIST, "2Hz")
   field(TEST, "1Hz")
   field(ZRVL, "5")
   field(ONVL, "10")
   field(TWVL, "20")
   field(THVL, "25")
   field(FRVL, "40")
   field(FVVL, "50")
   field(SXVL, "100")
   field(SVVL, "200")
   field(EIVL, "250")
   field(NIVL, "500")
   field(TEVL, "1000")
   field(FLNK, "FE14I-CS-ADC-04:SET_SAMPLES1")
}

record(ao, "FE14I-CS-ADC-04:SET_SAMPLES1")
{
   field(DOL,  "FE14I-CS-ADC-04:FREQ1.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-04:ADC1_SAMPLES PP")
   field(FLNK, "FE14I-CS-ADC-04:SET_AVERAGE1")
}

record(ao, "FE14I-CS-ADC-04:SET_AVERAGE1")
{
   field(DOL,  "FE14I-CS-ADC-04:FREQ1.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-04:ADC1_AVERAGE PP")
}
# ethercat gadc.template
# % macro, DEVICE, EtherCAT slave
# % macro, CHANNEL, ADC channel
# % macro, PORT, asyn port for EtherCAT slave
# % macro, SAMPLES, number of samples in waveform
# % macro, SCAN, polling period
# % macro, MDEL, MDEL for VALUE and INTEGRAL fields
# % macro, INTSCAN, polling period for the INTERRUPT parameter
# % macro, name, name for gui element
# % gui, GT6, edm, AdcControl.edl, DEVICE=FE14I-CS-ADC-04,CHANNEL=2

# % gui, GT6, boyembed, ethercatApp_opi/gadc_embed_box.opi, DEVICE=FE14I-CS-ADC-04, CHANNEL=2, name=GT6
# % gui, GT6, boyembed, ethercatApp_opi/gadc_embed.opi, DEVICE=FE14I-CS-ADC-04, CHANNEL=2, name=GT6
# % gui, GT6, boydetail, ethercatApp_opi/gadc_detail.opi, DEVICE=FE14I-CS-ADC-04, CHANNEL=2, name=GT6

# <GUI tag>, <name>, <type>, <descr>, <PV>
# Where <type> is in <demand|readback|enum|statusbits|command|toggle>
# % gui, GT6, demand, Samples, FE14I-CS-ADC-04:ADC2_SAMPLES
# % gui, GT6, demand, Average, FE14I-CS-ADC-04:ADC2_AVERAGE
# % gui, GT6, readback, Value, FE14I-CS-ADC-04:ADC2_VALUE
# % gui, GT6, readback, Status, FE14I-CS-ADC-04:ADC2_STATE
# % gui, GT6, enum, Retrigger, FE14I-CS-ADC-04:ADC2_RETRIGGER
# % gui, GT6, enum, Enable, FE14I-CS-ADC-04:ADC2_ENABLED
# % gui, GT6, readback, Enabled, FE14I-CS-ADC-04:ADC2_ENABLED_R

record(longout, "FE14I-CS-ADC-04:ADC2_CHANBUFF")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)CHANBUFF")
   field(DOL,  "10000000")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-04:ADC2_INFO")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)INFO")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-04:ADC2_SAMPLES")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)SAMPLES")
}

record(longout, "FE14I-CS-ADC-04:ADC2_OFFSET")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)OFFSET")
}

record(mbbo, "FE14I-CS-ADC-04:ADC2_MODE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)MODE")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "CONTINUOUS")
   field(ONST, "TRIGGERED")
   field(TWST, "GATED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(busy, "FE14I-CS-ADC-04:ADC2_TRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)TRIGGER")
   field(ZNAM, "Done")
   field(ONAM, "Acquire")
   field(VAL,  "0")
}

record(longout, "FE14I-CS-ADC-04:ADC2_CAPTURE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)CAPTURE")
   field(DOL,  "1")
   field(PINI, "YES")
}

record(longout, "FE14I-CS-ADC-04:ADC2_AVERAGE")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)AVERAGE")
}

record(waveform, "FE14I-CS-ADC-04:ADC2_WAVEFORM")
{
    field(DTYP, "asynInt32ArrayIn")
    field(NELM, "100")
    field(SCAN, "I/O Intr")
    field(FTVL, "LONG")
    field(INP,  "@asyn(AI3_ADC2)WAVEFORM")
}

record(longin, "FE14I-CS-ADC-04:ADC2_BUFFERCOUNT")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC2)BUFFERCOUNT")
   field(SCAN, "1 second")
}

# % archiver 10 Monitor
record(longin, "FE14I-CS-ADC-04:ADC2_VALUE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC2)VALUE")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(ai, "FE14I-CS-ADC-04:ADC2_INTEGRAL")
{
   field(DTYP, "asynFloat64")
   field(INP,  "@asyn(AI3_ADC2)INTEGRAL")
   field(PREC, "3")
   field(SCAN, "I/O Intr")
   field(MDEL, "-1")
}

record(mbbi, "FE14I-CS-ADC-04:ADC2_STATE")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC2)STATE")
   field(SCAN, "I/O Intr")
   field(ZRVL, "0")
   field(ONVL, "1")
   field(TWVL, "2")
   field(ZRST, "WAITING")
   field(ONST, "TRIGGERED")
   field(TWST, "DONE")

}

record(bi, "FE14I-CS-ADC-04:ADC2_ENABLED_R")
{
   field(DTYP, "asynInt32")
   field(INP,  "@asyn(AI3_ADC2)ENABLED")
   field(SCAN, "I/O Intr")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
}

record(bo, "FE14I-CS-ADC-04:ADC2_ENABLED")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)ENABLED")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "0")
}

record(bo, "FE14I-CS-ADC-04:ADC2_RETRIGGER")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)RETRIGGER")
   field(ZNAM, "DISABLED")
   field(ONAM, "ENABLED")
   field(PINI, "YES")
   field(VAL,  "1")
}

record(longout, "FE14I-CS-ADC-04:ADC2_INTERRUPT")
{
   field(DTYP, "asynInt32")
   field(OUT,  "@asyn(AI3_ADC2)INTERRUPT")
   field(SCAN, "I/O Intr")
}

record(longout, "FE14I-CS-ADC-04:ADC2_CLEAR")
{
    field(DTYP, "asynInt32")
    field(OUT,  "@asyn(AI3_ADC2)CLEAR")
}

record(mbbo, "FE14I-CS-ADC-04:FREQ2")
{
   field(DTYP, "Raw Soft Channel")
   field(SCAN, "Passive")
   field(PINI, "YES")
   field(DOL, "0")
   field(ZRST, "200Hz")
   field(ONST, "100Hz")
   field(TWST, "50Hz")
   field(THST, "40Hz")
   field(FRST, "25Hz")
   field(FVST, "20Hz")
   field(SXST, "10Hz")
   field(SVST, "5Hz")
   field(EIST, "4Hz")
   field(NIST, "2Hz")
   field(TEST, "1Hz")
   field(ZRVL, "5")
   field(ONVL, "10")
   field(TWVL, "20")
   field(THVL, "25")
   field(FRVL, "40")
   field(FVVL, "50")
   field(SXVL, "100")
   field(SVVL, "200")
   field(EIVL, "250")
   field(NIVL, "500")
   field(TEVL, "1000")
   field(FLNK, "FE14I-CS-ADC-04:SET_SAMPLES2")
}

record(ao, "FE14I-CS-ADC-04:SET_SAMPLES2")
{
   field(DOL,  "FE14I-CS-ADC-04:FREQ2.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-04:ADC2_SAMPLES PP")
   field(FLNK, "FE14I-CS-ADC-04:SET_AVERAGE2")
}

record(ao, "FE14I-CS-ADC-04:SET_AVERAGE2")
{
   field(DOL,  "FE14I-CS-ADC-04:FREQ2.RVAL")
   field(OMSL, "closed_loop")
   field(OUT,  "FE14I-CS-ADC-04:ADC2_AVERAGE PP")
}
# space_b.template
#%, macro, __doc__, Template database for a vacuum space 
# Consists of just 1 pump, 1 gauge and 1 valve (or more likely groups of these)
# Pete Owens - 10/6/05
#
# Modified for mks937b
# Jonathan Thompson November 2010
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, ionp, ion pump
#% macro, gauge, combination gauge
#% macro, img, IMG
#% macro, pirg, Pirani gauge
#% macro, valve, Vacuum valve
# Note: The following relay numbers are mapped to the IMG or PIRG device number, not the absolute controller relay number.  
#% macro, valveIlRelay   , Valve interlock IMG relay
#% macro, mpsIlRelay1    , Machine protection system interlock IMG relay
#% macro, mpsIlRelay2    , Machine protection system interlock IMG relay
#% macro, rgaIlRelay     , RGA interlock IMG relay
#% macro, ionPumpIlRelay , Ion pump interlock PIRG relay
################################################################################



# This associates an edm screen with the template
# % gui, , edm, space_b.edl, device=FE14I-VA-SPACE-01


# This associates a BOY screen with the template
# % gui, , boydetail, vacuumSpaceApp_opi/space_detail_b.opi, device=FE14I-VA-SPACE-01, desc=FE14I-VA-SPACE-01, name=
# % gui, , boyembed, vacuumSpaceApp_opi/space_embed_box_b.opi, device=FE14I-VA-SPACE-01, desc=FE14I-VA-SPACE-01, name=
# % gui, , boyembed, vacuumSpaceApp_opi/space_embed_b.opi, device=FE14I-VA-SPACE-01, desc=FE14I-VA-SPACE-01, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, CTL SP Interlock,   FE14I-VA-SPACE-01:CTL:SP, =pv("FE14I-VA-SPACE-01:CTL:SP.DESC")
# % gui, , readback, PRO Interlock,  FE14I-VA-SPACE-01:PRO:SP, =pv("FE14I-VA-SPACE-01:PRO:SP.DESC")
# % gui, , readback, RLY Interlock,  FE14I-VA-SPACE-01:RLY:SP, =pv("FE14I-VA-SPACE-01:RLY:SP.DESC")
# % gui, , readback, RLA Interlock,  FE14I-VA-SPACE-01:RLA:SP, =pv("FE14I-VA-SPACE-01:RLA:SP.DESC")
# % gui, , readback, RGA RLY Interlock,  FE14I-VA-SPACE-01:RGARLY:SP, =pv("FE14I-VA-SPACE-01:RGARLY:SP.DESC")
# % gui, , readback, Fast Valve RLY Interlock,  FE14I-VA-SPACE-01:FVALVRLY:SP, =pv("FE14I-VA-SPACE-01:FVALVRLY:SP.DESC")
# % gui, , readback, RLB Interlock,  FE14I-VA-SPACE-01:RLB:SP, =pv("FE14I-VA-SPACE-01:RLB:SP.DESC")
# % gui, , statusbits, Status,  FE14I-VA-SPACE-01:STA.VAL, IMGs, Pumps, Valves, Pressure
# % gui, , demand, Set CTL SP Interlock,   FE14I-VA-SPACE-01:CTL:SETSP, =pv("FE14I-VA-SPACE-01:CTL:SETSP.DESC")
# % gui, , enum, IMG Enable Ctrl, FE14I-VA-SPACE-01:CTL:ENABLE, concat(=pv("FE14I-VA-SPACE-01:CTL:SETSP.DESC"), " Ctrl")
# % gui, , demand, Set PRO Interlock,  FE14I-VA-SPACE-01:PRO:SETSP, =pv("FE14I-VA-SPACE-01:PRO:SP.DESC")
# % gui, , demand, Set RLY Interlock,  FE14I-VA-SPACE-01:RLY:SETSP, =pv("FE14I-VA-SPACE-01:RLY:SP.DESC")
# % gui, , demand, Set RLA Interlock,  FE14I-VA-SPACE-01:RLA:SETSP, =pv("FE14I-VA-SPACE-01:RLA:SP.DESC")
# % gui, , demand, Set RGA RLY Interlock,  FE14I-VA-SPACE-01:RGARLY:SETSP, =pv("FE14I-VA-SPACE-01:RGARLY:SP.DESC")
# % gui, , demand, Set Fast Valve RLY Interlock,  FE14I-VA-SPACE-01:FVALVRLY:SETSP, =pv("FE14I-VA-SPACE-01:FVALVRLY:SP.DESC")
# % gui, , demand, Set RLB Interlock,  FE14I-VA-SPACE-01:RLB:SETSP, =pv("FE14I-VA-SPACE-01:RLB:SETSP.DESC")

# Pressure (maximum value from all spaces)
#
#% archiver 1 Monitor
#
record(ai, "FE14I-VA-SPACE-01:PLOG")
{
    field(DESC, "log Pressure")
    field(SCAN, "1 second")
    field(EGU,  "log")
    field(INP,  "FE14I-VA-GAUGE-91:PLOG")
    field(HOPR, "3")
    field(LOPR, "-11")
    field(HIGH, "-7")
    field(HSV,  "MINOR")
    field(ADEL, "0.025")
}
#
#% archiver 10
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-SPACE-01:P")
{
    field(DESC, "Pressure")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-GAUGE-91:P")
    field(HIGH, "1.0e-7")
    field(HSV,  "MINOR")
}
################################################################################
# Status
# B0 Gauge not OK
# B1 Ion Pump not swiched on
# B2 Valve not open
# B3 Pressure
#
#% archiver 10 Monitor
#% controldesk Status smon
#
record(mbbiDirect,"FE14I-VA-SPACE-01:STA") 
{
    field(DESC,"Status")
    field(SCAN,"1 second")
    field(INP, "FE14I-VA-SPACE-01:CALSTA PP MS")
}
record(calc, "FE14I-VA-SPACE-01:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A|B|C|D")
    field(INPA, "FE14I-VA-SPACE-01:IMGSTA PP MS")
    field(INPB, "FE14I-VA-SPACE-01:IONPSTA PP MS")
    field(INPC, "FE14I-VA-SPACE-01:VALVESTA PP MS")
    field(INPD, "FE14I-VA-SPACE-01:PSTA PP MS")
}
record(calc, "FE14I-VA-SPACE-01:IMGSTA")
{
    field(DESC, "IMGs Status")
    field(CALC, "(A<2||A=8)?0:1")
    field(INPA, "FE14I-VA-IMG-91:STA")
    field(HIGH, "1.5")
    field(HSV,  "MINOR")
#    field(INPA, "FE14I-VA-IMG-91:STA MS")
#    field(HIHI, "1.5")
#    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-01:IONPSTA")
{
    field(DESC, "Pumps Status")
    field(CALC, "(A=4)?0:2")
    field(INPA, "FE14I-VA-IONP-91:STA")
    field(HIGH, "0.5")
    field(HSV,  "MINOR")
#    field(INPA, "FE14I-VA-IONP-91:STA MS")
#    field(HIHI, "0.5")
#    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-01:VALVESTA")
{
    field(DESC, "Valves Status")
    field(CALC, "(A=1)?0:4")
    field(INPA, "FE14I-VA-VALVE-01:STA MS")
    field(HIHI, "3.5")
    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-01:PSTA")
{
    field(DESC, "Pressure Status")
    field(CALC, "(A<B)?0:8")
    field(INPA, "FE14I-VA-SPACE-01:P MS")
    field(INPB, "1.0e-7")
    field(HIGH, "7.5")
    field(HSV,  "MINOR")
}
#################################################################################
# Control Pumps
#
#% controldesk Pumps scon
#
record(bo,"FE14I-VA-SPACE-01:START") 
{
    field(DESC, "Control Pumps")
    field(OUT,  "FE14I-VA-IONP-91:START PP")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
#
#% controldesk Pumps smon
#
record(bi,"FE14I-VA-SPACE-01:STARTING")
{
    field(DESC, "Starting Pumps")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-IONP-91:STARTING")
    field(ZNAM, "")
    field(ONAM, "Starting")
}
#################################################################################
# Control Valves
#
#% controldesk Valves scon
#
record(mbbo,"FE14I-VA-SPACE-01:CON") 
{
    field(DESC, "Control Valves")
    field(OUT,  "FE14I-VA-VALVE-01:CON PP")
    field(ZRST, "Open")
    field(ONST, "Close")
    field(TWST, "Reset")
}
#
#% controldesk Valves smon
#
record(bi,"FE14I-VA-SPACE-01:OPENING")
{
    field(DESC, "Opening Valves")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-VALVE-01:OPENING")
    field(ZNAM, "")
    field(ONAM, "Opening")
}
#################################################################################
# Cold Cathode Enable
#
#% controldesk Gauges scon
#
record(bo, "FE14I-VA-SPACE-01:CCHV")
{
    field(DESC, "Cold Cathode Enable")
    field(OUT,  "FE14I-VA-IMG-91:CCHV PP")
    field(ZNAM, "Off")
    field(ONAM, "On")
}
#
#% controldesk Gauges smon
#
record(bi,"FE14I-VA-SPACE-01:SWITCHING")
{
    field(DESC, "Switching")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-IMG-91:SWITCHING")
    field(ZNAM, "")
    field(ONAM, "Switching")
}
#################################################################################
# PIRG Control Interlocks - IMG Enable
#
record(ao, "FE14I-VA-SPACE-01:CTL:SETSP")
{
    field(DESC, "IMG Enable")
    field(OUT,  "FE14I-VA-PIRG-91:CTL:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(mbbo, "FE14I-VA-SPACE-01:CTL:ENABLE")
{
    field(DESC, "Enable Control Setpoint")
    field(OUT,  "FE14I-VA-PIRG-91:CTL:ENABLE PP")
    field(ZRST, "Force On")
    field(ONST, "I/L Safe")
    field(TWST, "I/L Operating")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL , "1")
    field(PINI, "YES")
}
record(ai, "FE14I-VA-SPACE-01:CTL:SP")
{
    field(DESC, "IMG Enable")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-PIRG-91:CTL:SP MS")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
}
#################################################################################
# IMG Protection Interlocks - IMG Overpressure
#
record(ao, "FE14I-VA-SPACE-01:PRO:OUTSP")
{
    field(DESC, "IMG Overpressure")
    field(OUT,  "FE14I-VA-IMG-91:PRO:OUTSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
    field(DRVH, "1.0e-2")
    field(DRVL, "1.3e-5")
    field(DOL , "5.0e-4")
}
#record(mbbo, "FE14I-VA-SPACE-01:PRO:ENABLE")
#{
#    field(DESC, "Enable Protection Setpoint")
#    field(OUT,  "FE14I-VA-IMG-91:PRO:ENABLE PP")
#    field(ZRST, "Force On I/L")
#    field(ONST, "I/L Operating")
#    field(ZRVL, "1")
#    field(ONVL, "2")
#    field(ZRSV, "MAJOR")
#    field(ONSV, "NO_ALARM")
#    field(DOL , "1")
#    field(PINI, "YES")
#}
record(ai, "FE14I-VA-SPACE-01:PRO:SP")
{
    field(DESC, "IMG Overpressure")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-91:PRO:SP MS")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
#################################################################################
# IMG Relay Interlocks - Valve Interlock
#
record(ao, "FE14I-VA-SPACE-01:RLY:SETSP")
{
    field(DESC, "Valve I/L")
    field(OUT,  "FE14I-VA-IMG-91:RLY1:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-6")
}
record(ai, "FE14I-VA-SPACE-01:RLY:SP")
{
    field(DESC, "Valve I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-91:RLY1:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# IMG Relay 2 (Channel A) Interlocks - MPS Interlock 1
#
record(ao, "FE14I-VA-SPACE-01:RLA:SETSP")
{
    field(DESC, "MPS Interlock 1")
    field(OUT,  "FE14I-VA-IMG-91:RLY2:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(ai, "FE14I-VA-SPACE-01:RLA:SP")
{
    field(DESC, "MPS Interlock 1")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-91:RLY2:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# IMG Relay 3 (Channel A) Interlocks - MPS Interlock 2
#
record(ao, "FE14I-VA-SPACE-01:RLA2:SETSP")
{
    field(DESC, "MPS Interlock 2")
    field(OUT,  "FE14I-VA-IMG-91:RLY3:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(ai, "FE14I-VA-SPACE-01:RLA2:SP")
{
    field(DESC, "MPS Interlock 2")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-91:RLY3:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# Pirani Gauge  Relay Interlocks - Ion Pump Interlock
#
record(ao, "FE14I-VA-SPACE-01:RLB:SETSP")
{
    field(DESC, "Ion Pump I/L")
    field(OUT,  "FE14I-VA-PIRG-91:RLY1:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
    field(DRVH, "1.2e2")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(ai, "FE14I-VA-SPACE-01:RLB:SP")
{
    field(DESC, "Ion Pump I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
}
#################################################################################

#################################################################################
# IMG Relay Interlocks - RGA Interlock
#
record(ao, "FE14I-VA-SPACE-01:RGARLY:SETSP")
{
    field(DESC, "RGA I/L")
    field(OUT,  "FE14I-VA-IMG-91:RLY4:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-4")
}
record(ai, "FE14I-VA-SPACE-01:RGARLY:SP")
{
    field(DESC, "RGA I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-91:RLY4:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}

#################################################################################
# IMG Relay Interlocks - Fast Valve Interlock
#
record(ao, "FE14I-VA-SPACE-01:FVALVRLY:SETSP")
{
    field(DESC, "Fast Valve I/L")
    field(OUT,  "FE14I-VA-IMG-91:FRLY:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-5")
}
record(ai, "FE14I-VA-SPACE-01:FVALVRLY:SP")
{
    field(DESC, "Fast Valve I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-91:FRLY:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
# space_b.template
#%, macro, __doc__, Template database for a vacuum space 
# Consists of just 1 pump, 1 gauge and 1 valve (or more likely groups of these)
# Pete Owens - 10/6/05
#
# Modified for mks937b
# Jonathan Thompson November 2010
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, ionp, ion pump
#% macro, gauge, combination gauge
#% macro, img, IMG
#% macro, pirg, Pirani gauge
#% macro, valve, Vacuum valve
# Note: The following relay numbers are mapped to the IMG or PIRG device number, not the absolute controller relay number.  
#% macro, valveIlRelay   , Valve interlock IMG relay
#% macro, mpsIlRelay1    , Machine protection system interlock IMG relay
#% macro, mpsIlRelay2    , Machine protection system interlock IMG relay
#% macro, rgaIlRelay     , RGA interlock IMG relay
#% macro, ionPumpIlRelay , Ion pump interlock PIRG relay
################################################################################



# This associates an edm screen with the template
# % gui, , edm, space_b.edl, device=FE14I-VA-SPACE-02


# This associates a BOY screen with the template
# % gui, , boydetail, vacuumSpaceApp_opi/space_detail_b.opi, device=FE14I-VA-SPACE-02, desc=FE14I-VA-SPACE-02, name=
# % gui, , boyembed, vacuumSpaceApp_opi/space_embed_box_b.opi, device=FE14I-VA-SPACE-02, desc=FE14I-VA-SPACE-02, name=
# % gui, , boyembed, vacuumSpaceApp_opi/space_embed_b.opi, device=FE14I-VA-SPACE-02, desc=FE14I-VA-SPACE-02, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, CTL SP Interlock,   FE14I-VA-SPACE-02:CTL:SP, =pv("FE14I-VA-SPACE-02:CTL:SP.DESC")
# % gui, , readback, PRO Interlock,  FE14I-VA-SPACE-02:PRO:SP, =pv("FE14I-VA-SPACE-02:PRO:SP.DESC")
# % gui, , readback, RLY Interlock,  FE14I-VA-SPACE-02:RLY:SP, =pv("FE14I-VA-SPACE-02:RLY:SP.DESC")
# % gui, , readback, RLA Interlock,  FE14I-VA-SPACE-02:RLA:SP, =pv("FE14I-VA-SPACE-02:RLA:SP.DESC")
# % gui, , readback, RGA RLY Interlock,  FE14I-VA-SPACE-02:RGARLY:SP, =pv("FE14I-VA-SPACE-02:RGARLY:SP.DESC")
# % gui, , readback, Fast Valve RLY Interlock,  FE14I-VA-SPACE-02:FVALVRLY:SP, =pv("FE14I-VA-SPACE-02:FVALVRLY:SP.DESC")
# % gui, , readback, RLB Interlock,  FE14I-VA-SPACE-02:RLB:SP, =pv("FE14I-VA-SPACE-02:RLB:SP.DESC")
# % gui, , statusbits, Status,  FE14I-VA-SPACE-02:STA.VAL, IMGs, Pumps, Valves, Pressure
# % gui, , demand, Set CTL SP Interlock,   FE14I-VA-SPACE-02:CTL:SETSP, =pv("FE14I-VA-SPACE-02:CTL:SETSP.DESC")
# % gui, , enum, IMG Enable Ctrl, FE14I-VA-SPACE-02:CTL:ENABLE, concat(=pv("FE14I-VA-SPACE-02:CTL:SETSP.DESC"), " Ctrl")
# % gui, , demand, Set PRO Interlock,  FE14I-VA-SPACE-02:PRO:SETSP, =pv("FE14I-VA-SPACE-02:PRO:SP.DESC")
# % gui, , demand, Set RLY Interlock,  FE14I-VA-SPACE-02:RLY:SETSP, =pv("FE14I-VA-SPACE-02:RLY:SP.DESC")
# % gui, , demand, Set RLA Interlock,  FE14I-VA-SPACE-02:RLA:SETSP, =pv("FE14I-VA-SPACE-02:RLA:SP.DESC")
# % gui, , demand, Set RGA RLY Interlock,  FE14I-VA-SPACE-02:RGARLY:SETSP, =pv("FE14I-VA-SPACE-02:RGARLY:SP.DESC")
# % gui, , demand, Set Fast Valve RLY Interlock,  FE14I-VA-SPACE-02:FVALVRLY:SETSP, =pv("FE14I-VA-SPACE-02:FVALVRLY:SP.DESC")
# % gui, , demand, Set RLB Interlock,  FE14I-VA-SPACE-02:RLB:SETSP, =pv("FE14I-VA-SPACE-02:RLB:SETSP.DESC")

# Pressure (maximum value from all spaces)
#
#% archiver 1 Monitor
#
record(ai, "FE14I-VA-SPACE-02:PLOG")
{
    field(DESC, "log Pressure")
    field(SCAN, "1 second")
    field(EGU,  "log")
    field(INP,  "FE14I-VA-GAUGE-92:PLOG")
    field(HOPR, "3")
    field(LOPR, "-11")
    field(HIGH, "-7")
    field(HSV,  "MINOR")
    field(ADEL, "0.025")
}
#
#% archiver 10
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-SPACE-02:P")
{
    field(DESC, "Pressure")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-GAUGE-92:P")
    field(HIGH, "1.0e-7")
    field(HSV,  "MINOR")
}
################################################################################
# Status
# B0 Gauge not OK
# B1 Ion Pump not swiched on
# B2 Valve not open
# B3 Pressure
#
#% archiver 10 Monitor
#% controldesk Status smon
#
record(mbbiDirect,"FE14I-VA-SPACE-02:STA") 
{
    field(DESC,"Status")
    field(SCAN,"1 second")
    field(INP, "FE14I-VA-SPACE-02:CALSTA PP MS")
}
record(calc, "FE14I-VA-SPACE-02:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A|B|C|D")
    field(INPA, "FE14I-VA-SPACE-02:IMGSTA PP MS")
    field(INPB, "FE14I-VA-SPACE-02:IONPSTA PP MS")
    field(INPC, "FE14I-VA-SPACE-02:VALVESTA PP MS")
    field(INPD, "FE14I-VA-SPACE-02:PSTA PP MS")
}
record(calc, "FE14I-VA-SPACE-02:IMGSTA")
{
    field(DESC, "IMGs Status")
    field(CALC, "(A<2||A=8)?0:1")
    field(INPA, "FE14I-VA-IMG-92:STA")
    field(HIGH, "1.5")
    field(HSV,  "MINOR")
#    field(INPA, "FE14I-VA-IMG-92:STA MS")
#    field(HIHI, "1.5")
#    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-02:IONPSTA")
{
    field(DESC, "Pumps Status")
    field(CALC, "(A=4)?0:2")
    field(INPA, "FE14I-VA-IONP-93:STA")
    field(HIGH, "0.5")
    field(HSV,  "MINOR")
#    field(INPA, "FE14I-VA-IONP-93:STA MS")
#    field(HIHI, "0.5")
#    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-02:VALVESTA")
{
    field(DESC, "Valves Status")
    field(CALC, "(A=1)?0:4")
    field(INPA, "FE14I-VA-VALVE-02:STA MS")
    field(HIHI, "3.5")
    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-02:PSTA")
{
    field(DESC, "Pressure Status")
    field(CALC, "(A<B)?0:8")
    field(INPA, "FE14I-VA-SPACE-02:P MS")
    field(INPB, "1.0e-7")
    field(HIGH, "7.5")
    field(HSV,  "MINOR")
}
#################################################################################
# Control Pumps
#
#% controldesk Pumps scon
#
record(bo,"FE14I-VA-SPACE-02:START") 
{
    field(DESC, "Control Pumps")
    field(OUT,  "FE14I-VA-IONP-93:START PP")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
#
#% controldesk Pumps smon
#
record(bi,"FE14I-VA-SPACE-02:STARTING")
{
    field(DESC, "Starting Pumps")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-IONP-93:STARTING")
    field(ZNAM, "")
    field(ONAM, "Starting")
}
#################################################################################
# Control Valves
#
#% controldesk Valves scon
#
record(mbbo,"FE14I-VA-SPACE-02:CON") 
{
    field(DESC, "Control Valves")
    field(OUT,  "FE14I-VA-VALVE-02:CON PP")
    field(ZRST, "Open")
    field(ONST, "Close")
    field(TWST, "Reset")
}
#
#% controldesk Valves smon
#
record(bi,"FE14I-VA-SPACE-02:OPENING")
{
    field(DESC, "Opening Valves")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-VALVE-02:OPENING")
    field(ZNAM, "")
    field(ONAM, "Opening")
}
#################################################################################
# Cold Cathode Enable
#
#% controldesk Gauges scon
#
record(bo, "FE14I-VA-SPACE-02:CCHV")
{
    field(DESC, "Cold Cathode Enable")
    field(OUT,  "FE14I-VA-IMG-92:CCHV PP")
    field(ZNAM, "Off")
    field(ONAM, "On")
}
#
#% controldesk Gauges smon
#
record(bi,"FE14I-VA-SPACE-02:SWITCHING")
{
    field(DESC, "Switching")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-IMG-92:SWITCHING")
    field(ZNAM, "")
    field(ONAM, "Switching")
}
#################################################################################
# PIRG Control Interlocks - IMG Enable
#
record(ao, "FE14I-VA-SPACE-02:CTL:SETSP")
{
    field(DESC, "IMG Enable")
    field(OUT,  "FE14I-VA-PIRG-92:CTL:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(mbbo, "FE14I-VA-SPACE-02:CTL:ENABLE")
{
    field(DESC, "Enable Control Setpoint")
    field(OUT,  "FE14I-VA-PIRG-92:CTL:ENABLE PP")
    field(ZRST, "Force On")
    field(ONST, "I/L Safe")
    field(TWST, "I/L Operating")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL , "1")
    field(PINI, "YES")
}
record(ai, "FE14I-VA-SPACE-02:CTL:SP")
{
    field(DESC, "IMG Enable")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-PIRG-92:CTL:SP MS")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
}
#################################################################################
# IMG Protection Interlocks - IMG Overpressure
#
record(ao, "FE14I-VA-SPACE-02:PRO:OUTSP")
{
    field(DESC, "IMG Overpressure")
    field(OUT,  "FE14I-VA-IMG-92:PRO:OUTSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
    field(DRVH, "1.0e-2")
    field(DRVL, "1.3e-5")
    field(DOL , "5.0e-4")
}
#record(mbbo, "FE14I-VA-SPACE-02:PRO:ENABLE")
#{
#    field(DESC, "Enable Protection Setpoint")
#    field(OUT,  "FE14I-VA-IMG-92:PRO:ENABLE PP")
#    field(ZRST, "Force On I/L")
#    field(ONST, "I/L Operating")
#    field(ZRVL, "1")
#    field(ONVL, "2")
#    field(ZRSV, "MAJOR")
#    field(ONSV, "NO_ALARM")
#    field(DOL , "1")
#    field(PINI, "YES")
#}
record(ai, "FE14I-VA-SPACE-02:PRO:SP")
{
    field(DESC, "IMG Overpressure")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-92:PRO:SP MS")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
#################################################################################
# IMG Relay Interlocks - Valve Interlock
#
record(ao, "FE14I-VA-SPACE-02:RLY:SETSP")
{
    field(DESC, "Valve I/L")
    field(OUT,  "FE14I-VA-IMG-92:RLY1:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-6")
}
record(ai, "FE14I-VA-SPACE-02:RLY:SP")
{
    field(DESC, "Valve I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-92:RLY1:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# IMG Relay 2 (Channel A) Interlocks - MPS Interlock 1
#
record(ao, "FE14I-VA-SPACE-02:RLA:SETSP")
{
    field(DESC, "MPS Interlock 1")
    field(OUT,  "FE14I-VA-IMG-92:RLY2:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(ai, "FE14I-VA-SPACE-02:RLA:SP")
{
    field(DESC, "MPS Interlock 1")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-92:RLY2:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# IMG Relay 3 (Channel A) Interlocks - MPS Interlock 2
#
record(ao, "FE14I-VA-SPACE-02:RLA2:SETSP")
{
    field(DESC, "MPS Interlock 2")
    field(OUT,  "FE14I-VA-IMG-92:RLY3:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(ai, "FE14I-VA-SPACE-02:RLA2:SP")
{
    field(DESC, "MPS Interlock 2")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-92:RLY3:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# Pirani Gauge  Relay Interlocks - Ion Pump Interlock
#
record(ao, "FE14I-VA-SPACE-02:RLB:SETSP")
{
    field(DESC, "Ion Pump I/L")
    field(OUT,  "FE14I-VA-PIRG-92:RLY1:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
    field(DRVH, "1.2e2")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(ai, "FE14I-VA-SPACE-02:RLB:SP")
{
    field(DESC, "Ion Pump I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-PIRG-92:RLY1:SP MS")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
}
#################################################################################

#################################################################################
# IMG Relay Interlocks - RGA Interlock
#
record(ao, "FE14I-VA-SPACE-02:RGARLY:SETSP")
{
    field(DESC, "RGA I/L")
    field(OUT,  "FE14I-VA-IMG-92:RLY4:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-4")
}
record(ai, "FE14I-VA-SPACE-02:RGARLY:SP")
{
    field(DESC, "RGA I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-92:RLY4:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}

#################################################################################
# IMG Relay Interlocks - Fast Valve Interlock
#
record(ao, "FE14I-VA-SPACE-02:FVALVRLY:SETSP")
{
    field(DESC, "Fast Valve I/L")
    field(OUT,  "FE14I-VA-IMG-92:FRLY:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-5")
}
record(ai, "FE14I-VA-SPACE-02:FVALVRLY:SP")
{
    field(DESC, "Fast Valve I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-92:FRLY:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
# space_b.template
#%, macro, __doc__, Template database for a vacuum space 
# Consists of just 1 pump, 1 gauge and 1 valve (or more likely groups of these)
# Pete Owens - 10/6/05
#
# Modified for mks937b
# Jonathan Thompson November 2010
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, ionp, ion pump
#% macro, gauge, combination gauge
#% macro, img, IMG
#% macro, pirg, Pirani gauge
#% macro, valve, Vacuum valve
# Note: The following relay numbers are mapped to the IMG or PIRG device number, not the absolute controller relay number.  
#% macro, valveIlRelay   , Valve interlock IMG relay
#% macro, mpsIlRelay1    , Machine protection system interlock IMG relay
#% macro, mpsIlRelay2    , Machine protection system interlock IMG relay
#% macro, rgaIlRelay     , RGA interlock IMG relay
#% macro, ionPumpIlRelay , Ion pump interlock PIRG relay
################################################################################



# This associates an edm screen with the template
# % gui, , edm, space_b.edl, device=FE14I-VA-SPACE-99


# This associates a BOY screen with the template
# % gui, , boydetail, vacuumSpaceApp_opi/space_detail_b.opi, device=FE14I-VA-SPACE-99, desc=FE14I-VA-SPACE-99, name=
# % gui, , boyembed, vacuumSpaceApp_opi/space_embed_box_b.opi, device=FE14I-VA-SPACE-99, desc=FE14I-VA-SPACE-99, name=
# % gui, , boyembed, vacuumSpaceApp_opi/space_embed_b.opi, device=FE14I-VA-SPACE-99, desc=FE14I-VA-SPACE-99, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, CTL SP Interlock,   FE14I-VA-SPACE-99:CTL:SP, =pv("FE14I-VA-SPACE-99:CTL:SP.DESC")
# % gui, , readback, PRO Interlock,  FE14I-VA-SPACE-99:PRO:SP, =pv("FE14I-VA-SPACE-99:PRO:SP.DESC")
# % gui, , readback, RLY Interlock,  FE14I-VA-SPACE-99:RLY:SP, =pv("FE14I-VA-SPACE-99:RLY:SP.DESC")
# % gui, , readback, RLA Interlock,  FE14I-VA-SPACE-99:RLA:SP, =pv("FE14I-VA-SPACE-99:RLA:SP.DESC")
# % gui, , readback, RGA RLY Interlock,  FE14I-VA-SPACE-99:RGARLY:SP, =pv("FE14I-VA-SPACE-99:RGARLY:SP.DESC")
# % gui, , readback, Fast Valve RLY Interlock,  FE14I-VA-SPACE-99:FVALVRLY:SP, =pv("FE14I-VA-SPACE-99:FVALVRLY:SP.DESC")
# % gui, , readback, RLB Interlock,  FE14I-VA-SPACE-99:RLB:SP, =pv("FE14I-VA-SPACE-99:RLB:SP.DESC")
# % gui, , statusbits, Status,  FE14I-VA-SPACE-99:STA.VAL, IMGs, Pumps, Valves, Pressure
# % gui, , demand, Set CTL SP Interlock,   FE14I-VA-SPACE-99:CTL:SETSP, =pv("FE14I-VA-SPACE-99:CTL:SETSP.DESC")
# % gui, , enum, IMG Enable Ctrl, FE14I-VA-SPACE-99:CTL:ENABLE, concat(=pv("FE14I-VA-SPACE-99:CTL:SETSP.DESC"), " Ctrl")
# % gui, , demand, Set PRO Interlock,  FE14I-VA-SPACE-99:PRO:SETSP, =pv("FE14I-VA-SPACE-99:PRO:SP.DESC")
# % gui, , demand, Set RLY Interlock,  FE14I-VA-SPACE-99:RLY:SETSP, =pv("FE14I-VA-SPACE-99:RLY:SP.DESC")
# % gui, , demand, Set RLA Interlock,  FE14I-VA-SPACE-99:RLA:SETSP, =pv("FE14I-VA-SPACE-99:RLA:SP.DESC")
# % gui, , demand, Set RGA RLY Interlock,  FE14I-VA-SPACE-99:RGARLY:SETSP, =pv("FE14I-VA-SPACE-99:RGARLY:SP.DESC")
# % gui, , demand, Set Fast Valve RLY Interlock,  FE14I-VA-SPACE-99:FVALVRLY:SETSP, =pv("FE14I-VA-SPACE-99:FVALVRLY:SP.DESC")
# % gui, , demand, Set RLB Interlock,  FE14I-VA-SPACE-99:RLB:SETSP, =pv("FE14I-VA-SPACE-99:RLB:SETSP.DESC")

# Pressure (maximum value from all spaces)
#
#% archiver 1 Monitor
#
record(ai, "FE14I-VA-SPACE-99:PLOG")
{
    field(DESC, "log Pressure")
    field(SCAN, "1 second")
    field(EGU,  "log")
    field(INP,  "FE14I-VA-GAUGE-99:PLOG")
    field(HOPR, "3")
    field(LOPR, "-11")
    field(HIGH, "-7")
    field(HSV,  "MINOR")
    field(ADEL, "0.025")
}
#
#% archiver 10
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-SPACE-99:P")
{
    field(DESC, "Pressure")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-GAUGE-99:P")
    field(HIGH, "1.0e-7")
    field(HSV,  "MINOR")
}
################################################################################
# Status
# B0 Gauge not OK
# B1 Ion Pump not swiched on
# B2 Valve not open
# B3 Pressure
#
#% archiver 10 Monitor
#% controldesk Status smon
#
record(mbbiDirect,"FE14I-VA-SPACE-99:STA") 
{
    field(DESC,"Status")
    field(SCAN,"1 second")
    field(INP, "FE14I-VA-SPACE-99:CALSTA PP MS")
}
record(calc, "FE14I-VA-SPACE-99:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A|B|C|D")
    field(INPA, "FE14I-VA-SPACE-99:IMGSTA PP MS")
    field(INPB, "FE14I-VA-SPACE-99:IONPSTA PP MS")
    field(INPC, "FE14I-VA-SPACE-99:VALVESTA PP MS")
    field(INPD, "FE14I-VA-SPACE-99:PSTA PP MS")
}
record(calc, "FE14I-VA-SPACE-99:IMGSTA")
{
    field(DESC, "IMGs Status")
    field(CALC, "(A<2||A=8)?0:1")
    field(INPA, "FE14I-VA-IMG-99:STA")
    field(HIGH, "1.5")
    field(HSV,  "MINOR")
#    field(INPA, "FE14I-VA-IMG-99:STA MS")
#    field(HIHI, "1.5")
#    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-99:IONPSTA")
{
    field(DESC, "Pumps Status")
    field(CALC, "(A=4)?0:2")
    field(INPA, "FE14I-VA-IONP-99:STA")
    field(HIGH, "0.5")
    field(HSV,  "MINOR")
#    field(INPA, "FE14I-VA-IONP-99:STA MS")
#    field(HIHI, "0.5")
#    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-99:VALVESTA")
{
    field(DESC, "Valves Status")
    field(CALC, "(A=1)?0:4")
    field(INPA, "FE14I-VA-GVALV-01:STA MS")
    field(HIHI, "3.5")
    field(HHSV, "MAJOR")
}
record(calc, "FE14I-VA-SPACE-99:PSTA")
{
    field(DESC, "Pressure Status")
    field(CALC, "(A<B)?0:8")
    field(INPA, "FE14I-VA-SPACE-99:P MS")
    field(INPB, "1.0e-7")
    field(HIGH, "7.5")
    field(HSV,  "MINOR")
}
#################################################################################
# Control Pumps
#
#% controldesk Pumps scon
#
record(bo,"FE14I-VA-SPACE-99:START") 
{
    field(DESC, "Control Pumps")
    field(OUT,  "FE14I-VA-IONP-99:START PP")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
#
#% controldesk Pumps smon
#
record(bi,"FE14I-VA-SPACE-99:STARTING")
{
    field(DESC, "Starting Pumps")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-IONP-99:STARTING")
    field(ZNAM, "")
    field(ONAM, "Starting")
}
#################################################################################
# Control Valves
#
#% controldesk Valves scon
#
record(mbbo,"FE14I-VA-SPACE-99:CON") 
{
    field(DESC, "Control Valves")
    field(OUT,  "FE14I-VA-GVALV-01:CON PP")
    field(ZRST, "Open")
    field(ONST, "Close")
    field(TWST, "Reset")
}
#
#% controldesk Valves smon
#
record(bi,"FE14I-VA-SPACE-99:OPENING")
{
    field(DESC, "Opening Valves")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-GVALV-01:OPENING")
    field(ZNAM, "")
    field(ONAM, "Opening")
}
#################################################################################
# Cold Cathode Enable
#
#% controldesk Gauges scon
#
record(bo, "FE14I-VA-SPACE-99:CCHV")
{
    field(DESC, "Cold Cathode Enable")
    field(OUT,  "FE14I-VA-IMG-99:CCHV PP")
    field(ZNAM, "Off")
    field(ONAM, "On")
}
#
#% controldesk Gauges smon
#
record(bi,"FE14I-VA-SPACE-99:SWITCHING")
{
    field(DESC, "Switching")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-IMG-99:SWITCHING")
    field(ZNAM, "")
    field(ONAM, "Switching")
}
#################################################################################
# PIRG Control Interlocks - IMG Enable
#
record(ao, "FE14I-VA-SPACE-99:CTL:SETSP")
{
    field(DESC, "IMG Enable")
    field(OUT,  "FE14I-VA-PIRG-99:CTL:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(mbbo, "FE14I-VA-SPACE-99:CTL:ENABLE")
{
    field(DESC, "Enable Control Setpoint")
    field(OUT,  "FE14I-VA-PIRG-99:CTL:ENABLE PP")
    field(ZRST, "Force On")
    field(ONST, "I/L Safe")
    field(TWST, "I/L Operating")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL , "1")
    field(PINI, "YES")
}
record(ai, "FE14I-VA-SPACE-99:CTL:SP")
{
    field(DESC, "IMG Enable")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-PIRG-99:CTL:SP MS")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
}
#################################################################################
# IMG Protection Interlocks - IMG Overpressure
#
record(ao, "FE14I-VA-SPACE-99:PRO:OUTSP")
{
    field(DESC, "IMG Overpressure")
    field(OUT,  "FE14I-VA-IMG-99:PRO:OUTSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
    field(DRVH, "1.0e-2")
    field(DRVL, "1.3e-5")
    field(DOL , "5.0e-4")
}
#record(mbbo, "FE14I-VA-SPACE-99:PRO:ENABLE")
#{
#    field(DESC, "Enable Protection Setpoint")
#    field(OUT,  "FE14I-VA-IMG-99:PRO:ENABLE PP")
#    field(ZRST, "Force On I/L")
#    field(ONST, "I/L Operating")
#    field(ZRVL, "1")
#    field(ONVL, "2")
#    field(ZRSV, "MAJOR")
#    field(ONSV, "NO_ALARM")
#    field(DOL , "1")
#    field(PINI, "YES")
#}
record(ai, "FE14I-VA-SPACE-99:PRO:SP")
{
    field(DESC, "IMG Overpressure")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-99:PRO:SP MS")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
#################################################################################
# IMG Relay Interlocks - Valve Interlock
#
record(ao, "FE14I-VA-SPACE-99:RLY:SETSP")
{
    field(DESC, "Valve I/L")
    field(OUT,  "FE14I-VA-IMG-99:RLY1:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-6")
}
record(ai, "FE14I-VA-SPACE-99:RLY:SP")
{
    field(DESC, "Valve I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-99:RLY1:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# IMG Relay 2 (Channel A) Interlocks - MPS Interlock 1
#
record(ao, "FE14I-VA-SPACE-99:RLA:SETSP")
{
    field(DESC, "MPS Interlock 1")
    field(OUT,  "FE14I-VA-IMG-99:RLY2:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(ai, "FE14I-VA-SPACE-99:RLA:SP")
{
    field(DESC, "MPS Interlock 1")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-99:RLY2:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# IMG Relay 3 (Channel A) Interlocks - MPS Interlock 2
#
record(ao, "FE14I-VA-SPACE-99:RLA2:SETSP")
{
    field(DESC, "MPS Interlock 2")
    field(OUT,  "FE14I-VA-IMG-99:RLY3:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(ai, "FE14I-VA-SPACE-99:RLA2:SP")
{
    field(DESC, "MPS Interlock 2")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-99:RLY3:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#################################################################################
# Pirani Gauge  Relay Interlocks - Ion Pump Interlock
#
record(ao, "FE14I-VA-SPACE-99:RLB:SETSP")
{
    field(DESC, "Ion Pump I/L")
    field(OUT,  "FE14I-VA-PIRG-99:RLY1:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
    field(DRVH, "1.2e2")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(ai, "FE14I-VA-SPACE-99:RLB:SP")
{
    field(DESC, "Ion Pump I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-PIRG-99:RLY1:SP MS")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
}
#################################################################################

#################################################################################
# IMG Relay Interlocks - RGA Interlock
#
record(ao, "FE14I-VA-SPACE-99:RGARLY:SETSP")
{
    field(DESC, "RGA I/L")
    field(OUT,  "FE14I-VA-IMG-99:RLY4:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-4")
}
record(ai, "FE14I-VA-SPACE-99:RGARLY:SP")
{
    field(DESC, "RGA I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-99:RLY4:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}

#################################################################################
# IMG Relay Interlocks - Fast Valve Interlock
#
record(ao, "FE14I-VA-SPACE-99:FVALVRLY:SETSP")
{
    field(DESC, "Fast Valve I/L")
    field(OUT,  "FE14I-VA-IMG-99:FRLY:SETSP PP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-5")
}
record(ai, "FE14I-VA-SPACE-99:FVALVRLY:SP")
{
    field(DESC, "Fast Valve I/L")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(INP,  "FE14I-VA-IMG-99:FRLY:SP MS")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# vacuumValveGroup.template
#% macro, __doc__, Template database for a group of up to 8 vacuum valves
# Pete Owens - 3/5/05
#
# substitutions:
#% macro, device, device name
#% macro, delay, delay between opening valves
#% macro, valve1, Valve 1 device name
#% macro, valve2, Valve 2 device name
#% macro, valve3, Valve 3 device name
#% macro, valve4, Valve 4 device name
#% macro, valve5, Valve 5 device name
#% macro, valve6, Valve 6 device name
#% macro, valve7, Valve 7 device name
#% macro, valve8, Valve 8 device name
#% macro, mode1, name of remote operational mode (:MODE)
#% macro, mode2, name of local operational mode (:MODE)
################################################################################
# Control
#
record(mbbo, "FE14I-VA-GVALV-01:CON") {
  field(DESC, "Control")
  field(FLNK, "FE14I-VA-GVALV-01:CON1")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
}

record(bi, "FE14I-VA-GVALV-01:OPENING") {
  field(DESC, "Opening Valves")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Opening")
}

record(calc, "FE14I-VA-GVALV-01:CON0") {
  field(DESC, "CON + 1")
  field(CALC, "A+1")
  field(INPA, "FE14I-VA-GVALV-01:CON")
}

record(seq, "FE14I-VA-GVALV-01:CON1") {
  field(DESC, "Control Valves")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-GVALV-01:CON0 PP")
  field(DOL1, "0")
  field(LNK1, "FE14I-VA-GVALV-01:SEQOPEN  PP")
  field(LNK2, "FE14I-VA-GVALV-01:SEQCLOSE PP")
  field(LNK3, "FE14I-VA-GVALV-01:SEQRESET PP")
}

record(seq, "FE14I-VA-GVALV-01:SEQOPEN") {
  field(DESC, "Open Valves")
  field(SELM, "All")
  field(DOL1, "1")
  field(DOL2, "FE14I-VA-GVALV-01:CON")
  field(DOL3, "FE14I-VA-GVALV-01:CON")
  field(DOL4, "FE14I-VA-GVALV-01:CON")
  field(DOL5, "FE14I-VA-GVALV-01:CON")
  field(DOL6, "FE14I-VA-GVALV-01:CON")
  field(DOL7, "FE14I-VA-GVALV-01:CON")
  field(DOL8, "FE14I-VA-GVALV-01:CON")
  field(DOL9, "FE14I-VA-GVALV-01:CON")
  field(DOLA, "0")
  field(DLY1, "0")
  field(DLY2, "0")
  field(DLY3, "0")
  field(DLY4, "0")
  field(DLY5, "0")
  field(DLY6, "0")
  field(DLY7, "0")
  field(DLY8, "0")
  field(DLY9, "0")
  field(DLYA, "0")
  field(LNK1, "FE14I-VA-GVALV-01:OPENING PP")
  field(LNK2, "FE14I-VA-VALVE-01:CON CA")
  field(LNK3, "FE14I-VA-VALVE-01:CON CA")
  field(LNK4, "FE14I-VA-VALVE-01:CON CA")
  field(LNK5, "FE14I-VA-VALVE-01:CON CA")
  field(LNK6, "FE14I-VA-VALVE-01:CON CA")
  field(LNK7, "FE14I-VA-VALVE-01:CON CA")
  field(LNK8, "FE14I-VA-VALVE-01:CON CA")
  field(LNK9, "FE14I-VA-VALVE-02:CON CA")
  field(LNKA, "FE14I-VA-GVALV-01:OPENING PP")
}

record(seq, "FE14I-VA-GVALV-01:SEQCLOSE") {
  field(DESC, "Close Valves")
  field(SELM, "All")
  field(DOL1, "1")
  field(DOL2, "1")
  field(DOL3, "1")
  field(DOL4, "1")
  field(DOL5, "1")
  field(DOL6, "1")
  field(DOL7, "1")
  field(DOL8, "1")
  field(LNK1, "FE14I-VA-VALVE-01:CON CA")
  field(LNK2, "FE14I-VA-VALVE-01:CON CA")
  field(LNK3, "FE14I-VA-VALVE-01:CON CA")
  field(LNK4, "FE14I-VA-VALVE-01:CON CA")
  field(LNK5, "FE14I-VA-VALVE-01:CON CA")
  field(LNK6, "FE14I-VA-VALVE-01:CON CA")
  field(LNK7, "FE14I-VA-VALVE-01:CON CA")
  field(LNK8, "FE14I-VA-VALVE-02:CON CA")
  field(DLY2, "0")
  field(DLY3, "0")
  field(DLY4, "0")
  field(DLY5, "0")
  field(DLY6, "0")
  field(DLY7, "0")
  field(DLY8, "0")
}

record(seq, "FE14I-VA-GVALV-01:SEQRESET") {
  field(DESC, "Reset Valves")
  field(SELM, "All")
  field(DOL1, "2")
  field(DOL2, "2")
  field(DOL3, "2")
  field(DOL4, "2")
  field(DOL5, "2")
  field(DOL6, "2")
  field(DOL7, "2")
  field(DOL8, "2")
  field(LNK1, "FE14I-VA-VALVE-01:CON CA")
  field(LNK2, "FE14I-VA-VALVE-01:CON CA")
  field(LNK3, "FE14I-VA-VALVE-01:CON CA")
  field(LNK4, "FE14I-VA-VALVE-01:CON CA")
  field(LNK5, "FE14I-VA-VALVE-01:CON CA")
  field(LNK6, "FE14I-VA-VALVE-01:CON CA")
  field(LNK7, "FE14I-VA-VALVE-01:CON CA")
  field(LNK8, "FE14I-VA-VALVE-02:CON CA")
}

record(mbbi, "FE14I-VA-GVALV-01:LASTCON") {
  field(DESC, "Control Readback")
  field(INP, "FE14I-VA-VALVE-01:LASTCON")
  field(SCAN, "1 second")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
}

################################################################################
# Interlock Status
#
record(mbbi, "FE14I-VA-GVALV-01:ILKSTA") {
  field(DESC, "Interlock Status")
  field(INP, "FE14I-VA-GVALV-01:SELILKSTA MS PP")
  field(SCAN, "1 second")
  field(ZRST, "Failed")
  field(ONST, "Run Ilks OK")
  field(TWST, "OK")
  field(THST, "Disarmed")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
}

record(sel, "FE14I-VA-GVALV-01:SELILKSTA") {
  field(SELM, "Low Signal")
  field(INPA, "FE14I-VA-VALVE-01:ILKSTA MS")
  field(INPB, "FE14I-VA-VALVE-01:ILKSTA MS")
  field(INPC, "FE14I-VA-VALVE-01:ILKSTA MS")
  field(INPD, "FE14I-VA-VALVE-01:ILKSTA MS")
  field(INPE, "FE14I-VA-VALVE-01:ILKSTA MS")
  field(INPF, "FE14I-VA-VALVE-01:ILKSTA MS")
  field(INPG, "FE14I-VA-VALVE-01:ILKSTA MS")
  field(INPH, "FE14I-VA-VALVE-02:ILKSTA MS")
}

################################################################################
# Status
#
record(mbbi, "FE14I-VA-GVALV-01:STA") {
  field(DESC, "Status")
  field(SCAN, "1 second")
  field(INP, "FE14I-VA-GVALV-01:CALSTA PP MS")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
}

record(calc, "FE14I-VA-GVALV-01:CALSTA") {
  field(DESC, "Calculate Status")
  field(CALC, "A<C?A:(B>C?(B>D?A:B):C)")
  field(INPA, "FE14I-VA-GVALV-01:MINSTA PP MS")
  field(INPB, "FE14I-VA-GVALV-01:MAXSTA PP MS")
  field(INPC, "1")
  field(INPD, "4")
}

record(sel, "FE14I-VA-GVALV-01:MINSTA") {
  field(SELM, "Low Signal")
  field(INPA, "FE14I-VA-VALVE-01:STA MS")
  field(INPB, "FE14I-VA-VALVE-01:STA MS")
  field(INPC, "FE14I-VA-VALVE-01:STA MS")
  field(INPD, "FE14I-VA-VALVE-01:STA MS")
  field(INPE, "FE14I-VA-VALVE-01:STA MS")
  field(INPF, "FE14I-VA-VALVE-01:STA MS")
  field(INPG, "FE14I-VA-VALVE-01:STA MS")
  field(INPH, "FE14I-VA-VALVE-02:STA MS")
}

record(sel, "FE14I-VA-GVALV-01:MAXSTA") {
  field(SELM, "High Signal")
  field(INPA, "FE14I-VA-VALVE-01:STA MS")
  field(INPB, "FE14I-VA-VALVE-01:STA MS")
  field(INPC, "FE14I-VA-VALVE-01:STA MS")
  field(INPD, "FE14I-VA-VALVE-01:STA MS")
  field(INPE, "FE14I-VA-VALVE-01:STA MS")
  field(INPF, "FE14I-VA-VALVE-01:STA MS")
  field(INPG, "FE14I-VA-VALVE-01:STA MS")
  field(INPH, "FE14I-VA-VALVE-02:STA MS")
}

################################################################################
# Number of Operations
#
record(longin, "FE14I-VA-GVALV-01:OPS") {
  field(DESC, "Operations")
  field(INP, "FE14I-VA-GVALV-01:SELOPS MS PP")
  field(SCAN, "1 second")
  field(HOPR, "10000")
  field(LOPR, "0")
  field(HIHI, "10000")
  field(HIGH, "9000")
  field(LOW, "0")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(LLSV, "MAJOR")
}

record(sel, "FE14I-VA-GVALV-01:SELOPS") {
  field(SELM, "High Signal")
  field(INPA, "FE14I-VA-VALVE-01:OPS MS")
  field(INPB, "FE14I-VA-VALVE-01:OPS MS")
  field(INPC, "FE14I-VA-VALVE-01:OPS MS")
  field(INPD, "FE14I-VA-VALVE-01:OPS MS")
  field(INPE, "FE14I-VA-VALVE-01:OPS MS")
  field(INPF, "FE14I-VA-VALVE-01:OPS MS")
  field(INPG, "FE14I-VA-VALVE-01:OPS MS")
  field(INPH, "FE14I-VA-VALVE-02:OPS MS")
}

################################################################################
# Operational/Service Mode
#
record(bi, "FE14I-VA-GVALV-01:MODE") {
  field(DESC, "Mode")
  field(INP, "FE14I-VA-GVALV-01:SELMODE MS PP")
  field(SCAN, "1 second")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

record(sel, "FE14I-VA-GVALV-01:SELMODE") {
  field(SELM, "High Signal")
  field(INPA, "FE14I-VA-VALVE-01:MODE MS")
  field(INPB, "FE14I-VA-VALVE-01:MODE MS")
  field(INPC, "FE14I-VA-VALVE-01:MODE MS")
  field(INPD, "FE14I-VA-VALVE-01:MODE MS")
  field(INPE, "FE14I-VA-VALVE-01:MODE MS")
  field(INPF, "FE14I-VA-VALVE-01:MODE MS")
  field(INPG, "FE14I-VA-VALVE-01:MODE MS")
  field(INPH, "FE14I-VA-VALVE-02:MODE MS")
}

#
# Raw Air Pressure Status, not debounced
#
record(bi, "FE14I-VA-GVALV-01:RAWAIRSTA") {
  field(DESC, "Raw Air Pressure Status")
  field(INP, "FE14I-VA-GVALV-01:SELRAWAIRSTA MS PP")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZNAM, "Low")
  field(ONAM, "Good")
}

record(sel, "FE14I-VA-GVALV-01:SELRAWAIRSTA") {
  field(SELM, "High Signal")
  field(INPA, "FE14I-VA-VALVE-01:RAWAIRSTA MS")
  field(INPB, "FE14I-VA-VALVE-01:RAWAIRSTA MS")
  field(INPC, "FE14I-VA-VALVE-01:RAWAIRSTA MS")
  field(INPD, "FE14I-VA-VALVE-01:RAWAIRSTA MS")
  field(INPE, "FE14I-VA-VALVE-01:RAWAIRSTA MS")
  field(INPF, "FE14I-VA-VALVE-01:RAWAIRSTA MS")
  field(INPG, "FE14I-VA-VALVE-01:RAWAIRSTA MS")
  field(INPH, "FE14I-VA-VALVE-02:RAWAIRSTA MS")
}

################################################################################
# Air Pressure De-bounce Time
#
record(ao, "FE14I-VA-GVALV-01:SETADB") {
  field(DESC, "De-bounce Time")
  field(FLNK, "FE14I-VA-GVALV-01:SEQADB PP")
  field(EGU, "s")
  field(PREC, "1")
  field(DOL, "10.0")
  field(PINI, "YES")
}

record(seq, "FE14I-VA-GVALV-01:SEQADB") {
  field(SELM, "All")
  field(DOL1, "FE14I-VA-GVALV-01:SETADB")
  field(DOL2, "FE14I-VA-GVALV-01:SETADB")
  field(DOL3, "FE14I-VA-GVALV-01:SETADB")
  field(DOL4, "FE14I-VA-GVALV-01:SETADB")
  field(DOL5, "FE14I-VA-GVALV-01:SETADB")
  field(DOL6, "FE14I-VA-GVALV-01:SETADB")
  field(DOL7, "FE14I-VA-GVALV-01:SETADB")
  field(DOL8, "FE14I-VA-GVALV-01:SETADB")
  field(LNK1, "FE14I-VA-VALVE-01:SETADB CA")
  field(LNK2, "FE14I-VA-VALVE-01:SETADB CA")
  field(LNK3, "FE14I-VA-VALVE-01:SETADB CA")
  field(LNK4, "FE14I-VA-VALVE-01:SETADB CA")
  field(LNK5, "FE14I-VA-VALVE-01:SETADB CA")
  field(LNK6, "FE14I-VA-VALVE-01:SETADB CA")
  field(LNK7, "FE14I-VA-VALVE-01:SETADB CA")
  field(LNK8, "FE14I-VA-VALVE-02:SETADB CA")
}

record(ai, "FE14I-VA-GVALV-01:ADB") {
  field(DESC, "De-bounce Time")
  field(INP, "FE14I-VA-GVALV-01:SELADB MS PP")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
}

record(sel, "FE14I-VA-GVALV-01:SELADB") {
  field(SELM, "Low Signal")
  field(INPA, "FE14I-VA-VALVE-01:ADB MS")
  field(INPB, "FE14I-VA-VALVE-01:ADB MS")
  field(INPC, "FE14I-VA-VALVE-01:ADB MS")
  field(INPD, "FE14I-VA-VALVE-01:ADB MS")
  field(INPE, "FE14I-VA-VALVE-01:ADB MS")
  field(INPF, "FE14I-VA-VALVE-01:ADB MS")
  field(INPG, "FE14I-VA-VALVE-01:ADB MS")
  field(INPH, "FE14I-VA-VALVE-02:ADB MS")
}

################################################################################
# Interlocks
#
record(mbbiDirect, "FE14I-VA-GVALV-01:ILK") {
  field(DESC, "Latched Interlocks")
  field(INP, "FE14I-VA-GVALV-01:CALILK PP")
  field(SCAN, "1 second")
}

record(calc, "FE14I-VA-GVALV-01:CALILK") {
  field(CALC, "A|B|C|D|E|F|G|H")
  field(INPA, "FE14I-VA-VALVE-01:ILK")
  field(INPB, "FE14I-VA-VALVE-01:ILK")
  field(INPC, "FE14I-VA-VALVE-01:ILK")
  field(INPD, "FE14I-VA-VALVE-01:ILK")
  field(INPE, "FE14I-VA-VALVE-01:ILK")
  field(INPF, "FE14I-VA-VALVE-01:ILK")
  field(INPG, "FE14I-VA-VALVE-01:ILK")
  field(INPH, "FE14I-VA-VALVE-02:ILK")
}

record(mbbiDirect, "FE14I-VA-GVALV-01:INIILK") {
  field(DESC, "Raw Interlock Status")
  field(INP, "FE14I-VA-GVALV-01:CALINIILK PP")
  field(SCAN, "1 second")
}

record(calc, "FE14I-VA-GVALV-01:CALINIILK") {
  field(CALC, "A|B|C|D|E|F|G|H")
  field(INPA, "FE14I-VA-VALVE-01:INIILK")
  field(INPB, "FE14I-VA-VALVE-01:INIILK")
  field(INPC, "FE14I-VA-VALVE-01:INIILK")
  field(INPD, "FE14I-VA-VALVE-01:INIILK")
  field(INPE, "FE14I-VA-VALVE-01:INIILK")
  field(INPF, "FE14I-VA-VALVE-01:INIILK")
  field(INPG, "FE14I-VA-VALVE-01:INIILK")
  field(INPH, "FE14I-VA-VALVE-02:INIILK")
}

record(mbbiDirect, "FE14I-VA-GVALV-01:RAWILK") {
  field(DESC, "Raw Interlock Status")
  field(INP, "FE14I-VA-GVALV-01:CALRAWILK PP")
  field(SCAN, "1 second")
}

record(calc, "FE14I-VA-GVALV-01:CALRAWILK") {
  field(CALC, "A&B&C&D&E&F&G&H")
  field(INPA, "FE14I-VA-VALVE-01:RAWILK")
  field(INPB, "FE14I-VA-VALVE-01:RAWILK")
  field(INPC, "FE14I-VA-VALVE-01:RAWILK")
  field(INPD, "FE14I-VA-VALVE-01:RAWILK")
  field(INPE, "FE14I-VA-VALVE-01:RAWILK")
  field(INPF, "FE14I-VA-VALVE-01:RAWILK")
  field(INPG, "FE14I-VA-VALVE-01:RAWILK")
  field(INPH, "FE14I-VA-VALVE-02:RAWILK")
}

record(mbbiDirect, "FE14I-VA-GVALV-01:GILK") {
  field(DESC, "Gauge Interlock Status")
  field(INP, "FE14I-VA-GVALV-01:CALGILK PP")
  field(SCAN, "1 second")
}

record(calc, "FE14I-VA-GVALV-01:CALGILK") {
  field(CALC, "A|B|C|D|E|F|G|H")
  field(INPA, "FE14I-VA-VALVE-01:GILK")
  field(INPB, "FE14I-VA-VALVE-01:GILK")
  field(INPC, "FE14I-VA-VALVE-01:GILK")
  field(INPD, "FE14I-VA-VALVE-01:GILK")
  field(INPE, "FE14I-VA-VALVE-01:GILK")
  field(INPF, "FE14I-VA-VALVE-01:GILK")
  field(INPG, "FE14I-VA-VALVE-01:GILK")
  field(INPH, "FE14I-VA-VALVE-02:GILK")
}

record(mbbiDirect, "FE14I-VA-GVALV-01:IMGILK") {
  field(DESC, "IMG Interlock Status")
  field(INP, "FE14I-VA-GVALV-01:CALIMGILK PP")
  field(SCAN, "1 second")
}

record(calc, "FE14I-VA-GVALV-01:CALIMGILK") {
  field(CALC, "A&B&C&D&E&F&G&H")
  field(INPA, "FE14I-VA-VALVE-01:IMGILK")
  field(INPB, "FE14I-VA-VALVE-01:IMGILK")
  field(INPC, "FE14I-VA-VALVE-01:IMGILK")
  field(INPD, "FE14I-VA-VALVE-01:IMGILK")
  field(INPE, "FE14I-VA-VALVE-01:IMGILK")
  field(INPF, "FE14I-VA-VALVE-01:IMGILK")
  field(INPG, "FE14I-VA-VALVE-01:IMGILK")
  field(INPH, "FE14I-VA-VALVE-02:IMGILK")
}

record(mbbiDirect, "FE14I-VA-GVALV-01:PIRGILK") {
  field(DESC, "Pirani Interlock Status")
  field(INP, "FE14I-VA-GVALV-01:CALPIRGILK PP")
  field(SCAN, "1 second")
}

record(calc, "FE14I-VA-GVALV-01:CALPIRGILK") {
  field(CALC, "A&B&C&D&E&F&G&H")
  field(INPA, "FE14I-VA-VALVE-01:PIRGILK")
  field(INPB, "FE14I-VA-VALVE-01:PIRGILK")
  field(INPC, "FE14I-VA-VALVE-01:PIRGILK")
  field(INPD, "FE14I-VA-VALVE-01:PIRGILK")
  field(INPE, "FE14I-VA-VALVE-01:PIRGILK")
  field(INPF, "FE14I-VA-VALVE-01:PIRGILK")
  field(INPG, "FE14I-VA-VALVE-01:PIRGILK")
  field(INPH, "FE14I-VA-VALVE-02:PIRGILK")
}

################################################################################
# Individual Interlocks
#
record(bi, "FE14I-VA-GVALV-01:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-VA-GVALV-01:ILK.B0")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 0")
  field(ONAM, "Interlock 0")
}

record(bi, "FE14I-VA-GVALV-01:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-VA-GVALV-01:ILK.B1")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 1")
  field(ONAM, "Interlock 1")
}

record(bi, "FE14I-VA-GVALV-01:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-VA-GVALV-01:ILK.B2")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 2")
  field(ONAM, "Interlock 2")
}

record(bi, "FE14I-VA-GVALV-01:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-VA-GVALV-01:ILK.B3")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 3")
  field(ONAM, "Interlock 3")
}

record(bi, "FE14I-VA-GVALV-01:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-VA-GVALV-01:ILK.B4")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 4")
  field(ONAM, "Interlock 4")
}

record(bi, "FE14I-VA-GVALV-01:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-VA-GVALV-01:ILK.B5")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 5")
  field(ONAM, "Interlock 5")
}

record(bi, "FE14I-VA-GVALV-01:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-VA-GVALV-01:ILK.B6")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 6")
  field(ONAM, "Interlock 6")
}

record(bi, "FE14I-VA-GVALV-01:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-VA-GVALV-01:ILK.B7")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 7")
  field(ONAM, "Interlock 7")
}

record(bi, "FE14I-VA-GVALV-01:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-VA-GVALV-01:ILK.B8")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 8")
  field(ONAM, "Interlock 8")
}

record(bi, "FE14I-VA-GVALV-01:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-VA-GVALV-01:ILK.B9")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 9")
  field(ONAM, "Interlock 9")
}

record(bi, "FE14I-VA-GVALV-01:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-VA-GVALV-01:ILK.BA")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 10")
  field(ONAM, "Interlock 10")
}

record(bi, "FE14I-VA-GVALV-01:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-VA-GVALV-01:ILK.BB")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 11")
  field(ONAM, "Interlock 11")
}

record(bi, "FE14I-VA-GVALV-01:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-VA-GVALV-01:ILK.BC")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 12")
  field(ONAM, "Interlock 12")
}

record(bi, "FE14I-VA-GVALV-01:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-VA-GVALV-01:ILK.BD")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 13")
  field(ONAM, "Interlock 13")
}

record(bi, "FE14I-VA-GVALV-01:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-VA-GVALV-01:ILK.BE")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 14")
  field(ONAM, "Interlock 14")
}

record(bi, "FE14I-VA-GVALV-01:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-VA-GVALV-01:ILK.BF")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Interlock 15")
  field(ONAM, "Interlock 15")
}

################################################################################
# Individual Gauge Interlocks
#
record(mbbiDirect, "FE14I-VA-GVALV-01:GAUGEILK") {
  field(DESC, "Combined Gauge Interlock")
  field(INP, "FE14I-VA-GVALV-01:CALGILK PP MS")
}

record(bi, "FE14I-VA-GVALV-01:GILK0") {
  field(DESC, "Gauge ILK 0")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 0")
  field(ONAM, "Gauge ILK 0")
}

record(bi, "FE14I-VA-GVALV-01:GILK1") {
  field(DESC, "Gauge ILK 1")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 1")
  field(ONAM, "Gauge ILK 1")
}

record(bi, "FE14I-VA-GVALV-01:GILK2") {
  field(DESC, "Gauge ILK 2")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 2")
  field(ONAM, "Gauge ILK 2")
}

record(bi, "FE14I-VA-GVALV-01:GILK3") {
  field(DESC, "Gauge ILK 3")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 3")
  field(ONAM, "Gauge ILK 3")
}

record(bi, "FE14I-VA-GVALV-01:GILK4") {
  field(DESC, "Gauge ILK 4")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 4")
  field(ONAM, "Gauge ILK 4")
}

record(bi, "FE14I-VA-GVALV-01:GILK5") {
  field(DESC, "Gauge ILK 5")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 5")
  field(ONAM, "Gauge ILK 5")
}

record(bi, "FE14I-VA-GVALV-01:GILK6") {
  field(DESC, "Gauge ILK 6")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 6")
  field(ONAM, "Gauge ILK 6")
}

record(bi, "FE14I-VA-GVALV-01:GILK7") {
  field(DESC, "Gauge ILK 7")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 7")
  field(ONAM, "Gauge ILK 7")
}

record(bi, "FE14I-VA-GVALV-01:GILK8") {
  field(DESC, "Gauge ILK 8")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 8")
  field(ONAM, "Gauge ILK 8")
}

record(bi, "FE14I-VA-GVALV-01:GILK9") {
  field(DESC, "Gauge ILK 9")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 9")
  field(ONAM, "Gauge ILK 9")
}

record(bi, "FE14I-VA-GVALV-01:GILK10") {
  field(DESC, "Gauge ILK 10")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 10")
  field(ONAM, "Gauge ILK 10")
}

record(bi, "FE14I-VA-GVALV-01:GILK11") {
  field(DESC, "Gauge ILK 11")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 11")
  field(ONAM, "Gauge ILK 11")
}

record(bi, "FE14I-VA-GVALV-01:GILK12") {
  field(DESC, "Gauge ILK 12")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 12")
  field(ONAM, "Gauge ILK 12")
}

record(bi, "FE14I-VA-GVALV-01:GILK13") {
  field(DESC, "Gauge ILK 13")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 13")
  field(ONAM, "Gauge ILK 13")
}

record(bi, "FE14I-VA-GVALV-01:GILK14") {
  field(DESC, "Gauge ILK 14")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 14")
  field(ONAM, "Gauge ILK 14")
}

record(bi, "FE14I-VA-GVALV-01:GILK15") {
  field(DESC, "Gauge ILK 15")
  field(INP, "FE14I-VA-GVALV-01:GAUGEILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gauge ILK 15")
  field(ONAM, "Gauge ILK 15")
}
# digitelMpcIonpGroup.db
#% macro, __doc__, Template database for a group of up to 8 digitel MPC Ion Pumps
# Pete Owens - 3/5/05
#
# substitutions:
# % macro, device, device name
# % macro, delay, delay between starting pumps
# % macro, ionp1, Ion pump 1 device name
# % macro, ionp2, Ion pump 2 device name
# % macro, ionp3, Ion pump 3 device name
# % macro, ionp4, Ion pump 4 device name
# % macro, ionp5, Ion pump 5 device name
# % macro, ionp6, Ion pump 6 device name
# % macro, ionp7, Ion pump 7 device name
# % macro, ionp8, Ion pump 8 device name

################################################################################
# Maximum pump current
#
record(sel, "FE14I-VA-IONP-91:I") 
{
    field(DESC, "Pump Current")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:I")
    field(INPB, "FE14I-VA-IONP-02:I")
    field(INPC, "FE14I-VA-IONP-01:I")
    field(INPD, "FE14I-VA-IONP-01:I")
    field(INPE, "FE14I-VA-IONP-01:I")
    field(INPF, "FE14I-VA-IONP-01:I")
    field(INPG, "FE14I-VA-IONP-01:I")
    field(INPH, "FE14I-VA-IONP-01:I")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Maximum pump pressure
#
record(sel, "FE14I-VA-IONP-91:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:P")
    field(INPB, "FE14I-VA-IONP-02:P")
    field(INPC, "FE14I-VA-IONP-01:P")
    field(INPD, "FE14I-VA-IONP-01:P")
    field(INPE, "FE14I-VA-IONP-01:P")
    field(INPF, "FE14I-VA-IONP-01:P")
    field(INPG, "FE14I-VA-IONP-01:P")
    field(INPH, "FE14I-VA-IONP-01:P")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calc, "FE14I-VA-IONP-91:PLOG")
{
    field(DESC, "log Pressure")
    field(SCAN, "1 second")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-91:P PP")
    field(HOPR, "3")
    field(LOPR, "-12")
}
################################################################################
# Maximum pump voltage
#
record(sel, "FE14I-VA-IONP-91:V") 
{
    field(DESC, "Pump Voltage")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:V")
    field(INPB, "FE14I-VA-IONP-02:V")
    field(INPC, "FE14I-VA-IONP-01:V")
    field(INPD, "FE14I-VA-IONP-01:V")
    field(INPE, "FE14I-VA-IONP-01:V")
    field(INPF, "FE14I-VA-IONP-01:V")
    field(INPG, "FE14I-VA-IONP-01:V")
    field(INPH, "FE14I-VA-IONP-01:V")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Maximum HV Strapping
#
record(sel, "FE14I-VA-IONP-91:HV") 
{
    field(DESC, "HV Strapping")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:HV")
    field(INPB, "FE14I-VA-IONP-02:HV")
    field(INPC, "FE14I-VA-IONP-01:HV")
    field(INPD, "FE14I-VA-IONP-01:HV")
    field(INPE, "FE14I-VA-IONP-01:HV")
    field(INPF, "FE14I-VA-IONP-01:HV")
    field(INPG, "FE14I-VA-IONP-01:HV")
    field(INPH, "FE14I-VA-IONP-01:HV")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Worst supply status
#
record(mbbi, "FE14I-VA-IONP-91:STA")
{
    field(DESC, "Supply Status")
    field(INP,  "FE14I-VA-IONP-91:CALSTA PP MS")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
}
record(calc, "FE14I-VA-IONP-91:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A>C?A:(B<C?B:C)")
    field(INPA, "FE14I-VA-IONP-91:MAXSTA PP MS")
    field(INPB, "FE14I-VA-IONP-91:MINSTA PP MS")
    field(INPC, "4")
}
record(sel, "FE14I-VA-IONP-91:MAXSTA") 
{
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:STA MS")
    field(INPB, "FE14I-VA-IONP-02:STA MS")
    field(INPC, "FE14I-VA-IONP-01:STA MS")
    field(INPD, "FE14I-VA-IONP-01:STA MS")
    field(INPE, "FE14I-VA-IONP-01:STA MS")
    field(INPF, "FE14I-VA-IONP-01:STA MS")
    field(INPG, "FE14I-VA-IONP-01:STA MS")
    field(INPH, "FE14I-VA-IONP-01:STA MS")
}
record(sel, "FE14I-VA-IONP-91:MINSTA") 
{
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-01:STA MS")
    field(INPB, "FE14I-VA-IONP-02:STA MS")
    field(INPC, "FE14I-VA-IONP-01:STA MS")
    field(INPD, "FE14I-VA-IONP-01:STA MS")
    field(INPE, "FE14I-VA-IONP-01:STA MS")
    field(INPF, "FE14I-VA-IONP-01:STA MS")
    field(INPG, "FE14I-VA-IONP-01:STA MS")
    field(INPH, "FE14I-VA-IONP-01:STA MS")
}
record(mbbi, "FE14I-VA-IONP-91:ERR")
{
    field(DESC, "Error Code")
    field(INP,  "FE14I-VA-IONP-91:SELERR PP")
    field(SCAN, "1 second")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
record(sel, "FE14I-VA-IONP-91:SELERR") 
{
    field(DESC, "Select Error")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:ERR")
    field(INPB, "FE14I-VA-IONP-02:ERR")
    field(INPC, "FE14I-VA-IONP-01:ERR")
    field(INPD, "FE14I-VA-IONP-01:ERR")
    field(INPE, "FE14I-VA-IONP-01:ERR")
    field(INPF, "FE14I-VA-IONP-01:ERR")
    field(INPG, "FE14I-VA-IONP-01:ERR")
    field(INPH, "FE14I-VA-IONP-01:ERR")
}
################################################################################
# Pump size
#
record(sel, "FE14I-VA-IONP-91:SIZE")
{
    field(DESC, "Pump Size")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:SIZE")
    field(INPB, "FE14I-VA-IONP-02:SIZE")
    field(INPC, "FE14I-VA-IONP-01:SIZE")
    field(INPD, "FE14I-VA-IONP-01:SIZE")
    field(INPE, "FE14I-VA-IONP-01:SIZE")
    field(INPF, "FE14I-VA-IONP-01:SIZE")
    field(INPG, "FE14I-VA-IONP-01:SIZE")
    field(INPH, "FE14I-VA-IONP-01:SIZE")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
record(ao, "FE14I-VA-IONP-91:SETSIZE")
{
    field(DESC, "Pump Size")
    field(DOL,  "FE14I-VA-IONP-91:SIZE PP")
    field(OMSL, "closed_loop")
    field(SCAN, "1 second")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
record(sel, "FE14I-VA-IONP-91:CAL") {
    field(DESC, "Calibration Factor")
    field(SELM, "Median Signal")
    field(INPA, "FE14I-VA-IONP-01:CAL")
    field(INPB, "FE14I-VA-IONP-02:CAL")
    field(INPC, "FE14I-VA-IONP-01:CAL")
    field(INPD, "FE14I-VA-IONP-01:CAL")
    field(INPE, "FE14I-VA-IONP-01:CAL")
    field(INPF, "FE14I-VA-IONP-01:CAL")
    field(INPG, "FE14I-VA-IONP-01:CAL")
    field(INPH, "FE14I-VA-IONP-01:CAL")
    field(SCAN, "1 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(ao, "FE14I-VA-IONP-91:SETCAL") {
    field(DESC, "Calibration Factor")
    field(FLNK, "FE14I-VA-IONP-91:SEQCAL")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(seq, "FE14I-VA-IONP-91:SEQCAL")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-91:SETCAL")
    field(DOL2, "FE14I-VA-IONP-91:SETCAL")
    field(DOL3, "FE14I-VA-IONP-91:SETCAL")
    field(DOL4, "FE14I-VA-IONP-91:SETCAL")
    field(DOL5, "FE14I-VA-IONP-91:SETCAL")
    field(DOL6, "FE14I-VA-IONP-91:SETCAL")
    field(DOL7, "FE14I-VA-IONP-91:SETCAL")
    field(DOL8, "FE14I-VA-IONP-91:SETCAL")
    field(LNK1, "FE14I-VA-IONP-01:SETCAL CA")
    field(LNK2, "FE14I-VA-IONP-02:SETCAL CA")
    field(LNK3, "FE14I-VA-IONP-01:SETCAL CA")
    field(LNK4, "FE14I-VA-IONP-01:SETCAL CA")
    field(LNK5, "FE14I-VA-IONP-01:SETCAL CA")
    field(LNK6, "FE14I-VA-IONP-01:SETCAL CA")
    field(LNK7, "FE14I-VA-IONP-01:SETCAL CA")
    field(LNK8, "FE14I-VA-IONP-01:SETCAL CA")
}
################################################################################
# Start
#
record(bo, "FE14I-VA-IONP-91:START")
{
    field(DESC, "HV on/off")
    field(FLNK, "FE14I-VA-IONP-91:START1")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-91:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}
record(calc,"FE14I-VA-IONP-91:START0")
{
    field(DESC, "START + 1")
    field(CALC, "A+1")
    field(INPA, "FE14I-VA-IONP-91:START")
}
record(seq, "FE14I-VA-IONP-91:START1")
{
    field(DESC, "Stop or Start Pumps")
    field(SELM, "Specified")
    field(SELL, "FE14I-VA-IONP-91:START0 PP")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-91:SEQSTOP PP")
    field(LNK2, "FE14I-VA-IONP-91:SEQSTART PP")
}
record(seq, "FE14I-VA-IONP-91:SEQSTOP")
{
    field(DESC, "Stop Pumps")
    field(SELM, "All")
    field(DOL1, "0")
    field(DOL2, "0")
    field(DOL3, "0")
    field(DOL4, "0")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "0")
    field(DOL8, "0")
    field(LNK1, "FE14I-VA-IONP-01:START CA")
    field(LNK2, "FE14I-VA-IONP-02:START CA")
    field(LNK3, "FE14I-VA-IONP-01:START CA")
    field(LNK4, "FE14I-VA-IONP-01:START CA")
    field(LNK5, "FE14I-VA-IONP-01:START CA")
    field(LNK6, "FE14I-VA-IONP-01:START CA")
    field(LNK7, "FE14I-VA-IONP-01:START CA")
    field(LNK8, "FE14I-VA-IONP-01:START CA")
}
record(seq, "FE14I-VA-IONP-91:SEQSTART")
{
    field(DESC, "Strart Pumps")
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "FE14I-VA-IONP-91:START")
    field(DOL3, "FE14I-VA-IONP-91:START")
    field(DOL4, "FE14I-VA-IONP-91:START")
    field(DOL5, "FE14I-VA-IONP-91:START")
    field(DOL6, "FE14I-VA-IONP-91:START")
    field(DOL7, "FE14I-VA-IONP-91:START")
    field(DOL8, "FE14I-VA-IONP-91:START")
    field(DOL9, "FE14I-VA-IONP-91:START")
    field(DOLA, "0")
    field(DLY1, "0")
    field(DLY2, "0")
    field(DLY3, "5")
    field(DLY4, "5")
    field(DLY5, "5")
    field(DLY6, "5")
    field(DLY7, "5")
    field(DLY8, "5")
    field(DLY9, "5")
    field(DLYA, "5")
    field(LNK1, "FE14I-VA-IONP-91:STARTING PP")
    field(LNK2, "FE14I-VA-IONP-01:START CA")
    field(LNK3, "FE14I-VA-IONP-02:START CA")
    field(LNK4, "FE14I-VA-IONP-01:START CA")
    field(LNK5, "FE14I-VA-IONP-01:START CA")
    field(LNK6, "FE14I-VA-IONP-01:START CA")
    field(LNK7, "FE14I-VA-IONP-01:START CA")
    field(LNK8, "FE14I-VA-IONP-01:START CA")
    field(LNK9, "FE14I-VA-IONP-01:START CA")
    field(LNKA, "FE14I-VA-IONP-91:STARTING PP")
}
################################################################################
# Setpoint 1
#
record(sel, "FE14I-VA-IONP-91:SP1ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:SP1ON")
    field(INPB, "FE14I-VA-IONP-02:SP1ON")
    field(INPC, "FE14I-VA-IONP-01:SP1ON")
    field(INPD, "FE14I-VA-IONP-01:SP1ON")
    field(INPE, "FE14I-VA-IONP-01:SP1ON")
    field(INPF, "FE14I-VA-IONP-01:SP1ON")
    field(INPG, "FE14I-VA-IONP-01:SP1ON")
    field(INPH, "FE14I-VA-IONP-01:SP1ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-91:SETSP1ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-91:SEQSP1ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-91:SEQSP1ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-91:SETSP1ON")
    field(DOL2, "FE14I-VA-IONP-91:SETSP1ON")
    field(DOL3, "FE14I-VA-IONP-91:SETSP1ON")
    field(DOL4, "FE14I-VA-IONP-91:SETSP1ON")
    field(DOL5, "FE14I-VA-IONP-91:SETSP1ON")
    field(DOL6, "FE14I-VA-IONP-91:SETSP1ON")
    field(DOL7, "FE14I-VA-IONP-91:SETSP1ON")
    field(DOL8, "FE14I-VA-IONP-91:SETSP1ON")
    field(LNK1, "FE14I-VA-IONP-01:SETSP1ON CA")
    field(LNK2, "FE14I-VA-IONP-02:SETSP1ON CA")
    field(LNK3, "FE14I-VA-IONP-01:SETSP1ON CA")
    field(LNK4, "FE14I-VA-IONP-01:SETSP1ON CA")
    field(LNK5, "FE14I-VA-IONP-01:SETSP1ON CA")
    field(LNK6, "FE14I-VA-IONP-01:SETSP1ON CA")
    field(LNK7, "FE14I-VA-IONP-01:SETSP1ON CA")
    field(LNK8, "FE14I-VA-IONP-01:SETSP1ON CA")
}
record(sel, "FE14I-VA-IONP-91:SP1OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-01:SP1OFF")
    field(INPB, "FE14I-VA-IONP-02:SP1OFF")
    field(INPC, "FE14I-VA-IONP-01:SP1OFF")
    field(INPD, "FE14I-VA-IONP-01:SP1OFF")
    field(INPE, "FE14I-VA-IONP-01:SP1OFF")
    field(INPF, "FE14I-VA-IONP-01:SP1OFF")
    field(INPG, "FE14I-VA-IONP-01:SP1OFF")
    field(INPH, "FE14I-VA-IONP-01:SP1OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-91:SETSP1OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-91:SEQSP1OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-91:SEQSP1OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-91:SETSP1OFF")
    field(DOL2, "FE14I-VA-IONP-91:SETSP1OFF")
    field(DOL3, "FE14I-VA-IONP-91:SETSP1OFF")
    field(DOL4, "FE14I-VA-IONP-91:SETSP1OFF")
    field(DOL5, "FE14I-VA-IONP-91:SETSP1OFF")
    field(DOL6, "FE14I-VA-IONP-91:SETSP1OFF")
    field(DOL7, "FE14I-VA-IONP-91:SETSP1OFF")
    field(DOL8, "FE14I-VA-IONP-91:SETSP1OFF")
    field(LNK1, "FE14I-VA-IONP-01:SETSP1OFF CA")
    field(LNK2, "FE14I-VA-IONP-02:SETSP1OFF CA")
    field(LNK3, "FE14I-VA-IONP-01:SETSP1OFF CA")
    field(LNK4, "FE14I-VA-IONP-01:SETSP1OFF CA")
    field(LNK5, "FE14I-VA-IONP-01:SETSP1OFF CA")
    field(LNK6, "FE14I-VA-IONP-01:SETSP1OFF CA")
    field(LNK7, "FE14I-VA-IONP-01:SETSP1OFF CA")
    field(LNK8, "FE14I-VA-IONP-01:SETSP1OFF CA")
}
################################################################################
################################################################################
# Setpoint 2
#
record(sel, "FE14I-VA-IONP-91:SP2ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-01:SP2ON")
    field(INPB, "FE14I-VA-IONP-02:SP2ON")
    field(INPC, "FE14I-VA-IONP-01:SP2ON")
    field(INPD, "FE14I-VA-IONP-01:SP2ON")
    field(INPE, "FE14I-VA-IONP-01:SP2ON")
    field(INPF, "FE14I-VA-IONP-01:SP2ON")
    field(INPG, "FE14I-VA-IONP-01:SP2ON")
    field(INPH, "FE14I-VA-IONP-01:SP2ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-91:SETSP2ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-91:SEQSP2ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-91:SEQSP2ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-91:SETSP2ON")
    field(DOL2, "FE14I-VA-IONP-91:SETSP2ON")
    field(DOL3, "FE14I-VA-IONP-91:SETSP2ON")
    field(DOL4, "FE14I-VA-IONP-91:SETSP2ON")
    field(DOL5, "FE14I-VA-IONP-91:SETSP2ON")
    field(DOL6, "FE14I-VA-IONP-91:SETSP2ON")
    field(DOL7, "FE14I-VA-IONP-91:SETSP2ON")
    field(DOL8, "FE14I-VA-IONP-91:SETSP2ON")
    field(LNK1, "FE14I-VA-IONP-01:SETSP2ON CA")
    field(LNK2, "FE14I-VA-IONP-02:SETSP2ON CA")
    field(LNK3, "FE14I-VA-IONP-01:SETSP2ON CA")
    field(LNK4, "FE14I-VA-IONP-01:SETSP2ON CA")
    field(LNK5, "FE14I-VA-IONP-01:SETSP2ON CA")
    field(LNK6, "FE14I-VA-IONP-01:SETSP2ON CA")
    field(LNK7, "FE14I-VA-IONP-01:SETSP2ON CA")
    field(LNK8, "FE14I-VA-IONP-01:SETSP2ON CA")
}
record(sel, "FE14I-VA-IONP-91:SP2OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-01:SP2OFF")
    field(INPB, "FE14I-VA-IONP-02:SP2OFF")
    field(INPC, "FE14I-VA-IONP-01:SP2OFF")
    field(INPD, "FE14I-VA-IONP-01:SP2OFF")
    field(INPE, "FE14I-VA-IONP-01:SP2OFF")
    field(INPF, "FE14I-VA-IONP-01:SP2OFF")
    field(INPG, "FE14I-VA-IONP-01:SP2OFF")
    field(INPH, "FE14I-VA-IONP-01:SP2OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-91:SETSP2OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-91:SEQSP2OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-91:SEQSP2OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-91:SETSP2OFF")
    field(DOL2, "FE14I-VA-IONP-91:SETSP2OFF")
    field(DOL3, "FE14I-VA-IONP-91:SETSP2OFF")
    field(DOL4, "FE14I-VA-IONP-91:SETSP2OFF")
    field(DOL5, "FE14I-VA-IONP-91:SETSP2OFF")
    field(DOL6, "FE14I-VA-IONP-91:SETSP2OFF")
    field(DOL7, "FE14I-VA-IONP-91:SETSP2OFF")
    field(DOL8, "FE14I-VA-IONP-91:SETSP2OFF")
    field(LNK1, "FE14I-VA-IONP-01:SETSP2OFF CA")
    field(LNK2, "FE14I-VA-IONP-02:SETSP2OFF CA")
    field(LNK3, "FE14I-VA-IONP-01:SETSP2OFF CA")
    field(LNK4, "FE14I-VA-IONP-01:SETSP2OFF CA")
    field(LNK5, "FE14I-VA-IONP-01:SETSP2OFF CA")
    field(LNK6, "FE14I-VA-IONP-01:SETSP2OFF CA")
    field(LNK7, "FE14I-VA-IONP-01:SETSP2OFF CA")
    field(LNK8, "FE14I-VA-IONP-01:SETSP2OFF CA")
}
################################################################################

# digitelMpcIonpGroup.db
#% macro, __doc__, Template database for a group of up to 8 digitel MPC Ion Pumps
# Pete Owens - 3/5/05
#
# substitutions:
# % macro, device, device name
# % macro, delay, delay between starting pumps
# % macro, ionp1, Ion pump 1 device name
# % macro, ionp2, Ion pump 2 device name
# % macro, ionp3, Ion pump 3 device name
# % macro, ionp4, Ion pump 4 device name
# % macro, ionp5, Ion pump 5 device name
# % macro, ionp6, Ion pump 6 device name
# % macro, ionp7, Ion pump 7 device name
# % macro, ionp8, Ion pump 8 device name

################################################################################
# Maximum pump current
#
record(sel, "FE14I-VA-IONP-92:I") 
{
    field(DESC, "Pump Current")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:I")
    field(INPB, "FE14I-VA-IONP-04:I")
    field(INPC, "FE14I-VA-IONP-03:I")
    field(INPD, "FE14I-VA-IONP-03:I")
    field(INPE, "FE14I-VA-IONP-03:I")
    field(INPF, "FE14I-VA-IONP-03:I")
    field(INPG, "FE14I-VA-IONP-03:I")
    field(INPH, "FE14I-VA-IONP-03:I")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Maximum pump pressure
#
record(sel, "FE14I-VA-IONP-92:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:P")
    field(INPB, "FE14I-VA-IONP-04:P")
    field(INPC, "FE14I-VA-IONP-03:P")
    field(INPD, "FE14I-VA-IONP-03:P")
    field(INPE, "FE14I-VA-IONP-03:P")
    field(INPF, "FE14I-VA-IONP-03:P")
    field(INPG, "FE14I-VA-IONP-03:P")
    field(INPH, "FE14I-VA-IONP-03:P")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calc, "FE14I-VA-IONP-92:PLOG")
{
    field(DESC, "log Pressure")
    field(SCAN, "1 second")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-92:P PP")
    field(HOPR, "3")
    field(LOPR, "-12")
}
################################################################################
# Maximum pump voltage
#
record(sel, "FE14I-VA-IONP-92:V") 
{
    field(DESC, "Pump Voltage")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:V")
    field(INPB, "FE14I-VA-IONP-04:V")
    field(INPC, "FE14I-VA-IONP-03:V")
    field(INPD, "FE14I-VA-IONP-03:V")
    field(INPE, "FE14I-VA-IONP-03:V")
    field(INPF, "FE14I-VA-IONP-03:V")
    field(INPG, "FE14I-VA-IONP-03:V")
    field(INPH, "FE14I-VA-IONP-03:V")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Maximum HV Strapping
#
record(sel, "FE14I-VA-IONP-92:HV") 
{
    field(DESC, "HV Strapping")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:HV")
    field(INPB, "FE14I-VA-IONP-04:HV")
    field(INPC, "FE14I-VA-IONP-03:HV")
    field(INPD, "FE14I-VA-IONP-03:HV")
    field(INPE, "FE14I-VA-IONP-03:HV")
    field(INPF, "FE14I-VA-IONP-03:HV")
    field(INPG, "FE14I-VA-IONP-03:HV")
    field(INPH, "FE14I-VA-IONP-03:HV")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Worst supply status
#
record(mbbi, "FE14I-VA-IONP-92:STA")
{
    field(DESC, "Supply Status")
    field(INP,  "FE14I-VA-IONP-92:CALSTA PP MS")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
}
record(calc, "FE14I-VA-IONP-92:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A>C?A:(B<C?B:C)")
    field(INPA, "FE14I-VA-IONP-92:MAXSTA PP MS")
    field(INPB, "FE14I-VA-IONP-92:MINSTA PP MS")
    field(INPC, "4")
}
record(sel, "FE14I-VA-IONP-92:MAXSTA") 
{
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:STA MS")
    field(INPB, "FE14I-VA-IONP-04:STA MS")
    field(INPC, "FE14I-VA-IONP-03:STA MS")
    field(INPD, "FE14I-VA-IONP-03:STA MS")
    field(INPE, "FE14I-VA-IONP-03:STA MS")
    field(INPF, "FE14I-VA-IONP-03:STA MS")
    field(INPG, "FE14I-VA-IONP-03:STA MS")
    field(INPH, "FE14I-VA-IONP-03:STA MS")
}
record(sel, "FE14I-VA-IONP-92:MINSTA") 
{
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-03:STA MS")
    field(INPB, "FE14I-VA-IONP-04:STA MS")
    field(INPC, "FE14I-VA-IONP-03:STA MS")
    field(INPD, "FE14I-VA-IONP-03:STA MS")
    field(INPE, "FE14I-VA-IONP-03:STA MS")
    field(INPF, "FE14I-VA-IONP-03:STA MS")
    field(INPG, "FE14I-VA-IONP-03:STA MS")
    field(INPH, "FE14I-VA-IONP-03:STA MS")
}
record(mbbi, "FE14I-VA-IONP-92:ERR")
{
    field(DESC, "Error Code")
    field(INP,  "FE14I-VA-IONP-92:SELERR PP")
    field(SCAN, "1 second")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
record(sel, "FE14I-VA-IONP-92:SELERR") 
{
    field(DESC, "Select Error")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:ERR")
    field(INPB, "FE14I-VA-IONP-04:ERR")
    field(INPC, "FE14I-VA-IONP-03:ERR")
    field(INPD, "FE14I-VA-IONP-03:ERR")
    field(INPE, "FE14I-VA-IONP-03:ERR")
    field(INPF, "FE14I-VA-IONP-03:ERR")
    field(INPG, "FE14I-VA-IONP-03:ERR")
    field(INPH, "FE14I-VA-IONP-03:ERR")
}
################################################################################
# Pump size
#
record(sel, "FE14I-VA-IONP-92:SIZE")
{
    field(DESC, "Pump Size")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:SIZE")
    field(INPB, "FE14I-VA-IONP-04:SIZE")
    field(INPC, "FE14I-VA-IONP-03:SIZE")
    field(INPD, "FE14I-VA-IONP-03:SIZE")
    field(INPE, "FE14I-VA-IONP-03:SIZE")
    field(INPF, "FE14I-VA-IONP-03:SIZE")
    field(INPG, "FE14I-VA-IONP-03:SIZE")
    field(INPH, "FE14I-VA-IONP-03:SIZE")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
record(ao, "FE14I-VA-IONP-92:SETSIZE")
{
    field(DESC, "Pump Size")
    field(DOL,  "FE14I-VA-IONP-92:SIZE PP")
    field(OMSL, "closed_loop")
    field(SCAN, "1 second")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
record(sel, "FE14I-VA-IONP-92:CAL") {
    field(DESC, "Calibration Factor")
    field(SELM, "Median Signal")
    field(INPA, "FE14I-VA-IONP-03:CAL")
    field(INPB, "FE14I-VA-IONP-04:CAL")
    field(INPC, "FE14I-VA-IONP-03:CAL")
    field(INPD, "FE14I-VA-IONP-03:CAL")
    field(INPE, "FE14I-VA-IONP-03:CAL")
    field(INPF, "FE14I-VA-IONP-03:CAL")
    field(INPG, "FE14I-VA-IONP-03:CAL")
    field(INPH, "FE14I-VA-IONP-03:CAL")
    field(SCAN, "1 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(ao, "FE14I-VA-IONP-92:SETCAL") {
    field(DESC, "Calibration Factor")
    field(FLNK, "FE14I-VA-IONP-92:SEQCAL")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(seq, "FE14I-VA-IONP-92:SEQCAL")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-92:SETCAL")
    field(DOL2, "FE14I-VA-IONP-92:SETCAL")
    field(DOL3, "FE14I-VA-IONP-92:SETCAL")
    field(DOL4, "FE14I-VA-IONP-92:SETCAL")
    field(DOL5, "FE14I-VA-IONP-92:SETCAL")
    field(DOL6, "FE14I-VA-IONP-92:SETCAL")
    field(DOL7, "FE14I-VA-IONP-92:SETCAL")
    field(DOL8, "FE14I-VA-IONP-92:SETCAL")
    field(LNK1, "FE14I-VA-IONP-03:SETCAL CA")
    field(LNK2, "FE14I-VA-IONP-04:SETCAL CA")
    field(LNK3, "FE14I-VA-IONP-03:SETCAL CA")
    field(LNK4, "FE14I-VA-IONP-03:SETCAL CA")
    field(LNK5, "FE14I-VA-IONP-03:SETCAL CA")
    field(LNK6, "FE14I-VA-IONP-03:SETCAL CA")
    field(LNK7, "FE14I-VA-IONP-03:SETCAL CA")
    field(LNK8, "FE14I-VA-IONP-03:SETCAL CA")
}
################################################################################
# Start
#
record(bo, "FE14I-VA-IONP-92:START")
{
    field(DESC, "HV on/off")
    field(FLNK, "FE14I-VA-IONP-92:START1")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-92:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}
record(calc,"FE14I-VA-IONP-92:START0")
{
    field(DESC, "START + 1")
    field(CALC, "A+1")
    field(INPA, "FE14I-VA-IONP-92:START")
}
record(seq, "FE14I-VA-IONP-92:START1")
{
    field(DESC, "Stop or Start Pumps")
    field(SELM, "Specified")
    field(SELL, "FE14I-VA-IONP-92:START0 PP")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-92:SEQSTOP PP")
    field(LNK2, "FE14I-VA-IONP-92:SEQSTART PP")
}
record(seq, "FE14I-VA-IONP-92:SEQSTOP")
{
    field(DESC, "Stop Pumps")
    field(SELM, "All")
    field(DOL1, "0")
    field(DOL2, "0")
    field(DOL3, "0")
    field(DOL4, "0")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "0")
    field(DOL8, "0")
    field(LNK1, "FE14I-VA-IONP-03:START CA")
    field(LNK2, "FE14I-VA-IONP-04:START CA")
    field(LNK3, "FE14I-VA-IONP-03:START CA")
    field(LNK4, "FE14I-VA-IONP-03:START CA")
    field(LNK5, "FE14I-VA-IONP-03:START CA")
    field(LNK6, "FE14I-VA-IONP-03:START CA")
    field(LNK7, "FE14I-VA-IONP-03:START CA")
    field(LNK8, "FE14I-VA-IONP-03:START CA")
}
record(seq, "FE14I-VA-IONP-92:SEQSTART")
{
    field(DESC, "Strart Pumps")
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "FE14I-VA-IONP-92:START")
    field(DOL3, "FE14I-VA-IONP-92:START")
    field(DOL4, "FE14I-VA-IONP-92:START")
    field(DOL5, "FE14I-VA-IONP-92:START")
    field(DOL6, "FE14I-VA-IONP-92:START")
    field(DOL7, "FE14I-VA-IONP-92:START")
    field(DOL8, "FE14I-VA-IONP-92:START")
    field(DOL9, "FE14I-VA-IONP-92:START")
    field(DOLA, "0")
    field(DLY1, "0")
    field(DLY2, "0")
    field(DLY3, "5")
    field(DLY4, "5")
    field(DLY5, "5")
    field(DLY6, "5")
    field(DLY7, "5")
    field(DLY8, "5")
    field(DLY9, "5")
    field(DLYA, "5")
    field(LNK1, "FE14I-VA-IONP-92:STARTING PP")
    field(LNK2, "FE14I-VA-IONP-03:START CA")
    field(LNK3, "FE14I-VA-IONP-04:START CA")
    field(LNK4, "FE14I-VA-IONP-03:START CA")
    field(LNK5, "FE14I-VA-IONP-03:START CA")
    field(LNK6, "FE14I-VA-IONP-03:START CA")
    field(LNK7, "FE14I-VA-IONP-03:START CA")
    field(LNK8, "FE14I-VA-IONP-03:START CA")
    field(LNK9, "FE14I-VA-IONP-03:START CA")
    field(LNKA, "FE14I-VA-IONP-92:STARTING PP")
}
################################################################################
# Setpoint 1
#
record(sel, "FE14I-VA-IONP-92:SP1ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:SP1ON")
    field(INPB, "FE14I-VA-IONP-04:SP1ON")
    field(INPC, "FE14I-VA-IONP-03:SP1ON")
    field(INPD, "FE14I-VA-IONP-03:SP1ON")
    field(INPE, "FE14I-VA-IONP-03:SP1ON")
    field(INPF, "FE14I-VA-IONP-03:SP1ON")
    field(INPG, "FE14I-VA-IONP-03:SP1ON")
    field(INPH, "FE14I-VA-IONP-03:SP1ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-92:SETSP1ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-92:SEQSP1ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-92:SEQSP1ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-92:SETSP1ON")
    field(DOL2, "FE14I-VA-IONP-92:SETSP1ON")
    field(DOL3, "FE14I-VA-IONP-92:SETSP1ON")
    field(DOL4, "FE14I-VA-IONP-92:SETSP1ON")
    field(DOL5, "FE14I-VA-IONP-92:SETSP1ON")
    field(DOL6, "FE14I-VA-IONP-92:SETSP1ON")
    field(DOL7, "FE14I-VA-IONP-92:SETSP1ON")
    field(DOL8, "FE14I-VA-IONP-92:SETSP1ON")
    field(LNK1, "FE14I-VA-IONP-03:SETSP1ON CA")
    field(LNK2, "FE14I-VA-IONP-04:SETSP1ON CA")
    field(LNK3, "FE14I-VA-IONP-03:SETSP1ON CA")
    field(LNK4, "FE14I-VA-IONP-03:SETSP1ON CA")
    field(LNK5, "FE14I-VA-IONP-03:SETSP1ON CA")
    field(LNK6, "FE14I-VA-IONP-03:SETSP1ON CA")
    field(LNK7, "FE14I-VA-IONP-03:SETSP1ON CA")
    field(LNK8, "FE14I-VA-IONP-03:SETSP1ON CA")
}
record(sel, "FE14I-VA-IONP-92:SP1OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-03:SP1OFF")
    field(INPB, "FE14I-VA-IONP-04:SP1OFF")
    field(INPC, "FE14I-VA-IONP-03:SP1OFF")
    field(INPD, "FE14I-VA-IONP-03:SP1OFF")
    field(INPE, "FE14I-VA-IONP-03:SP1OFF")
    field(INPF, "FE14I-VA-IONP-03:SP1OFF")
    field(INPG, "FE14I-VA-IONP-03:SP1OFF")
    field(INPH, "FE14I-VA-IONP-03:SP1OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-92:SETSP1OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-92:SEQSP1OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-92:SEQSP1OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-92:SETSP1OFF")
    field(DOL2, "FE14I-VA-IONP-92:SETSP1OFF")
    field(DOL3, "FE14I-VA-IONP-92:SETSP1OFF")
    field(DOL4, "FE14I-VA-IONP-92:SETSP1OFF")
    field(DOL5, "FE14I-VA-IONP-92:SETSP1OFF")
    field(DOL6, "FE14I-VA-IONP-92:SETSP1OFF")
    field(DOL7, "FE14I-VA-IONP-92:SETSP1OFF")
    field(DOL8, "FE14I-VA-IONP-92:SETSP1OFF")
    field(LNK1, "FE14I-VA-IONP-03:SETSP1OFF CA")
    field(LNK2, "FE14I-VA-IONP-04:SETSP1OFF CA")
    field(LNK3, "FE14I-VA-IONP-03:SETSP1OFF CA")
    field(LNK4, "FE14I-VA-IONP-03:SETSP1OFF CA")
    field(LNK5, "FE14I-VA-IONP-03:SETSP1OFF CA")
    field(LNK6, "FE14I-VA-IONP-03:SETSP1OFF CA")
    field(LNK7, "FE14I-VA-IONP-03:SETSP1OFF CA")
    field(LNK8, "FE14I-VA-IONP-03:SETSP1OFF CA")
}
################################################################################
################################################################################
# Setpoint 2
#
record(sel, "FE14I-VA-IONP-92:SP2ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-03:SP2ON")
    field(INPB, "FE14I-VA-IONP-04:SP2ON")
    field(INPC, "FE14I-VA-IONP-03:SP2ON")
    field(INPD, "FE14I-VA-IONP-03:SP2ON")
    field(INPE, "FE14I-VA-IONP-03:SP2ON")
    field(INPF, "FE14I-VA-IONP-03:SP2ON")
    field(INPG, "FE14I-VA-IONP-03:SP2ON")
    field(INPH, "FE14I-VA-IONP-03:SP2ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-92:SETSP2ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-92:SEQSP2ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-92:SEQSP2ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-92:SETSP2ON")
    field(DOL2, "FE14I-VA-IONP-92:SETSP2ON")
    field(DOL3, "FE14I-VA-IONP-92:SETSP2ON")
    field(DOL4, "FE14I-VA-IONP-92:SETSP2ON")
    field(DOL5, "FE14I-VA-IONP-92:SETSP2ON")
    field(DOL6, "FE14I-VA-IONP-92:SETSP2ON")
    field(DOL7, "FE14I-VA-IONP-92:SETSP2ON")
    field(DOL8, "FE14I-VA-IONP-92:SETSP2ON")
    field(LNK1, "FE14I-VA-IONP-03:SETSP2ON CA")
    field(LNK2, "FE14I-VA-IONP-04:SETSP2ON CA")
    field(LNK3, "FE14I-VA-IONP-03:SETSP2ON CA")
    field(LNK4, "FE14I-VA-IONP-03:SETSP2ON CA")
    field(LNK5, "FE14I-VA-IONP-03:SETSP2ON CA")
    field(LNK6, "FE14I-VA-IONP-03:SETSP2ON CA")
    field(LNK7, "FE14I-VA-IONP-03:SETSP2ON CA")
    field(LNK8, "FE14I-VA-IONP-03:SETSP2ON CA")
}
record(sel, "FE14I-VA-IONP-92:SP2OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-03:SP2OFF")
    field(INPB, "FE14I-VA-IONP-04:SP2OFF")
    field(INPC, "FE14I-VA-IONP-03:SP2OFF")
    field(INPD, "FE14I-VA-IONP-03:SP2OFF")
    field(INPE, "FE14I-VA-IONP-03:SP2OFF")
    field(INPF, "FE14I-VA-IONP-03:SP2OFF")
    field(INPG, "FE14I-VA-IONP-03:SP2OFF")
    field(INPH, "FE14I-VA-IONP-03:SP2OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-92:SETSP2OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-92:SEQSP2OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-92:SEQSP2OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-92:SETSP2OFF")
    field(DOL2, "FE14I-VA-IONP-92:SETSP2OFF")
    field(DOL3, "FE14I-VA-IONP-92:SETSP2OFF")
    field(DOL4, "FE14I-VA-IONP-92:SETSP2OFF")
    field(DOL5, "FE14I-VA-IONP-92:SETSP2OFF")
    field(DOL6, "FE14I-VA-IONP-92:SETSP2OFF")
    field(DOL7, "FE14I-VA-IONP-92:SETSP2OFF")
    field(DOL8, "FE14I-VA-IONP-92:SETSP2OFF")
    field(LNK1, "FE14I-VA-IONP-03:SETSP2OFF CA")
    field(LNK2, "FE14I-VA-IONP-04:SETSP2OFF CA")
    field(LNK3, "FE14I-VA-IONP-03:SETSP2OFF CA")
    field(LNK4, "FE14I-VA-IONP-03:SETSP2OFF CA")
    field(LNK5, "FE14I-VA-IONP-03:SETSP2OFF CA")
    field(LNK6, "FE14I-VA-IONP-03:SETSP2OFF CA")
    field(LNK7, "FE14I-VA-IONP-03:SETSP2OFF CA")
    field(LNK8, "FE14I-VA-IONP-03:SETSP2OFF CA")
}
################################################################################

# digitelMpcIonpGroup.db
#% macro, __doc__, Template database for a group of up to 8 digitel MPC Ion Pumps
# Pete Owens - 3/5/05
#
# substitutions:
# % macro, device, device name
# % macro, delay, delay between starting pumps
# % macro, ionp1, Ion pump 1 device name
# % macro, ionp2, Ion pump 2 device name
# % macro, ionp3, Ion pump 3 device name
# % macro, ionp4, Ion pump 4 device name
# % macro, ionp5, Ion pump 5 device name
# % macro, ionp6, Ion pump 6 device name
# % macro, ionp7, Ion pump 7 device name
# % macro, ionp8, Ion pump 8 device name

################################################################################
# Maximum pump current
#
record(sel, "FE14I-VA-IONP-93:I") 
{
    field(DESC, "Pump Current")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:I")
    field(INPB, "FE14I-VA-IONP-05:I")
    field(INPC, "FE14I-VA-IONP-05:I")
    field(INPD, "FE14I-VA-IONP-05:I")
    field(INPE, "FE14I-VA-IONP-05:I")
    field(INPF, "FE14I-VA-IONP-05:I")
    field(INPG, "FE14I-VA-IONP-05:I")
    field(INPH, "FE14I-VA-IONP-05:I")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Maximum pump pressure
#
record(sel, "FE14I-VA-IONP-93:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:P")
    field(INPB, "FE14I-VA-IONP-05:P")
    field(INPC, "FE14I-VA-IONP-05:P")
    field(INPD, "FE14I-VA-IONP-05:P")
    field(INPE, "FE14I-VA-IONP-05:P")
    field(INPF, "FE14I-VA-IONP-05:P")
    field(INPG, "FE14I-VA-IONP-05:P")
    field(INPH, "FE14I-VA-IONP-05:P")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calc, "FE14I-VA-IONP-93:PLOG")
{
    field(DESC, "log Pressure")
    field(SCAN, "1 second")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-93:P PP")
    field(HOPR, "3")
    field(LOPR, "-12")
}
################################################################################
# Maximum pump voltage
#
record(sel, "FE14I-VA-IONP-93:V") 
{
    field(DESC, "Pump Voltage")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:V")
    field(INPB, "FE14I-VA-IONP-05:V")
    field(INPC, "FE14I-VA-IONP-05:V")
    field(INPD, "FE14I-VA-IONP-05:V")
    field(INPE, "FE14I-VA-IONP-05:V")
    field(INPF, "FE14I-VA-IONP-05:V")
    field(INPG, "FE14I-VA-IONP-05:V")
    field(INPH, "FE14I-VA-IONP-05:V")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Maximum HV Strapping
#
record(sel, "FE14I-VA-IONP-93:HV") 
{
    field(DESC, "HV Strapping")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:HV")
    field(INPB, "FE14I-VA-IONP-05:HV")
    field(INPC, "FE14I-VA-IONP-05:HV")
    field(INPD, "FE14I-VA-IONP-05:HV")
    field(INPE, "FE14I-VA-IONP-05:HV")
    field(INPF, "FE14I-VA-IONP-05:HV")
    field(INPG, "FE14I-VA-IONP-05:HV")
    field(INPH, "FE14I-VA-IONP-05:HV")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Worst supply status
#
record(mbbi, "FE14I-VA-IONP-93:STA")
{
    field(DESC, "Supply Status")
    field(INP,  "FE14I-VA-IONP-93:CALSTA PP MS")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
}
record(calc, "FE14I-VA-IONP-93:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A>C?A:(B<C?B:C)")
    field(INPA, "FE14I-VA-IONP-93:MAXSTA PP MS")
    field(INPB, "FE14I-VA-IONP-93:MINSTA PP MS")
    field(INPC, "4")
}
record(sel, "FE14I-VA-IONP-93:MAXSTA") 
{
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:STA MS")
    field(INPB, "FE14I-VA-IONP-05:STA MS")
    field(INPC, "FE14I-VA-IONP-05:STA MS")
    field(INPD, "FE14I-VA-IONP-05:STA MS")
    field(INPE, "FE14I-VA-IONP-05:STA MS")
    field(INPF, "FE14I-VA-IONP-05:STA MS")
    field(INPG, "FE14I-VA-IONP-05:STA MS")
    field(INPH, "FE14I-VA-IONP-05:STA MS")
}
record(sel, "FE14I-VA-IONP-93:MINSTA") 
{
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-92:STA MS")
    field(INPB, "FE14I-VA-IONP-05:STA MS")
    field(INPC, "FE14I-VA-IONP-05:STA MS")
    field(INPD, "FE14I-VA-IONP-05:STA MS")
    field(INPE, "FE14I-VA-IONP-05:STA MS")
    field(INPF, "FE14I-VA-IONP-05:STA MS")
    field(INPG, "FE14I-VA-IONP-05:STA MS")
    field(INPH, "FE14I-VA-IONP-05:STA MS")
}
record(mbbi, "FE14I-VA-IONP-93:ERR")
{
    field(DESC, "Error Code")
    field(INP,  "FE14I-VA-IONP-93:SELERR PP")
    field(SCAN, "1 second")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
record(sel, "FE14I-VA-IONP-93:SELERR") 
{
    field(DESC, "Select Error")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:ERR")
    field(INPB, "FE14I-VA-IONP-05:ERR")
    field(INPC, "FE14I-VA-IONP-05:ERR")
    field(INPD, "FE14I-VA-IONP-05:ERR")
    field(INPE, "FE14I-VA-IONP-05:ERR")
    field(INPF, "FE14I-VA-IONP-05:ERR")
    field(INPG, "FE14I-VA-IONP-05:ERR")
    field(INPH, "FE14I-VA-IONP-05:ERR")
}
################################################################################
# Pump size
#
record(sel, "FE14I-VA-IONP-93:SIZE")
{
    field(DESC, "Pump Size")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:SIZE")
    field(INPB, "FE14I-VA-IONP-05:SIZE")
    field(INPC, "FE14I-VA-IONP-05:SIZE")
    field(INPD, "FE14I-VA-IONP-05:SIZE")
    field(INPE, "FE14I-VA-IONP-05:SIZE")
    field(INPF, "FE14I-VA-IONP-05:SIZE")
    field(INPG, "FE14I-VA-IONP-05:SIZE")
    field(INPH, "FE14I-VA-IONP-05:SIZE")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
record(ao, "FE14I-VA-IONP-93:SETSIZE")
{
    field(DESC, "Pump Size")
    field(DOL,  "FE14I-VA-IONP-93:SIZE PP")
    field(OMSL, "closed_loop")
    field(SCAN, "1 second")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
record(sel, "FE14I-VA-IONP-93:CAL") {
    field(DESC, "Calibration Factor")
    field(SELM, "Median Signal")
    field(INPA, "FE14I-VA-IONP-92:CAL")
    field(INPB, "FE14I-VA-IONP-05:CAL")
    field(INPC, "FE14I-VA-IONP-05:CAL")
    field(INPD, "FE14I-VA-IONP-05:CAL")
    field(INPE, "FE14I-VA-IONP-05:CAL")
    field(INPF, "FE14I-VA-IONP-05:CAL")
    field(INPG, "FE14I-VA-IONP-05:CAL")
    field(INPH, "FE14I-VA-IONP-05:CAL")
    field(SCAN, "1 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(ao, "FE14I-VA-IONP-93:SETCAL") {
    field(DESC, "Calibration Factor")
    field(FLNK, "FE14I-VA-IONP-93:SEQCAL")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(seq, "FE14I-VA-IONP-93:SEQCAL")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-93:SETCAL")
    field(DOL2, "FE14I-VA-IONP-93:SETCAL")
    field(DOL3, "FE14I-VA-IONP-93:SETCAL")
    field(DOL4, "FE14I-VA-IONP-93:SETCAL")
    field(DOL5, "FE14I-VA-IONP-93:SETCAL")
    field(DOL6, "FE14I-VA-IONP-93:SETCAL")
    field(DOL7, "FE14I-VA-IONP-93:SETCAL")
    field(DOL8, "FE14I-VA-IONP-93:SETCAL")
    field(LNK1, "FE14I-VA-IONP-92:SETCAL CA")
    field(LNK2, "FE14I-VA-IONP-05:SETCAL CA")
    field(LNK3, "FE14I-VA-IONP-05:SETCAL CA")
    field(LNK4, "FE14I-VA-IONP-05:SETCAL CA")
    field(LNK5, "FE14I-VA-IONP-05:SETCAL CA")
    field(LNK6, "FE14I-VA-IONP-05:SETCAL CA")
    field(LNK7, "FE14I-VA-IONP-05:SETCAL CA")
    field(LNK8, "FE14I-VA-IONP-05:SETCAL CA")
}
################################################################################
# Start
#
record(bo, "FE14I-VA-IONP-93:START")
{
    field(DESC, "HV on/off")
    field(FLNK, "FE14I-VA-IONP-93:START1")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-93:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}
record(calc,"FE14I-VA-IONP-93:START0")
{
    field(DESC, "START + 1")
    field(CALC, "A+1")
    field(INPA, "FE14I-VA-IONP-93:START")
}
record(seq, "FE14I-VA-IONP-93:START1")
{
    field(DESC, "Stop or Start Pumps")
    field(SELM, "Specified")
    field(SELL, "FE14I-VA-IONP-93:START0 PP")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-93:SEQSTOP PP")
    field(LNK2, "FE14I-VA-IONP-93:SEQSTART PP")
}
record(seq, "FE14I-VA-IONP-93:SEQSTOP")
{
    field(DESC, "Stop Pumps")
    field(SELM, "All")
    field(DOL1, "0")
    field(DOL2, "0")
    field(DOL3, "0")
    field(DOL4, "0")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "0")
    field(DOL8, "0")
    field(LNK1, "FE14I-VA-IONP-92:START CA")
    field(LNK2, "FE14I-VA-IONP-05:START CA")
    field(LNK3, "FE14I-VA-IONP-05:START CA")
    field(LNK4, "FE14I-VA-IONP-05:START CA")
    field(LNK5, "FE14I-VA-IONP-05:START CA")
    field(LNK6, "FE14I-VA-IONP-05:START CA")
    field(LNK7, "FE14I-VA-IONP-05:START CA")
    field(LNK8, "FE14I-VA-IONP-05:START CA")
}
record(seq, "FE14I-VA-IONP-93:SEQSTART")
{
    field(DESC, "Strart Pumps")
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "FE14I-VA-IONP-93:START")
    field(DOL3, "FE14I-VA-IONP-93:START")
    field(DOL4, "FE14I-VA-IONP-93:START")
    field(DOL5, "FE14I-VA-IONP-93:START")
    field(DOL6, "FE14I-VA-IONP-93:START")
    field(DOL7, "FE14I-VA-IONP-93:START")
    field(DOL8, "FE14I-VA-IONP-93:START")
    field(DOL9, "FE14I-VA-IONP-93:START")
    field(DOLA, "0")
    field(DLY1, "0")
    field(DLY2, "0")
    field(DLY3, "5")
    field(DLY4, "5")
    field(DLY5, "5")
    field(DLY6, "5")
    field(DLY7, "5")
    field(DLY8, "5")
    field(DLY9, "5")
    field(DLYA, "5")
    field(LNK1, "FE14I-VA-IONP-93:STARTING PP")
    field(LNK2, "FE14I-VA-IONP-92:START CA")
    field(LNK3, "FE14I-VA-IONP-05:START CA")
    field(LNK4, "FE14I-VA-IONP-05:START CA")
    field(LNK5, "FE14I-VA-IONP-05:START CA")
    field(LNK6, "FE14I-VA-IONP-05:START CA")
    field(LNK7, "FE14I-VA-IONP-05:START CA")
    field(LNK8, "FE14I-VA-IONP-05:START CA")
    field(LNK9, "FE14I-VA-IONP-05:START CA")
    field(LNKA, "FE14I-VA-IONP-93:STARTING PP")
}
################################################################################
# Setpoint 1
#
record(sel, "FE14I-VA-IONP-93:SP1ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:SP1ON")
    field(INPB, "FE14I-VA-IONP-05:SP1ON")
    field(INPC, "FE14I-VA-IONP-05:SP1ON")
    field(INPD, "FE14I-VA-IONP-05:SP1ON")
    field(INPE, "FE14I-VA-IONP-05:SP1ON")
    field(INPF, "FE14I-VA-IONP-05:SP1ON")
    field(INPG, "FE14I-VA-IONP-05:SP1ON")
    field(INPH, "FE14I-VA-IONP-05:SP1ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-93:SETSP1ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-93:SEQSP1ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-93:SEQSP1ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-93:SETSP1ON")
    field(DOL2, "FE14I-VA-IONP-93:SETSP1ON")
    field(DOL3, "FE14I-VA-IONP-93:SETSP1ON")
    field(DOL4, "FE14I-VA-IONP-93:SETSP1ON")
    field(DOL5, "FE14I-VA-IONP-93:SETSP1ON")
    field(DOL6, "FE14I-VA-IONP-93:SETSP1ON")
    field(DOL7, "FE14I-VA-IONP-93:SETSP1ON")
    field(DOL8, "FE14I-VA-IONP-93:SETSP1ON")
    field(LNK1, "FE14I-VA-IONP-92:SETSP1ON CA")
    field(LNK2, "FE14I-VA-IONP-05:SETSP1ON CA")
    field(LNK3, "FE14I-VA-IONP-05:SETSP1ON CA")
    field(LNK4, "FE14I-VA-IONP-05:SETSP1ON CA")
    field(LNK5, "FE14I-VA-IONP-05:SETSP1ON CA")
    field(LNK6, "FE14I-VA-IONP-05:SETSP1ON CA")
    field(LNK7, "FE14I-VA-IONP-05:SETSP1ON CA")
    field(LNK8, "FE14I-VA-IONP-05:SETSP1ON CA")
}
record(sel, "FE14I-VA-IONP-93:SP1OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-92:SP1OFF")
    field(INPB, "FE14I-VA-IONP-05:SP1OFF")
    field(INPC, "FE14I-VA-IONP-05:SP1OFF")
    field(INPD, "FE14I-VA-IONP-05:SP1OFF")
    field(INPE, "FE14I-VA-IONP-05:SP1OFF")
    field(INPF, "FE14I-VA-IONP-05:SP1OFF")
    field(INPG, "FE14I-VA-IONP-05:SP1OFF")
    field(INPH, "FE14I-VA-IONP-05:SP1OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-93:SETSP1OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-93:SEQSP1OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-93:SEQSP1OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-93:SETSP1OFF")
    field(DOL2, "FE14I-VA-IONP-93:SETSP1OFF")
    field(DOL3, "FE14I-VA-IONP-93:SETSP1OFF")
    field(DOL4, "FE14I-VA-IONP-93:SETSP1OFF")
    field(DOL5, "FE14I-VA-IONP-93:SETSP1OFF")
    field(DOL6, "FE14I-VA-IONP-93:SETSP1OFF")
    field(DOL7, "FE14I-VA-IONP-93:SETSP1OFF")
    field(DOL8, "FE14I-VA-IONP-93:SETSP1OFF")
    field(LNK1, "FE14I-VA-IONP-92:SETSP1OFF CA")
    field(LNK2, "FE14I-VA-IONP-05:SETSP1OFF CA")
    field(LNK3, "FE14I-VA-IONP-05:SETSP1OFF CA")
    field(LNK4, "FE14I-VA-IONP-05:SETSP1OFF CA")
    field(LNK5, "FE14I-VA-IONP-05:SETSP1OFF CA")
    field(LNK6, "FE14I-VA-IONP-05:SETSP1OFF CA")
    field(LNK7, "FE14I-VA-IONP-05:SETSP1OFF CA")
    field(LNK8, "FE14I-VA-IONP-05:SETSP1OFF CA")
}
################################################################################
################################################################################
# Setpoint 2
#
record(sel, "FE14I-VA-IONP-93:SP2ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-92:SP2ON")
    field(INPB, "FE14I-VA-IONP-05:SP2ON")
    field(INPC, "FE14I-VA-IONP-05:SP2ON")
    field(INPD, "FE14I-VA-IONP-05:SP2ON")
    field(INPE, "FE14I-VA-IONP-05:SP2ON")
    field(INPF, "FE14I-VA-IONP-05:SP2ON")
    field(INPG, "FE14I-VA-IONP-05:SP2ON")
    field(INPH, "FE14I-VA-IONP-05:SP2ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-93:SETSP2ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-93:SEQSP2ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-93:SEQSP2ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-93:SETSP2ON")
    field(DOL2, "FE14I-VA-IONP-93:SETSP2ON")
    field(DOL3, "FE14I-VA-IONP-93:SETSP2ON")
    field(DOL4, "FE14I-VA-IONP-93:SETSP2ON")
    field(DOL5, "FE14I-VA-IONP-93:SETSP2ON")
    field(DOL6, "FE14I-VA-IONP-93:SETSP2ON")
    field(DOL7, "FE14I-VA-IONP-93:SETSP2ON")
    field(DOL8, "FE14I-VA-IONP-93:SETSP2ON")
    field(LNK1, "FE14I-VA-IONP-92:SETSP2ON CA")
    field(LNK2, "FE14I-VA-IONP-05:SETSP2ON CA")
    field(LNK3, "FE14I-VA-IONP-05:SETSP2ON CA")
    field(LNK4, "FE14I-VA-IONP-05:SETSP2ON CA")
    field(LNK5, "FE14I-VA-IONP-05:SETSP2ON CA")
    field(LNK6, "FE14I-VA-IONP-05:SETSP2ON CA")
    field(LNK7, "FE14I-VA-IONP-05:SETSP2ON CA")
    field(LNK8, "FE14I-VA-IONP-05:SETSP2ON CA")
}
record(sel, "FE14I-VA-IONP-93:SP2OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-92:SP2OFF")
    field(INPB, "FE14I-VA-IONP-05:SP2OFF")
    field(INPC, "FE14I-VA-IONP-05:SP2OFF")
    field(INPD, "FE14I-VA-IONP-05:SP2OFF")
    field(INPE, "FE14I-VA-IONP-05:SP2OFF")
    field(INPF, "FE14I-VA-IONP-05:SP2OFF")
    field(INPG, "FE14I-VA-IONP-05:SP2OFF")
    field(INPH, "FE14I-VA-IONP-05:SP2OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-93:SETSP2OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-93:SEQSP2OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-93:SEQSP2OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-93:SETSP2OFF")
    field(DOL2, "FE14I-VA-IONP-93:SETSP2OFF")
    field(DOL3, "FE14I-VA-IONP-93:SETSP2OFF")
    field(DOL4, "FE14I-VA-IONP-93:SETSP2OFF")
    field(DOL5, "FE14I-VA-IONP-93:SETSP2OFF")
    field(DOL6, "FE14I-VA-IONP-93:SETSP2OFF")
    field(DOL7, "FE14I-VA-IONP-93:SETSP2OFF")
    field(DOL8, "FE14I-VA-IONP-93:SETSP2OFF")
    field(LNK1, "FE14I-VA-IONP-92:SETSP2OFF CA")
    field(LNK2, "FE14I-VA-IONP-05:SETSP2OFF CA")
    field(LNK3, "FE14I-VA-IONP-05:SETSP2OFF CA")
    field(LNK4, "FE14I-VA-IONP-05:SETSP2OFF CA")
    field(LNK5, "FE14I-VA-IONP-05:SETSP2OFF CA")
    field(LNK6, "FE14I-VA-IONP-05:SETSP2OFF CA")
    field(LNK7, "FE14I-VA-IONP-05:SETSP2OFF CA")
    field(LNK8, "FE14I-VA-IONP-05:SETSP2OFF CA")
}
################################################################################

# digitelMpcIonpGroup.db
#% macro, __doc__, Template database for a group of up to 8 digitel MPC Ion Pumps
# Pete Owens - 3/5/05
#
# substitutions:
# % macro, device, device name
# % macro, delay, delay between starting pumps
# % macro, ionp1, Ion pump 1 device name
# % macro, ionp2, Ion pump 2 device name
# % macro, ionp3, Ion pump 3 device name
# % macro, ionp4, Ion pump 4 device name
# % macro, ionp5, Ion pump 5 device name
# % macro, ionp6, Ion pump 6 device name
# % macro, ionp7, Ion pump 7 device name
# % macro, ionp8, Ion pump 8 device name

################################################################################
# Maximum pump current
#
record(sel, "FE14I-VA-IONP-99:I") 
{
    field(DESC, "Pump Current")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:I")
    field(INPB, "FE14I-VA-IONP-92:I")
    field(INPC, "FE14I-VA-IONP-93:I")
    field(INPD, "FE14I-VA-IONP-93:I")
    field(INPE, "FE14I-VA-IONP-93:I")
    field(INPF, "FE14I-VA-IONP-93:I")
    field(INPG, "FE14I-VA-IONP-93:I")
    field(INPH, "FE14I-VA-IONP-93:I")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Maximum pump pressure
#
record(sel, "FE14I-VA-IONP-99:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:P")
    field(INPB, "FE14I-VA-IONP-92:P")
    field(INPC, "FE14I-VA-IONP-93:P")
    field(INPD, "FE14I-VA-IONP-93:P")
    field(INPE, "FE14I-VA-IONP-93:P")
    field(INPF, "FE14I-VA-IONP-93:P")
    field(INPG, "FE14I-VA-IONP-93:P")
    field(INPH, "FE14I-VA-IONP-93:P")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calc, "FE14I-VA-IONP-99:PLOG")
{
    field(DESC, "log Pressure")
    field(SCAN, "1 second")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-99:P PP")
    field(HOPR, "3")
    field(LOPR, "-12")
}
################################################################################
# Maximum pump voltage
#
record(sel, "FE14I-VA-IONP-99:V") 
{
    field(DESC, "Pump Voltage")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:V")
    field(INPB, "FE14I-VA-IONP-92:V")
    field(INPC, "FE14I-VA-IONP-93:V")
    field(INPD, "FE14I-VA-IONP-93:V")
    field(INPE, "FE14I-VA-IONP-93:V")
    field(INPF, "FE14I-VA-IONP-93:V")
    field(INPG, "FE14I-VA-IONP-93:V")
    field(INPH, "FE14I-VA-IONP-93:V")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Maximum HV Strapping
#
record(sel, "FE14I-VA-IONP-99:HV") 
{
    field(DESC, "HV Strapping")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:HV")
    field(INPB, "FE14I-VA-IONP-92:HV")
    field(INPC, "FE14I-VA-IONP-93:HV")
    field(INPD, "FE14I-VA-IONP-93:HV")
    field(INPE, "FE14I-VA-IONP-93:HV")
    field(INPF, "FE14I-VA-IONP-93:HV")
    field(INPG, "FE14I-VA-IONP-93:HV")
    field(INPH, "FE14I-VA-IONP-93:HV")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Worst supply status
#
record(mbbi, "FE14I-VA-IONP-99:STA")
{
    field(DESC, "Supply Status")
    field(INP,  "FE14I-VA-IONP-99:CALSTA PP MS")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
}
record(calc, "FE14I-VA-IONP-99:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A>C?A:(B<C?B:C)")
    field(INPA, "FE14I-VA-IONP-99:MAXSTA PP MS")
    field(INPB, "FE14I-VA-IONP-99:MINSTA PP MS")
    field(INPC, "4")
}
record(sel, "FE14I-VA-IONP-99:MAXSTA") 
{
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:STA MS")
    field(INPB, "FE14I-VA-IONP-92:STA MS")
    field(INPC, "FE14I-VA-IONP-93:STA MS")
    field(INPD, "FE14I-VA-IONP-93:STA MS")
    field(INPE, "FE14I-VA-IONP-93:STA MS")
    field(INPF, "FE14I-VA-IONP-93:STA MS")
    field(INPG, "FE14I-VA-IONP-93:STA MS")
    field(INPH, "FE14I-VA-IONP-93:STA MS")
}
record(sel, "FE14I-VA-IONP-99:MINSTA") 
{
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-91:STA MS")
    field(INPB, "FE14I-VA-IONP-92:STA MS")
    field(INPC, "FE14I-VA-IONP-93:STA MS")
    field(INPD, "FE14I-VA-IONP-93:STA MS")
    field(INPE, "FE14I-VA-IONP-93:STA MS")
    field(INPF, "FE14I-VA-IONP-93:STA MS")
    field(INPG, "FE14I-VA-IONP-93:STA MS")
    field(INPH, "FE14I-VA-IONP-93:STA MS")
}
record(mbbi, "FE14I-VA-IONP-99:ERR")
{
    field(DESC, "Error Code")
    field(INP,  "FE14I-VA-IONP-99:SELERR PP")
    field(SCAN, "1 second")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
record(sel, "FE14I-VA-IONP-99:SELERR") 
{
    field(DESC, "Select Error")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:ERR")
    field(INPB, "FE14I-VA-IONP-92:ERR")
    field(INPC, "FE14I-VA-IONP-93:ERR")
    field(INPD, "FE14I-VA-IONP-93:ERR")
    field(INPE, "FE14I-VA-IONP-93:ERR")
    field(INPF, "FE14I-VA-IONP-93:ERR")
    field(INPG, "FE14I-VA-IONP-93:ERR")
    field(INPH, "FE14I-VA-IONP-93:ERR")
}
################################################################################
# Pump size
#
record(sel, "FE14I-VA-IONP-99:SIZE")
{
    field(DESC, "Pump Size")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:SIZE")
    field(INPB, "FE14I-VA-IONP-92:SIZE")
    field(INPC, "FE14I-VA-IONP-93:SIZE")
    field(INPD, "FE14I-VA-IONP-93:SIZE")
    field(INPE, "FE14I-VA-IONP-93:SIZE")
    field(INPF, "FE14I-VA-IONP-93:SIZE")
    field(INPG, "FE14I-VA-IONP-93:SIZE")
    field(INPH, "FE14I-VA-IONP-93:SIZE")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
record(ao, "FE14I-VA-IONP-99:SETSIZE")
{
    field(DESC, "Pump Size")
    field(DOL,  "FE14I-VA-IONP-99:SIZE PP")
    field(OMSL, "closed_loop")
    field(SCAN, "1 second")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
record(sel, "FE14I-VA-IONP-99:CAL") {
    field(DESC, "Calibration Factor")
    field(SELM, "Median Signal")
    field(INPA, "FE14I-VA-IONP-91:CAL")
    field(INPB, "FE14I-VA-IONP-92:CAL")
    field(INPC, "FE14I-VA-IONP-93:CAL")
    field(INPD, "FE14I-VA-IONP-93:CAL")
    field(INPE, "FE14I-VA-IONP-93:CAL")
    field(INPF, "FE14I-VA-IONP-93:CAL")
    field(INPG, "FE14I-VA-IONP-93:CAL")
    field(INPH, "FE14I-VA-IONP-93:CAL")
    field(SCAN, "1 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(ao, "FE14I-VA-IONP-99:SETCAL") {
    field(DESC, "Calibration Factor")
    field(FLNK, "FE14I-VA-IONP-99:SEQCAL")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
record(seq, "FE14I-VA-IONP-99:SEQCAL")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-99:SETCAL")
    field(DOL2, "FE14I-VA-IONP-99:SETCAL")
    field(DOL3, "FE14I-VA-IONP-99:SETCAL")
    field(DOL4, "FE14I-VA-IONP-99:SETCAL")
    field(DOL5, "FE14I-VA-IONP-99:SETCAL")
    field(DOL6, "FE14I-VA-IONP-99:SETCAL")
    field(DOL7, "FE14I-VA-IONP-99:SETCAL")
    field(DOL8, "FE14I-VA-IONP-99:SETCAL")
    field(LNK1, "FE14I-VA-IONP-91:SETCAL CA")
    field(LNK2, "FE14I-VA-IONP-92:SETCAL CA")
    field(LNK3, "FE14I-VA-IONP-93:SETCAL CA")
    field(LNK4, "FE14I-VA-IONP-93:SETCAL CA")
    field(LNK5, "FE14I-VA-IONP-93:SETCAL CA")
    field(LNK6, "FE14I-VA-IONP-93:SETCAL CA")
    field(LNK7, "FE14I-VA-IONP-93:SETCAL CA")
    field(LNK8, "FE14I-VA-IONP-93:SETCAL CA")
}
################################################################################
# Start
#
record(bo, "FE14I-VA-IONP-99:START")
{
    field(DESC, "HV on/off")
    field(FLNK, "FE14I-VA-IONP-99:START1")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-99:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}
record(calc,"FE14I-VA-IONP-99:START0")
{
    field(DESC, "START + 1")
    field(CALC, "A+1")
    field(INPA, "FE14I-VA-IONP-99:START")
}
record(seq, "FE14I-VA-IONP-99:START1")
{
    field(DESC, "Stop or Start Pumps")
    field(SELM, "Specified")
    field(SELL, "FE14I-VA-IONP-99:START0 PP")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-99:SEQSTOP PP")
    field(LNK2, "FE14I-VA-IONP-99:SEQSTART PP")
}
record(seq, "FE14I-VA-IONP-99:SEQSTOP")
{
    field(DESC, "Stop Pumps")
    field(SELM, "All")
    field(DOL1, "0")
    field(DOL2, "0")
    field(DOL3, "0")
    field(DOL4, "0")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "0")
    field(DOL8, "0")
    field(LNK1, "FE14I-VA-IONP-91:START CA")
    field(LNK2, "FE14I-VA-IONP-92:START CA")
    field(LNK3, "FE14I-VA-IONP-93:START CA")
    field(LNK4, "FE14I-VA-IONP-93:START CA")
    field(LNK5, "FE14I-VA-IONP-93:START CA")
    field(LNK6, "FE14I-VA-IONP-93:START CA")
    field(LNK7, "FE14I-VA-IONP-93:START CA")
    field(LNK8, "FE14I-VA-IONP-93:START CA")
}
record(seq, "FE14I-VA-IONP-99:SEQSTART")
{
    field(DESC, "Strart Pumps")
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "FE14I-VA-IONP-99:START")
    field(DOL3, "FE14I-VA-IONP-99:START")
    field(DOL4, "FE14I-VA-IONP-99:START")
    field(DOL5, "FE14I-VA-IONP-99:START")
    field(DOL6, "FE14I-VA-IONP-99:START")
    field(DOL7, "FE14I-VA-IONP-99:START")
    field(DOL8, "FE14I-VA-IONP-99:START")
    field(DOL9, "FE14I-VA-IONP-99:START")
    field(DOLA, "0")
    field(DLY1, "0")
    field(DLY2, "0")
    field(DLY3, "5")
    field(DLY4, "5")
    field(DLY5, "5")
    field(DLY6, "5")
    field(DLY7, "5")
    field(DLY8, "5")
    field(DLY9, "5")
    field(DLYA, "5")
    field(LNK1, "FE14I-VA-IONP-99:STARTING PP")
    field(LNK2, "FE14I-VA-IONP-91:START CA")
    field(LNK3, "FE14I-VA-IONP-92:START CA")
    field(LNK4, "FE14I-VA-IONP-93:START CA")
    field(LNK5, "FE14I-VA-IONP-93:START CA")
    field(LNK6, "FE14I-VA-IONP-93:START CA")
    field(LNK7, "FE14I-VA-IONP-93:START CA")
    field(LNK8, "FE14I-VA-IONP-93:START CA")
    field(LNK9, "FE14I-VA-IONP-93:START CA")
    field(LNKA, "FE14I-VA-IONP-99:STARTING PP")
}
################################################################################
# Setpoint 1
#
record(sel, "FE14I-VA-IONP-99:SP1ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:SP1ON")
    field(INPB, "FE14I-VA-IONP-92:SP1ON")
    field(INPC, "FE14I-VA-IONP-93:SP1ON")
    field(INPD, "FE14I-VA-IONP-93:SP1ON")
    field(INPE, "FE14I-VA-IONP-93:SP1ON")
    field(INPF, "FE14I-VA-IONP-93:SP1ON")
    field(INPG, "FE14I-VA-IONP-93:SP1ON")
    field(INPH, "FE14I-VA-IONP-93:SP1ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-99:SETSP1ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-99:SEQSP1ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-99:SEQSP1ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-99:SETSP1ON")
    field(DOL2, "FE14I-VA-IONP-99:SETSP1ON")
    field(DOL3, "FE14I-VA-IONP-99:SETSP1ON")
    field(DOL4, "FE14I-VA-IONP-99:SETSP1ON")
    field(DOL5, "FE14I-VA-IONP-99:SETSP1ON")
    field(DOL6, "FE14I-VA-IONP-99:SETSP1ON")
    field(DOL7, "FE14I-VA-IONP-99:SETSP1ON")
    field(DOL8, "FE14I-VA-IONP-99:SETSP1ON")
    field(LNK1, "FE14I-VA-IONP-91:SETSP1ON CA")
    field(LNK2, "FE14I-VA-IONP-92:SETSP1ON CA")
    field(LNK3, "FE14I-VA-IONP-93:SETSP1ON CA")
    field(LNK4, "FE14I-VA-IONP-93:SETSP1ON CA")
    field(LNK5, "FE14I-VA-IONP-93:SETSP1ON CA")
    field(LNK6, "FE14I-VA-IONP-93:SETSP1ON CA")
    field(LNK7, "FE14I-VA-IONP-93:SETSP1ON CA")
    field(LNK8, "FE14I-VA-IONP-93:SETSP1ON CA")
}
record(sel, "FE14I-VA-IONP-99:SP1OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-91:SP1OFF")
    field(INPB, "FE14I-VA-IONP-92:SP1OFF")
    field(INPC, "FE14I-VA-IONP-93:SP1OFF")
    field(INPD, "FE14I-VA-IONP-93:SP1OFF")
    field(INPE, "FE14I-VA-IONP-93:SP1OFF")
    field(INPF, "FE14I-VA-IONP-93:SP1OFF")
    field(INPG, "FE14I-VA-IONP-93:SP1OFF")
    field(INPH, "FE14I-VA-IONP-93:SP1OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-99:SETSP1OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-99:SEQSP1OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-99:SEQSP1OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-99:SETSP1OFF")
    field(DOL2, "FE14I-VA-IONP-99:SETSP1OFF")
    field(DOL3, "FE14I-VA-IONP-99:SETSP1OFF")
    field(DOL4, "FE14I-VA-IONP-99:SETSP1OFF")
    field(DOL5, "FE14I-VA-IONP-99:SETSP1OFF")
    field(DOL6, "FE14I-VA-IONP-99:SETSP1OFF")
    field(DOL7, "FE14I-VA-IONP-99:SETSP1OFF")
    field(DOL8, "FE14I-VA-IONP-99:SETSP1OFF")
    field(LNK1, "FE14I-VA-IONP-91:SETSP1OFF CA")
    field(LNK2, "FE14I-VA-IONP-92:SETSP1OFF CA")
    field(LNK3, "FE14I-VA-IONP-93:SETSP1OFF CA")
    field(LNK4, "FE14I-VA-IONP-93:SETSP1OFF CA")
    field(LNK5, "FE14I-VA-IONP-93:SETSP1OFF CA")
    field(LNK6, "FE14I-VA-IONP-93:SETSP1OFF CA")
    field(LNK7, "FE14I-VA-IONP-93:SETSP1OFF CA")
    field(LNK8, "FE14I-VA-IONP-93:SETSP1OFF CA")
}
################################################################################
################################################################################
# Setpoint 2
#
record(sel, "FE14I-VA-IONP-99:SP2ON") {
    field(DESC, "Setpoint 1")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IONP-91:SP2ON")
    field(INPB, "FE14I-VA-IONP-92:SP2ON")
    field(INPC, "FE14I-VA-IONP-93:SP2ON")
    field(INPD, "FE14I-VA-IONP-93:SP2ON")
    field(INPE, "FE14I-VA-IONP-93:SP2ON")
    field(INPF, "FE14I-VA-IONP-93:SP2ON")
    field(INPG, "FE14I-VA-IONP-93:SP2ON")
    field(INPH, "FE14I-VA-IONP-93:SP2ON")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-99:SETSP2ON") {
    field(DESC, "Setpoint On")
    field(FLNK, "FE14I-VA-IONP-99:SEQSP2ON")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-99:SEQSP2ON")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-99:SETSP2ON")
    field(DOL2, "FE14I-VA-IONP-99:SETSP2ON")
    field(DOL3, "FE14I-VA-IONP-99:SETSP2ON")
    field(DOL4, "FE14I-VA-IONP-99:SETSP2ON")
    field(DOL5, "FE14I-VA-IONP-99:SETSP2ON")
    field(DOL6, "FE14I-VA-IONP-99:SETSP2ON")
    field(DOL7, "FE14I-VA-IONP-99:SETSP2ON")
    field(DOL8, "FE14I-VA-IONP-99:SETSP2ON")
    field(LNK1, "FE14I-VA-IONP-91:SETSP2ON CA")
    field(LNK2, "FE14I-VA-IONP-92:SETSP2ON CA")
    field(LNK3, "FE14I-VA-IONP-93:SETSP2ON CA")
    field(LNK4, "FE14I-VA-IONP-93:SETSP2ON CA")
    field(LNK5, "FE14I-VA-IONP-93:SETSP2ON CA")
    field(LNK6, "FE14I-VA-IONP-93:SETSP2ON CA")
    field(LNK7, "FE14I-VA-IONP-93:SETSP2ON CA")
    field(LNK8, "FE14I-VA-IONP-93:SETSP2ON CA")
}
record(sel, "FE14I-VA-IONP-99:SP2OFF") {
    field(DESC, "Setpoint Off")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IONP-91:SP2OFF")
    field(INPB, "FE14I-VA-IONP-92:SP2OFF")
    field(INPC, "FE14I-VA-IONP-93:SP2OFF")
    field(INPD, "FE14I-VA-IONP-93:SP2OFF")
    field(INPE, "FE14I-VA-IONP-93:SP2OFF")
    field(INPF, "FE14I-VA-IONP-93:SP2OFF")
    field(INPG, "FE14I-VA-IONP-93:SP2OFF")
    field(INPH, "FE14I-VA-IONP-93:SP2OFF")
    field(SCAN, "1 second")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(ao, "FE14I-VA-IONP-99:SETSP2OFF") {
    field(DESC, "Setpoint 2")
    field(FLNK, "FE14I-VA-IONP-99:SEQSP2OFF")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
}
record(seq, "FE14I-VA-IONP-99:SEQSP2OFF")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IONP-99:SETSP2OFF")
    field(DOL2, "FE14I-VA-IONP-99:SETSP2OFF")
    field(DOL3, "FE14I-VA-IONP-99:SETSP2OFF")
    field(DOL4, "FE14I-VA-IONP-99:SETSP2OFF")
    field(DOL5, "FE14I-VA-IONP-99:SETSP2OFF")
    field(DOL6, "FE14I-VA-IONP-99:SETSP2OFF")
    field(DOL7, "FE14I-VA-IONP-99:SETSP2OFF")
    field(DOL8, "FE14I-VA-IONP-99:SETSP2OFF")
    field(LNK1, "FE14I-VA-IONP-91:SETSP2OFF CA")
    field(LNK2, "FE14I-VA-IONP-92:SETSP2OFF CA")
    field(LNK3, "FE14I-VA-IONP-93:SETSP2OFF CA")
    field(LNK4, "FE14I-VA-IONP-93:SETSP2OFF CA")
    field(LNK5, "FE14I-VA-IONP-93:SETSP2OFF CA")
    field(LNK6, "FE14I-VA-IONP-93:SETSP2OFF CA")
    field(LNK7, "FE14I-VA-IONP-93:SETSP2OFF CA")
    field(LNK8, "FE14I-VA-IONP-93:SETSP2OFF CA")
}
################################################################################

# mks937bGaugeGroup.template
#% macro, __doc__, Template database for a group of up to 8 MKS937B 
# combination gauges
# Pete Owens - 5/5/05
#
# substitutions:
#% macro, device, device name
#% macro, gauge1, gauge 1 device name
#% macro, gauge2, gauge 2 device name
#% macro, gauge3, gauge 3 device name
#% macro, gauge4, gauge 4 device name
#% macro, gauge5, gauge 5 device name
#% macro, gauge6, gauge 6 device name
#% macro, gauge7, gauge 7 device name
#% macro, gauge8, gauge 8 device name
#% macro, SELM, Defaults to 1 (High Signal). Set to 0 (Specified) and specify 
#               SELN in order to specify a particular gauge input to pass to 
#               the space template
#% macro, SELN, Use this to select which gauge to look at if you set SELM=0
################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(sel, "FE14I-VA-GAUGE-91:SEL")
{
    field(DESC, "Select Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-GAUGE-01:SEL MS")
    field(INPB, "FE14I-VA-GAUGE-02:SEL MS")
    field(INPC, "FE14I-VA-GAUGE-01:SEL MS")
    field(INPD, "FE14I-VA-GAUGE-01:SEL MS")
    field(INPE, "FE14I-VA-GAUGE-01:SEL MS")
    field(INPF, "FE14I-VA-GAUGE-01:SEL MS")
    field(INPG, "FE14I-VA-GAUGE-01:SEL MS")
    field(INPH, "FE14I-VA-GAUGE-01:SEL MS")
}
record(mbbi, "FE14I-VA-GAUGE-91:GAUGE")
{
    field(DESC, "Active Gauge")
    field(INP,  "FE14I-VA-GAUGE-91:SEL PP")
    field(SCAN, "1 second")
    field(ZRST, "IMG")
    field(ONST, "Pirani")
    field(TWST, "No Gauge")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MAJOR")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-GAUGE-91:PLOG")
{
    field(DESC, "log Pressure")
    field(SELM, "1")
    field(INPA, "FE14I-VA-GAUGE-01:PLOG MS")
    field(INPB, "FE14I-VA-GAUGE-02:PLOG MS")
    field(INPC, "FE14I-VA-GAUGE-01:PLOG MS")
    field(INPD, "FE14I-VA-GAUGE-01:PLOG MS")
    field(INPE, "FE14I-VA-GAUGE-01:PLOG MS")
    field(INPF, "FE14I-VA-GAUGE-01:PLOG MS")
    field(INPG, "FE14I-VA-GAUGE-01:PLOG MS")
    field(INPH, "FE14I-VA-GAUGE-01:PLOG MS")
    field(EGU,  "log")
    field(HOPR, "3")
    field(LOPR, "-11")
    field(ADEL, "0.003")
    field(SELN, "0")
}
record(calc, "FE14I-VA-GAUGE-91:P")
{
    field(DESC, "Pressure")
    field(EGU,  "mbar")
    field(CALC, "10^A")
    field(INPA, "FE14I-VA-GAUGE-91:PLOG PP MS")
    field(SCAN, "1 second")
    field(HOPR, "1000")
    field(LOPR, "1.0E-11")
}

################################################################################
# If any gauges in group have setpoint write inhibit set, then 
# set the group status to 'Inhibit'
# In the :NOWRITE bi record, 'Inhibit' => 1 so can use 'High Signal' to select
# IJG 10 Dec. 14
#
record(sel, "FE14I-VA-GAUGE-91:NWRSEL")
{
    field(DESC, "Select Inhibit status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS")
    field(INPB, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS")
    field(INPC, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS")
    field(INPD, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS")
    field(INPE, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS")
    field(INPF, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS")
    field(INPG, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS")
    field(INPH, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS")
}
record(mbbi, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE")
{
    field(DESC, "ILK setpoint write status")
    field(INP,  "FE14I-VA-GAUGE-91:NWRSEL PP")
    field(SCAN, "1 second")
    field(ZRST, "Allow")
    field(ONST, "Inhibit")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(UNSV, "NO_ALARM")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
}
# mks937bGaugeGroup.template
#% macro, __doc__, Template database for a group of up to 8 MKS937B 
# combination gauges
# Pete Owens - 5/5/05
#
# substitutions:
#% macro, device, device name
#% macro, gauge1, gauge 1 device name
#% macro, gauge2, gauge 2 device name
#% macro, gauge3, gauge 3 device name
#% macro, gauge4, gauge 4 device name
#% macro, gauge5, gauge 5 device name
#% macro, gauge6, gauge 6 device name
#% macro, gauge7, gauge 7 device name
#% macro, gauge8, gauge 8 device name
#% macro, SELM, Defaults to 1 (High Signal). Set to 0 (Specified) and specify 
#               SELN in order to specify a particular gauge input to pass to 
#               the space template
#% macro, SELN, Use this to select which gauge to look at if you set SELM=0
################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(sel, "FE14I-VA-GAUGE-92:SEL")
{
    field(DESC, "Select Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-GAUGE-03:SEL MS")
    field(INPB, "FE14I-VA-GAUGE-04:SEL MS")
    field(INPC, "FE14I-VA-GAUGE-05:SEL MS")
    field(INPD, "FE14I-VA-GAUGE-06:SEL MS")
    field(INPE, "FE14I-VA-GAUGE-06:SEL MS")
    field(INPF, "FE14I-VA-GAUGE-06:SEL MS")
    field(INPG, "FE14I-VA-GAUGE-06:SEL MS")
    field(INPH, "FE14I-VA-GAUGE-06:SEL MS")
}
record(mbbi, "FE14I-VA-GAUGE-92:GAUGE")
{
    field(DESC, "Active Gauge")
    field(INP,  "FE14I-VA-GAUGE-92:SEL PP")
    field(SCAN, "1 second")
    field(ZRST, "IMG")
    field(ONST, "Pirani")
    field(TWST, "No Gauge")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MAJOR")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-GAUGE-92:PLOG")
{
    field(DESC, "log Pressure")
    field(SELM, "1")
    field(INPA, "FE14I-VA-GAUGE-03:PLOG MS")
    field(INPB, "FE14I-VA-GAUGE-04:PLOG MS")
    field(INPC, "FE14I-VA-GAUGE-05:PLOG MS")
    field(INPD, "FE14I-VA-GAUGE-06:PLOG MS")
    field(INPE, "FE14I-VA-GAUGE-06:PLOG MS")
    field(INPF, "FE14I-VA-GAUGE-06:PLOG MS")
    field(INPG, "FE14I-VA-GAUGE-06:PLOG MS")
    field(INPH, "FE14I-VA-GAUGE-06:PLOG MS")
    field(EGU,  "log")
    field(HOPR, "3")
    field(LOPR, "-11")
    field(ADEL, "0.003")
    field(SELN, "0")
}
record(calc, "FE14I-VA-GAUGE-92:P")
{
    field(DESC, "Pressure")
    field(EGU,  "mbar")
    field(CALC, "10^A")
    field(INPA, "FE14I-VA-GAUGE-92:PLOG PP MS")
    field(SCAN, "1 second")
    field(HOPR, "1000")
    field(LOPR, "1.0E-11")
}

################################################################################
# If any gauges in group have setpoint write inhibit set, then 
# set the group status to 'Inhibit'
# In the :NOWRITE bi record, 'Inhibit' => 1 so can use 'High Signal' to select
# IJG 10 Dec. 14
#
record(sel, "FE14I-VA-GAUGE-92:NWRSEL")
{
    field(DESC, "Select Inhibit status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS")
    field(INPB, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS")
    field(INPC, "FE14I-VA-GAUGE-05:ILKSETSP:NOWRITE MS")
    field(INPD, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE MS")
    field(INPE, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE MS")
    field(INPF, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE MS")
    field(INPG, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE MS")
    field(INPH, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE MS")
}
record(mbbi, "FE14I-VA-GAUGE-92:ILKSETSP:NOWRITE")
{
    field(DESC, "ILK setpoint write status")
    field(INP,  "FE14I-VA-GAUGE-92:NWRSEL PP")
    field(SCAN, "1 second")
    field(ZRST, "Allow")
    field(ONST, "Inhibit")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(UNSV, "NO_ALARM")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
}
# mks937bGaugeGroup.template
#% macro, __doc__, Template database for a group of up to 8 MKS937B 
# combination gauges
# Pete Owens - 5/5/05
#
# substitutions:
#% macro, device, device name
#% macro, gauge1, gauge 1 device name
#% macro, gauge2, gauge 2 device name
#% macro, gauge3, gauge 3 device name
#% macro, gauge4, gauge 4 device name
#% macro, gauge5, gauge 5 device name
#% macro, gauge6, gauge 6 device name
#% macro, gauge7, gauge 7 device name
#% macro, gauge8, gauge 8 device name
#% macro, SELM, Defaults to 1 (High Signal). Set to 0 (Specified) and specify 
#               SELN in order to specify a particular gauge input to pass to 
#               the space template
#% macro, SELN, Use this to select which gauge to look at if you set SELM=0
################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(sel, "FE14I-VA-GAUGE-99:SEL")
{
    field(DESC, "Select Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-GAUGE-91:SEL MS")
    field(INPB, "FE14I-VA-GAUGE-92:SEL MS")
    field(INPC, "FE14I-VA-GAUGE-91:SEL MS")
    field(INPD, "FE14I-VA-GAUGE-91:SEL MS")
    field(INPE, "FE14I-VA-GAUGE-91:SEL MS")
    field(INPF, "FE14I-VA-GAUGE-91:SEL MS")
    field(INPG, "FE14I-VA-GAUGE-91:SEL MS")
    field(INPH, "FE14I-VA-GAUGE-91:SEL MS")
}
record(mbbi, "FE14I-VA-GAUGE-99:GAUGE")
{
    field(DESC, "Active Gauge")
    field(INP,  "FE14I-VA-GAUGE-99:SEL PP")
    field(SCAN, "1 second")
    field(ZRST, "IMG")
    field(ONST, "Pirani")
    field(TWST, "No Gauge")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MAJOR")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-GAUGE-99:PLOG")
{
    field(DESC, "log Pressure")
    field(SELM, "1")
    field(INPA, "FE14I-VA-GAUGE-91:PLOG MS")
    field(INPB, "FE14I-VA-GAUGE-92:PLOG MS")
    field(INPC, "FE14I-VA-GAUGE-91:PLOG MS")
    field(INPD, "FE14I-VA-GAUGE-91:PLOG MS")
    field(INPE, "FE14I-VA-GAUGE-91:PLOG MS")
    field(INPF, "FE14I-VA-GAUGE-91:PLOG MS")
    field(INPG, "FE14I-VA-GAUGE-91:PLOG MS")
    field(INPH, "FE14I-VA-GAUGE-91:PLOG MS")
    field(EGU,  "log")
    field(HOPR, "3")
    field(LOPR, "-11")
    field(ADEL, "0.003")
    field(SELN, "0")
}
record(calc, "FE14I-VA-GAUGE-99:P")
{
    field(DESC, "Pressure")
    field(EGU,  "mbar")
    field(CALC, "10^A")
    field(INPA, "FE14I-VA-GAUGE-99:PLOG PP MS")
    field(SCAN, "1 second")
    field(HOPR, "1000")
    field(LOPR, "1.0E-11")
}

################################################################################
# If any gauges in group have setpoint write inhibit set, then 
# set the group status to 'Inhibit'
# In the :NOWRITE bi record, 'Inhibit' => 1 so can use 'High Signal' to select
# IJG 10 Dec. 14
#
record(sel, "FE14I-VA-GAUGE-99:NWRSEL")
{
    field(DESC, "Select Inhibit status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE MS")
    field(INPB, "FE14I-VA-GAUGE-92:ILKSETSP:NOWRITE MS")
    field(INPC, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE MS")
    field(INPD, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE MS")
    field(INPE, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE MS")
    field(INPF, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE MS")
    field(INPG, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE MS")
    field(INPH, "FE14I-VA-GAUGE-91:ILKSETSP:NOWRITE MS")
}
record(mbbi, "FE14I-VA-GAUGE-99:ILKSETSP:NOWRITE")
{
    field(DESC, "ILK setpoint write status")
    field(INP,  "FE14I-VA-GAUGE-99:NWRSEL PP")
    field(SCAN, "1 second")
    field(ZRST, "Allow")
    field(ONST, "Inhibit")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(UNSV, "NO_ALARM")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
}
# mks937bImgGroup.template
#% macro, __doc__, Template database for a group of up to 8 IMGs
# Pete Owens - 10/5/05
#
# substitutions:
#% macro, device, device name
#% macro, delay, delay between starting each IMG
#% macro, img1, img 1 device name
#% macro, img2, img 2 device name
#% macro, img3, img 3 device name
#% macro, img4, img 4 device name
#% macro, img5, img 5 device name
#% macro, img6, img 6 device name
#% macro, img7, img 7 device name
#% macro, img8, img 8 device name
#% macro, valveIlRelay, Valve interlock relay
#% macro, mpsIlRelay1 , Machine protection system interlock 1 relay
#% macro, mpsIlRelay2 , Machine protection system interlock 2 relay
#% macro, rgaIlRelay  , RGA interlock relay
################################################################################
# Cold Cathode Enable
#
record(bo, "FE14I-VA-IMG-91:CCHV")
{
    field(DESC, "Cold Cathode Enable")
    field(FLNK, "FE14I-VA-IMG-91:SEQCCHV")
    field(ZNAM, "Off")
    field(ONAM, "On")
}
record(bi,"FE14I-VA-IMG-91:SWITCHING")
{
    field(DESC, "Switching")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Switching")
}
record(seq, "FE14I-VA-IMG-91:SEQCCHV")
{
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "FE14I-VA-IMG-91:CCHV")
    field(DOL3, "FE14I-VA-IMG-91:CCHV")
    field(DOL4, "FE14I-VA-IMG-91:CCHV")
    field(DOL5, "FE14I-VA-IMG-91:CCHV")
    field(DOL6, "FE14I-VA-IMG-91:CCHV")
    field(DOL7, "FE14I-VA-IMG-91:CCHV")
    field(DOL8, "FE14I-VA-IMG-91:CCHV")
    field(DOL9, "FE14I-VA-IMG-91:CCHV")
    field(DOLA, "0")
    field(DLY1, "0")
    field(DLY2, "0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY5, "0")
    field(DLY6, "0")
    field(DLY7, "0")
    field(DLY8, "0")
    field(DLY9, "0")
    field(DLYA, "0")
    field(LNK1, "FE14I-VA-IMG-91:SWITCHING PP")
    field(LNK2, "FE14I-VA-IMG-01:CCHV CA")
    field(LNK3, "FE14I-VA-IMG-02:CCHV CA")
    field(LNK4, "FE14I-VA-IMG-01:CCHV CA")
    field(LNK5, "FE14I-VA-IMG-01:CCHV CA")
    field(LNK6, "FE14I-VA-IMG-01:CCHV CA")
    field(LNK7, "FE14I-VA-IMG-01:CCHV CA")
    field(LNK8, "FE14I-VA-IMG-01:CCHV CA")
    field(LNK9, "FE14I-VA-IMG-01:CCHV CA")
    field(LNKA, "FE14I-VA-IMG-91:SWITCHING PP")
}
################################################################################
# Status
#
record(mbbi, "FE14I-VA-IMG-91:STA")
{
    field(DESC, "Status")
    field(INP,  "FE14I-VA-IMG-91:SELSTA PP MS")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IMG-91:P")
    field(ZRST, "OK")
    field(ONST, "OK")
    field(TWST, "Above Range")
    field(THST, "At Atmosphere")
    field(FRST, "Low Emission")
    field(FVST, "Filament Off")
    field(SXST, "HV Off")
    field(SVST, "Startup Delay")
    field(EIST, "Below Range")
    field(NIST, "Controlled")
    field(TEST, "Protected State")
    field(ELST, "No Gauge")
    field(TVST, "Not Connected")
    field(TTST, "Wrong Gauge")
    field(FTST, "Bad Command")
    field(FFST, "Locked Out")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MAJOR")
    field(FVSV, "MAJOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MINOR")
    field(EISV, "NO_ALARM")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
}
record(sel, "FE14I-VA-IMG-91:SELSTA") 
{
    field(DESC, "Select Status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:STA MS")
    field(INPB, "FE14I-VA-IMG-02:STA MS")
    field(INPC, "FE14I-VA-IMG-01:STA MS")
    field(INPD, "FE14I-VA-IMG-01:STA MS")
    field(INPE, "FE14I-VA-IMG-01:STA MS")
    field(INPF, "FE14I-VA-IMG-01:STA MS")
    field(INPG, "FE14I-VA-IMG-01:STA MS")
    field(INPH, "FE14I-VA-IMG-01:STA MS")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-IMG-91:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:P MS")
    field(INPB, "FE14I-VA-IMG-02:P MS")
    field(INPC, "FE14I-VA-IMG-01:P MS")
    field(INPD, "FE14I-VA-IMG-01:P MS")
    field(INPE, "FE14I-VA-IMG-01:P MS")
    field(INPF, "FE14I-VA-IMG-01:P MS")
    field(INPG, "FE14I-VA-IMG-01:P MS")
    field(INPH, "FE14I-VA-IMG-01:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(calc, "FE14I-VA-IMG-91:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IMG-91:P PP MS")
    field(FLNK, "FE14I-VA-IMG-91:PMAX")
    field(SCAN, "1 second")
    field(HOPR, "-2")
    field(LOPR, "-11")
}
record(sel, "FE14I-VA-IMG-91:PMAX")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:PMAX")
    field(INPB, "FE14I-VA-IMG-02:PMAX")
    field(INPC, "FE14I-VA-IMG-01:PMAX")
    field(INPD, "FE14I-VA-IMG-01:PMAX")
    field(INPE, "FE14I-VA-IMG-01:PMAX")
    field(INPF, "FE14I-VA-IMG-01:PMAX")
    field(INPG, "FE14I-VA-IMG-01:PMAX")
    field(INPH, "FE14I-VA-IMG-01:PMAX")
    field(FLNK, "FE14I-VA-IMG-91:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(sel, "FE14I-VA-IMG-91:PMIN")
{
    field(DESC, "Pressure")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IMG-01:PMIN")
    field(INPB, "FE14I-VA-IMG-02:PMIN")
    field(INPC, "FE14I-VA-IMG-01:PMIN")
    field(INPD, "FE14I-VA-IMG-01:PMIN")
    field(INPE, "FE14I-VA-IMG-01:PMIN")
    field(INPF, "FE14I-VA-IMG-01:PMIN")
    field(INPG, "FE14I-VA-IMG-01:PMIN")
    field(INPH, "FE14I-VA-IMG-01:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
################################################################################
# Protection - IMG Overpressure
#
record(ao, "FE14I-VA-IMG-91:PRO:OUTSP")
{
    field(DESC, "IMG Overpressure")
    field(FLNK, "FE14I-VA-IMG-91:PRO:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
    field(DRVH, "1.0e-2")
    field(DRVL, "1.3e-5")
    field(DOL , "5.0e-4")
}
record(seq, "FE14I-VA-IMG-91:PRO:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(DOL2, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(DOL3, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(DOL4, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(DOL5, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(DOL6, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(DOL7, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(DOL8, "FE14I-VA-IMG-91:PRO:OUTSP")
    field(LNK1, "FE14I-VA-IMG-01:PRO:OUTSP CA")
    field(LNK2, "FE14I-VA-IMG-02:PRO:OUTSP CA")
    field(LNK3, "FE14I-VA-IMG-01:PRO:OUTSP CA")
    field(LNK4, "FE14I-VA-IMG-01:PRO:OUTSP CA")
    field(LNK5, "FE14I-VA-IMG-01:PRO:OUTSP CA")
    field(LNK6, "FE14I-VA-IMG-01:PRO:OUTSP CA")
    field(LNK7, "FE14I-VA-IMG-01:PRO:OUTSP CA")
    field(LNK8, "FE14I-VA-IMG-01:PRO:OUTSP CA")
}
#record(mbbo, "FE14I-VA-IMG-91:PRO:ENABLE")
#{
#    field(DESC, "Enable Protection Setpoint")
#    field(FLNK, "FE14I-VA-IMG-91:PRO:SEQENA")
#    field(ZRST, "Force On I/L")
#    field(ONST, "I/L Operating")
#    field(ZRVL, "1")
#    field(ONVL, "2")
#    field(ZRSV, "MAJOR")
#    field(ONSV, "NO_ALARM")
#    field(DOL , "1")
#    field(PINI, "YES")
#}
#record(seq, "FE14I-VA-IMG-91:PRO:SEQENA")
#{
#    field(SELM, "All")
#    field(DOL1, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(DOL2, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(DOL3, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(DOL4, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(DOL5, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(DOL6, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(DOL7, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(DOL8, "FE14I-VA-IMG-91:PRO:ENABLE")
#    field(LNK1, "FE14I-VA-IMG-01:PRO:ENABLE CA")
#    field(LNK2, "FE14I-VA-IMG-02:PRO:ENABLE CA")
#    field(LNK3, "FE14I-VA-IMG-01:PRO:ENABLE CA")
#    field(LNK4, "FE14I-VA-IMG-01:PRO:ENABLE CA")
#    field(LNK5, "FE14I-VA-IMG-01:PRO:ENABLE CA")
#    field(LNK6, "FE14I-VA-IMG-01:PRO:ENABLE CA")
#    field(LNK7, "FE14I-VA-IMG-01:PRO:ENABLE CA")
#    field(LNK8, "FE14I-VA-IMG-01:PRO:ENABLE CA")
#}
record(sel, "FE14I-VA-IMG-91:PRO:SP")
{
    field(DESC, "IMG Overpressure")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:PRO:SP MS")
    field(INPB, "FE14I-VA-IMG-02:PRO:SP MS")
    field(INPC, "FE14I-VA-IMG-01:PRO:SP MS")
    field(INPD, "FE14I-VA-IMG-01:PRO:SP MS")
    field(INPE, "FE14I-VA-IMG-01:PRO:SP MS")
    field(INPF, "FE14I-VA-IMG-01:PRO:SP MS")
    field(INPG, "FE14I-VA-IMG-01:PRO:SP MS")
    field(INPH, "FE14I-VA-IMG-01:PRO:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
################################################################################
# Relay - Valve Interlock
#
record(ao, "FE14I-VA-IMG-91:RLY1:SETSP")
{
    field(DESC, "Valve I/L")
    field(FLNK, "FE14I-VA-IMG-91:RLY1:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-6")
}
record(seq, "FE14I-VA-IMG-91:RLY1:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(DOL2, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(DOL3, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(DOL4, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(DOL5, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(DOL6, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(DOL7, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(DOL8, "FE14I-VA-IMG-91:RLY1:SETSP")
    field(LNK1, "FE14I-VA-IMG-01:RLY1:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-02:RLY1:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-01:RLY1:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-01:RLY1:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-01:RLY1:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-01:RLY1:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-01:RLY1:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-01:RLY1:SETSP CA")
}

record(sel, "FE14I-VA-IMG-91:RLY1:SP")
{
    field(DESC, "Valve Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY1:SP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY1:SP MS")
    field(INPC, "FE14I-VA-IMG-01:RLY1:SP MS")
    field(INPD, "FE14I-VA-IMG-01:RLY1:SP MS")
    field(INPE, "FE14I-VA-IMG-01:RLY1:SP MS")
    field(INPF, "FE14I-VA-IMG-01:RLY1:SP MS")
    field(INPG, "FE14I-VA-IMG-01:RLY1:SP MS")
    field(INPH, "FE14I-VA-IMG-01:RLY1:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
################################################################################
# Relay 2 (Channel A Only) - MPS Interlock 1
#
record(sel, "FE14I-VA-IMG-91:RLY2:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY2:EXISTS")
    field(INPB, "FE14I-VA-IMG-02:RLY2:EXISTS")
    field(INPC, "FE14I-VA-IMG-01:RLY2:EXISTS")
    field(INPD, "FE14I-VA-IMG-01:RLY2:EXISTS")
    field(INPE, "FE14I-VA-IMG-01:RLY2:EXISTS")
    field(INPF, "FE14I-VA-IMG-01:RLY2:EXISTS")
    field(INPG, "FE14I-VA-IMG-01:RLY2:EXISTS")
    field(INPH, "FE14I-VA-IMG-01:RLY2:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-91:RLY2:SETSP")
{
    field(DESC, "MPS Interlock 1")
    field(FLNK, "FE14I-VA-IMG-91:RLY2:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(seq, "FE14I-VA-IMG-91:RLY2:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(DOL2, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(DOL3, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(DOL4, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(DOL5, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(DOL6, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(DOL7, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(DOL8, "FE14I-VA-IMG-91:RLY2:SETSP")
    field(LNK1, "FE14I-VA-IMG-01:RLY2:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-02:RLY2:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-01:RLY2:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-01:RLY2:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-01:RLY2:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-01:RLY2:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-01:RLY2:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-01:RLY2:SETSP CA")
}

record(sel, "FE14I-VA-IMG-91:RLY2:SP")
{
    field(DESC, "MPS Interlock 1")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY2:SP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY2:SP MS")
    field(INPC, "FE14I-VA-IMG-01:RLY2:SP MS")
    field(INPD, "FE14I-VA-IMG-01:RLY2:SP MS")
    field(INPE, "FE14I-VA-IMG-01:RLY2:SP MS")
    field(INPF, "FE14I-VA-IMG-01:RLY2:SP MS")
    field(INPG, "FE14I-VA-IMG-01:RLY2:SP MS")
    field(INPH, "FE14I-VA-IMG-01:RLY2:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################
################################################################################
# Relay 3 (Channel A Only) - MPS Interlock 2
#
record(sel, "FE14I-VA-IMG-91:RLY3:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY3:EXISTS")
    field(INPB, "FE14I-VA-IMG-02:RLY3:EXISTS")
    field(INPC, "FE14I-VA-IMG-01:RLY3:EXISTS")
    field(INPD, "FE14I-VA-IMG-01:RLY3:EXISTS")
    field(INPE, "FE14I-VA-IMG-01:RLY3:EXISTS")
    field(INPF, "FE14I-VA-IMG-01:RLY3:EXISTS")
    field(INPG, "FE14I-VA-IMG-01:RLY3:EXISTS")
    field(INPH, "FE14I-VA-IMG-01:RLY3:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-91:RLY3:SETSP")
{
    field(DESC, "MPS Interlock 2")
    field(FLNK, "FE14I-VA-IMG-91:RLY3:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(seq, "FE14I-VA-IMG-91:RLY3:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(DOL2, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(DOL3, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(DOL4, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(DOL5, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(DOL6, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(DOL7, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(DOL8, "FE14I-VA-IMG-91:RLY3:SETSP")
    field(LNK1, "FE14I-VA-IMG-01:RLY3:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-02:RLY3:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-01:RLY3:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-01:RLY3:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-01:RLY3:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-01:RLY3:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-01:RLY3:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-01:RLY3:SETSP CA")
}

record(sel, "FE14I-VA-IMG-91:RLY3:SP")
{
    field(DESC, "MPS Interlock 2")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY3:SP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY3:SP MS")
    field(INPC, "FE14I-VA-IMG-01:RLY3:SP MS")
    field(INPD, "FE14I-VA-IMG-01:RLY3:SP MS")
    field(INPE, "FE14I-VA-IMG-01:RLY3:SP MS")
    field(INPF, "FE14I-VA-IMG-01:RLY3:SP MS")
    field(INPG, "FE14I-VA-IMG-01:RLY3:SP MS")
    field(INPH, "FE14I-VA-IMG-01:RLY3:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################

################################################################################
# Relay 4 - RGA Interlock
#
record(sel, "FE14I-VA-IMG-91:RLY4:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY4:EXISTS")
    field(INPB, "FE14I-VA-IMG-02:RLY4:EXISTS")
    field(INPC, "FE14I-VA-IMG-01:RLY4:EXISTS")
    field(INPD, "FE14I-VA-IMG-01:RLY4:EXISTS")
    field(INPE, "FE14I-VA-IMG-01:RLY4:EXISTS")
    field(INPF, "FE14I-VA-IMG-01:RLY4:EXISTS")
    field(INPG, "FE14I-VA-IMG-01:RLY4:EXISTS")
    field(INPH, "FE14I-VA-IMG-01:RLY4:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-91:RLY4:SETSP")
{
    field(DESC, "RGA Interlock")
    field(FLNK, "FE14I-VA-IMG-91:RLY4:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-4")
}
record(seq, "FE14I-VA-IMG-91:RLY4:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(DOL2, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(DOL3, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(DOL4, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(DOL5, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(DOL6, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(DOL7, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(DOL8, "FE14I-VA-IMG-91:RLY4:SETSP")
    field(LNK1, "FE14I-VA-IMG-01:RLY4:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-02:RLY4:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-01:RLY4:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-01:RLY4:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-01:RLY4:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-01:RLY4:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-01:RLY4:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-01:RLY4:SETSP CA")
}

record(sel, "FE14I-VA-IMG-91:RLY4:SP")
{
    field(DESC, "RGA Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY4:SP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY4:SP MS")
    field(INPC, "FE14I-VA-IMG-01:RLY4:SP MS")
    field(INPD, "FE14I-VA-IMG-01:RLY4:SP MS")
    field(INPE, "FE14I-VA-IMG-01:RLY4:SP MS")
    field(INPF, "FE14I-VA-IMG-01:RLY4:SP MS")
    field(INPG, "FE14I-VA-IMG-01:RLY4:SP MS")
    field(INPH, "FE14I-VA-IMG-01:RLY4:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################

################################################################################
# Relay FRLY - Fast Valve Interlock
#
record(sel, "FE14I-VA-IMG-91:FRLY:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:FRLY:EXISTS")
    field(INPB, "FE14I-VA-IMG-02:FRLY:EXISTS")
    field(INPC, "FE14I-VA-IMG-01:FRLY:EXISTS")
    field(INPD, "FE14I-VA-IMG-01:FRLY:EXISTS")
    field(INPE, "FE14I-VA-IMG-01:FRLY:EXISTS")
    field(INPF, "FE14I-VA-IMG-01:FRLY:EXISTS")
    field(INPG, "FE14I-VA-IMG-01:FRLY:EXISTS")
    field(INPH, "FE14I-VA-IMG-01:FRLY:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-91:FRLY:SETSP")
{
    field(DESC, "Fast Valve Interlock")
    field(FLNK, "FE14I-VA-IMG-91:FRLY:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-5")
}
record(seq, "FE14I-VA-IMG-91:FRLY:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(DOL2, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(DOL3, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(DOL4, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(DOL5, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(DOL6, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(DOL7, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(DOL8, "FE14I-VA-IMG-91:FRLY:SETSP")
    field(LNK1, "FE14I-VA-IMG-01:FRLY:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-02:FRLY:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-01:FRLY:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-01:FRLY:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-01:FRLY:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-01:FRLY:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-01:FRLY:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-01:FRLY:SETSP CA")
}

record(sel, "FE14I-VA-IMG-91:FRLY:SP")
{
    field(DESC, "Fast Valve Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:FRLY:SP MS")
    field(INPB, "FE14I-VA-IMG-02:FRLY:SP MS")
    field(INPC, "FE14I-VA-IMG-01:FRLY:SP MS")
    field(INPD, "FE14I-VA-IMG-01:FRLY:SP MS")
    field(INPE, "FE14I-VA-IMG-01:FRLY:SP MS")
    field(INPF, "FE14I-VA-IMG-01:FRLY:SP MS")
    field(INPG, "FE14I-VA-IMG-01:FRLY:SP MS")
    field(INPH, "FE14I-VA-IMG-01:FRLY:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################
# mks937bImgGroup.template
#% macro, __doc__, Template database for a group of up to 8 IMGs
# Pete Owens - 10/5/05
#
# substitutions:
#% macro, device, device name
#% macro, delay, delay between starting each IMG
#% macro, img1, img 1 device name
#% macro, img2, img 2 device name
#% macro, img3, img 3 device name
#% macro, img4, img 4 device name
#% macro, img5, img 5 device name
#% macro, img6, img 6 device name
#% macro, img7, img 7 device name
#% macro, img8, img 8 device name
#% macro, valveIlRelay, Valve interlock relay
#% macro, mpsIlRelay1 , Machine protection system interlock 1 relay
#% macro, mpsIlRelay2 , Machine protection system interlock 2 relay
#% macro, rgaIlRelay  , RGA interlock relay
################################################################################
# Cold Cathode Enable
#
record(bo, "FE14I-VA-IMG-92:CCHV")
{
    field(DESC, "Cold Cathode Enable")
    field(FLNK, "FE14I-VA-IMG-92:SEQCCHV")
    field(ZNAM, "Off")
    field(ONAM, "On")
}
record(bi,"FE14I-VA-IMG-92:SWITCHING")
{
    field(DESC, "Switching")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Switching")
}
record(seq, "FE14I-VA-IMG-92:SEQCCHV")
{
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "FE14I-VA-IMG-92:CCHV")
    field(DOL3, "FE14I-VA-IMG-92:CCHV")
    field(DOL4, "FE14I-VA-IMG-92:CCHV")
    field(DOL5, "FE14I-VA-IMG-92:CCHV")
    field(DOL6, "FE14I-VA-IMG-92:CCHV")
    field(DOL7, "FE14I-VA-IMG-92:CCHV")
    field(DOL8, "FE14I-VA-IMG-92:CCHV")
    field(DOL9, "FE14I-VA-IMG-92:CCHV")
    field(DOLA, "0")
    field(DLY1, "0")
    field(DLY2, "0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY5, "0")
    field(DLY6, "0")
    field(DLY7, "0")
    field(DLY8, "0")
    field(DLY9, "0")
    field(DLYA, "0")
    field(LNK1, "FE14I-VA-IMG-92:SWITCHING PP")
    field(LNK2, "FE14I-VA-IMG-03:CCHV CA")
    field(LNK3, "FE14I-VA-IMG-04:CCHV CA")
    field(LNK4, "FE14I-VA-IMG-05:CCHV CA")
    field(LNK5, "FE14I-VA-IMG-06:CCHV CA")
    field(LNK6, "FE14I-VA-IMG-06:CCHV CA")
    field(LNK7, "FE14I-VA-IMG-06:CCHV CA")
    field(LNK8, "FE14I-VA-IMG-06:CCHV CA")
    field(LNK9, "FE14I-VA-IMG-06:CCHV CA")
    field(LNKA, "FE14I-VA-IMG-92:SWITCHING PP")
}
################################################################################
# Status
#
record(mbbi, "FE14I-VA-IMG-92:STA")
{
    field(DESC, "Status")
    field(INP,  "FE14I-VA-IMG-92:SELSTA PP MS")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IMG-92:P")
    field(ZRST, "OK")
    field(ONST, "OK")
    field(TWST, "Above Range")
    field(THST, "At Atmosphere")
    field(FRST, "Low Emission")
    field(FVST, "Filament Off")
    field(SXST, "HV Off")
    field(SVST, "Startup Delay")
    field(EIST, "Below Range")
    field(NIST, "Controlled")
    field(TEST, "Protected State")
    field(ELST, "No Gauge")
    field(TVST, "Not Connected")
    field(TTST, "Wrong Gauge")
    field(FTST, "Bad Command")
    field(FFST, "Locked Out")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MAJOR")
    field(FVSV, "MAJOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MINOR")
    field(EISV, "NO_ALARM")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
}
record(sel, "FE14I-VA-IMG-92:SELSTA") 
{
    field(DESC, "Select Status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:STA MS")
    field(INPB, "FE14I-VA-IMG-04:STA MS")
    field(INPC, "FE14I-VA-IMG-05:STA MS")
    field(INPD, "FE14I-VA-IMG-06:STA MS")
    field(INPE, "FE14I-VA-IMG-06:STA MS")
    field(INPF, "FE14I-VA-IMG-06:STA MS")
    field(INPG, "FE14I-VA-IMG-06:STA MS")
    field(INPH, "FE14I-VA-IMG-06:STA MS")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-IMG-92:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:P MS")
    field(INPB, "FE14I-VA-IMG-04:P MS")
    field(INPC, "FE14I-VA-IMG-05:P MS")
    field(INPD, "FE14I-VA-IMG-06:P MS")
    field(INPE, "FE14I-VA-IMG-06:P MS")
    field(INPF, "FE14I-VA-IMG-06:P MS")
    field(INPG, "FE14I-VA-IMG-06:P MS")
    field(INPH, "FE14I-VA-IMG-06:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(calc, "FE14I-VA-IMG-92:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IMG-92:P PP MS")
    field(FLNK, "FE14I-VA-IMG-92:PMAX")
    field(SCAN, "1 second")
    field(HOPR, "-2")
    field(LOPR, "-11")
}
record(sel, "FE14I-VA-IMG-92:PMAX")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:PMAX")
    field(INPB, "FE14I-VA-IMG-04:PMAX")
    field(INPC, "FE14I-VA-IMG-05:PMAX")
    field(INPD, "FE14I-VA-IMG-06:PMAX")
    field(INPE, "FE14I-VA-IMG-06:PMAX")
    field(INPF, "FE14I-VA-IMG-06:PMAX")
    field(INPG, "FE14I-VA-IMG-06:PMAX")
    field(INPH, "FE14I-VA-IMG-06:PMAX")
    field(FLNK, "FE14I-VA-IMG-92:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(sel, "FE14I-VA-IMG-92:PMIN")
{
    field(DESC, "Pressure")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IMG-03:PMIN")
    field(INPB, "FE14I-VA-IMG-04:PMIN")
    field(INPC, "FE14I-VA-IMG-05:PMIN")
    field(INPD, "FE14I-VA-IMG-06:PMIN")
    field(INPE, "FE14I-VA-IMG-06:PMIN")
    field(INPF, "FE14I-VA-IMG-06:PMIN")
    field(INPG, "FE14I-VA-IMG-06:PMIN")
    field(INPH, "FE14I-VA-IMG-06:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
################################################################################
# Protection - IMG Overpressure
#
record(ao, "FE14I-VA-IMG-92:PRO:OUTSP")
{
    field(DESC, "IMG Overpressure")
    field(FLNK, "FE14I-VA-IMG-92:PRO:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
    field(DRVH, "1.0e-2")
    field(DRVL, "1.3e-5")
    field(DOL , "5.0e-4")
}
record(seq, "FE14I-VA-IMG-92:PRO:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(DOL2, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(DOL3, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(DOL4, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(DOL5, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(DOL6, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(DOL7, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(DOL8, "FE14I-VA-IMG-92:PRO:OUTSP")
    field(LNK1, "FE14I-VA-IMG-03:PRO:OUTSP CA")
    field(LNK2, "FE14I-VA-IMG-04:PRO:OUTSP CA")
    field(LNK3, "FE14I-VA-IMG-05:PRO:OUTSP CA")
    field(LNK4, "FE14I-VA-IMG-06:PRO:OUTSP CA")
    field(LNK5, "FE14I-VA-IMG-06:PRO:OUTSP CA")
    field(LNK6, "FE14I-VA-IMG-06:PRO:OUTSP CA")
    field(LNK7, "FE14I-VA-IMG-06:PRO:OUTSP CA")
    field(LNK8, "FE14I-VA-IMG-06:PRO:OUTSP CA")
}
#record(mbbo, "FE14I-VA-IMG-92:PRO:ENABLE")
#{
#    field(DESC, "Enable Protection Setpoint")
#    field(FLNK, "FE14I-VA-IMG-92:PRO:SEQENA")
#    field(ZRST, "Force On I/L")
#    field(ONST, "I/L Operating")
#    field(ZRVL, "1")
#    field(ONVL, "2")
#    field(ZRSV, "MAJOR")
#    field(ONSV, "NO_ALARM")
#    field(DOL , "1")
#    field(PINI, "YES")
#}
#record(seq, "FE14I-VA-IMG-92:PRO:SEQENA")
#{
#    field(SELM, "All")
#    field(DOL1, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(DOL2, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(DOL3, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(DOL4, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(DOL5, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(DOL6, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(DOL7, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(DOL8, "FE14I-VA-IMG-92:PRO:ENABLE")
#    field(LNK1, "FE14I-VA-IMG-03:PRO:ENABLE CA")
#    field(LNK2, "FE14I-VA-IMG-04:PRO:ENABLE CA")
#    field(LNK3, "FE14I-VA-IMG-05:PRO:ENABLE CA")
#    field(LNK4, "FE14I-VA-IMG-06:PRO:ENABLE CA")
#    field(LNK5, "FE14I-VA-IMG-06:PRO:ENABLE CA")
#    field(LNK6, "FE14I-VA-IMG-06:PRO:ENABLE CA")
#    field(LNK7, "FE14I-VA-IMG-06:PRO:ENABLE CA")
#    field(LNK8, "FE14I-VA-IMG-06:PRO:ENABLE CA")
#}
record(sel, "FE14I-VA-IMG-92:PRO:SP")
{
    field(DESC, "IMG Overpressure")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:PRO:SP MS")
    field(INPB, "FE14I-VA-IMG-04:PRO:SP MS")
    field(INPC, "FE14I-VA-IMG-05:PRO:SP MS")
    field(INPD, "FE14I-VA-IMG-06:PRO:SP MS")
    field(INPE, "FE14I-VA-IMG-06:PRO:SP MS")
    field(INPF, "FE14I-VA-IMG-06:PRO:SP MS")
    field(INPG, "FE14I-VA-IMG-06:PRO:SP MS")
    field(INPH, "FE14I-VA-IMG-06:PRO:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
################################################################################
# Relay - Valve Interlock
#
record(ao, "FE14I-VA-IMG-92:RLY1:SETSP")
{
    field(DESC, "Valve I/L")
    field(FLNK, "FE14I-VA-IMG-92:RLY1:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-6")
}
record(seq, "FE14I-VA-IMG-92:RLY1:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(DOL2, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(DOL3, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(DOL4, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(DOL5, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(DOL6, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(DOL7, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(DOL8, "FE14I-VA-IMG-92:RLY1:SETSP")
    field(LNK1, "FE14I-VA-IMG-03:RLY1:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-04:RLY1:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-05:RLY1:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-06:RLY1:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-06:RLY1:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-06:RLY1:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-06:RLY1:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-06:RLY1:SETSP CA")
}

record(sel, "FE14I-VA-IMG-92:RLY1:SP")
{
    field(DESC, "Valve Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY1:SP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY1:SP MS")
    field(INPC, "FE14I-VA-IMG-05:RLY1:SP MS")
    field(INPD, "FE14I-VA-IMG-06:RLY1:SP MS")
    field(INPE, "FE14I-VA-IMG-06:RLY1:SP MS")
    field(INPF, "FE14I-VA-IMG-06:RLY1:SP MS")
    field(INPG, "FE14I-VA-IMG-06:RLY1:SP MS")
    field(INPH, "FE14I-VA-IMG-06:RLY1:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
################################################################################
# Relay 2 (Channel A Only) - MPS Interlock 1
#
record(sel, "FE14I-VA-IMG-92:RLY2:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY2:EXISTS")
    field(INPB, "FE14I-VA-IMG-04:RLY2:EXISTS")
    field(INPC, "FE14I-VA-IMG-05:RLY2:EXISTS")
    field(INPD, "FE14I-VA-IMG-06:RLY2:EXISTS")
    field(INPE, "FE14I-VA-IMG-06:RLY2:EXISTS")
    field(INPF, "FE14I-VA-IMG-06:RLY2:EXISTS")
    field(INPG, "FE14I-VA-IMG-06:RLY2:EXISTS")
    field(INPH, "FE14I-VA-IMG-06:RLY2:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-92:RLY2:SETSP")
{
    field(DESC, "MPS Interlock 1")
    field(FLNK, "FE14I-VA-IMG-92:RLY2:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(seq, "FE14I-VA-IMG-92:RLY2:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(DOL2, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(DOL3, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(DOL4, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(DOL5, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(DOL6, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(DOL7, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(DOL8, "FE14I-VA-IMG-92:RLY2:SETSP")
    field(LNK1, "FE14I-VA-IMG-03:RLY2:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-04:RLY2:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-05:RLY2:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-06:RLY2:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-06:RLY2:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-06:RLY2:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-06:RLY2:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-06:RLY2:SETSP CA")
}

record(sel, "FE14I-VA-IMG-92:RLY2:SP")
{
    field(DESC, "MPS Interlock 1")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY2:SP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY2:SP MS")
    field(INPC, "FE14I-VA-IMG-05:RLY2:SP MS")
    field(INPD, "FE14I-VA-IMG-06:RLY2:SP MS")
    field(INPE, "FE14I-VA-IMG-06:RLY2:SP MS")
    field(INPF, "FE14I-VA-IMG-06:RLY2:SP MS")
    field(INPG, "FE14I-VA-IMG-06:RLY2:SP MS")
    field(INPH, "FE14I-VA-IMG-06:RLY2:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################
################################################################################
# Relay 3 (Channel A Only) - MPS Interlock 2
#
record(sel, "FE14I-VA-IMG-92:RLY3:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY3:EXISTS")
    field(INPB, "FE14I-VA-IMG-04:RLY3:EXISTS")
    field(INPC, "FE14I-VA-IMG-05:RLY3:EXISTS")
    field(INPD, "FE14I-VA-IMG-06:RLY3:EXISTS")
    field(INPE, "FE14I-VA-IMG-06:RLY3:EXISTS")
    field(INPF, "FE14I-VA-IMG-06:RLY3:EXISTS")
    field(INPG, "FE14I-VA-IMG-06:RLY3:EXISTS")
    field(INPH, "FE14I-VA-IMG-06:RLY3:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-92:RLY3:SETSP")
{
    field(DESC, "MPS Interlock 2")
    field(FLNK, "FE14I-VA-IMG-92:RLY3:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(seq, "FE14I-VA-IMG-92:RLY3:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(DOL2, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(DOL3, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(DOL4, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(DOL5, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(DOL6, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(DOL7, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(DOL8, "FE14I-VA-IMG-92:RLY3:SETSP")
    field(LNK1, "FE14I-VA-IMG-03:RLY3:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-04:RLY3:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-05:RLY3:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-06:RLY3:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-06:RLY3:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-06:RLY3:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-06:RLY3:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-06:RLY3:SETSP CA")
}

record(sel, "FE14I-VA-IMG-92:RLY3:SP")
{
    field(DESC, "MPS Interlock 2")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY3:SP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY3:SP MS")
    field(INPC, "FE14I-VA-IMG-05:RLY3:SP MS")
    field(INPD, "FE14I-VA-IMG-06:RLY3:SP MS")
    field(INPE, "FE14I-VA-IMG-06:RLY3:SP MS")
    field(INPF, "FE14I-VA-IMG-06:RLY3:SP MS")
    field(INPG, "FE14I-VA-IMG-06:RLY3:SP MS")
    field(INPH, "FE14I-VA-IMG-06:RLY3:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################

################################################################################
# Relay 4 - RGA Interlock
#
record(sel, "FE14I-VA-IMG-92:RLY4:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY4:EXISTS")
    field(INPB, "FE14I-VA-IMG-04:RLY4:EXISTS")
    field(INPC, "FE14I-VA-IMG-05:RLY4:EXISTS")
    field(INPD, "FE14I-VA-IMG-06:RLY4:EXISTS")
    field(INPE, "FE14I-VA-IMG-06:RLY4:EXISTS")
    field(INPF, "FE14I-VA-IMG-06:RLY4:EXISTS")
    field(INPG, "FE14I-VA-IMG-06:RLY4:EXISTS")
    field(INPH, "FE14I-VA-IMG-06:RLY4:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-92:RLY4:SETSP")
{
    field(DESC, "RGA Interlock")
    field(FLNK, "FE14I-VA-IMG-92:RLY4:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-4")
}
record(seq, "FE14I-VA-IMG-92:RLY4:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(DOL2, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(DOL3, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(DOL4, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(DOL5, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(DOL6, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(DOL7, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(DOL8, "FE14I-VA-IMG-92:RLY4:SETSP")
    field(LNK1, "FE14I-VA-IMG-03:RLY4:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-04:RLY4:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-05:RLY4:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-06:RLY4:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-06:RLY4:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-06:RLY4:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-06:RLY4:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-06:RLY4:SETSP CA")
}

record(sel, "FE14I-VA-IMG-92:RLY4:SP")
{
    field(DESC, "RGA Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY4:SP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY4:SP MS")
    field(INPC, "FE14I-VA-IMG-05:RLY4:SP MS")
    field(INPD, "FE14I-VA-IMG-06:RLY4:SP MS")
    field(INPE, "FE14I-VA-IMG-06:RLY4:SP MS")
    field(INPF, "FE14I-VA-IMG-06:RLY4:SP MS")
    field(INPG, "FE14I-VA-IMG-06:RLY4:SP MS")
    field(INPH, "FE14I-VA-IMG-06:RLY4:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################

################################################################################
# Relay FRLY - Fast Valve Interlock
#
record(sel, "FE14I-VA-IMG-92:FRLY:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:FRLY:EXISTS")
    field(INPB, "FE14I-VA-IMG-04:FRLY:EXISTS")
    field(INPC, "FE14I-VA-IMG-05:FRLY:EXISTS")
    field(INPD, "FE14I-VA-IMG-06:FRLY:EXISTS")
    field(INPE, "FE14I-VA-IMG-06:FRLY:EXISTS")
    field(INPF, "FE14I-VA-IMG-06:FRLY:EXISTS")
    field(INPG, "FE14I-VA-IMG-06:FRLY:EXISTS")
    field(INPH, "FE14I-VA-IMG-06:FRLY:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-92:FRLY:SETSP")
{
    field(DESC, "Fast Valve Interlock")
    field(FLNK, "FE14I-VA-IMG-92:FRLY:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-5")
}
record(seq, "FE14I-VA-IMG-92:FRLY:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(DOL2, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(DOL3, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(DOL4, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(DOL5, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(DOL6, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(DOL7, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(DOL8, "FE14I-VA-IMG-92:FRLY:SETSP")
    field(LNK1, "FE14I-VA-IMG-03:FRLY:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-04:FRLY:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-05:FRLY:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-06:FRLY:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-06:FRLY:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-06:FRLY:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-06:FRLY:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-06:FRLY:SETSP CA")
}

record(sel, "FE14I-VA-IMG-92:FRLY:SP")
{
    field(DESC, "Fast Valve Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:FRLY:SP MS")
    field(INPB, "FE14I-VA-IMG-04:FRLY:SP MS")
    field(INPC, "FE14I-VA-IMG-05:FRLY:SP MS")
    field(INPD, "FE14I-VA-IMG-06:FRLY:SP MS")
    field(INPE, "FE14I-VA-IMG-06:FRLY:SP MS")
    field(INPF, "FE14I-VA-IMG-06:FRLY:SP MS")
    field(INPG, "FE14I-VA-IMG-06:FRLY:SP MS")
    field(INPH, "FE14I-VA-IMG-06:FRLY:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################
# mks937bImgGroup.template
#% macro, __doc__, Template database for a group of up to 8 IMGs
# Pete Owens - 10/5/05
#
# substitutions:
#% macro, device, device name
#% macro, delay, delay between starting each IMG
#% macro, img1, img 1 device name
#% macro, img2, img 2 device name
#% macro, img3, img 3 device name
#% macro, img4, img 4 device name
#% macro, img5, img 5 device name
#% macro, img6, img 6 device name
#% macro, img7, img 7 device name
#% macro, img8, img 8 device name
#% macro, valveIlRelay, Valve interlock relay
#% macro, mpsIlRelay1 , Machine protection system interlock 1 relay
#% macro, mpsIlRelay2 , Machine protection system interlock 2 relay
#% macro, rgaIlRelay  , RGA interlock relay
################################################################################
# Cold Cathode Enable
#
record(bo, "FE14I-VA-IMG-99:CCHV")
{
    field(DESC, "Cold Cathode Enable")
    field(FLNK, "FE14I-VA-IMG-99:SEQCCHV")
    field(ZNAM, "Off")
    field(ONAM, "On")
}
record(bi,"FE14I-VA-IMG-99:SWITCHING")
{
    field(DESC, "Switching")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Switching")
}
record(seq, "FE14I-VA-IMG-99:SEQCCHV")
{
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "FE14I-VA-IMG-99:CCHV")
    field(DOL3, "FE14I-VA-IMG-99:CCHV")
    field(DOL4, "FE14I-VA-IMG-99:CCHV")
    field(DOL5, "FE14I-VA-IMG-99:CCHV")
    field(DOL6, "FE14I-VA-IMG-99:CCHV")
    field(DOL7, "FE14I-VA-IMG-99:CCHV")
    field(DOL8, "FE14I-VA-IMG-99:CCHV")
    field(DOL9, "FE14I-VA-IMG-99:CCHV")
    field(DOLA, "0")
    field(DLY1, "0")
    field(DLY2, "0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY5, "0")
    field(DLY6, "0")
    field(DLY7, "0")
    field(DLY8, "0")
    field(DLY9, "0")
    field(DLYA, "0")
    field(LNK1, "FE14I-VA-IMG-99:SWITCHING PP")
    field(LNK2, "FE14I-VA-IMG-91:CCHV CA")
    field(LNK3, "FE14I-VA-IMG-92:CCHV CA")
    field(LNK4, "FE14I-VA-IMG-91:CCHV CA")
    field(LNK5, "FE14I-VA-IMG-91:CCHV CA")
    field(LNK6, "FE14I-VA-IMG-91:CCHV CA")
    field(LNK7, "FE14I-VA-IMG-91:CCHV CA")
    field(LNK8, "FE14I-VA-IMG-91:CCHV CA")
    field(LNK9, "FE14I-VA-IMG-91:CCHV CA")
    field(LNKA, "FE14I-VA-IMG-99:SWITCHING PP")
}
################################################################################
# Status
#
record(mbbi, "FE14I-VA-IMG-99:STA")
{
    field(DESC, "Status")
    field(INP,  "FE14I-VA-IMG-99:SELSTA PP MS")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IMG-99:P")
    field(ZRST, "OK")
    field(ONST, "OK")
    field(TWST, "Above Range")
    field(THST, "At Atmosphere")
    field(FRST, "Low Emission")
    field(FVST, "Filament Off")
    field(SXST, "HV Off")
    field(SVST, "Startup Delay")
    field(EIST, "Below Range")
    field(NIST, "Controlled")
    field(TEST, "Protected State")
    field(ELST, "No Gauge")
    field(TVST, "Not Connected")
    field(TTST, "Wrong Gauge")
    field(FTST, "Bad Command")
    field(FFST, "Locked Out")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MAJOR")
    field(FVSV, "MAJOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MINOR")
    field(EISV, "NO_ALARM")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
}
record(sel, "FE14I-VA-IMG-99:SELSTA") 
{
    field(DESC, "Select Status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:STA MS")
    field(INPB, "FE14I-VA-IMG-92:STA MS")
    field(INPC, "FE14I-VA-IMG-91:STA MS")
    field(INPD, "FE14I-VA-IMG-91:STA MS")
    field(INPE, "FE14I-VA-IMG-91:STA MS")
    field(INPF, "FE14I-VA-IMG-91:STA MS")
    field(INPG, "FE14I-VA-IMG-91:STA MS")
    field(INPH, "FE14I-VA-IMG-91:STA MS")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-IMG-99:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:P MS")
    field(INPB, "FE14I-VA-IMG-92:P MS")
    field(INPC, "FE14I-VA-IMG-91:P MS")
    field(INPD, "FE14I-VA-IMG-91:P MS")
    field(INPE, "FE14I-VA-IMG-91:P MS")
    field(INPF, "FE14I-VA-IMG-91:P MS")
    field(INPG, "FE14I-VA-IMG-91:P MS")
    field(INPH, "FE14I-VA-IMG-91:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(calc, "FE14I-VA-IMG-99:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IMG-99:P PP MS")
    field(FLNK, "FE14I-VA-IMG-99:PMAX")
    field(SCAN, "1 second")
    field(HOPR, "-2")
    field(LOPR, "-11")
}
record(sel, "FE14I-VA-IMG-99:PMAX")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:PMAX")
    field(INPB, "FE14I-VA-IMG-92:PMAX")
    field(INPC, "FE14I-VA-IMG-91:PMAX")
    field(INPD, "FE14I-VA-IMG-91:PMAX")
    field(INPE, "FE14I-VA-IMG-91:PMAX")
    field(INPF, "FE14I-VA-IMG-91:PMAX")
    field(INPG, "FE14I-VA-IMG-91:PMAX")
    field(INPH, "FE14I-VA-IMG-91:PMAX")
    field(FLNK, "FE14I-VA-IMG-99:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(sel, "FE14I-VA-IMG-99:PMIN")
{
    field(DESC, "Pressure")
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-IMG-91:PMIN")
    field(INPB, "FE14I-VA-IMG-92:PMIN")
    field(INPC, "FE14I-VA-IMG-91:PMIN")
    field(INPD, "FE14I-VA-IMG-91:PMIN")
    field(INPE, "FE14I-VA-IMG-91:PMIN")
    field(INPF, "FE14I-VA-IMG-91:PMIN")
    field(INPG, "FE14I-VA-IMG-91:PMIN")
    field(INPH, "FE14I-VA-IMG-91:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
################################################################################
# Protection - IMG Overpressure
#
record(ao, "FE14I-VA-IMG-99:PRO:OUTSP")
{
    field(DESC, "IMG Overpressure")
    field(FLNK, "FE14I-VA-IMG-99:PRO:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
    field(DRVH, "1.0e-2")
    field(DRVL, "1.3e-5")
    field(DOL , "5.0e-4")
}
record(seq, "FE14I-VA-IMG-99:PRO:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(DOL2, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(DOL3, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(DOL4, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(DOL5, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(DOL6, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(DOL7, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(DOL8, "FE14I-VA-IMG-99:PRO:OUTSP")
    field(LNK1, "FE14I-VA-IMG-91:PRO:OUTSP CA")
    field(LNK2, "FE14I-VA-IMG-92:PRO:OUTSP CA")
    field(LNK3, "FE14I-VA-IMG-91:PRO:OUTSP CA")
    field(LNK4, "FE14I-VA-IMG-91:PRO:OUTSP CA")
    field(LNK5, "FE14I-VA-IMG-91:PRO:OUTSP CA")
    field(LNK6, "FE14I-VA-IMG-91:PRO:OUTSP CA")
    field(LNK7, "FE14I-VA-IMG-91:PRO:OUTSP CA")
    field(LNK8, "FE14I-VA-IMG-91:PRO:OUTSP CA")
}
#record(mbbo, "FE14I-VA-IMG-99:PRO:ENABLE")
#{
#    field(DESC, "Enable Protection Setpoint")
#    field(FLNK, "FE14I-VA-IMG-99:PRO:SEQENA")
#    field(ZRST, "Force On I/L")
#    field(ONST, "I/L Operating")
#    field(ZRVL, "1")
#    field(ONVL, "2")
#    field(ZRSV, "MAJOR")
#    field(ONSV, "NO_ALARM")
#    field(DOL , "1")
#    field(PINI, "YES")
#}
#record(seq, "FE14I-VA-IMG-99:PRO:SEQENA")
#{
#    field(SELM, "All")
#    field(DOL1, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(DOL2, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(DOL3, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(DOL4, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(DOL5, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(DOL6, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(DOL7, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(DOL8, "FE14I-VA-IMG-99:PRO:ENABLE")
#    field(LNK1, "FE14I-VA-IMG-91:PRO:ENABLE CA")
#    field(LNK2, "FE14I-VA-IMG-92:PRO:ENABLE CA")
#    field(LNK3, "FE14I-VA-IMG-91:PRO:ENABLE CA")
#    field(LNK4, "FE14I-VA-IMG-91:PRO:ENABLE CA")
#    field(LNK5, "FE14I-VA-IMG-91:PRO:ENABLE CA")
#    field(LNK6, "FE14I-VA-IMG-91:PRO:ENABLE CA")
#    field(LNK7, "FE14I-VA-IMG-91:PRO:ENABLE CA")
#    field(LNK8, "FE14I-VA-IMG-91:PRO:ENABLE CA")
#}
record(sel, "FE14I-VA-IMG-99:PRO:SP")
{
    field(DESC, "IMG Overpressure")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:PRO:SP MS")
    field(INPB, "FE14I-VA-IMG-92:PRO:SP MS")
    field(INPC, "FE14I-VA-IMG-91:PRO:SP MS")
    field(INPD, "FE14I-VA-IMG-91:PRO:SP MS")
    field(INPE, "FE14I-VA-IMG-91:PRO:SP MS")
    field(INPF, "FE14I-VA-IMG-91:PRO:SP MS")
    field(INPG, "FE14I-VA-IMG-91:PRO:SP MS")
    field(INPH, "FE14I-VA-IMG-91:PRO:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
################################################################################
# Relay - Valve Interlock
#
record(ao, "FE14I-VA-IMG-99:RLY1:SETSP")
{
    field(DESC, "Valve I/L")
    field(FLNK, "FE14I-VA-IMG-99:RLY1:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-6")
}
record(seq, "FE14I-VA-IMG-99:RLY1:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(DOL2, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(DOL3, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(DOL4, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(DOL5, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(DOL6, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(DOL7, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(DOL8, "FE14I-VA-IMG-99:RLY1:SETSP")
    field(LNK1, "FE14I-VA-IMG-91:RLY1:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-92:RLY1:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-91:RLY1:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-91:RLY1:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-91:RLY1:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-91:RLY1:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-91:RLY1:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-91:RLY1:SETSP CA")
}

record(sel, "FE14I-VA-IMG-99:RLY1:SP")
{
    field(DESC, "Valve Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:RLY1:SP MS")
    field(INPB, "FE14I-VA-IMG-92:RLY1:SP MS")
    field(INPC, "FE14I-VA-IMG-91:RLY1:SP MS")
    field(INPD, "FE14I-VA-IMG-91:RLY1:SP MS")
    field(INPE, "FE14I-VA-IMG-91:RLY1:SP MS")
    field(INPF, "FE14I-VA-IMG-91:RLY1:SP MS")
    field(INPG, "FE14I-VA-IMG-91:RLY1:SP MS")
    field(INPH, "FE14I-VA-IMG-91:RLY1:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.0e-2")
    field(LOPR, "1.3e-5")
}
################################################################################
# Relay 2 (Channel A Only) - MPS Interlock 1
#
record(sel, "FE14I-VA-IMG-99:RLY2:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:RLY2:EXISTS")
    field(INPB, "FE14I-VA-IMG-92:RLY2:EXISTS")
    field(INPC, "FE14I-VA-IMG-91:RLY2:EXISTS")
    field(INPD, "FE14I-VA-IMG-91:RLY2:EXISTS")
    field(INPE, "FE14I-VA-IMG-91:RLY2:EXISTS")
    field(INPF, "FE14I-VA-IMG-91:RLY2:EXISTS")
    field(INPG, "FE14I-VA-IMG-91:RLY2:EXISTS")
    field(INPH, "FE14I-VA-IMG-91:RLY2:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-99:RLY2:SETSP")
{
    field(DESC, "MPS Interlock 1")
    field(FLNK, "FE14I-VA-IMG-99:RLY2:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(seq, "FE14I-VA-IMG-99:RLY2:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(DOL2, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(DOL3, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(DOL4, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(DOL5, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(DOL6, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(DOL7, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(DOL8, "FE14I-VA-IMG-99:RLY2:SETSP")
    field(LNK1, "FE14I-VA-IMG-91:RLY2:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-92:RLY2:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-91:RLY2:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-91:RLY2:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-91:RLY2:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-91:RLY2:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-91:RLY2:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-91:RLY2:SETSP CA")
}

record(sel, "FE14I-VA-IMG-99:RLY2:SP")
{
    field(DESC, "MPS Interlock 1")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:RLY2:SP MS")
    field(INPB, "FE14I-VA-IMG-92:RLY2:SP MS")
    field(INPC, "FE14I-VA-IMG-91:RLY2:SP MS")
    field(INPD, "FE14I-VA-IMG-91:RLY2:SP MS")
    field(INPE, "FE14I-VA-IMG-91:RLY2:SP MS")
    field(INPF, "FE14I-VA-IMG-91:RLY2:SP MS")
    field(INPG, "FE14I-VA-IMG-91:RLY2:SP MS")
    field(INPH, "FE14I-VA-IMG-91:RLY2:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################
################################################################################
# Relay 3 (Channel A Only) - MPS Interlock 2
#
record(sel, "FE14I-VA-IMG-99:RLY3:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:RLY3:EXISTS")
    field(INPB, "FE14I-VA-IMG-92:RLY3:EXISTS")
    field(INPC, "FE14I-VA-IMG-91:RLY3:EXISTS")
    field(INPD, "FE14I-VA-IMG-91:RLY3:EXISTS")
    field(INPE, "FE14I-VA-IMG-91:RLY3:EXISTS")
    field(INPF, "FE14I-VA-IMG-91:RLY3:EXISTS")
    field(INPG, "FE14I-VA-IMG-91:RLY3:EXISTS")
    field(INPH, "FE14I-VA-IMG-91:RLY3:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-99:RLY3:SETSP")
{
    field(DESC, "MPS Interlock 2")
    field(FLNK, "FE14I-VA-IMG-99:RLY3:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-7")
}
record(seq, "FE14I-VA-IMG-99:RLY3:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(DOL2, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(DOL3, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(DOL4, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(DOL5, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(DOL6, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(DOL7, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(DOL8, "FE14I-VA-IMG-99:RLY3:SETSP")
    field(LNK1, "FE14I-VA-IMG-91:RLY3:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-92:RLY3:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-91:RLY3:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-91:RLY3:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-91:RLY3:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-91:RLY3:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-91:RLY3:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-91:RLY3:SETSP CA")
}

record(sel, "FE14I-VA-IMG-99:RLY3:SP")
{
    field(DESC, "MPS Interlock 2")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:RLY3:SP MS")
    field(INPB, "FE14I-VA-IMG-92:RLY3:SP MS")
    field(INPC, "FE14I-VA-IMG-91:RLY3:SP MS")
    field(INPD, "FE14I-VA-IMG-91:RLY3:SP MS")
    field(INPE, "FE14I-VA-IMG-91:RLY3:SP MS")
    field(INPF, "FE14I-VA-IMG-91:RLY3:SP MS")
    field(INPG, "FE14I-VA-IMG-91:RLY3:SP MS")
    field(INPH, "FE14I-VA-IMG-91:RLY3:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################

################################################################################
# Relay 4 - RGA Interlock
#
record(sel, "FE14I-VA-IMG-99:RLY4:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:RLY4:EXISTS")
    field(INPB, "FE14I-VA-IMG-92:RLY4:EXISTS")
    field(INPC, "FE14I-VA-IMG-91:RLY4:EXISTS")
    field(INPD, "FE14I-VA-IMG-91:RLY4:EXISTS")
    field(INPE, "FE14I-VA-IMG-91:RLY4:EXISTS")
    field(INPF, "FE14I-VA-IMG-91:RLY4:EXISTS")
    field(INPG, "FE14I-VA-IMG-91:RLY4:EXISTS")
    field(INPH, "FE14I-VA-IMG-91:RLY4:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-99:RLY4:SETSP")
{
    field(DESC, "RGA Interlock")
    field(FLNK, "FE14I-VA-IMG-99:RLY4:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-4")
}
record(seq, "FE14I-VA-IMG-99:RLY4:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(DOL2, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(DOL3, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(DOL4, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(DOL5, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(DOL6, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(DOL7, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(DOL8, "FE14I-VA-IMG-99:RLY4:SETSP")
    field(LNK1, "FE14I-VA-IMG-91:RLY4:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-92:RLY4:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-91:RLY4:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-91:RLY4:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-91:RLY4:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-91:RLY4:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-91:RLY4:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-91:RLY4:SETSP CA")
}

record(sel, "FE14I-VA-IMG-99:RLY4:SP")
{
    field(DESC, "RGA Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:RLY4:SP MS")
    field(INPB, "FE14I-VA-IMG-92:RLY4:SP MS")
    field(INPC, "FE14I-VA-IMG-91:RLY4:SP MS")
    field(INPD, "FE14I-VA-IMG-91:RLY4:SP MS")
    field(INPE, "FE14I-VA-IMG-91:RLY4:SP MS")
    field(INPF, "FE14I-VA-IMG-91:RLY4:SP MS")
    field(INPG, "FE14I-VA-IMG-91:RLY4:SP MS")
    field(INPH, "FE14I-VA-IMG-91:RLY4:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################

################################################################################
# Relay FRLY - Fast Valve Interlock
#
record(sel, "FE14I-VA-IMG-99:FRLY:EXISTS")
{
    field(DESC, "Relay Exists")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:FRLY:EXISTS")
    field(INPB, "FE14I-VA-IMG-92:FRLY:EXISTS")
    field(INPC, "FE14I-VA-IMG-91:FRLY:EXISTS")
    field(INPD, "FE14I-VA-IMG-91:FRLY:EXISTS")
    field(INPE, "FE14I-VA-IMG-91:FRLY:EXISTS")
    field(INPF, "FE14I-VA-IMG-91:FRLY:EXISTS")
    field(INPG, "FE14I-VA-IMG-91:FRLY:EXISTS")
    field(INPH, "FE14I-VA-IMG-91:FRLY:EXISTS")
    field(PINI, "YES")
}
record(ao, "FE14I-VA-IMG-99:FRLY:SETSP")
{
    field(DESC, "Fast Valve Interlock")
    field(FLNK, "FE14I-VA-IMG-99:FRLY:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
    field(DRVH, "1.2e-2")
    field(DRVL, "2.7e-10")
    field(DOL , "1.0e-5")
}
record(seq, "FE14I-VA-IMG-99:FRLY:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(DOL2, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(DOL3, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(DOL4, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(DOL5, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(DOL6, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(DOL7, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(DOL8, "FE14I-VA-IMG-99:FRLY:SETSP")
    field(LNK1, "FE14I-VA-IMG-91:FRLY:SETSP CA")
    field(LNK2, "FE14I-VA-IMG-92:FRLY:SETSP CA")
    field(LNK3, "FE14I-VA-IMG-91:FRLY:SETSP CA")
    field(LNK4, "FE14I-VA-IMG-91:FRLY:SETSP CA")
    field(LNK5, "FE14I-VA-IMG-91:FRLY:SETSP CA")
    field(LNK6, "FE14I-VA-IMG-91:FRLY:SETSP CA")
    field(LNK7, "FE14I-VA-IMG-91:FRLY:SETSP CA")
    field(LNK8, "FE14I-VA-IMG-91:FRLY:SETSP CA")
}

record(sel, "FE14I-VA-IMG-99:FRLY:SP")
{
    field(DESC, "Fast Valve Interlock")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-91:FRLY:SP MS")
    field(INPB, "FE14I-VA-IMG-92:FRLY:SP MS")
    field(INPC, "FE14I-VA-IMG-91:FRLY:SP MS")
    field(INPD, "FE14I-VA-IMG-91:FRLY:SP MS")
    field(INPE, "FE14I-VA-IMG-91:FRLY:SP MS")
    field(INPF, "FE14I-VA-IMG-91:FRLY:SP MS")
    field(INPG, "FE14I-VA-IMG-91:FRLY:SP MS")
    field(INPH, "FE14I-VA-IMG-91:FRLY:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e-2")
    field(LOPR, "2.7e-10")
}
################################################################################
# mks937bPirgGroup.template
#% macro, __doc__, Template database for a group of up to 8 Pirani Gauges
# Pete Owens - 9/5/05
#
# substitutions:
#% macro, device, device name
#% macro, pirg1, pirg 1 device name
#% macro, pirg2, pirg 2 device name
#% macro, pirg3, pirg 3 device name
#% macro, pirg4, pirg 4 device name
#% macro, pirg5, pirg 5 device name
#% macro, pirg6, pirg 6 device name
#% macro, pirg7, pirg 7 device name
#% macro, pirg8, pirg 8 device name
#% macro, ionPumpIlRelay, Ion pump interlock relay
################################################################################
# Status
#
record(mbbi, "FE14I-VA-PIRG-91:STA")
{
    field(DESC, "Status")
    field(INP,  "FE14I-VA-PIRG-91:SELSTA PP MS")
    field(SCAN, "1 second")
    field(ZRST, "OK")
    field(ONST, "OK")
    field(TWST, "Above Range")
    field(THST, "At Atmosphere")
    field(FRST, "Low Emission")
    field(FVST, "Filament Off")
    field(SXST, "HV Off")
    field(SVST, "Startup Delay")
    field(EIST, "Below Range")
    field(NIST, "Controlled")
    field(TEST, "Protected State")
    field(ELST, "No Gauge")
    field(TVST, "Not Connected")
    field(TTST, "Wrong Gauge")
    field(FTST, "Bad Command")
    field(FFST, "Locked Out")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MAJOR")
    field(FVSV, "MAJOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MINOR")
    field(EISV, "NO_ALARM")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
}
record(sel, "FE14I-VA-PIRG-91:SELSTA") 
{
    field(DESC, "Select Status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-01:STA")
    field(INPB, "FE14I-VA-PIRG-02:STA")
    field(INPC, "FE14I-VA-PIRG-01:STA")
    field(INPD, "FE14I-VA-PIRG-01:STA")
    field(INPE, "FE14I-VA-PIRG-01:STA")
    field(INPF, "FE14I-VA-PIRG-01:STA")
    field(INPG, "FE14I-VA-PIRG-01:STA")
    field(INPH, "FE14I-VA-PIRG-01:STA")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-PIRG-91:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-01:P MS")
    field(INPB, "FE14I-VA-PIRG-02:P MS")
    field(INPC, "FE14I-VA-PIRG-01:P MS")
    field(INPD, "FE14I-VA-PIRG-01:P MS")
    field(INPE, "FE14I-VA-PIRG-01:P MS")
    field(INPF, "FE14I-VA-PIRG-01:P MS")
    field(INPG, "FE14I-VA-PIRG-01:P MS")
    field(INPH, "FE14I-VA-PIRG-01:P MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "0.001")
}
record(calc, "FE14I-VA-PIRG-91:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-PIRG-91:P PP MS")
    field(SCAN, "1 second")
    field(HOPR, "3")
    field(LOPR, "-3")
}
################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#
record(ao, "FE14I-VA-PIRG-91:CTL:SETSP")
{
    field(DESC, "IMG Enable")
    field(FLNK, "FE14I-VA-PIRG-91:CTL:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(seq, "FE14I-VA-PIRG-91:CTL:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(DOL2, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(DOL3, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(DOL4, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(DOL5, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(DOL6, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(DOL7, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(DOL8, "FE14I-VA-PIRG-91:CTL:SETSP")
    field(LNK1, "FE14I-VA-PIRG-01:CTL:SETSP CA")
    field(LNK2, "FE14I-VA-PIRG-02:CTL:SETSP CA")
    field(LNK3, "FE14I-VA-PIRG-01:CTL:SETSP CA")
    field(LNK4, "FE14I-VA-PIRG-01:CTL:SETSP CA")
    field(LNK5, "FE14I-VA-PIRG-01:CTL:SETSP CA")
    field(LNK6, "FE14I-VA-PIRG-01:CTL:SETSP CA")
    field(LNK7, "FE14I-VA-PIRG-01:CTL:SETSP CA")
    field(LNK8, "FE14I-VA-PIRG-01:CTL:SETSP CA")
}
record(mbbo, "FE14I-VA-PIRG-91:CTL:ENABLE")
{
    field(DESC, "Enable Control Setpoint")
    field(FLNK, "FE14I-VA-PIRG-91:CTL:SEQENA")
    field(ZRST, "Force On")
    field(ONST, "I/L Safe")
    field(TWST, "I/L Operating")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL , "1")
    field(PINI, "YES")
}

record(seq, "FE14I-VA-PIRG-91:CTL:SEQENA")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(DOL2, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(DOL3, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(DOL4, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(DOL5, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(DOL6, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(DOL7, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(DOL8, "FE14I-VA-PIRG-91:CTL:ENABLE")
    field(LNK1, "FE14I-VA-PIRG-01:CTL:ENABLE CA")
    field(LNK2, "FE14I-VA-PIRG-02:CTL:ENABLE CA")
    field(LNK3, "FE14I-VA-PIRG-01:CTL:ENABLE CA")
    field(LNK4, "FE14I-VA-PIRG-01:CTL:ENABLE CA")
    field(LNK5, "FE14I-VA-PIRG-01:CTL:ENABLE CA")
    field(LNK6, "FE14I-VA-PIRG-01:CTL:ENABLE CA")
    field(LNK7, "FE14I-VA-PIRG-01:CTL:ENABLE CA")
    field(LNK8, "FE14I-VA-PIRG-01:CTL:ENABLE CA")
}
record(sel, "FE14I-VA-PIRG-91:CTL:SP")
{
    field(DESC, "IMG Enable")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-01:CTL:SP MS")
    field(INPB, "FE14I-VA-PIRG-02:CTL:SP MS")
    field(INPC, "FE14I-VA-PIRG-01:CTL:SP MS")
    field(INPD, "FE14I-VA-PIRG-01:CTL:SP MS")
    field(INPE, "FE14I-VA-PIRG-01:CTL:SP MS")
    field(INPF, "FE14I-VA-PIRG-01:CTL:SP MS")
    field(INPG, "FE14I-VA-PIRG-01:CTL:SP MS")
    field(INPH, "FE14I-VA-PIRG-01:CTL:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
}
################################################################################
# Relay - Ion Pump Interlock
#
record(ao, "FE14I-VA-PIRG-91:RLY1:SETSP")
{
    field(DESC, "Ion Pump I/L")
    field(FLNK, "FE14I-VA-PIRG-91:RLY1:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
    field(DRVH, "1.2e2")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(seq, "FE14I-VA-PIRG-91:RLY1:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(DOL2, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(DOL3, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(DOL4, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(DOL5, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(DOL6, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(DOL7, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(DOL8, "FE14I-VA-PIRG-91:RLY1:SETSP")
    field(LNK1, "FE14I-VA-PIRG-01:RLY1:SETSP CA")
    field(LNK2, "FE14I-VA-PIRG-02:RLY1:SETSP CA")
    field(LNK3, "FE14I-VA-PIRG-01:RLY1:SETSP CA")
    field(LNK4, "FE14I-VA-PIRG-01:RLY1:SETSP CA")
    field(LNK5, "FE14I-VA-PIRG-01:RLY1:SETSP CA")
    field(LNK6, "FE14I-VA-PIRG-01:RLY1:SETSP CA")
    field(LNK7, "FE14I-VA-PIRG-01:RLY1:SETSP CA")
    field(LNK8, "FE14I-VA-PIRG-01:RLY1:SETSP CA")
}

record(sel, "FE14I-VA-PIRG-91:RLY1:SP")
{
    field(DESC, "Ion Pump I/L")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-01:RLY1:SP MS")
    field(INPB, "FE14I-VA-PIRG-02:RLY1:SP MS")
    field(INPC, "FE14I-VA-PIRG-01:RLY1:SP MS")
    field(INPD, "FE14I-VA-PIRG-01:RLY1:SP MS")
    field(INPE, "FE14I-VA-PIRG-01:RLY1:SP MS")
    field(INPF, "FE14I-VA-PIRG-01:RLY1:SP MS")
    field(INPG, "FE14I-VA-PIRG-01:RLY1:SP MS")
    field(INPH, "FE14I-VA-PIRG-01:RLY1:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
}
################################################################################
# mks937bPirgGroup.template
#% macro, __doc__, Template database for a group of up to 8 Pirani Gauges
# Pete Owens - 9/5/05
#
# substitutions:
#% macro, device, device name
#% macro, pirg1, pirg 1 device name
#% macro, pirg2, pirg 2 device name
#% macro, pirg3, pirg 3 device name
#% macro, pirg4, pirg 4 device name
#% macro, pirg5, pirg 5 device name
#% macro, pirg6, pirg 6 device name
#% macro, pirg7, pirg 7 device name
#% macro, pirg8, pirg 8 device name
#% macro, ionPumpIlRelay, Ion pump interlock relay
################################################################################
# Status
#
record(mbbi, "FE14I-VA-PIRG-92:STA")
{
    field(DESC, "Status")
    field(INP,  "FE14I-VA-PIRG-92:SELSTA PP MS")
    field(SCAN, "1 second")
    field(ZRST, "OK")
    field(ONST, "OK")
    field(TWST, "Above Range")
    field(THST, "At Atmosphere")
    field(FRST, "Low Emission")
    field(FVST, "Filament Off")
    field(SXST, "HV Off")
    field(SVST, "Startup Delay")
    field(EIST, "Below Range")
    field(NIST, "Controlled")
    field(TEST, "Protected State")
    field(ELST, "No Gauge")
    field(TVST, "Not Connected")
    field(TTST, "Wrong Gauge")
    field(FTST, "Bad Command")
    field(FFST, "Locked Out")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MAJOR")
    field(FVSV, "MAJOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MINOR")
    field(EISV, "NO_ALARM")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
}
record(sel, "FE14I-VA-PIRG-92:SELSTA") 
{
    field(DESC, "Select Status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-03:STA")
    field(INPB, "FE14I-VA-PIRG-04:STA")
    field(INPC, "FE14I-VA-PIRG-05:STA")
    field(INPD, "FE14I-VA-PIRG-06:STA")
    field(INPE, "FE14I-VA-PIRG-06:STA")
    field(INPF, "FE14I-VA-PIRG-06:STA")
    field(INPG, "FE14I-VA-PIRG-06:STA")
    field(INPH, "FE14I-VA-PIRG-06:STA")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-PIRG-92:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-03:P MS")
    field(INPB, "FE14I-VA-PIRG-04:P MS")
    field(INPC, "FE14I-VA-PIRG-05:P MS")
    field(INPD, "FE14I-VA-PIRG-06:P MS")
    field(INPE, "FE14I-VA-PIRG-06:P MS")
    field(INPF, "FE14I-VA-PIRG-06:P MS")
    field(INPG, "FE14I-VA-PIRG-06:P MS")
    field(INPH, "FE14I-VA-PIRG-06:P MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "0.001")
}
record(calc, "FE14I-VA-PIRG-92:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-PIRG-92:P PP MS")
    field(SCAN, "1 second")
    field(HOPR, "3")
    field(LOPR, "-3")
}
################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#
record(ao, "FE14I-VA-PIRG-92:CTL:SETSP")
{
    field(DESC, "IMG Enable")
    field(FLNK, "FE14I-VA-PIRG-92:CTL:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(seq, "FE14I-VA-PIRG-92:CTL:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(DOL2, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(DOL3, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(DOL4, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(DOL5, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(DOL6, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(DOL7, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(DOL8, "FE14I-VA-PIRG-92:CTL:SETSP")
    field(LNK1, "FE14I-VA-PIRG-03:CTL:SETSP CA")
    field(LNK2, "FE14I-VA-PIRG-04:CTL:SETSP CA")
    field(LNK3, "FE14I-VA-PIRG-05:CTL:SETSP CA")
    field(LNK4, "FE14I-VA-PIRG-06:CTL:SETSP CA")
    field(LNK5, "FE14I-VA-PIRG-06:CTL:SETSP CA")
    field(LNK6, "FE14I-VA-PIRG-06:CTL:SETSP CA")
    field(LNK7, "FE14I-VA-PIRG-06:CTL:SETSP CA")
    field(LNK8, "FE14I-VA-PIRG-06:CTL:SETSP CA")
}
record(mbbo, "FE14I-VA-PIRG-92:CTL:ENABLE")
{
    field(DESC, "Enable Control Setpoint")
    field(FLNK, "FE14I-VA-PIRG-92:CTL:SEQENA")
    field(ZRST, "Force On")
    field(ONST, "I/L Safe")
    field(TWST, "I/L Operating")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL , "1")
    field(PINI, "YES")
}

record(seq, "FE14I-VA-PIRG-92:CTL:SEQENA")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(DOL2, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(DOL3, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(DOL4, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(DOL5, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(DOL6, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(DOL7, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(DOL8, "FE14I-VA-PIRG-92:CTL:ENABLE")
    field(LNK1, "FE14I-VA-PIRG-03:CTL:ENABLE CA")
    field(LNK2, "FE14I-VA-PIRG-04:CTL:ENABLE CA")
    field(LNK3, "FE14I-VA-PIRG-05:CTL:ENABLE CA")
    field(LNK4, "FE14I-VA-PIRG-06:CTL:ENABLE CA")
    field(LNK5, "FE14I-VA-PIRG-06:CTL:ENABLE CA")
    field(LNK6, "FE14I-VA-PIRG-06:CTL:ENABLE CA")
    field(LNK7, "FE14I-VA-PIRG-06:CTL:ENABLE CA")
    field(LNK8, "FE14I-VA-PIRG-06:CTL:ENABLE CA")
}
record(sel, "FE14I-VA-PIRG-92:CTL:SP")
{
    field(DESC, "IMG Enable")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-03:CTL:SP MS")
    field(INPB, "FE14I-VA-PIRG-04:CTL:SP MS")
    field(INPC, "FE14I-VA-PIRG-05:CTL:SP MS")
    field(INPD, "FE14I-VA-PIRG-06:CTL:SP MS")
    field(INPE, "FE14I-VA-PIRG-06:CTL:SP MS")
    field(INPF, "FE14I-VA-PIRG-06:CTL:SP MS")
    field(INPG, "FE14I-VA-PIRG-06:CTL:SP MS")
    field(INPH, "FE14I-VA-PIRG-06:CTL:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
}
################################################################################
# Relay - Ion Pump Interlock
#
record(ao, "FE14I-VA-PIRG-92:RLY1:SETSP")
{
    field(DESC, "Ion Pump I/L")
    field(FLNK, "FE14I-VA-PIRG-92:RLY1:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
    field(DRVH, "1.2e2")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(seq, "FE14I-VA-PIRG-92:RLY1:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(DOL2, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(DOL3, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(DOL4, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(DOL5, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(DOL6, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(DOL7, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(DOL8, "FE14I-VA-PIRG-92:RLY1:SETSP")
    field(LNK1, "FE14I-VA-PIRG-03:RLY1:SETSP CA")
    field(LNK2, "FE14I-VA-PIRG-04:RLY1:SETSP CA")
    field(LNK3, "FE14I-VA-PIRG-05:RLY1:SETSP CA")
    field(LNK4, "FE14I-VA-PIRG-06:RLY1:SETSP CA")
    field(LNK5, "FE14I-VA-PIRG-06:RLY1:SETSP CA")
    field(LNK6, "FE14I-VA-PIRG-06:RLY1:SETSP CA")
    field(LNK7, "FE14I-VA-PIRG-06:RLY1:SETSP CA")
    field(LNK8, "FE14I-VA-PIRG-06:RLY1:SETSP CA")
}

record(sel, "FE14I-VA-PIRG-92:RLY1:SP")
{
    field(DESC, "Ion Pump I/L")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-03:RLY1:SP MS")
    field(INPB, "FE14I-VA-PIRG-04:RLY1:SP MS")
    field(INPC, "FE14I-VA-PIRG-05:RLY1:SP MS")
    field(INPD, "FE14I-VA-PIRG-06:RLY1:SP MS")
    field(INPE, "FE14I-VA-PIRG-06:RLY1:SP MS")
    field(INPF, "FE14I-VA-PIRG-06:RLY1:SP MS")
    field(INPG, "FE14I-VA-PIRG-06:RLY1:SP MS")
    field(INPH, "FE14I-VA-PIRG-06:RLY1:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
}
################################################################################
# mks937bPirgGroup.template
#% macro, __doc__, Template database for a group of up to 8 Pirani Gauges
# Pete Owens - 9/5/05
#
# substitutions:
#% macro, device, device name
#% macro, pirg1, pirg 1 device name
#% macro, pirg2, pirg 2 device name
#% macro, pirg3, pirg 3 device name
#% macro, pirg4, pirg 4 device name
#% macro, pirg5, pirg 5 device name
#% macro, pirg6, pirg 6 device name
#% macro, pirg7, pirg 7 device name
#% macro, pirg8, pirg 8 device name
#% macro, ionPumpIlRelay, Ion pump interlock relay
################################################################################
# Status
#
record(mbbi, "FE14I-VA-PIRG-99:STA")
{
    field(DESC, "Status")
    field(INP,  "FE14I-VA-PIRG-99:SELSTA PP MS")
    field(SCAN, "1 second")
    field(ZRST, "OK")
    field(ONST, "OK")
    field(TWST, "Above Range")
    field(THST, "At Atmosphere")
    field(FRST, "Low Emission")
    field(FVST, "Filament Off")
    field(SXST, "HV Off")
    field(SVST, "Startup Delay")
    field(EIST, "Below Range")
    field(NIST, "Controlled")
    field(TEST, "Protected State")
    field(ELST, "No Gauge")
    field(TVST, "Not Connected")
    field(TTST, "Wrong Gauge")
    field(FTST, "Bad Command")
    field(FFST, "Locked Out")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MAJOR")
    field(FVSV, "MAJOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MINOR")
    field(EISV, "NO_ALARM")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
}
record(sel, "FE14I-VA-PIRG-99:SELSTA") 
{
    field(DESC, "Select Status")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-91:STA")
    field(INPB, "FE14I-VA-PIRG-92:STA")
    field(INPC, "FE14I-VA-PIRG-91:STA")
    field(INPD, "FE14I-VA-PIRG-91:STA")
    field(INPE, "FE14I-VA-PIRG-91:STA")
    field(INPF, "FE14I-VA-PIRG-91:STA")
    field(INPG, "FE14I-VA-PIRG-91:STA")
    field(INPH, "FE14I-VA-PIRG-91:STA")
}
################################################################################
# Pressure
#
record(sel, "FE14I-VA-PIRG-99:P")
{
    field(DESC, "Pressure")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-91:P MS")
    field(INPB, "FE14I-VA-PIRG-92:P MS")
    field(INPC, "FE14I-VA-PIRG-91:P MS")
    field(INPD, "FE14I-VA-PIRG-91:P MS")
    field(INPE, "FE14I-VA-PIRG-91:P MS")
    field(INPF, "FE14I-VA-PIRG-91:P MS")
    field(INPG, "FE14I-VA-PIRG-91:P MS")
    field(INPH, "FE14I-VA-PIRG-91:P MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "0.001")
}
record(calc, "FE14I-VA-PIRG-99:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-PIRG-99:P PP MS")
    field(SCAN, "1 second")
    field(HOPR, "3")
    field(LOPR, "-3")
}
################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#
record(ao, "FE14I-VA-PIRG-99:CTL:SETSP")
{
    field(DESC, "IMG Enable")
    field(FLNK, "FE14I-VA-PIRG-99:CTL:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(seq, "FE14I-VA-PIRG-99:CTL:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(DOL2, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(DOL3, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(DOL4, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(DOL5, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(DOL6, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(DOL7, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(DOL8, "FE14I-VA-PIRG-99:CTL:SETSP")
    field(LNK1, "FE14I-VA-PIRG-91:CTL:SETSP CA")
    field(LNK2, "FE14I-VA-PIRG-92:CTL:SETSP CA")
    field(LNK3, "FE14I-VA-PIRG-91:CTL:SETSP CA")
    field(LNK4, "FE14I-VA-PIRG-91:CTL:SETSP CA")
    field(LNK5, "FE14I-VA-PIRG-91:CTL:SETSP CA")
    field(LNK6, "FE14I-VA-PIRG-91:CTL:SETSP CA")
    field(LNK7, "FE14I-VA-PIRG-91:CTL:SETSP CA")
    field(LNK8, "FE14I-VA-PIRG-91:CTL:SETSP CA")
}
record(mbbo, "FE14I-VA-PIRG-99:CTL:ENABLE")
{
    field(DESC, "Enable Control Setpoint")
    field(FLNK, "FE14I-VA-PIRG-99:CTL:SEQENA")
    field(ZRST, "Force On")
    field(ONST, "I/L Safe")
    field(TWST, "I/L Operating")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL , "1")
    field(PINI, "YES")
}

record(seq, "FE14I-VA-PIRG-99:CTL:SEQENA")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(DOL2, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(DOL3, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(DOL4, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(DOL5, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(DOL6, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(DOL7, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(DOL8, "FE14I-VA-PIRG-99:CTL:ENABLE")
    field(LNK1, "FE14I-VA-PIRG-91:CTL:ENABLE CA")
    field(LNK2, "FE14I-VA-PIRG-92:CTL:ENABLE CA")
    field(LNK3, "FE14I-VA-PIRG-91:CTL:ENABLE CA")
    field(LNK4, "FE14I-VA-PIRG-91:CTL:ENABLE CA")
    field(LNK5, "FE14I-VA-PIRG-91:CTL:ENABLE CA")
    field(LNK6, "FE14I-VA-PIRG-91:CTL:ENABLE CA")
    field(LNK7, "FE14I-VA-PIRG-91:CTL:ENABLE CA")
    field(LNK8, "FE14I-VA-PIRG-91:CTL:ENABLE CA")
}
record(sel, "FE14I-VA-PIRG-99:CTL:SP")
{
    field(DESC, "IMG Enable")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-91:CTL:SP MS")
    field(INPB, "FE14I-VA-PIRG-92:CTL:SP MS")
    field(INPC, "FE14I-VA-PIRG-91:CTL:SP MS")
    field(INPD, "FE14I-VA-PIRG-91:CTL:SP MS")
    field(INPE, "FE14I-VA-PIRG-91:CTL:SP MS")
    field(INPF, "FE14I-VA-PIRG-91:CTL:SP MS")
    field(INPG, "FE14I-VA-PIRG-91:CTL:SP MS")
    field(INPH, "FE14I-VA-PIRG-91:CTL:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
}
################################################################################
# Relay - Ion Pump Interlock
#
record(ao, "FE14I-VA-PIRG-99:RLY1:SETSP")
{
    field(DESC, "Ion Pump I/L")
    field(FLNK, "FE14I-VA-PIRG-99:RLY1:SEQSP")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
    field(DRVH, "1.2e2")
    field(DRVL, "2.7e-3")
    field(DOL , "1.0e-2")
}
record(seq, "FE14I-VA-PIRG-99:RLY1:SEQSP")
{
    field(SELM, "All")
    field(DOL1, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(DOL2, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(DOL3, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(DOL4, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(DOL5, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(DOL6, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(DOL7, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(DOL8, "FE14I-VA-PIRG-99:RLY1:SETSP")
    field(LNK1, "FE14I-VA-PIRG-91:RLY1:SETSP CA")
    field(LNK2, "FE14I-VA-PIRG-92:RLY1:SETSP CA")
    field(LNK3, "FE14I-VA-PIRG-91:RLY1:SETSP CA")
    field(LNK4, "FE14I-VA-PIRG-91:RLY1:SETSP CA")
    field(LNK5, "FE14I-VA-PIRG-91:RLY1:SETSP CA")
    field(LNK6, "FE14I-VA-PIRG-91:RLY1:SETSP CA")
    field(LNK7, "FE14I-VA-PIRG-91:RLY1:SETSP CA")
    field(LNK8, "FE14I-VA-PIRG-91:RLY1:SETSP CA")
}

record(sel, "FE14I-VA-PIRG-99:RLY1:SP")
{
    field(DESC, "Ion Pump I/L")
    field(SCAN, "1 second")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(INPB, "FE14I-VA-PIRG-92:RLY1:SP MS")
    field(INPC, "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(INPD, "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(INPE, "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(INPF, "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(INPG, "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(INPH, "FE14I-VA-PIRG-91:RLY1:SP MS")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1.2e2")
    field(LOPR, "2.7e-3")
}
################################################################################
# frontendValveSNL.template
# Based on vacuumValveGroup.template
# This template opens and arms a fast valve before opening 2 valves
# and also the closes an absorber before closing 2 valves
# the open/close sequencing of which are controlled via
# an SNL statemachine
#
# Ian Gillingham - 11/01/06
#
# substitutions:
# device  - device name - FExxx-VA-VALVE-99
# fvdelay - delay between opening fvalve and valve1
# abdelay - delay between closing absorber and valve1
# valve1  - 1st valve  - FExxx-VA-VALVE-01
# valve2  - 2nd valve  - FExxx-VA-VALVE-02
# fvalve  - fast valve - FExxx-VA-FVALV-01
# absb    - absorber   - FExxx-VA-ABSB-01
################################################################################
# Control
#

record(state, "FE14I-VA-GVALV-01:CTL")
	{
	field(DESC,"FE Valve Sequencer control")
	}

record(state, "FE14I-VA-GVALV-01:STS")
	{
	field(DESC,"FE Valve Sequencer status")
	}


record(mbbo, "FE14I-VA-GVALV-01:CON")
{
    field(DESC, "Control")
    field(FLNK, "FE14I-VA-GVALV-01:CON1")
    field(ZRST, "Open")
    field(ONST, "Close")
    field(TWST, "Reset")
}
record(bi,"FE14I-VA-GVALV-01:OPENING")
{
    field(DESC, "Opening Valves")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Opening")
}
record(calc,"FE14I-VA-GVALV-01:CON0")
{
    field(DESC, "CON + 1")
    field(CALC, "A+1")
    field(INPA, "FE14I-VA-GVALV-01:CON")
}
record(seq, "FE14I-VA-GVALV-01:CON1")
{
    field(DESC, "Control Valves")
    field(SELM, "Specified")
    field(SELL, "FE14I-VA-GVALV-01:CON0 PP")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-GVALV-01:SEQOPEN  PP")
    field(LNK2, "FE14I-VA-GVALV-01:SEQCLOSE PP")
    field(LNK3, "FE14I-VA-GVALV-01:SEQRESET PP")
}
record(seq, "FE14I-VA-GVALV-01:SEQOPEN")
{
    field(DESC, "Open Valves")
    field(SELM, "All")
    field(DOL1, "1")
    field(DOL2, "1")
    field(LNK1, "FE14I-VA-GVALV-01:OPENING PP")
    field(LNK2, "FE14I-VA-GVALV-01:CTL CA")
}
record(seq, "FE14I-VA-GVALV-01:SEQCLOSE")
{
    field(DESC, "Close Pumps")
    field(SELM, "All")
    field(DOL1, "2")
    field(LNK1, "FE14I-VA-GVALV-01:CTL CA")
}
record(seq, "FE14I-VA-GVALV-01:SEQRESET")
{
    field(DESC, "Reset Valves")
    field(SELM, "All")
    field(DOL1, "3")
    field(LNK1, "FE14I-VA-GVALV-01:CTL CA")
}

record(mbbi, "FE14I-VA-GVALV-01:LASTCON")
{
    field(DESC, "Control Readback")
    field(INP, "FE14I-VA-VALVE-01:LASTCON")
    field(SCAN, "1 second")
    field(ZRST, "Open")
    field(ONST, "Close")
    field(TWST, "Reset")
}

################################################################################
# Interlock Status
#
record(mbbi, "FE14I-VA-GVALV-01:ILKSTA")
{
    field(DESC, "Interlock Status")
    field(INP,  "FE14I-VA-GVALV-01:SELILKSTA MS PP")
    field(SCAN, "1 second")
    field(ZRST, "Failed")
    field(ONST, "Run Ilks OK")
    field(TWST, "OK")
    field(THST, "Disarmed")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
}
record(sel, "FE14I-VA-GVALV-01:SELILKSTA")
{
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-VALVE-01:ILKSTA MS")
    field(INPB, "FE14I-VA-VALVE-02:ILKSTA MS")
    field(INPC, "FE14I-VA-FVALV-01:ILKSTA MS")
}
################################################################################
# Status
#
#% archiver 600 Monitor
record(mbbi, "FE14I-VA-GVALV-01:STA")
{
    field(DESC, "Status")
    field(SCAN, "1 second")
    field(INP,  "FE14I-VA-GVALV-01:CALSTA PP MS")
    field(ZRST, "Fault")
    field(ONST, "Open")
    field(TWST, "Opening")
    field(THST, "Closed")
    field(FRST, "Closing")
    field(ZRSV, "MAJOR")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
}
record(calc, "FE14I-VA-GVALV-01:CALSTA")
{
    field(DESC, "Calculate Status")
    field(CALC, "A<C?A:(B>C?B:C)")
    field(INPA, "FE14I-VA-GVALV-01:MINSTA PP MS")
    field(INPB, "FE14I-VA-GVALV-01:MAXSTA PP MS")
    field(INPC, "1")
}
record(sel, "FE14I-VA-GVALV-01:MINSTA")
{
    field(SELM, "Low Signal")
    field(INPA, "FE14I-VA-VALVE-01:STA MS")
    field(INPB, "FE14I-VA-VALVE-02:STA MS")
    field(INPC, "FE14I-VA-FVALV-01:STA MS")
}
record(sel, "FE14I-VA-GVALV-01:MAXSTA")
{
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-VALVE-01:STA MS")
    field(INPB, "FE14I-VA-VALVE-02:STA MS")
#    field(INPC, "FE14I-VA-FVALV-01:STA MS")
}
################################################################################
# Number of Operations
#
record(longin, "FE14I-VA-GVALV-01:OPS")
{
    field(DESC, "Operations")
    field(INP,  "FE14I-VA-GVALV-01:SELOPS MS PP")
    field(SCAN, "1 second")
    field(HOPR, "10000")
    field(LOPR, "0")
    field(HIHI, "10000")
    field(HIGH, "9000")
    field(LOW,  "0")
    field(LOLO, "-1")
    field(HHSV, "MAJOR")
    field(HSV,  "MINOR")
    field(LSV,  "MINOR")
    field(LLSV, "MAJOR")
}
record(sel, "FE14I-VA-GVALV-01:SELOPS")
{
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-VALVE-01:OPS MS")
    field(INPB, "FE14I-VA-VALVE-02:OPS MS")
    field(INPC, "FE14I-VA-FVALV-01:OPS MS")
}
################################################################################
# Operational/Service Mode
#
record(bi, "FE14I-VA-GVALV-01:MODE")
{
    field(DESC, "Mode")
    field(INP,  "FE14I-VA-GVALV-01:SELMODE MS PP")
    field(SCAN, "1 second")
    field(ZNAM, "Operational")
    field(ONAM, "Service")
}
record(sel, "FE14I-VA-GVALV-01:SELMODE")
{
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-VALVE-01:MODE MS")
    field(INPB, "FE14I-VA-VALVE-02:MODE MS")
    field(INPC, "FE14I-VA-FVALV-01:MODE MS")
}
################################################################################
# Interlocks
#
record(mbbiDirect, "FE14I-VA-GVALV-01:ILK")
{
    field(DESC, "Latched Interlocks")
    field(INP,  "FE14I-VA-GVALV-01:CALILK PP")
    field(SCAN, "1 second")
}
record(calc, "FE14I-VA-GVALV-01:CALILK")
{
    field(CALC, "A&B&C")
    field(INPA, "FE14I-VA-VALVE-01:ILK")
    field(INPB, "FE14I-VA-VALVE-02:ILK")
    field(INPC, "FE14I-VA-FVALV-01:ILK")
}

record(mbbiDirect, "FE14I-VA-GVALV-01:INIILK")
{
    field(DESC, "Raw Interlock Status")
    field(INP,  "FE14I-VA-GVALV-01:CALINIILK PP")
    field(SCAN, "1 second")
}
record(calc, "FE14I-VA-GVALV-01:CALINIILK")
{
    field(CALC, "A&B&C")
    field(INPA, "FE14I-VA-VALVE-01:INIILK")
    field(INPB, "FE14I-VA-VALVE-02:INIILK")
    field(INPC, "FE14I-VA-FVALV-01:INIILK")
}

record(mbbiDirect, "FE14I-VA-GVALV-01:RAWILK")
{
    field(DESC, "Raw Interlock Status")
    field(INP,  "FE14I-VA-GVALV-01:CALRAWILK PP")
    field(SCAN, "1 second")
}
record(calc, "FE14I-VA-GVALV-01:CALRAWILK")
{
    field(CALC, "A&B&C")
    field(INPA, "FE14I-VA-VALVE-01:RAWILK")
    field(INPB, "FE14I-VA-VALVE-02:RAWILK")
    field(INPC, "FE14I-VA-FVALV-01:RAWILK")
}

################################################################################
# Individual Interlocks
#
record(bi, "FE14I-VA-GVALV-01:ILK0")
{
    field(DESC, "Interlock 0")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B0")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 0")
    field(ONAM, "Interlock 0")
}
record(bi, "FE14I-VA-GVALV-01:ILK1")
{
    field(DESC, "Interlock 1")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B1")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 1")
    field(ONAM, "Interlock 1")
}

record(bi, "FE14I-VA-GVALV-01:ILK2")
{
    field(DESC, "Interlock 2")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B2")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 2")
    field(ONAM, "Interlock 2")
}
record(bi, "FE14I-VA-GVALV-01:ILK3")
{
    field(DESC, "Interlock 3")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B3")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 3")
    field(ONAM, "Interlock 3")
}
record(bi, "FE14I-VA-GVALV-01:ILK4")
{
    field(DESC, "Interlock 4")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B4")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 4")
    field(ONAM, "Interlock 4")
}
record(bi, "FE14I-VA-GVALV-01:ILK5")
{
    field(DESC, "Interlock 5")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B5")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 5")
    field(ONAM, "Interlock 5")
}
record(bi, "FE14I-VA-GVALV-01:ILK6")
{
    field(DESC, "Interlock 6")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B6")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 6")
    field(ONAM, "Interlock 6")
}
record(bi, "FE14I-VA-GVALV-01:ILK7")
{
    field(DESC, "Interlock 7")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B7")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 7")
    field(ONAM, "Interlock 7")
}
record(bi, "FE14I-VA-GVALV-01:ILK8")
{
    field(DESC, "Interlock 8")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B8")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 8")
    field(ONAM, "Interlock 8")
}
record(bi, "FE14I-VA-GVALV-01:ILK9")
{
    field(DESC, "Interlock 9")
    field(INP,  "FE14I-VA-GVALV-01:ILK.B9")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 9")
    field(ONAM, "Interlock 9")
}
record(bi, "FE14I-VA-GVALV-01:ILK10")
{
    field(DESC, "Interlock 10")
    field(INP,  "FE14I-VA-GVALV-01:ILK.BA")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 10")
    field(ONAM, "Interlock 10")
}
record(bi, "FE14I-VA-GVALV-01:ILK11")
{
    field(DESC, "Interlock 11")
    field(INP,  "FE14I-VA-GVALV-01:ILK.BB")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 11")
    field(ONAM, "Interlock 11")
}
record(bi, "FE14I-VA-GVALV-01:ILK12")
{
    field(DESC, "Interlock 12")
    field(INP,  "FE14I-VA-GVALV-01:ILK.BC")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 12")
    field(ONAM, "Interlock 12")
}
record(bi, "FE14I-VA-GVALV-01:ILK13")
{
    field(DESC, "Interlock 13")
    field(INP,  "FE14I-VA-GVALV-01:ILK.BD")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 13")
    field(ONAM, "Interlock 13")
}
record(bi, "FE14I-VA-GVALV-01:ILK14")
{
    field(DESC, "Interlock 14")
    field(INP,  "FE14I-VA-GVALV-01:ILK.BE")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 14")
    field(ONAM, "Interlock 14")
}
record(bi, "FE14I-VA-GVALV-01:ILK15")
{
    field(DESC, "Interlock 15")
    field(INP,  "FE14I-VA-GVALV-01:ILK.BF")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(ZSV,  "MAJOR")
    field(OSV,  "NO_ALARM")
    field(ZNAM, "Interlock 15")
    field(ONAM, "Interlock 15")
}
################################################################################
# beamline_access.template
# This template is the EPICS interface to the beamline control state-machine
# beam_bl_request inside vacuum_state_machine.st
#
# Ian Gillingham - 22/12/08
#
# substitutions:
# % macro, device, device name - FExxx-CS-BEAM-01
################################################################################
# Control
# :CTL
#     0 = Idle (assigned by state-machine)
#     1 = Open (Request to attempt to open VALVE-02, SHTR-02, ABSB-02 [or ABSB-01 if only one absorber])
#     2 = Close (Requst to close ABSB, SHTR-02, VALVE-02
#     3 = Abort (Abort any active request)
#
# :STS - The state-machine status given by the following 32 bit value 
#    --------------------------------------------------------------------------------|
#    |   31    |   30    |   29    |   28    |   27    |   26    |   25    |   24    |
#    | ACTIVE  |    X    |    X    |    X    |    X    |    X    |    X    |    X    |
#    --------------------------------------------------------------------------------|
#    |   23    |   22    |   21    |   20    |   19    |   18    |   17    |   16    |
#    |    X    |    X    |  SHTR2  |  SHTR1  |  ABSB   | VALVE2  | VALVE1  | FASTV   |
#    --------------------------------------------------------------------------------|
#    |   15    |   14    |   13    |   12    |   11    |   10    |    9    |    8    |
#    |    X    |    X    |    X    |    X    |    X    |    X    |    X    |    X    |
#    --------------------------------------------------------------------------------|
#    |    7    |    6    |    5    |    4    |    3    |    2    |    1    |    0    |
#    | TIMEOUT | INTERLK |   ARM   |  CLOSE  |  OPEN   |  ABORT  |  DONE   |  INIT   |
#    --------------------------------------------------------------------------------|
#
#  Any request written to :CTL will result in the ACTIVE bit being set to 1 then reset to 0 when the state-machine completes.
#  This applies even if the request caused no change to any devices.
#
#  Ian Gillingham - 13 Jan 2009
#


# % archiver 10 Monitor
record(state, "FE14I-CS-BEAM-01:CTL")
	{
	field(DESC,"FE Beamline access control")
	}

# % archiver 10 Monitor
record(state, "FE14I-CS-BEAM-01:STS")
	{
	field(DESC,"FE Beamline access status")
	}

##########################################################################
# Status
# This record provides a clean interface to the state of the overall
# front-end beam path status. It is written to by the SNL program which 
# manages the beamline access to beam path control.
# The interface is intended to be identical to that of a vacuum valve :STA record
# 
# % archiver 10 Monitor
record(mbbi, "FE14I-CS-BEAM-01:PATH") 
{
  field(DESC, "FE Beampath Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
}
# $Author$
# $Date$
# $Id$
# $Name: post_review_2 $
# $Revision$


# Valve open/close
#
#-------------------------------------------------------------------
# SEQ-01 no longer used - now supported in frontendValveSNL.template
#-------------------------------------------------------------------
record(state, "FE14I-VA-SEQ-01:CON")
	{
	field(DESC,"FE Valve Sequencer control")
	}

record(state, "FE14I-VA-SEQ-01:STA")
	{
	field(DESC,"FE Valve Sequencer status")
	}

	
# Beam block/unblock
record(state, "FE14I-VA-SEQ-02:CON")
	{
	field(DESC,"FE Beam Sequencer control")
	}

record(state, "FE14I-VA-SEQ-02:STA")
	{
	field(DESC,"FE Beam Sequencer status")
	}
	

# Pumps start/stop
record(state, "FE14I-VA-GIONP-01:CTL")
	{
	field(DESC,"FE Pump Sequencer control")
	}

record(state, "FE14I-VA-GIONP-01:STS")
	{
	field(DESC,"FE Pump Sequencer status")
	}

	# mks937b.template
#% macro, __doc__, Template database for an MKS937B Multi-Sensor System
# Ian Gillingham - April 2010
#
# substitutions:
#% macro, device, Device name
#% macro, port,   Asyn Port name, e.g. ty_40_0
#% macro, address, Controller address (001 .. 253)
################################################################################
# Pressure Unit
#
#% controldesk Pressure Unit readback
record(stringin, "FE14I-VA-GCTLR-01:UNIT")
{
    field(DESC, "Pressure Unit")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol unit(001) ts1_1 0")
    field(SCAN, "10 second")
}
################################################################################
# Controller Version
#
#% archiver 10 Monitor
#% controldesk Controller Version readback
record(ai, "FE14I-VA-GCTLR-01:CTLV")
{
    field(DESC, "Controller Version")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol ctlv(001) ts1_1 0")
    field(SCAN, "10 second")
    field(PREC, "2")
}
################################################################################
# Communications Module Version
# !! Note - for the 937B the comms module is integrated and has no ID
# !!        so this record is deprecated and scan is forced to Passive
#% controldesk Communications Version readback
record(ai, "FE14I-VA-GCTLR-01:COMV")
{
    field(DESC, "Communications Version")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol comv(001) ts1_1 0")
    field(SCAN, "Passive")
    #field(SCAN, "10 second")
    field(PREC, "2")
}
################################################################################
# Module in Slot CC
#
#% controldesk Slot CC smon
record(mbbi, "FE14I-VA-GCTLR-01:MCC")
{
    field(DESC, "Slot CC")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol modcc(001) ts1_1 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################
# Module in Slot A
#
#% controldesk Slot A smon
record(mbbi, "FE14I-VA-GCTLR-01:MA")
{
    field(DESC, "Slot A")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol moda(001) ts1_1 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################
# Module in Slot B
#
#% controldesk Slot B smon
record(mbbi, "FE14I-VA-GCTLR-01:MB")
{
    field(DESC, "Slot B")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol modb(001) ts1_1 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################

record(stringin, "FE14I-VA-GCTLR-01:DEBUG")
{
    field(DESC, "Generic command")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol debug(001) ts1_1 0")
    field(SCAN, "Passive")
}

#
# COMMS record to report state of serial communications
# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-GCTLR-01:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-GCTLR-01:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-GCTLR-01:UNIT.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-GCTLR-01:COMMS PP MS")
    }

# mks937b.template
#% macro, __doc__, Template database for an MKS937B Multi-Sensor System
# Ian Gillingham - April 2010
#
# substitutions:
#% macro, device, Device name
#% macro, port,   Asyn Port name, e.g. ty_40_0
#% macro, address, Controller address (001 .. 253)
################################################################################
# Pressure Unit
#
#% controldesk Pressure Unit readback
record(stringin, "FE14I-VA-GCTLR-02:UNIT")
{
    field(DESC, "Pressure Unit")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol unit(001) ts1_2 0")
    field(SCAN, "10 second")
}
################################################################################
# Controller Version
#
#% archiver 10 Monitor
#% controldesk Controller Version readback
record(ai, "FE14I-VA-GCTLR-02:CTLV")
{
    field(DESC, "Controller Version")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol ctlv(001) ts1_2 0")
    field(SCAN, "10 second")
    field(PREC, "2")
}
################################################################################
# Communications Module Version
# !! Note - for the 937B the comms module is integrated and has no ID
# !!        so this record is deprecated and scan is forced to Passive
#% controldesk Communications Version readback
record(ai, "FE14I-VA-GCTLR-02:COMV")
{
    field(DESC, "Communications Version")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol comv(001) ts1_2 0")
    field(SCAN, "Passive")
    #field(SCAN, "10 second")
    field(PREC, "2")
}
################################################################################
# Module in Slot CC
#
#% controldesk Slot CC smon
record(mbbi, "FE14I-VA-GCTLR-02:MCC")
{
    field(DESC, "Slot CC")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol modcc(001) ts1_2 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################
# Module in Slot A
#
#% controldesk Slot A smon
record(mbbi, "FE14I-VA-GCTLR-02:MA")
{
    field(DESC, "Slot A")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol moda(001) ts1_2 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################
# Module in Slot B
#
#% controldesk Slot B smon
record(mbbi, "FE14I-VA-GCTLR-02:MB")
{
    field(DESC, "Slot B")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol modb(001) ts1_2 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################

record(stringin, "FE14I-VA-GCTLR-02:DEBUG")
{
    field(DESC, "Generic command")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol debug(001) ts1_2 0")
    field(SCAN, "Passive")
}

#
# COMMS record to report state of serial communications
# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-GCTLR-02:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-GCTLR-02:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-GCTLR-02:UNIT.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-GCTLR-02:COMMS PP MS")
    }

# mks937b.template
#% macro, __doc__, Template database for an MKS937B Multi-Sensor System
# Ian Gillingham - April 2010
#
# substitutions:
#% macro, device, Device name
#% macro, port,   Asyn Port name, e.g. ty_40_0
#% macro, address, Controller address (001 .. 253)
################################################################################
# Pressure Unit
#
#% controldesk Pressure Unit readback
record(stringin, "FE14I-VA-GCTLR-03:UNIT")
{
    field(DESC, "Pressure Unit")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol unit(001) ts1_3 0")
    field(SCAN, "10 second")
}
################################################################################
# Controller Version
#
#% archiver 10 Monitor
#% controldesk Controller Version readback
record(ai, "FE14I-VA-GCTLR-03:CTLV")
{
    field(DESC, "Controller Version")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol ctlv(001) ts1_3 0")
    field(SCAN, "10 second")
    field(PREC, "2")
}
################################################################################
# Communications Module Version
# !! Note - for the 937B the comms module is integrated and has no ID
# !!        so this record is deprecated and scan is forced to Passive
#% controldesk Communications Version readback
record(ai, "FE14I-VA-GCTLR-03:COMV")
{
    field(DESC, "Communications Version")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol comv(001) ts1_3 0")
    field(SCAN, "Passive")
    #field(SCAN, "10 second")
    field(PREC, "2")
}
################################################################################
# Module in Slot CC
#
#% controldesk Slot CC smon
record(mbbi, "FE14I-VA-GCTLR-03:MCC")
{
    field(DESC, "Slot CC")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol modcc(001) ts1_3 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################
# Module in Slot A
#
#% controldesk Slot A smon
record(mbbi, "FE14I-VA-GCTLR-03:MA")
{
    field(DESC, "Slot A")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol moda(001) ts1_3 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################
# Module in Slot B
#
#% controldesk Slot B smon
record(mbbi, "FE14I-VA-GCTLR-03:MB")
{
    field(DESC, "Slot B")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol modb(001) ts1_3 0")
    field(SCAN, "10 second")
    field(ZRST, "Hot Cathode")
    field(ONST, "Cold Cathode")
    field(TWST, "Dual Pirani")
    field(THST, "Dual Cnv Pirani")
    field(FRST, "Dual Thermocpl")
    field(FVST, "Dual Cap Manmtr")
    field(SXST, "Sngl Pirani")
    field(SVST, "Sngl Cnv Pirani")
    field(EIST, "Sngl Thrmcpl")
    field(NIST, "Sngl Cap Manmtr")
    field(TEST, "No Module")
    field(ELST, "Wrong Module")
    field(UNSV, "MAJOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(THSV, "NO_ALARM")
    field(FRSV, "NO_ALARM")
    field(FVSV, "NO_ALARM")
    field(SXSV, "NO_ALARM")
    field(SVSV, "NO_ALARM")
    field(EISV, "NO_ALARM")
    field(NISV, "NO_ALARM")
    field(TESV, "NO_ALARM")
    field(ELSV, "MAJOR")
}
################################################################################

record(stringin, "FE14I-VA-GCTLR-03:DEBUG")
{
    field(DESC, "Generic command")
    field(DTYP, "stream")
    field(INP,  "@mks937b.protocol debug(001) ts1_3 0")
    field(SCAN, "Passive")
}

#
# COMMS record to report state of serial communications
# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-GCTLR-03:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-GCTLR-03:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-GCTLR-03:UNIT.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-GCTLR-03:COMMS PP MS")
    }

#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bImg.template
#% macro, __doc__, Template database for an inverted magnetron guage connected 
# to one channel of an mks937b Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)
#
# optional substitutions:
#% macro, name,        Object name, and gui association name
#% macro, ctl_channel, The desired control channel 0 = C1, 1 = C2, 2 = None, 3 = A1, 4 = B1, 5 = A2, 6 = B2.
#% macro, ctlsp_level, The desired control setpoint value.
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_hihi,  The HIHI alarm field on the control setpoint record.
#% macro, ctlsp_lolo,  The LOLO alarm field on the control setpoint record.
#% macro, ctlsp_high,  The HIGH alarm field on the control setpoint record.
#% macro, ctlsp_low ,  The LOW alarm field on the control setpoint record.
#% macro, ctlsp_desc,  The DESC field on the control setpoint record.
#% macro, ctlhyst_hopr,The HOPR field on control hysteresis records 
#                      (high operator value - helps display set correct range).
#% macro, ctlhyst_lopr,The LOPR field on control hysteresis records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_level, The desired protection setpoint value.
#% macro, prosp_drvh,  The DRVH field on protection setpoint records 
#                      (limits max value of protection setpoint)
#% macro, prosp_drvl,  The DRVL field on protection setpoint records. 
#                      (limits min value of protection setpoint)
#% macro, prosp_hopr,  The HOPR field on protection setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, prosp_lopr,  The LOPR field on protection setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_hihi,  The HIHI alarm field on the protection setpoint record.
#% macro, prosp_lolo,  The LOLO alarm field on the protection setpoint record.
#% macro, prosp_high,  The HIGH alarm field on the protection setpoint record.
#% macro, prosp_low ,  The LOW alarm field on the protection setpoint record.
#% macro, prosp_desc,  The DESC field on the protection setpoint record 
#                      (appears as a label on the Img EDM screen).
#
#% macro, offwarn,     Flag to display a warning that switching off the IMG could trip the beam
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
#% macro, img_ctl_setmode, Default = 1 (I/L Safe), 0 (Force ON), 2 (I/L Operating).
#
################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bImg.edl, device=FE14I-VA-IMG-01

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/img_detail.opi, device=FE14I-VA-IMG-01, desc=FE14I-VA-IMG-01, name=
# % gui, , boyembed, mks937bApp_opi/img_embed_box.opi, device=FE14I-VA-IMG-01, desc=FE14I-VA-IMG-01, name=
# % gui, , boyembed, mks937bApp_opi/img_embed.opi, device=FE14I-VA-IMG-01, desc=FE14I-VA-IMG-01, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,                                FE14I-VA-IMG-01:P
# % gui, , readback, Status,                                  FE14I-VA-IMG-01:STA
# % gui, , readback, Gauge Setpoint Write,                    FE14I-VA-IMG-01:PRO:ILKSETSP:NOWRITE
# % gui, , readback, Relay 1 on SetPoint for Summary,         FE14I-VA-IMG-01:RLY1:SP,        =pv("FE14I-VA-IMG-01:RLY1:SP.DESC")
# % gui, , readback, Relay 1 off SetPoint for Summary,        FE14I-VA-IMG-01:RLY1:SPOFF,     =pv("FE14I-VA-IMG-01:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 on SetPoint for Summary,         FE14I-VA-IMG-01:RLY2:SP,        =pv("FE14I-VA-IMG-01:RLY2:SP.DESC")
# % gui, , readback, Relay 3 on SetPoint for Summary,         FE14I-VA-IMG-01:RLY3:SP,        =pv("FE14I-VA-IMG-01:RLY3:SP.DESC")
## TODO The below gives us feedback on what the state actually is - without this you get the current demand
## (as per differences between EDM and CSS enum menus)
# % gui, , readback, Cold Cathode,                            FE14I-VA-IMG-01:ISENABLED
# % gui, , enum, Cold Cathode,                                FE14I-VA-IMG-01:CCHV

# % gui, , readback, CTL SP Controlling Gauge,                FE14I-VA-IMG-01:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-01:CTL:SP.DESC")," Gauge")
# % gui, , readback, CTL SP MODE,                             FE14I-VA-IMG-01:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-01:CTL:SP.DESC")," Mode")
# % gui, , readback, Pro Setpoint,                            FE14I-VA-IMG-01:PRO:SP,         =pv("FE14I-VA-IMG-01:PRO:SP.DESC")
# % gui, , readback, Relay 1 On Setpoint,                     FE14I-VA-IMG-01:RLY1:SP,        =pv("FE14I-VA-IMG-01:RLY1:SP.DESC")
# % gui, , readback, Relay 1 Off Setpoint,                    FE14I-VA-IMG-01:RLY1:SPOFF,     =pv("FE14I-VA-IMG-01:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 On Setpoint,                     FE14I-VA-IMG-01:RLY2:SP,        =pv("FE14I-VA-IMG-01:RLY2:SP.DESC")
# % gui, , readback, Relay 2 Off Setpoint,                    FE14I-VA-IMG-01:RLY2:SPOFF,     =pv("FE14I-VA-IMG-01:RLY2:SPOFF.DESC")
# % gui, , readback, Relay 3 On Setpoint,                     FE14I-VA-IMG-01:RLY3:SP,        =pv("FE14I-VA-IMG-01:RLY3:SP.DESC")
# % gui, , readback, Relay 3 Off Setpoint,                    FE14I-VA-IMG-01:RLY3:SPOFF,     =pv("FE14I-VA-IMG-01:RLY3:SPOFF.DESC")
# % gui, , readback, Relay 4 On Setpoint,                     FE14I-VA-IMG-01:RLY4:SP,        =pv("FE14I-VA-IMG-01:RLY4:SP.DESC")
# % gui, , readback, Relay 4 Off Setpoint,                    FE14I-VA-IMG-01:RLY4:SPOFF,     =pv("FE14I-VA-IMG-01:RLY4:SPOFF.DESC")
# % gui, , readback, Fast Relay On Setpoint,                  FE14I-VA-IMG-01:FRLY:SP,        =pv("FE14I-VA-IMG-01:FRLY:SP.DESC")

# % gui, , demand,   Pro Setpoint,                            FE14I-VA-IMG-01:PRO:OUTSP,      =pv("FE14I-VA-IMG-01:PRO:SP.DESC")
# % gui, , demand,   Relay 1 On Setpoint,                     FE14I-VA-IMG-01:RLY1:SETSP,     =pv("FE14I-VA-IMG-01:RLY1:SP.DESC")
# % gui, , demand,   Relay 1 Off Setpoint,                    FE14I-VA-IMG-01:RLY1:SETSPOFF,  =pv("FE14I-VA-IMG-01:RLY1:SPOFF.DESC")
# % gui, , demand,   Relay 2 On Setpoint,                     FE14I-VA-IMG-01:RLY2:SETSP,     =pv("FE14I-VA-IMG-01:RLY2:SP.DESC")
# % gui, , demand,   Relay 2 Off Setpoint,                    FE14I-VA-IMG-01:RLY2:SETSPOFF,  =pv("FE14I-VA-IMG-01:RLY2:SPOFF.DESC")
# % gui, , demand,   Relay 3 On Setpoint,                     FE14I-VA-IMG-01:RLY3:SETSP,     =pv("FE14I-VA-IMG-01:RLY3:SP.DESC")
# % gui, , demand,   Relay 3 Off Setpoint,                    FE14I-VA-IMG-01:RLY3:SETSPOFF,  =pv("FE14I-VA-IMG-01:RLY3:SPOFF.DESC")
# % gui, , demand,   Relay 4 On Setpoint,                     FE14I-VA-IMG-01:RLY4:SETSP,     =pv("FE14I-VA-IMG-01:RLY4:SP.DESC")
# % gui, , demand,   Relay 4 Off Setpoint,                    FE14I-VA-IMG-01:RLY4:SETSPOFF,  =pv("FE14I-VA-IMG-01:RLY4:SPOFF.DESC")
# % gui, , demand,   Fast Relay On Setpoint,                  FE14I-VA-IMG-01:FRLY:SETSP,     =pv("FE14I-VA-IMG-01:FRLY:SP.DESC")

# % gui, , readback, Relay 1 SP Mode,                         FE14I-VA-IMG-01:RLY1:MODE,      =concat(pv("FE14I-VA-IMG-01:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Mode,                         FE14I-VA-IMG-01:RLY2:MODE,      =concat(pv("FE14I-VA-IMG-01:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Mode,                         FE14I-VA-IMG-01:RLY3:MODE,      =concat(pv("FE14I-VA-IMG-01:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Mode,                         FE14I-VA-IMG-01:RLY4:MODE,      =concat(pv("FE14I-VA-IMG-01:RLY4:SP.DESC")," Mode")

# % gui, , enum, CTL SP Controlling Gauge,                    FE14I-VA-IMG-01:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-01:CTL:SP.DESC")," Gauge")
# % gui, , enum, CTL SP MODE,                                 FE14I-VA-IMG-01:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-01:CTL:SP.DESC")," Mode")
# % gui, , enum, Relay 1 SP Mode,                             FE14I-VA-IMG-01:RLY1:SETMODE,   =concat(pv("FE14I-VA-IMG-01:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 1 SP Direction,                    FE14I-VA-IMG-01:RLY1:DIR,       =concat(pv("FE14I-VA-IMG-01:RLY1:SP.DESC")," Dir")
# % gui, , enum, Relay 2 SP Mode,                             FE14I-VA-IMG-01:RLY2:SETMODE,   =concat(pv("FE14I-VA-IMG-01:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Direction,                    FE14I-VA-IMG-01:RLY2:DIR,       =concat(pv("FE14I-VA-IMG-01:RLY2:SP.DESC")," Dir")
# % gui, , enum, Relay 3 SP Mode,                             FE14I-VA-IMG-01:RLY3:SETMODE,   =concat(pv("FE14I-VA-IMG-01:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Direction,                    FE14I-VA-IMG-01:RLY3:DIR,       =concat(pv("FE14I-VA-IMG-01:RLY3:SP.DESC")," Dir")
# % gui, , enum, Relay 4 SP Mode,                             FE14I-VA-IMG-01:RLY4:SETMODE,   =concat(pv("FE14I-VA-IMG-01:RLY4:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Direction,                    FE14I-VA-IMG-01:RLY4:DIR,       =concat(pv("FE14I-VA-IMG-01:RLY4:SP.DESC")," Dir")

#
#% archiver 10 Monitor
#% controldesk Pressure scon
#
record(bo, "FE14I-VA-IMG-01:CCHV") 
{
  field(DESC, "Cold Cathode Enable")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol ccenable(001,1) ts1_1 0")
  field(FLNK, "FE14I-VA-IMG-01:FANENAB")
  field(ZNAM, "Off")
  field(ONAM, "On")
}

record(mbbi, "FE14I-VA-IMG-01:ISENABLED") {
  field(DESC, "IMG power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_cc_enabled(001,1) ts1_1")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

#  Changing CC HV mode requires associated processing of :STA and :ISENABLED
#  to update the readbacks
record(fanout, "FE14I-VA-IMG-01:FANENAB")
{
    field(DESC, "Distribute enabled")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-01:STA")
    field(LNK2, "FE14I-VA-IMG-01:ISENABLED")
}


record(bi, "FE14I-VA-IMG-01:SWITCHING") 
{
  field(DESC, "Switching")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Switching")
}

################################################################################
# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-IMG-01:STA") 
{
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,1) ts1_1")
#  field(SCAN, "I/O Intr")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-IMG-01:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
#   This record is disabled when :PDIS is 1, i.e. when the status returned is 
#   not a pressure reading.
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-IMG-01:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,1,FE14I-VA-IMG-01) ts1_1")
  field(FLNK, "FE14I-VA-IMG-01:PLOG")
  field(EGU, "mbar")
  field(PREC, "11")
  field(HOPR, "0.01")
  field(LOPR, "1.0E-11")
#  field(SDIS, "FE14I-VA-IMG-01:PDIS")
  field(DISS, "INVALID")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-IMG-01:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-IMG-01:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-IMG-01:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-IMG-01:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-IMG-01:STA PP")
}

record(calcout, "FE14I-VA-IMG-01:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-IMG-01:P.ADEL")
  field(INPA, "FE14I-VA-IMG-01:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IMG-01:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-IMG-01:P MS")
  field(FLNK, "FE14I-VA-IMG-01:PMAX")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}
record(ai, "FE14I-VA-IMG-01:PMAX")
{
    field(DESC, "Max Pressure")
    field(INP,  "FE14I-VA-IMG-01:P MS")
    field(FLNK, "FE14I-VA-IMG-01:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(ai, "FE14I-VA-IMG-01:PMIN")
{
    field(DESC, "Min Pressure")
    field(INP,  "FE14I-VA-IMG-01:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
    field(FLNK, "FE14I-VA-IMG-01:PSEQ")
}
################################################################################
# Control - IMG Enable
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-01:CTL:FAN10S")
{
    field(DESC, "CTL 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-01:CTL:MODE PP")
    field(LNK2, "FE14I-VA-IMG-01:CTL:CCS PP")
    field(LNK3, "FE14I-VA-IMG-01:CTL:SP PP")
    field(LNK4, "FE14I-VA-IMG-01:PRO:SP PP")
    field(SELM, "All")
}

#record(ao, "FE14I-VA-IMG-01:CTL:SETSP") {
#  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_1")
#  field(FLNK, "FE14I-VA-IMG-01:CTL:HYST")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "9.5e-1")
#  field(LOPR, "2.7e-3")
#  field(DRVH, "9.5e-1")
#  field(DRVL, "2.7e-3")
#  field(DOL, "1.0e-2")
#}

record(ai, "FE14I-VA-IMG-01:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_sp(001,1) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(HIHI, "9.6e-1")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "9.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# This record sets the setpoint locally
# but doesnt write it to the controller
# as we now need to send a pre-command
# to extend the setpoint range (XCS<n> command)
record(ao, "FE14I-VA-IMG-01:CTL:OUTSP") 
{
  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  Device Output now via CTL:SETSP after CTL:SETSPPRESEQ
#  field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(DOL, "1.0e-2")
#  field(FLNK, "FE14I-VA-IMG-01:CTL:SETSPFAN")
# Insert pre-sequence to set extended setpoint
  field(FLNK, "FE14I-VA-IMG-01:CTL:SETSPPRESEQ")
}

record(ao, "FE14I-VA-IMG-01:CTL:SETSP") 
    {
    field(DESC, "IMG Enable")
    field(DTYP, "stream")
    field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_1")
    field(EGU, "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL, "1.0e-2")
    field(FLNK, "FE14I-VA-IMG-01:CTL:SETSPFAN")
    }

record(seq, "FE14I-VA-IMG-01:CTL:SETSPPRESEQ")
    {
    field(DESC, "Preconditions to IMG Setpoint")
    field(SELM, "All")
    field(DOL1, "1")
    field(LNK1, "FE14I-VA-IMG-01:CTL:SETEXTRANGE PP")
    field(DOL2, "FE14I-VA-IMG-01:CTL:OUTSP")
    field(LNK2, "FE14I-VA-IMG-01:CTL:SETSP PP")
    }

record(mbbo, "FE14I-VA-IMG-01:CTL:SETEXTRANGE")
    {
    field(DTYP, "stream")
    field(DESC, "CC Extended Setpoint Enable")
    field(OUT, "@mks937b.protocol setcc_extended_range(001,1) ts1_1")
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL, "1")
#    field(PINI, "YES")
    }

# On setting a new interlock control setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-01:CTL:SETSPFAN")
{
    field(DESC, "CTL Set SP fanout")
    field(LNK1, "FE14I-VA-IMG-01:CTL:HYST PP")
    field(LNK2, "FE14I-VA-IMG-01:CTL:SP PP")
}

record(ao, "FE14I-VA-IMG-01:CTL:SETHYST") 
{
  field(DESC, "CC Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setcc_hyst(001,1) ts1_1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(FLNK, "FE14I-VA-IMG-01:CTL:HYST PP")
}

record(calc, "FE14I-VA-IMG-01:CTL:MINHYST") 
{
  field(DESC, "Minimum hysteresis")
  field(EGU, "mbar")
  field(CALC, "A*1.2")
  field(INPA, "FE14I-VA-IMG-01:CTL:SP MS")
  field(FLNK, "FE14I-VA-IMG-01:CTL:SETHYST")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}

record(ai, "FE14I-VA-IMG-01:CTL:HYST") 
{
  field(DESC, "Setpoint Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_hyst(001,1) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-01:CTL:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-IMG-01:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-01:CTL:HYST")
  field(LNK1, "FE14I-VA-IMG-01:CTL:SETHYST.VAL PP")
}


record(bo, "FE14I-VA-IMG-01:CTL:DIS") 
{
  field(DESC, "Disable Control Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol discc_sp(001,1) ts1_1")
}

record(mbbo, "FE14I-VA-IMG-01:CTL:SETMODE") 
{
  field(DTYP, "stream")
  field(DESC, "CC Operating Mode")
  field(OUT, "@mks937b.protocol setcc_ctl(001,1) ts1_1")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:CTL:MODE")
}


record(mbbi, "FE14I-VA-IMG-01:CTL:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctl(001,1) ts1_1")
  field(DESC, "CC Status")
  field(SCAN, "Passive")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(UNSV, "MAJOR")
  field(ZRSV, "MINOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}


record(mbbo, "FE14I-VA-IMG-01:CTL:SETCCS") 
{
  field(DTYP, "stream")
  field(DESC, "Control Channel Status")
  field(OUT, "@mks937b.protocol setcc_ctrl_chan(001,1) ts1_1")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(ZRSV, "MINOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(DOL, "0")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:CTL:CCS")
}


record(mbbi, "FE14I-VA-IMG-01:CTL:CCS") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctrl_chan(001,1) ts1_1")
  field(DESC, "Control Channel Status")
  field(SCAN, "Passive")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
}


################################################################################
# Protection - IMG Overpressure
#
##% archiver 10 Monitor
#
#record(ao, "FE14I-VA-IMG-01:PRO:SETSP") 
#{
#  field(DESC, "IMG Overpressure")
#  field(FLNK, "FE14I-VA-IMG-01:PRO:SEQ")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "1.0e-2")
#  field(LOPR, "1.3e-5")
#  field(DRVH, "1.0e-2")
#  field(DRVL, "1.3e-5")
#  field(DOL, "5.0e-4")
#}

#
##% archiver 10 Monitor
#
#record(mbbo, "FE14I-VA-IMG-01:PRO:ENABLE") 
#{
#  field(DESC, "Enable Protection Setpoint")
#  field(FLNK, "FE14I-VA-IMG-01:PRO:SEQ")
#  field(ZRST, "Force On I/L")
#  field(ONST, "I/L Operating")
#  field(ZRVL, "1")
#  field(ONVL, "2")
#  field(ZRSV, "MAJOR")
#  field(ONSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")    field(LNK2, "FE14I-VA-IMG-01:CTL:CCS")

#}

#record(seq, "FE14I-VA-IMG-01:PRO:SEQ") 
#{
#  field(DESC, "Sequence Protection Setpoint")
#  field(SELM, "Specified")
#  field(SELL, "FE14I-VA-IMG-01:PRO:ENABLE.RVAL")
#  field(DOL1, "0")
#  field(LNK1, "FE14I-VA-IMG-01:PRO:DIS PP")
#  field(DOL2, "FE14I-VA-IMG-01:PRO:SETSP")
#  field(LNK2, "FE14I-VA-IMG-01:PRO:OUTSP PP")
#}

#
#% archiver 10 Monitor
#% controldesk IMG Overpressure readback
#
record(ai, "FE14I-VA-IMG-01:PRO:SP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getpro(001,1) ts1_1 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(HIHI, "1.1e-2")
  field(LOLO, "1.2e-5")
  field(HIGH, "5.1e-4")
  field(LOW, "4.9e-4")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-01:PRO:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-01:PRO:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-01:PRO:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-01:PRO:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-01:PRO:OUTSP")
    field(LNK3, "FE14I-VA-IMG-01:PRO:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-01:PRO:OUTSP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setpro(001,1) ts1_1")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(DRVH, "1.0e-2")
  field(DRVL, "1.3e-5")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-01:PRO:ILKSETSP:NOWRITE")
  field(DOL,  "5.0e-4")
  field(FLNK, "FE14I-VA-IMG-01:PRO:SP PP")
}
# -----------------------------------------------------------------------------------------

record(bo, "FE14I-VA-IMG-01:PRO:DIS") 
{
  field(DESC, "Disable Protection Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dispro(001,1) ts1_1")
}

record(calc, "FE14I-VA-IMG-01:PDIS") {
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-IMG-01:STA")
  field(FLNK, "FE14I-VA-IMG-01:P")
}

record(ai, "FE14I-VA-IMG-01:ERRORNUM") 
{
  field(DESC, "Last error code")
  field(DTYP, "Soft Channel")
  field(INP, "0")
  field(SCAN, "Passive")
}


record(bi, "FE14I-VA-IMG-01:OFFWARN") 
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}


#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-01:PRO:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-01:PRO:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
  #! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bImg.template
#% macro, __doc__, Template database for an inverted magnetron guage connected 
# to one channel of an mks937b Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)
#
# optional substitutions:
#% macro, name,        Object name, and gui association name
#% macro, ctl_channel, The desired control channel 0 = C1, 1 = C2, 2 = None, 3 = A1, 4 = B1, 5 = A2, 6 = B2.
#% macro, ctlsp_level, The desired control setpoint value.
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_hihi,  The HIHI alarm field on the control setpoint record.
#% macro, ctlsp_lolo,  The LOLO alarm field on the control setpoint record.
#% macro, ctlsp_high,  The HIGH alarm field on the control setpoint record.
#% macro, ctlsp_low ,  The LOW alarm field on the control setpoint record.
#% macro, ctlsp_desc,  The DESC field on the control setpoint record.
#% macro, ctlhyst_hopr,The HOPR field on control hysteresis records 
#                      (high operator value - helps display set correct range).
#% macro, ctlhyst_lopr,The LOPR field on control hysteresis records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_level, The desired protection setpoint value.
#% macro, prosp_drvh,  The DRVH field on protection setpoint records 
#                      (limits max value of protection setpoint)
#% macro, prosp_drvl,  The DRVL field on protection setpoint records. 
#                      (limits min value of protection setpoint)
#% macro, prosp_hopr,  The HOPR field on protection setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, prosp_lopr,  The LOPR field on protection setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_hihi,  The HIHI alarm field on the protection setpoint record.
#% macro, prosp_lolo,  The LOLO alarm field on the protection setpoint record.
#% macro, prosp_high,  The HIGH alarm field on the protection setpoint record.
#% macro, prosp_low ,  The LOW alarm field on the protection setpoint record.
#% macro, prosp_desc,  The DESC field on the protection setpoint record 
#                      (appears as a label on the Img EDM screen).
#
#% macro, offwarn,     Flag to display a warning that switching off the IMG could trip the beam
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
#% macro, img_ctl_setmode, Default = 1 (I/L Safe), 0 (Force ON), 2 (I/L Operating).
#
################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bImg.edl, device=FE14I-VA-IMG-02

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/img_detail.opi, device=FE14I-VA-IMG-02, desc=FE14I-VA-IMG-02, name=
# % gui, , boyembed, mks937bApp_opi/img_embed_box.opi, device=FE14I-VA-IMG-02, desc=FE14I-VA-IMG-02, name=
# % gui, , boyembed, mks937bApp_opi/img_embed.opi, device=FE14I-VA-IMG-02, desc=FE14I-VA-IMG-02, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,                                FE14I-VA-IMG-02:P
# % gui, , readback, Status,                                  FE14I-VA-IMG-02:STA
# % gui, , readback, Gauge Setpoint Write,                    FE14I-VA-IMG-02:PRO:ILKSETSP:NOWRITE
# % gui, , readback, Relay 1 on SetPoint for Summary,         FE14I-VA-IMG-02:RLY1:SP,        =pv("FE14I-VA-IMG-02:RLY1:SP.DESC")
# % gui, , readback, Relay 1 off SetPoint for Summary,        FE14I-VA-IMG-02:RLY1:SPOFF,     =pv("FE14I-VA-IMG-02:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 on SetPoint for Summary,         FE14I-VA-IMG-02:RLY2:SP,        =pv("FE14I-VA-IMG-02:RLY2:SP.DESC")
# % gui, , readback, Relay 3 on SetPoint for Summary,         FE14I-VA-IMG-02:RLY3:SP,        =pv("FE14I-VA-IMG-02:RLY3:SP.DESC")
## TODO The below gives us feedback on what the state actually is - without this you get the current demand
## (as per differences between EDM and CSS enum menus)
# % gui, , readback, Cold Cathode,                            FE14I-VA-IMG-02:ISENABLED
# % gui, , enum, Cold Cathode,                                FE14I-VA-IMG-02:CCHV

# % gui, , readback, CTL SP Controlling Gauge,                FE14I-VA-IMG-02:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-02:CTL:SP.DESC")," Gauge")
# % gui, , readback, CTL SP MODE,                             FE14I-VA-IMG-02:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-02:CTL:SP.DESC")," Mode")
# % gui, , readback, Pro Setpoint,                            FE14I-VA-IMG-02:PRO:SP,         =pv("FE14I-VA-IMG-02:PRO:SP.DESC")
# % gui, , readback, Relay 1 On Setpoint,                     FE14I-VA-IMG-02:RLY1:SP,        =pv("FE14I-VA-IMG-02:RLY1:SP.DESC")
# % gui, , readback, Relay 1 Off Setpoint,                    FE14I-VA-IMG-02:RLY1:SPOFF,     =pv("FE14I-VA-IMG-02:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 On Setpoint,                     FE14I-VA-IMG-02:RLY2:SP,        =pv("FE14I-VA-IMG-02:RLY2:SP.DESC")
# % gui, , readback, Relay 2 Off Setpoint,                    FE14I-VA-IMG-02:RLY2:SPOFF,     =pv("FE14I-VA-IMG-02:RLY2:SPOFF.DESC")
# % gui, , readback, Relay 3 On Setpoint,                     FE14I-VA-IMG-02:RLY3:SP,        =pv("FE14I-VA-IMG-02:RLY3:SP.DESC")
# % gui, , readback, Relay 3 Off Setpoint,                    FE14I-VA-IMG-02:RLY3:SPOFF,     =pv("FE14I-VA-IMG-02:RLY3:SPOFF.DESC")
# % gui, , readback, Relay 4 On Setpoint,                     FE14I-VA-IMG-02:RLY4:SP,        =pv("FE14I-VA-IMG-02:RLY4:SP.DESC")
# % gui, , readback, Relay 4 Off Setpoint,                    FE14I-VA-IMG-02:RLY4:SPOFF,     =pv("FE14I-VA-IMG-02:RLY4:SPOFF.DESC")
# % gui, , readback, Fast Relay On Setpoint,                  FE14I-VA-IMG-02:FRLY:SP,        =pv("FE14I-VA-IMG-02:FRLY:SP.DESC")

# % gui, , demand,   Pro Setpoint,                            FE14I-VA-IMG-02:PRO:OUTSP,      =pv("FE14I-VA-IMG-02:PRO:SP.DESC")
# % gui, , demand,   Relay 1 On Setpoint,                     FE14I-VA-IMG-02:RLY1:SETSP,     =pv("FE14I-VA-IMG-02:RLY1:SP.DESC")
# % gui, , demand,   Relay 1 Off Setpoint,                    FE14I-VA-IMG-02:RLY1:SETSPOFF,  =pv("FE14I-VA-IMG-02:RLY1:SPOFF.DESC")
# % gui, , demand,   Relay 2 On Setpoint,                     FE14I-VA-IMG-02:RLY2:SETSP,     =pv("FE14I-VA-IMG-02:RLY2:SP.DESC")
# % gui, , demand,   Relay 2 Off Setpoint,                    FE14I-VA-IMG-02:RLY2:SETSPOFF,  =pv("FE14I-VA-IMG-02:RLY2:SPOFF.DESC")
# % gui, , demand,   Relay 3 On Setpoint,                     FE14I-VA-IMG-02:RLY3:SETSP,     =pv("FE14I-VA-IMG-02:RLY3:SP.DESC")
# % gui, , demand,   Relay 3 Off Setpoint,                    FE14I-VA-IMG-02:RLY3:SETSPOFF,  =pv("FE14I-VA-IMG-02:RLY3:SPOFF.DESC")
# % gui, , demand,   Relay 4 On Setpoint,                     FE14I-VA-IMG-02:RLY4:SETSP,     =pv("FE14I-VA-IMG-02:RLY4:SP.DESC")
# % gui, , demand,   Relay 4 Off Setpoint,                    FE14I-VA-IMG-02:RLY4:SETSPOFF,  =pv("FE14I-VA-IMG-02:RLY4:SPOFF.DESC")
# % gui, , demand,   Fast Relay On Setpoint,                  FE14I-VA-IMG-02:FRLY:SETSP,     =pv("FE14I-VA-IMG-02:FRLY:SP.DESC")

# % gui, , readback, Relay 1 SP Mode,                         FE14I-VA-IMG-02:RLY1:MODE,      =concat(pv("FE14I-VA-IMG-02:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Mode,                         FE14I-VA-IMG-02:RLY2:MODE,      =concat(pv("FE14I-VA-IMG-02:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Mode,                         FE14I-VA-IMG-02:RLY3:MODE,      =concat(pv("FE14I-VA-IMG-02:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Mode,                         FE14I-VA-IMG-02:RLY4:MODE,      =concat(pv("FE14I-VA-IMG-02:RLY4:SP.DESC")," Mode")

# % gui, , enum, CTL SP Controlling Gauge,                    FE14I-VA-IMG-02:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-02:CTL:SP.DESC")," Gauge")
# % gui, , enum, CTL SP MODE,                                 FE14I-VA-IMG-02:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-02:CTL:SP.DESC")," Mode")
# % gui, , enum, Relay 1 SP Mode,                             FE14I-VA-IMG-02:RLY1:SETMODE,   =concat(pv("FE14I-VA-IMG-02:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 1 SP Direction,                    FE14I-VA-IMG-02:RLY1:DIR,       =concat(pv("FE14I-VA-IMG-02:RLY1:SP.DESC")," Dir")
# % gui, , enum, Relay 2 SP Mode,                             FE14I-VA-IMG-02:RLY2:SETMODE,   =concat(pv("FE14I-VA-IMG-02:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Direction,                    FE14I-VA-IMG-02:RLY2:DIR,       =concat(pv("FE14I-VA-IMG-02:RLY2:SP.DESC")," Dir")
# % gui, , enum, Relay 3 SP Mode,                             FE14I-VA-IMG-02:RLY3:SETMODE,   =concat(pv("FE14I-VA-IMG-02:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Direction,                    FE14I-VA-IMG-02:RLY3:DIR,       =concat(pv("FE14I-VA-IMG-02:RLY3:SP.DESC")," Dir")
# % gui, , enum, Relay 4 SP Mode,                             FE14I-VA-IMG-02:RLY4:SETMODE,   =concat(pv("FE14I-VA-IMG-02:RLY4:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Direction,                    FE14I-VA-IMG-02:RLY4:DIR,       =concat(pv("FE14I-VA-IMG-02:RLY4:SP.DESC")," Dir")

#
#% archiver 10 Monitor
#% controldesk Pressure scon
#
record(bo, "FE14I-VA-IMG-02:CCHV") 
{
  field(DESC, "Cold Cathode Enable")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol ccenable(001,3) ts1_1 0")
  field(FLNK, "FE14I-VA-IMG-02:FANENAB")
  field(ZNAM, "Off")
  field(ONAM, "On")
}

record(mbbi, "FE14I-VA-IMG-02:ISENABLED") {
  field(DESC, "IMG power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_cc_enabled(001,3) ts1_1")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

#  Changing CC HV mode requires associated processing of :STA and :ISENABLED
#  to update the readbacks
record(fanout, "FE14I-VA-IMG-02:FANENAB")
{
    field(DESC, "Distribute enabled")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-02:STA")
    field(LNK2, "FE14I-VA-IMG-02:ISENABLED")
}


record(bi, "FE14I-VA-IMG-02:SWITCHING") 
{
  field(DESC, "Switching")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Switching")
}

################################################################################
# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-IMG-02:STA") 
{
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,3) ts1_1")
#  field(SCAN, "I/O Intr")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-IMG-02:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
#   This record is disabled when :PDIS is 1, i.e. when the status returned is 
#   not a pressure reading.
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-IMG-02:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,3,FE14I-VA-IMG-02) ts1_1")
  field(FLNK, "FE14I-VA-IMG-02:PLOG")
  field(EGU, "mbar")
  field(PREC, "11")
  field(HOPR, "0.01")
  field(LOPR, "1.0E-11")
#  field(SDIS, "FE14I-VA-IMG-02:PDIS")
  field(DISS, "INVALID")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-IMG-02:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-IMG-02:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-IMG-02:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-IMG-02:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-IMG-02:STA PP")
}

record(calcout, "FE14I-VA-IMG-02:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-IMG-02:P.ADEL")
  field(INPA, "FE14I-VA-IMG-02:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IMG-02:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-IMG-02:P MS")
  field(FLNK, "FE14I-VA-IMG-02:PMAX")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}
record(ai, "FE14I-VA-IMG-02:PMAX")
{
    field(DESC, "Max Pressure")
    field(INP,  "FE14I-VA-IMG-02:P MS")
    field(FLNK, "FE14I-VA-IMG-02:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(ai, "FE14I-VA-IMG-02:PMIN")
{
    field(DESC, "Min Pressure")
    field(INP,  "FE14I-VA-IMG-02:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
    field(FLNK, "FE14I-VA-IMG-02:PSEQ")
}
################################################################################
# Control - IMG Enable
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-02:CTL:FAN10S")
{
    field(DESC, "CTL 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-02:CTL:MODE PP")
    field(LNK2, "FE14I-VA-IMG-02:CTL:CCS PP")
    field(LNK3, "FE14I-VA-IMG-02:CTL:SP PP")
    field(LNK4, "FE14I-VA-IMG-02:PRO:SP PP")
    field(SELM, "All")
}

#record(ao, "FE14I-VA-IMG-02:CTL:SETSP") {
#  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_1")
#  field(FLNK, "FE14I-VA-IMG-02:CTL:HYST")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "9.5e-1")
#  field(LOPR, "2.7e-3")
#  field(DRVH, "9.5e-1")
#  field(DRVL, "2.7e-3")
#  field(DOL, "1.0e-2")
#}

record(ai, "FE14I-VA-IMG-02:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_sp(001,3) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(HIHI, "9.6e-1")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "9.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# This record sets the setpoint locally
# but doesnt write it to the controller
# as we now need to send a pre-command
# to extend the setpoint range (XCS<n> command)
record(ao, "FE14I-VA-IMG-02:CTL:OUTSP") 
{
  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  Device Output now via CTL:SETSP after CTL:SETSPPRESEQ
#  field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(DOL, "1.0e-2")
#  field(FLNK, "FE14I-VA-IMG-02:CTL:SETSPFAN")
# Insert pre-sequence to set extended setpoint
  field(FLNK, "FE14I-VA-IMG-02:CTL:SETSPPRESEQ")
}

record(ao, "FE14I-VA-IMG-02:CTL:SETSP") 
    {
    field(DESC, "IMG Enable")
    field(DTYP, "stream")
    field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_1")
    field(EGU, "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL, "1.0e-2")
    field(FLNK, "FE14I-VA-IMG-02:CTL:SETSPFAN")
    }

record(seq, "FE14I-VA-IMG-02:CTL:SETSPPRESEQ")
    {
    field(DESC, "Preconditions to IMG Setpoint")
    field(SELM, "All")
    field(DOL1, "1")
    field(LNK1, "FE14I-VA-IMG-02:CTL:SETEXTRANGE PP")
    field(DOL2, "FE14I-VA-IMG-02:CTL:OUTSP")
    field(LNK2, "FE14I-VA-IMG-02:CTL:SETSP PP")
    }

record(mbbo, "FE14I-VA-IMG-02:CTL:SETEXTRANGE")
    {
    field(DTYP, "stream")
    field(DESC, "CC Extended Setpoint Enable")
    field(OUT, "@mks937b.protocol setcc_extended_range(001,3) ts1_1")
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL, "1")
#    field(PINI, "YES")
    }

# On setting a new interlock control setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-02:CTL:SETSPFAN")
{
    field(DESC, "CTL Set SP fanout")
    field(LNK1, "FE14I-VA-IMG-02:CTL:HYST PP")
    field(LNK2, "FE14I-VA-IMG-02:CTL:SP PP")
}

record(ao, "FE14I-VA-IMG-02:CTL:SETHYST") 
{
  field(DESC, "CC Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setcc_hyst(001,3) ts1_1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(FLNK, "FE14I-VA-IMG-02:CTL:HYST PP")
}

record(calc, "FE14I-VA-IMG-02:CTL:MINHYST") 
{
  field(DESC, "Minimum hysteresis")
  field(EGU, "mbar")
  field(CALC, "A*1.2")
  field(INPA, "FE14I-VA-IMG-02:CTL:SP MS")
  field(FLNK, "FE14I-VA-IMG-02:CTL:SETHYST")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}

record(ai, "FE14I-VA-IMG-02:CTL:HYST") 
{
  field(DESC, "Setpoint Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_hyst(001,3) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-02:CTL:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-IMG-02:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-02:CTL:HYST")
  field(LNK1, "FE14I-VA-IMG-02:CTL:SETHYST.VAL PP")
}


record(bo, "FE14I-VA-IMG-02:CTL:DIS") 
{
  field(DESC, "Disable Control Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol discc_sp(001,3) ts1_1")
}

record(mbbo, "FE14I-VA-IMG-02:CTL:SETMODE") 
{
  field(DTYP, "stream")
  field(DESC, "CC Operating Mode")
  field(OUT, "@mks937b.protocol setcc_ctl(001,3) ts1_1")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:CTL:MODE")
}


record(mbbi, "FE14I-VA-IMG-02:CTL:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctl(001,3) ts1_1")
  field(DESC, "CC Status")
  field(SCAN, "Passive")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(UNSV, "MAJOR")
  field(ZRSV, "MINOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}


record(mbbo, "FE14I-VA-IMG-02:CTL:SETCCS") 
{
  field(DTYP, "stream")
  field(DESC, "Control Channel Status")
  field(OUT, "@mks937b.protocol setcc_ctrl_chan(001,3) ts1_1")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(ZRSV, "MINOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:CTL:CCS")
}


record(mbbi, "FE14I-VA-IMG-02:CTL:CCS") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctrl_chan(001,3) ts1_1")
  field(DESC, "Control Channel Status")
  field(SCAN, "Passive")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
}


################################################################################
# Protection - IMG Overpressure
#
##% archiver 10 Monitor
#
#record(ao, "FE14I-VA-IMG-02:PRO:SETSP") 
#{
#  field(DESC, "IMG Overpressure")
#  field(FLNK, "FE14I-VA-IMG-02:PRO:SEQ")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "1.0e-2")
#  field(LOPR, "1.3e-5")
#  field(DRVH, "1.0e-2")
#  field(DRVL, "1.3e-5")
#  field(DOL, "5.0e-4")
#}

#
##% archiver 10 Monitor
#
#record(mbbo, "FE14I-VA-IMG-02:PRO:ENABLE") 
#{
#  field(DESC, "Enable Protection Setpoint")
#  field(FLNK, "FE14I-VA-IMG-02:PRO:SEQ")
#  field(ZRST, "Force On I/L")
#  field(ONST, "I/L Operating")
#  field(ZRVL, "1")
#  field(ONVL, "2")
#  field(ZRSV, "MAJOR")
#  field(ONSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")    field(LNK2, "FE14I-VA-IMG-02:CTL:CCS")

#}

#record(seq, "FE14I-VA-IMG-02:PRO:SEQ") 
#{
#  field(DESC, "Sequence Protection Setpoint")
#  field(SELM, "Specified")
#  field(SELL, "FE14I-VA-IMG-02:PRO:ENABLE.RVAL")
#  field(DOL1, "0")
#  field(LNK1, "FE14I-VA-IMG-02:PRO:DIS PP")
#  field(DOL2, "FE14I-VA-IMG-02:PRO:SETSP")
#  field(LNK2, "FE14I-VA-IMG-02:PRO:OUTSP PP")
#}

#
#% archiver 10 Monitor
#% controldesk IMG Overpressure readback
#
record(ai, "FE14I-VA-IMG-02:PRO:SP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getpro(001,3) ts1_1 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(HIHI, "1.1e-2")
  field(LOLO, "1.2e-5")
  field(HIGH, "5.1e-4")
  field(LOW, "4.9e-4")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-02:PRO:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-02:PRO:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-02:PRO:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-02:PRO:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-02:PRO:OUTSP")
    field(LNK3, "FE14I-VA-IMG-02:PRO:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-02:PRO:OUTSP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setpro(001,3) ts1_1")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(DRVH, "1.0e-2")
  field(DRVL, "1.3e-5")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-02:PRO:ILKSETSP:NOWRITE")
  field(DOL,  "5.0e-4")
  field(FLNK, "FE14I-VA-IMG-02:PRO:SP PP")
}
# -----------------------------------------------------------------------------------------

record(bo, "FE14I-VA-IMG-02:PRO:DIS") 
{
  field(DESC, "Disable Protection Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dispro(001,3) ts1_1")
}

record(calc, "FE14I-VA-IMG-02:PDIS") {
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-IMG-02:STA")
  field(FLNK, "FE14I-VA-IMG-02:P")
}

record(ai, "FE14I-VA-IMG-02:ERRORNUM") 
{
  field(DESC, "Last error code")
  field(DTYP, "Soft Channel")
  field(INP, "0")
  field(SCAN, "Passive")
}


record(bi, "FE14I-VA-IMG-02:OFFWARN") 
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}


#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-02:PRO:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-02:PRO:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
  #! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bImg.template
#% macro, __doc__, Template database for an inverted magnetron guage connected 
# to one channel of an mks937b Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)
#
# optional substitutions:
#% macro, name,        Object name, and gui association name
#% macro, ctl_channel, The desired control channel 0 = C1, 1 = C2, 2 = None, 3 = A1, 4 = B1, 5 = A2, 6 = B2.
#% macro, ctlsp_level, The desired control setpoint value.
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_hihi,  The HIHI alarm field on the control setpoint record.
#% macro, ctlsp_lolo,  The LOLO alarm field on the control setpoint record.
#% macro, ctlsp_high,  The HIGH alarm field on the control setpoint record.
#% macro, ctlsp_low ,  The LOW alarm field on the control setpoint record.
#% macro, ctlsp_desc,  The DESC field on the control setpoint record.
#% macro, ctlhyst_hopr,The HOPR field on control hysteresis records 
#                      (high operator value - helps display set correct range).
#% macro, ctlhyst_lopr,The LOPR field on control hysteresis records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_level, The desired protection setpoint value.
#% macro, prosp_drvh,  The DRVH field on protection setpoint records 
#                      (limits max value of protection setpoint)
#% macro, prosp_drvl,  The DRVL field on protection setpoint records. 
#                      (limits min value of protection setpoint)
#% macro, prosp_hopr,  The HOPR field on protection setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, prosp_lopr,  The LOPR field on protection setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_hihi,  The HIHI alarm field on the protection setpoint record.
#% macro, prosp_lolo,  The LOLO alarm field on the protection setpoint record.
#% macro, prosp_high,  The HIGH alarm field on the protection setpoint record.
#% macro, prosp_low ,  The LOW alarm field on the protection setpoint record.
#% macro, prosp_desc,  The DESC field on the protection setpoint record 
#                      (appears as a label on the Img EDM screen).
#
#% macro, offwarn,     Flag to display a warning that switching off the IMG could trip the beam
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
#% macro, img_ctl_setmode, Default = 1 (I/L Safe), 0 (Force ON), 2 (I/L Operating).
#
################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bImg.edl, device=FE14I-VA-IMG-03

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/img_detail.opi, device=FE14I-VA-IMG-03, desc=FE14I-VA-IMG-03, name=
# % gui, , boyembed, mks937bApp_opi/img_embed_box.opi, device=FE14I-VA-IMG-03, desc=FE14I-VA-IMG-03, name=
# % gui, , boyembed, mks937bApp_opi/img_embed.opi, device=FE14I-VA-IMG-03, desc=FE14I-VA-IMG-03, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,                                FE14I-VA-IMG-03:P
# % gui, , readback, Status,                                  FE14I-VA-IMG-03:STA
# % gui, , readback, Gauge Setpoint Write,                    FE14I-VA-IMG-03:PRO:ILKSETSP:NOWRITE
# % gui, , readback, Relay 1 on SetPoint for Summary,         FE14I-VA-IMG-03:RLY1:SP,        =pv("FE14I-VA-IMG-03:RLY1:SP.DESC")
# % gui, , readback, Relay 1 off SetPoint for Summary,        FE14I-VA-IMG-03:RLY1:SPOFF,     =pv("FE14I-VA-IMG-03:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 on SetPoint for Summary,         FE14I-VA-IMG-03:RLY2:SP,        =pv("FE14I-VA-IMG-03:RLY2:SP.DESC")
# % gui, , readback, Relay 3 on SetPoint for Summary,         FE14I-VA-IMG-03:RLY3:SP,        =pv("FE14I-VA-IMG-03:RLY3:SP.DESC")
## TODO The below gives us feedback on what the state actually is - without this you get the current demand
## (as per differences between EDM and CSS enum menus)
# % gui, , readback, Cold Cathode,                            FE14I-VA-IMG-03:ISENABLED
# % gui, , enum, Cold Cathode,                                FE14I-VA-IMG-03:CCHV

# % gui, , readback, CTL SP Controlling Gauge,                FE14I-VA-IMG-03:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-03:CTL:SP.DESC")," Gauge")
# % gui, , readback, CTL SP MODE,                             FE14I-VA-IMG-03:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-03:CTL:SP.DESC")," Mode")
# % gui, , readback, Pro Setpoint,                            FE14I-VA-IMG-03:PRO:SP,         =pv("FE14I-VA-IMG-03:PRO:SP.DESC")
# % gui, , readback, Relay 1 On Setpoint,                     FE14I-VA-IMG-03:RLY1:SP,        =pv("FE14I-VA-IMG-03:RLY1:SP.DESC")
# % gui, , readback, Relay 1 Off Setpoint,                    FE14I-VA-IMG-03:RLY1:SPOFF,     =pv("FE14I-VA-IMG-03:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 On Setpoint,                     FE14I-VA-IMG-03:RLY2:SP,        =pv("FE14I-VA-IMG-03:RLY2:SP.DESC")
# % gui, , readback, Relay 2 Off Setpoint,                    FE14I-VA-IMG-03:RLY2:SPOFF,     =pv("FE14I-VA-IMG-03:RLY2:SPOFF.DESC")
# % gui, , readback, Relay 3 On Setpoint,                     FE14I-VA-IMG-03:RLY3:SP,        =pv("FE14I-VA-IMG-03:RLY3:SP.DESC")
# % gui, , readback, Relay 3 Off Setpoint,                    FE14I-VA-IMG-03:RLY3:SPOFF,     =pv("FE14I-VA-IMG-03:RLY3:SPOFF.DESC")
# % gui, , readback, Relay 4 On Setpoint,                     FE14I-VA-IMG-03:RLY4:SP,        =pv("FE14I-VA-IMG-03:RLY4:SP.DESC")
# % gui, , readback, Relay 4 Off Setpoint,                    FE14I-VA-IMG-03:RLY4:SPOFF,     =pv("FE14I-VA-IMG-03:RLY4:SPOFF.DESC")
# % gui, , readback, Fast Relay On Setpoint,                  FE14I-VA-IMG-03:FRLY:SP,        =pv("FE14I-VA-IMG-03:FRLY:SP.DESC")

# % gui, , demand,   Pro Setpoint,                            FE14I-VA-IMG-03:PRO:OUTSP,      =pv("FE14I-VA-IMG-03:PRO:SP.DESC")
# % gui, , demand,   Relay 1 On Setpoint,                     FE14I-VA-IMG-03:RLY1:SETSP,     =pv("FE14I-VA-IMG-03:RLY1:SP.DESC")
# % gui, , demand,   Relay 1 Off Setpoint,                    FE14I-VA-IMG-03:RLY1:SETSPOFF,  =pv("FE14I-VA-IMG-03:RLY1:SPOFF.DESC")
# % gui, , demand,   Relay 2 On Setpoint,                     FE14I-VA-IMG-03:RLY2:SETSP,     =pv("FE14I-VA-IMG-03:RLY2:SP.DESC")
# % gui, , demand,   Relay 2 Off Setpoint,                    FE14I-VA-IMG-03:RLY2:SETSPOFF,  =pv("FE14I-VA-IMG-03:RLY2:SPOFF.DESC")
# % gui, , demand,   Relay 3 On Setpoint,                     FE14I-VA-IMG-03:RLY3:SETSP,     =pv("FE14I-VA-IMG-03:RLY3:SP.DESC")
# % gui, , demand,   Relay 3 Off Setpoint,                    FE14I-VA-IMG-03:RLY3:SETSPOFF,  =pv("FE14I-VA-IMG-03:RLY3:SPOFF.DESC")
# % gui, , demand,   Relay 4 On Setpoint,                     FE14I-VA-IMG-03:RLY4:SETSP,     =pv("FE14I-VA-IMG-03:RLY4:SP.DESC")
# % gui, , demand,   Relay 4 Off Setpoint,                    FE14I-VA-IMG-03:RLY4:SETSPOFF,  =pv("FE14I-VA-IMG-03:RLY4:SPOFF.DESC")
# % gui, , demand,   Fast Relay On Setpoint,                  FE14I-VA-IMG-03:FRLY:SETSP,     =pv("FE14I-VA-IMG-03:FRLY:SP.DESC")

# % gui, , readback, Relay 1 SP Mode,                         FE14I-VA-IMG-03:RLY1:MODE,      =concat(pv("FE14I-VA-IMG-03:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Mode,                         FE14I-VA-IMG-03:RLY2:MODE,      =concat(pv("FE14I-VA-IMG-03:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Mode,                         FE14I-VA-IMG-03:RLY3:MODE,      =concat(pv("FE14I-VA-IMG-03:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Mode,                         FE14I-VA-IMG-03:RLY4:MODE,      =concat(pv("FE14I-VA-IMG-03:RLY4:SP.DESC")," Mode")

# % gui, , enum, CTL SP Controlling Gauge,                    FE14I-VA-IMG-03:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-03:CTL:SP.DESC")," Gauge")
# % gui, , enum, CTL SP MODE,                                 FE14I-VA-IMG-03:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-03:CTL:SP.DESC")," Mode")
# % gui, , enum, Relay 1 SP Mode,                             FE14I-VA-IMG-03:RLY1:SETMODE,   =concat(pv("FE14I-VA-IMG-03:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 1 SP Direction,                    FE14I-VA-IMG-03:RLY1:DIR,       =concat(pv("FE14I-VA-IMG-03:RLY1:SP.DESC")," Dir")
# % gui, , enum, Relay 2 SP Mode,                             FE14I-VA-IMG-03:RLY2:SETMODE,   =concat(pv("FE14I-VA-IMG-03:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Direction,                    FE14I-VA-IMG-03:RLY2:DIR,       =concat(pv("FE14I-VA-IMG-03:RLY2:SP.DESC")," Dir")
# % gui, , enum, Relay 3 SP Mode,                             FE14I-VA-IMG-03:RLY3:SETMODE,   =concat(pv("FE14I-VA-IMG-03:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Direction,                    FE14I-VA-IMG-03:RLY3:DIR,       =concat(pv("FE14I-VA-IMG-03:RLY3:SP.DESC")," Dir")
# % gui, , enum, Relay 4 SP Mode,                             FE14I-VA-IMG-03:RLY4:SETMODE,   =concat(pv("FE14I-VA-IMG-03:RLY4:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Direction,                    FE14I-VA-IMG-03:RLY4:DIR,       =concat(pv("FE14I-VA-IMG-03:RLY4:SP.DESC")," Dir")

#
#% archiver 10 Monitor
#% controldesk Pressure scon
#
record(bo, "FE14I-VA-IMG-03:CCHV") 
{
  field(DESC, "Cold Cathode Enable")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol ccenable(001,1) ts1_2 0")
  field(FLNK, "FE14I-VA-IMG-03:FANENAB")
  field(ZNAM, "Off")
  field(ONAM, "On")
}

record(mbbi, "FE14I-VA-IMG-03:ISENABLED") {
  field(DESC, "IMG power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_cc_enabled(001,1) ts1_2")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

#  Changing CC HV mode requires associated processing of :STA and :ISENABLED
#  to update the readbacks
record(fanout, "FE14I-VA-IMG-03:FANENAB")
{
    field(DESC, "Distribute enabled")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-03:STA")
    field(LNK2, "FE14I-VA-IMG-03:ISENABLED")
}


record(bi, "FE14I-VA-IMG-03:SWITCHING") 
{
  field(DESC, "Switching")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Switching")
}

################################################################################
# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-IMG-03:STA") 
{
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,1) ts1_2")
#  field(SCAN, "I/O Intr")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-IMG-03:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
#   This record is disabled when :PDIS is 1, i.e. when the status returned is 
#   not a pressure reading.
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-IMG-03:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,1,FE14I-VA-IMG-03) ts1_2")
  field(FLNK, "FE14I-VA-IMG-03:PLOG")
  field(EGU, "mbar")
  field(PREC, "11")
  field(HOPR, "0.01")
  field(LOPR, "1.0E-11")
#  field(SDIS, "FE14I-VA-IMG-03:PDIS")
  field(DISS, "INVALID")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-IMG-03:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-IMG-03:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-IMG-03:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-IMG-03:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-IMG-03:STA PP")
}

record(calcout, "FE14I-VA-IMG-03:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-IMG-03:P.ADEL")
  field(INPA, "FE14I-VA-IMG-03:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IMG-03:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-IMG-03:P MS")
  field(FLNK, "FE14I-VA-IMG-03:PMAX")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}
record(ai, "FE14I-VA-IMG-03:PMAX")
{
    field(DESC, "Max Pressure")
    field(INP,  "FE14I-VA-IMG-03:P MS")
    field(FLNK, "FE14I-VA-IMG-03:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(ai, "FE14I-VA-IMG-03:PMIN")
{
    field(DESC, "Min Pressure")
    field(INP,  "FE14I-VA-IMG-03:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
    field(FLNK, "FE14I-VA-IMG-03:PSEQ")
}
################################################################################
# Control - IMG Enable
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-03:CTL:FAN10S")
{
    field(DESC, "CTL 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-03:CTL:MODE PP")
    field(LNK2, "FE14I-VA-IMG-03:CTL:CCS PP")
    field(LNK3, "FE14I-VA-IMG-03:CTL:SP PP")
    field(LNK4, "FE14I-VA-IMG-03:PRO:SP PP")
    field(SELM, "All")
}

#record(ao, "FE14I-VA-IMG-03:CTL:SETSP") {
#  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_2")
#  field(FLNK, "FE14I-VA-IMG-03:CTL:HYST")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "9.5e-1")
#  field(LOPR, "2.7e-3")
#  field(DRVH, "9.5e-1")
#  field(DRVL, "2.7e-3")
#  field(DOL, "1.0e-2")
#}

record(ai, "FE14I-VA-IMG-03:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_sp(001,1) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(HIHI, "9.6e-1")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "9.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# This record sets the setpoint locally
# but doesnt write it to the controller
# as we now need to send a pre-command
# to extend the setpoint range (XCS<n> command)
record(ao, "FE14I-VA-IMG-03:CTL:OUTSP") 
{
  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  Device Output now via CTL:SETSP after CTL:SETSPPRESEQ
#  field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_2")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(DOL, "1.0e-2")
#  field(FLNK, "FE14I-VA-IMG-03:CTL:SETSPFAN")
# Insert pre-sequence to set extended setpoint
  field(FLNK, "FE14I-VA-IMG-03:CTL:SETSPPRESEQ")
}

record(ao, "FE14I-VA-IMG-03:CTL:SETSP") 
    {
    field(DESC, "IMG Enable")
    field(DTYP, "stream")
    field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_2")
    field(EGU, "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL, "1.0e-2")
    field(FLNK, "FE14I-VA-IMG-03:CTL:SETSPFAN")
    }

record(seq, "FE14I-VA-IMG-03:CTL:SETSPPRESEQ")
    {
    field(DESC, "Preconditions to IMG Setpoint")
    field(SELM, "All")
    field(DOL1, "1")
    field(LNK1, "FE14I-VA-IMG-03:CTL:SETEXTRANGE PP")
    field(DOL2, "FE14I-VA-IMG-03:CTL:OUTSP")
    field(LNK2, "FE14I-VA-IMG-03:CTL:SETSP PP")
    }

record(mbbo, "FE14I-VA-IMG-03:CTL:SETEXTRANGE")
    {
    field(DTYP, "stream")
    field(DESC, "CC Extended Setpoint Enable")
    field(OUT, "@mks937b.protocol setcc_extended_range(001,1) ts1_2")
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL, "1")
#    field(PINI, "YES")
    }

# On setting a new interlock control setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-03:CTL:SETSPFAN")
{
    field(DESC, "CTL Set SP fanout")
    field(LNK1, "FE14I-VA-IMG-03:CTL:HYST PP")
    field(LNK2, "FE14I-VA-IMG-03:CTL:SP PP")
}

record(ao, "FE14I-VA-IMG-03:CTL:SETHYST") 
{
  field(DESC, "CC Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setcc_hyst(001,1) ts1_2")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(FLNK, "FE14I-VA-IMG-03:CTL:HYST PP")
}

record(calc, "FE14I-VA-IMG-03:CTL:MINHYST") 
{
  field(DESC, "Minimum hysteresis")
  field(EGU, "mbar")
  field(CALC, "A*1.2")
  field(INPA, "FE14I-VA-IMG-03:CTL:SP MS")
  field(FLNK, "FE14I-VA-IMG-03:CTL:SETHYST")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}

record(ai, "FE14I-VA-IMG-03:CTL:HYST") 
{
  field(DESC, "Setpoint Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_hyst(001,1) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-03:CTL:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-IMG-03:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-03:CTL:HYST")
  field(LNK1, "FE14I-VA-IMG-03:CTL:SETHYST.VAL PP")
}


record(bo, "FE14I-VA-IMG-03:CTL:DIS") 
{
  field(DESC, "Disable Control Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol discc_sp(001,1) ts1_2")
}

record(mbbo, "FE14I-VA-IMG-03:CTL:SETMODE") 
{
  field(DTYP, "stream")
  field(DESC, "CC Operating Mode")
  field(OUT, "@mks937b.protocol setcc_ctl(001,1) ts1_2")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:CTL:MODE")
}


record(mbbi, "FE14I-VA-IMG-03:CTL:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctl(001,1) ts1_2")
  field(DESC, "CC Status")
  field(SCAN, "Passive")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(UNSV, "MAJOR")
  field(ZRSV, "MINOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}


record(mbbo, "FE14I-VA-IMG-03:CTL:SETCCS") 
{
  field(DTYP, "stream")
  field(DESC, "Control Channel Status")
  field(OUT, "@mks937b.protocol setcc_ctrl_chan(001,1) ts1_2")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(ZRSV, "MINOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(DOL, "0")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:CTL:CCS")
}


record(mbbi, "FE14I-VA-IMG-03:CTL:CCS") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctrl_chan(001,1) ts1_2")
  field(DESC, "Control Channel Status")
  field(SCAN, "Passive")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
}


################################################################################
# Protection - IMG Overpressure
#
##% archiver 10 Monitor
#
#record(ao, "FE14I-VA-IMG-03:PRO:SETSP") 
#{
#  field(DESC, "IMG Overpressure")
#  field(FLNK, "FE14I-VA-IMG-03:PRO:SEQ")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "1.0e-2")
#  field(LOPR, "1.3e-5")
#  field(DRVH, "1.0e-2")
#  field(DRVL, "1.3e-5")
#  field(DOL, "5.0e-4")
#}

#
##% archiver 10 Monitor
#
#record(mbbo, "FE14I-VA-IMG-03:PRO:ENABLE") 
#{
#  field(DESC, "Enable Protection Setpoint")
#  field(FLNK, "FE14I-VA-IMG-03:PRO:SEQ")
#  field(ZRST, "Force On I/L")
#  field(ONST, "I/L Operating")
#  field(ZRVL, "1")
#  field(ONVL, "2")
#  field(ZRSV, "MAJOR")
#  field(ONSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")    field(LNK2, "FE14I-VA-IMG-03:CTL:CCS")

#}

#record(seq, "FE14I-VA-IMG-03:PRO:SEQ") 
#{
#  field(DESC, "Sequence Protection Setpoint")
#  field(SELM, "Specified")
#  field(SELL, "FE14I-VA-IMG-03:PRO:ENABLE.RVAL")
#  field(DOL1, "0")
#  field(LNK1, "FE14I-VA-IMG-03:PRO:DIS PP")
#  field(DOL2, "FE14I-VA-IMG-03:PRO:SETSP")
#  field(LNK2, "FE14I-VA-IMG-03:PRO:OUTSP PP")
#}

#
#% archiver 10 Monitor
#% controldesk IMG Overpressure readback
#
record(ai, "FE14I-VA-IMG-03:PRO:SP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getpro(001,1) ts1_2 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(HIHI, "1.1e-2")
  field(LOLO, "1.2e-5")
  field(HIGH, "5.1e-4")
  field(LOW, "4.9e-4")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-03:PRO:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-03:PRO:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-03:PRO:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-03:PRO:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-03:PRO:OUTSP")
    field(LNK3, "FE14I-VA-IMG-03:PRO:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-03:PRO:OUTSP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setpro(001,1) ts1_2")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(DRVH, "1.0e-2")
  field(DRVL, "1.3e-5")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-03:PRO:ILKSETSP:NOWRITE")
  field(DOL,  "5.0e-4")
  field(FLNK, "FE14I-VA-IMG-03:PRO:SP PP")
}
# -----------------------------------------------------------------------------------------

record(bo, "FE14I-VA-IMG-03:PRO:DIS") 
{
  field(DESC, "Disable Protection Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dispro(001,1) ts1_2")
}

record(calc, "FE14I-VA-IMG-03:PDIS") {
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-IMG-03:STA")
  field(FLNK, "FE14I-VA-IMG-03:P")
}

record(ai, "FE14I-VA-IMG-03:ERRORNUM") 
{
  field(DESC, "Last error code")
  field(DTYP, "Soft Channel")
  field(INP, "0")
  field(SCAN, "Passive")
}


record(bi, "FE14I-VA-IMG-03:OFFWARN") 
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}


#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-03:PRO:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-03:PRO:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
  #! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bImg.template
#% macro, __doc__, Template database for an inverted magnetron guage connected 
# to one channel of an mks937b Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)
#
# optional substitutions:
#% macro, name,        Object name, and gui association name
#% macro, ctl_channel, The desired control channel 0 = C1, 1 = C2, 2 = None, 3 = A1, 4 = B1, 5 = A2, 6 = B2.
#% macro, ctlsp_level, The desired control setpoint value.
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_hihi,  The HIHI alarm field on the control setpoint record.
#% macro, ctlsp_lolo,  The LOLO alarm field on the control setpoint record.
#% macro, ctlsp_high,  The HIGH alarm field on the control setpoint record.
#% macro, ctlsp_low ,  The LOW alarm field on the control setpoint record.
#% macro, ctlsp_desc,  The DESC field on the control setpoint record.
#% macro, ctlhyst_hopr,The HOPR field on control hysteresis records 
#                      (high operator value - helps display set correct range).
#% macro, ctlhyst_lopr,The LOPR field on control hysteresis records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_level, The desired protection setpoint value.
#% macro, prosp_drvh,  The DRVH field on protection setpoint records 
#                      (limits max value of protection setpoint)
#% macro, prosp_drvl,  The DRVL field on protection setpoint records. 
#                      (limits min value of protection setpoint)
#% macro, prosp_hopr,  The HOPR field on protection setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, prosp_lopr,  The LOPR field on protection setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_hihi,  The HIHI alarm field on the protection setpoint record.
#% macro, prosp_lolo,  The LOLO alarm field on the protection setpoint record.
#% macro, prosp_high,  The HIGH alarm field on the protection setpoint record.
#% macro, prosp_low ,  The LOW alarm field on the protection setpoint record.
#% macro, prosp_desc,  The DESC field on the protection setpoint record 
#                      (appears as a label on the Img EDM screen).
#
#% macro, offwarn,     Flag to display a warning that switching off the IMG could trip the beam
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
#% macro, img_ctl_setmode, Default = 1 (I/L Safe), 0 (Force ON), 2 (I/L Operating).
#
################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bImg.edl, device=FE14I-VA-IMG-04

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/img_detail.opi, device=FE14I-VA-IMG-04, desc=FE14I-VA-IMG-04, name=
# % gui, , boyembed, mks937bApp_opi/img_embed_box.opi, device=FE14I-VA-IMG-04, desc=FE14I-VA-IMG-04, name=
# % gui, , boyembed, mks937bApp_opi/img_embed.opi, device=FE14I-VA-IMG-04, desc=FE14I-VA-IMG-04, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,                                FE14I-VA-IMG-04:P
# % gui, , readback, Status,                                  FE14I-VA-IMG-04:STA
# % gui, , readback, Gauge Setpoint Write,                    FE14I-VA-IMG-04:PRO:ILKSETSP:NOWRITE
# % gui, , readback, Relay 1 on SetPoint for Summary,         FE14I-VA-IMG-04:RLY1:SP,        =pv("FE14I-VA-IMG-04:RLY1:SP.DESC")
# % gui, , readback, Relay 1 off SetPoint for Summary,        FE14I-VA-IMG-04:RLY1:SPOFF,     =pv("FE14I-VA-IMG-04:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 on SetPoint for Summary,         FE14I-VA-IMG-04:RLY2:SP,        =pv("FE14I-VA-IMG-04:RLY2:SP.DESC")
# % gui, , readback, Relay 3 on SetPoint for Summary,         FE14I-VA-IMG-04:RLY3:SP,        =pv("FE14I-VA-IMG-04:RLY3:SP.DESC")
## TODO The below gives us feedback on what the state actually is - without this you get the current demand
## (as per differences between EDM and CSS enum menus)
# % gui, , readback, Cold Cathode,                            FE14I-VA-IMG-04:ISENABLED
# % gui, , enum, Cold Cathode,                                FE14I-VA-IMG-04:CCHV

# % gui, , readback, CTL SP Controlling Gauge,                FE14I-VA-IMG-04:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-04:CTL:SP.DESC")," Gauge")
# % gui, , readback, CTL SP MODE,                             FE14I-VA-IMG-04:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-04:CTL:SP.DESC")," Mode")
# % gui, , readback, Pro Setpoint,                            FE14I-VA-IMG-04:PRO:SP,         =pv("FE14I-VA-IMG-04:PRO:SP.DESC")
# % gui, , readback, Relay 1 On Setpoint,                     FE14I-VA-IMG-04:RLY1:SP,        =pv("FE14I-VA-IMG-04:RLY1:SP.DESC")
# % gui, , readback, Relay 1 Off Setpoint,                    FE14I-VA-IMG-04:RLY1:SPOFF,     =pv("FE14I-VA-IMG-04:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 On Setpoint,                     FE14I-VA-IMG-04:RLY2:SP,        =pv("FE14I-VA-IMG-04:RLY2:SP.DESC")
# % gui, , readback, Relay 2 Off Setpoint,                    FE14I-VA-IMG-04:RLY2:SPOFF,     =pv("FE14I-VA-IMG-04:RLY2:SPOFF.DESC")
# % gui, , readback, Relay 3 On Setpoint,                     FE14I-VA-IMG-04:RLY3:SP,        =pv("FE14I-VA-IMG-04:RLY3:SP.DESC")
# % gui, , readback, Relay 3 Off Setpoint,                    FE14I-VA-IMG-04:RLY3:SPOFF,     =pv("FE14I-VA-IMG-04:RLY3:SPOFF.DESC")
# % gui, , readback, Relay 4 On Setpoint,                     FE14I-VA-IMG-04:RLY4:SP,        =pv("FE14I-VA-IMG-04:RLY4:SP.DESC")
# % gui, , readback, Relay 4 Off Setpoint,                    FE14I-VA-IMG-04:RLY4:SPOFF,     =pv("FE14I-VA-IMG-04:RLY4:SPOFF.DESC")
# % gui, , readback, Fast Relay On Setpoint,                  FE14I-VA-IMG-04:FRLY:SP,        =pv("FE14I-VA-IMG-04:FRLY:SP.DESC")

# % gui, , demand,   Pro Setpoint,                            FE14I-VA-IMG-04:PRO:OUTSP,      =pv("FE14I-VA-IMG-04:PRO:SP.DESC")
# % gui, , demand,   Relay 1 On Setpoint,                     FE14I-VA-IMG-04:RLY1:SETSP,     =pv("FE14I-VA-IMG-04:RLY1:SP.DESC")
# % gui, , demand,   Relay 1 Off Setpoint,                    FE14I-VA-IMG-04:RLY1:SETSPOFF,  =pv("FE14I-VA-IMG-04:RLY1:SPOFF.DESC")
# % gui, , demand,   Relay 2 On Setpoint,                     FE14I-VA-IMG-04:RLY2:SETSP,     =pv("FE14I-VA-IMG-04:RLY2:SP.DESC")
# % gui, , demand,   Relay 2 Off Setpoint,                    FE14I-VA-IMG-04:RLY2:SETSPOFF,  =pv("FE14I-VA-IMG-04:RLY2:SPOFF.DESC")
# % gui, , demand,   Relay 3 On Setpoint,                     FE14I-VA-IMG-04:RLY3:SETSP,     =pv("FE14I-VA-IMG-04:RLY3:SP.DESC")
# % gui, , demand,   Relay 3 Off Setpoint,                    FE14I-VA-IMG-04:RLY3:SETSPOFF,  =pv("FE14I-VA-IMG-04:RLY3:SPOFF.DESC")
# % gui, , demand,   Relay 4 On Setpoint,                     FE14I-VA-IMG-04:RLY4:SETSP,     =pv("FE14I-VA-IMG-04:RLY4:SP.DESC")
# % gui, , demand,   Relay 4 Off Setpoint,                    FE14I-VA-IMG-04:RLY4:SETSPOFF,  =pv("FE14I-VA-IMG-04:RLY4:SPOFF.DESC")
# % gui, , demand,   Fast Relay On Setpoint,                  FE14I-VA-IMG-04:FRLY:SETSP,     =pv("FE14I-VA-IMG-04:FRLY:SP.DESC")

# % gui, , readback, Relay 1 SP Mode,                         FE14I-VA-IMG-04:RLY1:MODE,      =concat(pv("FE14I-VA-IMG-04:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Mode,                         FE14I-VA-IMG-04:RLY2:MODE,      =concat(pv("FE14I-VA-IMG-04:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Mode,                         FE14I-VA-IMG-04:RLY3:MODE,      =concat(pv("FE14I-VA-IMG-04:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Mode,                         FE14I-VA-IMG-04:RLY4:MODE,      =concat(pv("FE14I-VA-IMG-04:RLY4:SP.DESC")," Mode")

# % gui, , enum, CTL SP Controlling Gauge,                    FE14I-VA-IMG-04:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-04:CTL:SP.DESC")," Gauge")
# % gui, , enum, CTL SP MODE,                                 FE14I-VA-IMG-04:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-04:CTL:SP.DESC")," Mode")
# % gui, , enum, Relay 1 SP Mode,                             FE14I-VA-IMG-04:RLY1:SETMODE,   =concat(pv("FE14I-VA-IMG-04:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 1 SP Direction,                    FE14I-VA-IMG-04:RLY1:DIR,       =concat(pv("FE14I-VA-IMG-04:RLY1:SP.DESC")," Dir")
# % gui, , enum, Relay 2 SP Mode,                             FE14I-VA-IMG-04:RLY2:SETMODE,   =concat(pv("FE14I-VA-IMG-04:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Direction,                    FE14I-VA-IMG-04:RLY2:DIR,       =concat(pv("FE14I-VA-IMG-04:RLY2:SP.DESC")," Dir")
# % gui, , enum, Relay 3 SP Mode,                             FE14I-VA-IMG-04:RLY3:SETMODE,   =concat(pv("FE14I-VA-IMG-04:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Direction,                    FE14I-VA-IMG-04:RLY3:DIR,       =concat(pv("FE14I-VA-IMG-04:RLY3:SP.DESC")," Dir")
# % gui, , enum, Relay 4 SP Mode,                             FE14I-VA-IMG-04:RLY4:SETMODE,   =concat(pv("FE14I-VA-IMG-04:RLY4:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Direction,                    FE14I-VA-IMG-04:RLY4:DIR,       =concat(pv("FE14I-VA-IMG-04:RLY4:SP.DESC")," Dir")

#
#% archiver 10 Monitor
#% controldesk Pressure scon
#
record(bo, "FE14I-VA-IMG-04:CCHV") 
{
  field(DESC, "Cold Cathode Enable")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol ccenable(001,1) ts1_3 0")
  field(FLNK, "FE14I-VA-IMG-04:FANENAB")
  field(ZNAM, "Off")
  field(ONAM, "On")
}

record(mbbi, "FE14I-VA-IMG-04:ISENABLED") {
  field(DESC, "IMG power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_cc_enabled(001,1) ts1_3")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

#  Changing CC HV mode requires associated processing of :STA and :ISENABLED
#  to update the readbacks
record(fanout, "FE14I-VA-IMG-04:FANENAB")
{
    field(DESC, "Distribute enabled")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-04:STA")
    field(LNK2, "FE14I-VA-IMG-04:ISENABLED")
}


record(bi, "FE14I-VA-IMG-04:SWITCHING") 
{
  field(DESC, "Switching")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Switching")
}

################################################################################
# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-IMG-04:STA") 
{
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,1) ts1_3")
#  field(SCAN, "I/O Intr")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-IMG-04:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
#   This record is disabled when :PDIS is 1, i.e. when the status returned is 
#   not a pressure reading.
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-IMG-04:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,1,FE14I-VA-IMG-04) ts1_3")
  field(FLNK, "FE14I-VA-IMG-04:PLOG")
  field(EGU, "mbar")
  field(PREC, "11")
  field(HOPR, "0.01")
  field(LOPR, "1.0E-11")
#  field(SDIS, "FE14I-VA-IMG-04:PDIS")
  field(DISS, "INVALID")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-IMG-04:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-IMG-04:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-IMG-04:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-IMG-04:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-IMG-04:STA PP")
}

record(calcout, "FE14I-VA-IMG-04:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-IMG-04:P.ADEL")
  field(INPA, "FE14I-VA-IMG-04:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IMG-04:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-IMG-04:P MS")
  field(FLNK, "FE14I-VA-IMG-04:PMAX")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}
record(ai, "FE14I-VA-IMG-04:PMAX")
{
    field(DESC, "Max Pressure")
    field(INP,  "FE14I-VA-IMG-04:P MS")
    field(FLNK, "FE14I-VA-IMG-04:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(ai, "FE14I-VA-IMG-04:PMIN")
{
    field(DESC, "Min Pressure")
    field(INP,  "FE14I-VA-IMG-04:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
    field(FLNK, "FE14I-VA-IMG-04:PSEQ")
}
################################################################################
# Control - IMG Enable
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-04:CTL:FAN10S")
{
    field(DESC, "CTL 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-04:CTL:MODE PP")
    field(LNK2, "FE14I-VA-IMG-04:CTL:CCS PP")
    field(LNK3, "FE14I-VA-IMG-04:CTL:SP PP")
    field(LNK4, "FE14I-VA-IMG-04:PRO:SP PP")
    field(SELM, "All")
}

#record(ao, "FE14I-VA-IMG-04:CTL:SETSP") {
#  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_3")
#  field(FLNK, "FE14I-VA-IMG-04:CTL:HYST")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "9.5e-1")
#  field(LOPR, "2.7e-3")
#  field(DRVH, "9.5e-1")
#  field(DRVL, "2.7e-3")
#  field(DOL, "1.0e-2")
#}

record(ai, "FE14I-VA-IMG-04:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_sp(001,1) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(HIHI, "9.6e-1")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "9.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# This record sets the setpoint locally
# but doesnt write it to the controller
# as we now need to send a pre-command
# to extend the setpoint range (XCS<n> command)
record(ao, "FE14I-VA-IMG-04:CTL:OUTSP") 
{
  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  Device Output now via CTL:SETSP after CTL:SETSPPRESEQ
#  field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_3")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(DOL, "1.0e-2")
#  field(FLNK, "FE14I-VA-IMG-04:CTL:SETSPFAN")
# Insert pre-sequence to set extended setpoint
  field(FLNK, "FE14I-VA-IMG-04:CTL:SETSPPRESEQ")
}

record(ao, "FE14I-VA-IMG-04:CTL:SETSP") 
    {
    field(DESC, "IMG Enable")
    field(DTYP, "stream")
    field(OUT, "@mks937b.protocol setcc_sp(001,1) ts1_3")
    field(EGU, "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL, "1.0e-2")
    field(FLNK, "FE14I-VA-IMG-04:CTL:SETSPFAN")
    }

record(seq, "FE14I-VA-IMG-04:CTL:SETSPPRESEQ")
    {
    field(DESC, "Preconditions to IMG Setpoint")
    field(SELM, "All")
    field(DOL1, "1")
    field(LNK1, "FE14I-VA-IMG-04:CTL:SETEXTRANGE PP")
    field(DOL2, "FE14I-VA-IMG-04:CTL:OUTSP")
    field(LNK2, "FE14I-VA-IMG-04:CTL:SETSP PP")
    }

record(mbbo, "FE14I-VA-IMG-04:CTL:SETEXTRANGE")
    {
    field(DTYP, "stream")
    field(DESC, "CC Extended Setpoint Enable")
    field(OUT, "@mks937b.protocol setcc_extended_range(001,1) ts1_3")
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL, "1")
#    field(PINI, "YES")
    }

# On setting a new interlock control setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-04:CTL:SETSPFAN")
{
    field(DESC, "CTL Set SP fanout")
    field(LNK1, "FE14I-VA-IMG-04:CTL:HYST PP")
    field(LNK2, "FE14I-VA-IMG-04:CTL:SP PP")
}

record(ao, "FE14I-VA-IMG-04:CTL:SETHYST") 
{
  field(DESC, "CC Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setcc_hyst(001,1) ts1_3")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(FLNK, "FE14I-VA-IMG-04:CTL:HYST PP")
}

record(calc, "FE14I-VA-IMG-04:CTL:MINHYST") 
{
  field(DESC, "Minimum hysteresis")
  field(EGU, "mbar")
  field(CALC, "A*1.2")
  field(INPA, "FE14I-VA-IMG-04:CTL:SP MS")
  field(FLNK, "FE14I-VA-IMG-04:CTL:SETHYST")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}

record(ai, "FE14I-VA-IMG-04:CTL:HYST") 
{
  field(DESC, "Setpoint Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_hyst(001,1) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-04:CTL:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-IMG-04:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-04:CTL:HYST")
  field(LNK1, "FE14I-VA-IMG-04:CTL:SETHYST.VAL PP")
}


record(bo, "FE14I-VA-IMG-04:CTL:DIS") 
{
  field(DESC, "Disable Control Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol discc_sp(001,1) ts1_3")
}

record(mbbo, "FE14I-VA-IMG-04:CTL:SETMODE") 
{
  field(DTYP, "stream")
  field(DESC, "CC Operating Mode")
  field(OUT, "@mks937b.protocol setcc_ctl(001,1) ts1_3")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:CTL:MODE")
}


record(mbbi, "FE14I-VA-IMG-04:CTL:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctl(001,1) ts1_3")
  field(DESC, "CC Status")
  field(SCAN, "Passive")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(UNSV, "MAJOR")
  field(ZRSV, "MINOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}


record(mbbo, "FE14I-VA-IMG-04:CTL:SETCCS") 
{
  field(DTYP, "stream")
  field(DESC, "Control Channel Status")
  field(OUT, "@mks937b.protocol setcc_ctrl_chan(001,1) ts1_3")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(ZRSV, "MINOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(DOL, "0")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:CTL:CCS")
}


record(mbbi, "FE14I-VA-IMG-04:CTL:CCS") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctrl_chan(001,1) ts1_3")
  field(DESC, "Control Channel Status")
  field(SCAN, "Passive")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
}


################################################################################
# Protection - IMG Overpressure
#
##% archiver 10 Monitor
#
#record(ao, "FE14I-VA-IMG-04:PRO:SETSP") 
#{
#  field(DESC, "IMG Overpressure")
#  field(FLNK, "FE14I-VA-IMG-04:PRO:SEQ")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "1.0e-2")
#  field(LOPR, "1.3e-5")
#  field(DRVH, "1.0e-2")
#  field(DRVL, "1.3e-5")
#  field(DOL, "5.0e-4")
#}

#
##% archiver 10 Monitor
#
#record(mbbo, "FE14I-VA-IMG-04:PRO:ENABLE") 
#{
#  field(DESC, "Enable Protection Setpoint")
#  field(FLNK, "FE14I-VA-IMG-04:PRO:SEQ")
#  field(ZRST, "Force On I/L")
#  field(ONST, "I/L Operating")
#  field(ZRVL, "1")
#  field(ONVL, "2")
#  field(ZRSV, "MAJOR")
#  field(ONSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")    field(LNK2, "FE14I-VA-IMG-04:CTL:CCS")

#}

#record(seq, "FE14I-VA-IMG-04:PRO:SEQ") 
#{
#  field(DESC, "Sequence Protection Setpoint")
#  field(SELM, "Specified")
#  field(SELL, "FE14I-VA-IMG-04:PRO:ENABLE.RVAL")
#  field(DOL1, "0")
#  field(LNK1, "FE14I-VA-IMG-04:PRO:DIS PP")
#  field(DOL2, "FE14I-VA-IMG-04:PRO:SETSP")
#  field(LNK2, "FE14I-VA-IMG-04:PRO:OUTSP PP")
#}

#
#% archiver 10 Monitor
#% controldesk IMG Overpressure readback
#
record(ai, "FE14I-VA-IMG-04:PRO:SP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getpro(001,1) ts1_3 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(HIHI, "1.1e-2")
  field(LOLO, "1.2e-5")
  field(HIGH, "5.1e-4")
  field(LOW, "4.9e-4")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-04:PRO:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-04:PRO:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-04:PRO:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-04:PRO:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-04:PRO:OUTSP")
    field(LNK3, "FE14I-VA-IMG-04:PRO:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-04:PRO:OUTSP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setpro(001,1) ts1_3")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(DRVH, "1.0e-2")
  field(DRVL, "1.3e-5")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-04:PRO:ILKSETSP:NOWRITE")
  field(DOL,  "5.0e-4")
  field(FLNK, "FE14I-VA-IMG-04:PRO:SP PP")
}
# -----------------------------------------------------------------------------------------

record(bo, "FE14I-VA-IMG-04:PRO:DIS") 
{
  field(DESC, "Disable Protection Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dispro(001,1) ts1_3")
}

record(calc, "FE14I-VA-IMG-04:PDIS") {
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-IMG-04:STA")
  field(FLNK, "FE14I-VA-IMG-04:P")
}

record(ai, "FE14I-VA-IMG-04:ERRORNUM") 
{
  field(DESC, "Last error code")
  field(DTYP, "Soft Channel")
  field(INP, "0")
  field(SCAN, "Passive")
}


record(bi, "FE14I-VA-IMG-04:OFFWARN") 
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}


#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-04:PRO:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-04:PRO:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
  #! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bImg.template
#% macro, __doc__, Template database for an inverted magnetron guage connected 
# to one channel of an mks937b Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)
#
# optional substitutions:
#% macro, name,        Object name, and gui association name
#% macro, ctl_channel, The desired control channel 0 = C1, 1 = C2, 2 = None, 3 = A1, 4 = B1, 5 = A2, 6 = B2.
#% macro, ctlsp_level, The desired control setpoint value.
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_hihi,  The HIHI alarm field on the control setpoint record.
#% macro, ctlsp_lolo,  The LOLO alarm field on the control setpoint record.
#% macro, ctlsp_high,  The HIGH alarm field on the control setpoint record.
#% macro, ctlsp_low ,  The LOW alarm field on the control setpoint record.
#% macro, ctlsp_desc,  The DESC field on the control setpoint record.
#% macro, ctlhyst_hopr,The HOPR field on control hysteresis records 
#                      (high operator value - helps display set correct range).
#% macro, ctlhyst_lopr,The LOPR field on control hysteresis records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_level, The desired protection setpoint value.
#% macro, prosp_drvh,  The DRVH field on protection setpoint records 
#                      (limits max value of protection setpoint)
#% macro, prosp_drvl,  The DRVL field on protection setpoint records. 
#                      (limits min value of protection setpoint)
#% macro, prosp_hopr,  The HOPR field on protection setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, prosp_lopr,  The LOPR field on protection setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_hihi,  The HIHI alarm field on the protection setpoint record.
#% macro, prosp_lolo,  The LOLO alarm field on the protection setpoint record.
#% macro, prosp_high,  The HIGH alarm field on the protection setpoint record.
#% macro, prosp_low ,  The LOW alarm field on the protection setpoint record.
#% macro, prosp_desc,  The DESC field on the protection setpoint record 
#                      (appears as a label on the Img EDM screen).
#
#% macro, offwarn,     Flag to display a warning that switching off the IMG could trip the beam
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
#% macro, img_ctl_setmode, Default = 1 (I/L Safe), 0 (Force ON), 2 (I/L Operating).
#
################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bImg.edl, device=FE14I-VA-IMG-05

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/img_detail.opi, device=FE14I-VA-IMG-05, desc=FE14I-VA-IMG-05, name=
# % gui, , boyembed, mks937bApp_opi/img_embed_box.opi, device=FE14I-VA-IMG-05, desc=FE14I-VA-IMG-05, name=
# % gui, , boyembed, mks937bApp_opi/img_embed.opi, device=FE14I-VA-IMG-05, desc=FE14I-VA-IMG-05, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,                                FE14I-VA-IMG-05:P
# % gui, , readback, Status,                                  FE14I-VA-IMG-05:STA
# % gui, , readback, Gauge Setpoint Write,                    FE14I-VA-IMG-05:PRO:ILKSETSP:NOWRITE
# % gui, , readback, Relay 1 on SetPoint for Summary,         FE14I-VA-IMG-05:RLY1:SP,        =pv("FE14I-VA-IMG-05:RLY1:SP.DESC")
# % gui, , readback, Relay 1 off SetPoint for Summary,        FE14I-VA-IMG-05:RLY1:SPOFF,     =pv("FE14I-VA-IMG-05:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 on SetPoint for Summary,         FE14I-VA-IMG-05:RLY2:SP,        =pv("FE14I-VA-IMG-05:RLY2:SP.DESC")
# % gui, , readback, Relay 3 on SetPoint for Summary,         FE14I-VA-IMG-05:RLY3:SP,        =pv("FE14I-VA-IMG-05:RLY3:SP.DESC")
## TODO The below gives us feedback on what the state actually is - without this you get the current demand
## (as per differences between EDM and CSS enum menus)
# % gui, , readback, Cold Cathode,                            FE14I-VA-IMG-05:ISENABLED
# % gui, , enum, Cold Cathode,                                FE14I-VA-IMG-05:CCHV

# % gui, , readback, CTL SP Controlling Gauge,                FE14I-VA-IMG-05:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-05:CTL:SP.DESC")," Gauge")
# % gui, , readback, CTL SP MODE,                             FE14I-VA-IMG-05:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-05:CTL:SP.DESC")," Mode")
# % gui, , readback, Pro Setpoint,                            FE14I-VA-IMG-05:PRO:SP,         =pv("FE14I-VA-IMG-05:PRO:SP.DESC")
# % gui, , readback, Relay 1 On Setpoint,                     FE14I-VA-IMG-05:RLY1:SP,        =pv("FE14I-VA-IMG-05:RLY1:SP.DESC")
# % gui, , readback, Relay 1 Off Setpoint,                    FE14I-VA-IMG-05:RLY1:SPOFF,     =pv("FE14I-VA-IMG-05:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 On Setpoint,                     FE14I-VA-IMG-05:RLY2:SP,        =pv("FE14I-VA-IMG-05:RLY2:SP.DESC")
# % gui, , readback, Relay 2 Off Setpoint,                    FE14I-VA-IMG-05:RLY2:SPOFF,     =pv("FE14I-VA-IMG-05:RLY2:SPOFF.DESC")
# % gui, , readback, Relay 3 On Setpoint,                     FE14I-VA-IMG-05:RLY3:SP,        =pv("FE14I-VA-IMG-05:RLY3:SP.DESC")
# % gui, , readback, Relay 3 Off Setpoint,                    FE14I-VA-IMG-05:RLY3:SPOFF,     =pv("FE14I-VA-IMG-05:RLY3:SPOFF.DESC")
# % gui, , readback, Relay 4 On Setpoint,                     FE14I-VA-IMG-05:RLY4:SP,        =pv("FE14I-VA-IMG-05:RLY4:SP.DESC")
# % gui, , readback, Relay 4 Off Setpoint,                    FE14I-VA-IMG-05:RLY4:SPOFF,     =pv("FE14I-VA-IMG-05:RLY4:SPOFF.DESC")
# % gui, , readback, Fast Relay On Setpoint,                  FE14I-VA-IMG-05:FRLY:SP,        =pv("FE14I-VA-IMG-05:FRLY:SP.DESC")

# % gui, , demand,   Pro Setpoint,                            FE14I-VA-IMG-05:PRO:OUTSP,      =pv("FE14I-VA-IMG-05:PRO:SP.DESC")
# % gui, , demand,   Relay 1 On Setpoint,                     FE14I-VA-IMG-05:RLY1:SETSP,     =pv("FE14I-VA-IMG-05:RLY1:SP.DESC")
# % gui, , demand,   Relay 1 Off Setpoint,                    FE14I-VA-IMG-05:RLY1:SETSPOFF,  =pv("FE14I-VA-IMG-05:RLY1:SPOFF.DESC")
# % gui, , demand,   Relay 2 On Setpoint,                     FE14I-VA-IMG-05:RLY2:SETSP,     =pv("FE14I-VA-IMG-05:RLY2:SP.DESC")
# % gui, , demand,   Relay 2 Off Setpoint,                    FE14I-VA-IMG-05:RLY2:SETSPOFF,  =pv("FE14I-VA-IMG-05:RLY2:SPOFF.DESC")
# % gui, , demand,   Relay 3 On Setpoint,                     FE14I-VA-IMG-05:RLY3:SETSP,     =pv("FE14I-VA-IMG-05:RLY3:SP.DESC")
# % gui, , demand,   Relay 3 Off Setpoint,                    FE14I-VA-IMG-05:RLY3:SETSPOFF,  =pv("FE14I-VA-IMG-05:RLY3:SPOFF.DESC")
# % gui, , demand,   Relay 4 On Setpoint,                     FE14I-VA-IMG-05:RLY4:SETSP,     =pv("FE14I-VA-IMG-05:RLY4:SP.DESC")
# % gui, , demand,   Relay 4 Off Setpoint,                    FE14I-VA-IMG-05:RLY4:SETSPOFF,  =pv("FE14I-VA-IMG-05:RLY4:SPOFF.DESC")
# % gui, , demand,   Fast Relay On Setpoint,                  FE14I-VA-IMG-05:FRLY:SETSP,     =pv("FE14I-VA-IMG-05:FRLY:SP.DESC")

# % gui, , readback, Relay 1 SP Mode,                         FE14I-VA-IMG-05:RLY1:MODE,      =concat(pv("FE14I-VA-IMG-05:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Mode,                         FE14I-VA-IMG-05:RLY2:MODE,      =concat(pv("FE14I-VA-IMG-05:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Mode,                         FE14I-VA-IMG-05:RLY3:MODE,      =concat(pv("FE14I-VA-IMG-05:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Mode,                         FE14I-VA-IMG-05:RLY4:MODE,      =concat(pv("FE14I-VA-IMG-05:RLY4:SP.DESC")," Mode")

# % gui, , enum, CTL SP Controlling Gauge,                    FE14I-VA-IMG-05:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-05:CTL:SP.DESC")," Gauge")
# % gui, , enum, CTL SP MODE,                                 FE14I-VA-IMG-05:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-05:CTL:SP.DESC")," Mode")
# % gui, , enum, Relay 1 SP Mode,                             FE14I-VA-IMG-05:RLY1:SETMODE,   =concat(pv("FE14I-VA-IMG-05:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 1 SP Direction,                    FE14I-VA-IMG-05:RLY1:DIR,       =concat(pv("FE14I-VA-IMG-05:RLY1:SP.DESC")," Dir")
# % gui, , enum, Relay 2 SP Mode,                             FE14I-VA-IMG-05:RLY2:SETMODE,   =concat(pv("FE14I-VA-IMG-05:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Direction,                    FE14I-VA-IMG-05:RLY2:DIR,       =concat(pv("FE14I-VA-IMG-05:RLY2:SP.DESC")," Dir")
# % gui, , enum, Relay 3 SP Mode,                             FE14I-VA-IMG-05:RLY3:SETMODE,   =concat(pv("FE14I-VA-IMG-05:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Direction,                    FE14I-VA-IMG-05:RLY3:DIR,       =concat(pv("FE14I-VA-IMG-05:RLY3:SP.DESC")," Dir")
# % gui, , enum, Relay 4 SP Mode,                             FE14I-VA-IMG-05:RLY4:SETMODE,   =concat(pv("FE14I-VA-IMG-05:RLY4:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Direction,                    FE14I-VA-IMG-05:RLY4:DIR,       =concat(pv("FE14I-VA-IMG-05:RLY4:SP.DESC")," Dir")

#
#% archiver 10 Monitor
#% controldesk Pressure scon
#
record(bo, "FE14I-VA-IMG-05:CCHV") 
{
  field(DESC, "Cold Cathode Enable")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol ccenable(001,3) ts1_2 0")
  field(FLNK, "FE14I-VA-IMG-05:FANENAB")
  field(ZNAM, "Off")
  field(ONAM, "On")
}

record(mbbi, "FE14I-VA-IMG-05:ISENABLED") {
  field(DESC, "IMG power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_cc_enabled(001,3) ts1_2")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

#  Changing CC HV mode requires associated processing of :STA and :ISENABLED
#  to update the readbacks
record(fanout, "FE14I-VA-IMG-05:FANENAB")
{
    field(DESC, "Distribute enabled")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-05:STA")
    field(LNK2, "FE14I-VA-IMG-05:ISENABLED")
}


record(bi, "FE14I-VA-IMG-05:SWITCHING") 
{
  field(DESC, "Switching")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Switching")
}

################################################################################
# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-IMG-05:STA") 
{
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,3) ts1_2")
#  field(SCAN, "I/O Intr")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-IMG-05:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
#   This record is disabled when :PDIS is 1, i.e. when the status returned is 
#   not a pressure reading.
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-IMG-05:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,3,FE14I-VA-IMG-05) ts1_2")
  field(FLNK, "FE14I-VA-IMG-05:PLOG")
  field(EGU, "mbar")
  field(PREC, "11")
  field(HOPR, "0.01")
  field(LOPR, "1.0E-11")
#  field(SDIS, "FE14I-VA-IMG-05:PDIS")
  field(DISS, "INVALID")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-IMG-05:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-IMG-05:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-IMG-05:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-IMG-05:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-IMG-05:STA PP")
}

record(calcout, "FE14I-VA-IMG-05:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-IMG-05:P.ADEL")
  field(INPA, "FE14I-VA-IMG-05:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IMG-05:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-IMG-05:P MS")
  field(FLNK, "FE14I-VA-IMG-05:PMAX")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}
record(ai, "FE14I-VA-IMG-05:PMAX")
{
    field(DESC, "Max Pressure")
    field(INP,  "FE14I-VA-IMG-05:P MS")
    field(FLNK, "FE14I-VA-IMG-05:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(ai, "FE14I-VA-IMG-05:PMIN")
{
    field(DESC, "Min Pressure")
    field(INP,  "FE14I-VA-IMG-05:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
    field(FLNK, "FE14I-VA-IMG-05:PSEQ")
}
################################################################################
# Control - IMG Enable
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-05:CTL:FAN10S")
{
    field(DESC, "CTL 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-05:CTL:MODE PP")
    field(LNK2, "FE14I-VA-IMG-05:CTL:CCS PP")
    field(LNK3, "FE14I-VA-IMG-05:CTL:SP PP")
    field(LNK4, "FE14I-VA-IMG-05:PRO:SP PP")
    field(SELM, "All")
}

#record(ao, "FE14I-VA-IMG-05:CTL:SETSP") {
#  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_2")
#  field(FLNK, "FE14I-VA-IMG-05:CTL:HYST")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "9.5e-1")
#  field(LOPR, "2.7e-3")
#  field(DRVH, "9.5e-1")
#  field(DRVL, "2.7e-3")
#  field(DOL, "1.0e-2")
#}

record(ai, "FE14I-VA-IMG-05:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_sp(001,3) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(HIHI, "9.6e-1")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "9.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# This record sets the setpoint locally
# but doesnt write it to the controller
# as we now need to send a pre-command
# to extend the setpoint range (XCS<n> command)
record(ao, "FE14I-VA-IMG-05:CTL:OUTSP") 
{
  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  Device Output now via CTL:SETSP after CTL:SETSPPRESEQ
#  field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_2")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(DOL, "1.0e-2")
#  field(FLNK, "FE14I-VA-IMG-05:CTL:SETSPFAN")
# Insert pre-sequence to set extended setpoint
  field(FLNK, "FE14I-VA-IMG-05:CTL:SETSPPRESEQ")
}

record(ao, "FE14I-VA-IMG-05:CTL:SETSP") 
    {
    field(DESC, "IMG Enable")
    field(DTYP, "stream")
    field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_2")
    field(EGU, "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL, "1.0e-2")
    field(FLNK, "FE14I-VA-IMG-05:CTL:SETSPFAN")
    }

record(seq, "FE14I-VA-IMG-05:CTL:SETSPPRESEQ")
    {
    field(DESC, "Preconditions to IMG Setpoint")
    field(SELM, "All")
    field(DOL1, "1")
    field(LNK1, "FE14I-VA-IMG-05:CTL:SETEXTRANGE PP")
    field(DOL2, "FE14I-VA-IMG-05:CTL:OUTSP")
    field(LNK2, "FE14I-VA-IMG-05:CTL:SETSP PP")
    }

record(mbbo, "FE14I-VA-IMG-05:CTL:SETEXTRANGE")
    {
    field(DTYP, "stream")
    field(DESC, "CC Extended Setpoint Enable")
    field(OUT, "@mks937b.protocol setcc_extended_range(001,3) ts1_2")
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL, "1")
#    field(PINI, "YES")
    }

# On setting a new interlock control setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-05:CTL:SETSPFAN")
{
    field(DESC, "CTL Set SP fanout")
    field(LNK1, "FE14I-VA-IMG-05:CTL:HYST PP")
    field(LNK2, "FE14I-VA-IMG-05:CTL:SP PP")
}

record(ao, "FE14I-VA-IMG-05:CTL:SETHYST") 
{
  field(DESC, "CC Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setcc_hyst(001,3) ts1_2")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(FLNK, "FE14I-VA-IMG-05:CTL:HYST PP")
}

record(calc, "FE14I-VA-IMG-05:CTL:MINHYST") 
{
  field(DESC, "Minimum hysteresis")
  field(EGU, "mbar")
  field(CALC, "A*1.2")
  field(INPA, "FE14I-VA-IMG-05:CTL:SP MS")
  field(FLNK, "FE14I-VA-IMG-05:CTL:SETHYST")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}

record(ai, "FE14I-VA-IMG-05:CTL:HYST") 
{
  field(DESC, "Setpoint Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_hyst(001,3) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-05:CTL:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-IMG-05:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-05:CTL:HYST")
  field(LNK1, "FE14I-VA-IMG-05:CTL:SETHYST.VAL PP")
}


record(bo, "FE14I-VA-IMG-05:CTL:DIS") 
{
  field(DESC, "Disable Control Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol discc_sp(001,3) ts1_2")
}

record(mbbo, "FE14I-VA-IMG-05:CTL:SETMODE") 
{
  field(DTYP, "stream")
  field(DESC, "CC Operating Mode")
  field(OUT, "@mks937b.protocol setcc_ctl(001,3) ts1_2")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:CTL:MODE")
}


record(mbbi, "FE14I-VA-IMG-05:CTL:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctl(001,3) ts1_2")
  field(DESC, "CC Status")
  field(SCAN, "Passive")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(UNSV, "MAJOR")
  field(ZRSV, "MINOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}


record(mbbo, "FE14I-VA-IMG-05:CTL:SETCCS") 
{
  field(DTYP, "stream")
  field(DESC, "Control Channel Status")
  field(OUT, "@mks937b.protocol setcc_ctrl_chan(001,3) ts1_2")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(ZRSV, "MINOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:CTL:CCS")
}


record(mbbi, "FE14I-VA-IMG-05:CTL:CCS") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctrl_chan(001,3) ts1_2")
  field(DESC, "Control Channel Status")
  field(SCAN, "Passive")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
}


################################################################################
# Protection - IMG Overpressure
#
##% archiver 10 Monitor
#
#record(ao, "FE14I-VA-IMG-05:PRO:SETSP") 
#{
#  field(DESC, "IMG Overpressure")
#  field(FLNK, "FE14I-VA-IMG-05:PRO:SEQ")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "1.0e-2")
#  field(LOPR, "1.3e-5")
#  field(DRVH, "1.0e-2")
#  field(DRVL, "1.3e-5")
#  field(DOL, "5.0e-4")
#}

#
##% archiver 10 Monitor
#
#record(mbbo, "FE14I-VA-IMG-05:PRO:ENABLE") 
#{
#  field(DESC, "Enable Protection Setpoint")
#  field(FLNK, "FE14I-VA-IMG-05:PRO:SEQ")
#  field(ZRST, "Force On I/L")
#  field(ONST, "I/L Operating")
#  field(ZRVL, "1")
#  field(ONVL, "2")
#  field(ZRSV, "MAJOR")
#  field(ONSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")    field(LNK2, "FE14I-VA-IMG-05:CTL:CCS")

#}

#record(seq, "FE14I-VA-IMG-05:PRO:SEQ") 
#{
#  field(DESC, "Sequence Protection Setpoint")
#  field(SELM, "Specified")
#  field(SELL, "FE14I-VA-IMG-05:PRO:ENABLE.RVAL")
#  field(DOL1, "0")
#  field(LNK1, "FE14I-VA-IMG-05:PRO:DIS PP")
#  field(DOL2, "FE14I-VA-IMG-05:PRO:SETSP")
#  field(LNK2, "FE14I-VA-IMG-05:PRO:OUTSP PP")
#}

#
#% archiver 10 Monitor
#% controldesk IMG Overpressure readback
#
record(ai, "FE14I-VA-IMG-05:PRO:SP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getpro(001,3) ts1_2 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(HIHI, "1.1e-2")
  field(LOLO, "1.2e-5")
  field(HIGH, "5.1e-4")
  field(LOW, "4.9e-4")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-05:PRO:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-05:PRO:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-05:PRO:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-05:PRO:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-05:PRO:OUTSP")
    field(LNK3, "FE14I-VA-IMG-05:PRO:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-05:PRO:OUTSP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setpro(001,3) ts1_2")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(DRVH, "1.0e-2")
  field(DRVL, "1.3e-5")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-05:PRO:ILKSETSP:NOWRITE")
  field(DOL,  "5.0e-4")
  field(FLNK, "FE14I-VA-IMG-05:PRO:SP PP")
}
# -----------------------------------------------------------------------------------------

record(bo, "FE14I-VA-IMG-05:PRO:DIS") 
{
  field(DESC, "Disable Protection Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dispro(001,3) ts1_2")
}

record(calc, "FE14I-VA-IMG-05:PDIS") {
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-IMG-05:STA")
  field(FLNK, "FE14I-VA-IMG-05:P")
}

record(ai, "FE14I-VA-IMG-05:ERRORNUM") 
{
  field(DESC, "Last error code")
  field(DTYP, "Soft Channel")
  field(INP, "0")
  field(SCAN, "Passive")
}


record(bi, "FE14I-VA-IMG-05:OFFWARN") 
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}


#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-05:PRO:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-05:PRO:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-05:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
  #! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bImg.template
#% macro, __doc__, Template database for an inverted magnetron guage connected 
# to one channel of an mks937b Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)
#
# optional substitutions:
#% macro, name,        Object name, and gui association name
#% macro, ctl_channel, The desired control channel 0 = C1, 1 = C2, 2 = None, 3 = A1, 4 = B1, 5 = A2, 6 = B2.
#% macro, ctlsp_level, The desired control setpoint value.
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_hihi,  The HIHI alarm field on the control setpoint record.
#% macro, ctlsp_lolo,  The LOLO alarm field on the control setpoint record.
#% macro, ctlsp_high,  The HIGH alarm field on the control setpoint record.
#% macro, ctlsp_low ,  The LOW alarm field on the control setpoint record.
#% macro, ctlsp_desc,  The DESC field on the control setpoint record.
#% macro, ctlhyst_hopr,The HOPR field on control hysteresis records 
#                      (high operator value - helps display set correct range).
#% macro, ctlhyst_lopr,The LOPR field on control hysteresis records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_level, The desired protection setpoint value.
#% macro, prosp_drvh,  The DRVH field on protection setpoint records 
#                      (limits max value of protection setpoint)
#% macro, prosp_drvl,  The DRVL field on protection setpoint records. 
#                      (limits min value of protection setpoint)
#% macro, prosp_hopr,  The HOPR field on protection setpoint records 
#                      (high operator value - helps display set correct range).
#% macro, prosp_lopr,  The LOPR field on protection setpoint records 
#                      (low operator value - helps display set correct range).
#% macro, prosp_hihi,  The HIHI alarm field on the protection setpoint record.
#% macro, prosp_lolo,  The LOLO alarm field on the protection setpoint record.
#% macro, prosp_high,  The HIGH alarm field on the protection setpoint record.
#% macro, prosp_low ,  The LOW alarm field on the protection setpoint record.
#% macro, prosp_desc,  The DESC field on the protection setpoint record 
#                      (appears as a label on the Img EDM screen).
#
#% macro, offwarn,     Flag to display a warning that switching off the IMG could trip the beam
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
#% macro, img_ctl_setmode, Default = 1 (I/L Safe), 0 (Force ON), 2 (I/L Operating).
#
################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bImg.edl, device=FE14I-VA-IMG-06

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/img_detail.opi, device=FE14I-VA-IMG-06, desc=FE14I-VA-IMG-06, name=
# % gui, , boyembed, mks937bApp_opi/img_embed_box.opi, device=FE14I-VA-IMG-06, desc=FE14I-VA-IMG-06, name=
# % gui, , boyembed, mks937bApp_opi/img_embed.opi, device=FE14I-VA-IMG-06, desc=FE14I-VA-IMG-06, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,                                FE14I-VA-IMG-06:P
# % gui, , readback, Status,                                  FE14I-VA-IMG-06:STA
# % gui, , readback, Gauge Setpoint Write,                    FE14I-VA-IMG-06:PRO:ILKSETSP:NOWRITE
# % gui, , readback, Relay 1 on SetPoint for Summary,         FE14I-VA-IMG-06:RLY1:SP,        =pv("FE14I-VA-IMG-06:RLY1:SP.DESC")
# % gui, , readback, Relay 1 off SetPoint for Summary,        FE14I-VA-IMG-06:RLY1:SPOFF,     =pv("FE14I-VA-IMG-06:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 on SetPoint for Summary,         FE14I-VA-IMG-06:RLY2:SP,        =pv("FE14I-VA-IMG-06:RLY2:SP.DESC")
# % gui, , readback, Relay 3 on SetPoint for Summary,         FE14I-VA-IMG-06:RLY3:SP,        =pv("FE14I-VA-IMG-06:RLY3:SP.DESC")
## TODO The below gives us feedback on what the state actually is - without this you get the current demand
## (as per differences between EDM and CSS enum menus)
# % gui, , readback, Cold Cathode,                            FE14I-VA-IMG-06:ISENABLED
# % gui, , enum, Cold Cathode,                                FE14I-VA-IMG-06:CCHV

# % gui, , readback, CTL SP Controlling Gauge,                FE14I-VA-IMG-06:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-06:CTL:SP.DESC")," Gauge")
# % gui, , readback, CTL SP MODE,                             FE14I-VA-IMG-06:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-06:CTL:SP.DESC")," Mode")
# % gui, , readback, Pro Setpoint,                            FE14I-VA-IMG-06:PRO:SP,         =pv("FE14I-VA-IMG-06:PRO:SP.DESC")
# % gui, , readback, Relay 1 On Setpoint,                     FE14I-VA-IMG-06:RLY1:SP,        =pv("FE14I-VA-IMG-06:RLY1:SP.DESC")
# % gui, , readback, Relay 1 Off Setpoint,                    FE14I-VA-IMG-06:RLY1:SPOFF,     =pv("FE14I-VA-IMG-06:RLY1:SPOFF.DESC")
# % gui, , readback, Relay 2 On Setpoint,                     FE14I-VA-IMG-06:RLY2:SP,        =pv("FE14I-VA-IMG-06:RLY2:SP.DESC")
# % gui, , readback, Relay 2 Off Setpoint,                    FE14I-VA-IMG-06:RLY2:SPOFF,     =pv("FE14I-VA-IMG-06:RLY2:SPOFF.DESC")
# % gui, , readback, Relay 3 On Setpoint,                     FE14I-VA-IMG-06:RLY3:SP,        =pv("FE14I-VA-IMG-06:RLY3:SP.DESC")
# % gui, , readback, Relay 3 Off Setpoint,                    FE14I-VA-IMG-06:RLY3:SPOFF,     =pv("FE14I-VA-IMG-06:RLY3:SPOFF.DESC")
# % gui, , readback, Relay 4 On Setpoint,                     FE14I-VA-IMG-06:RLY4:SP,        =pv("FE14I-VA-IMG-06:RLY4:SP.DESC")
# % gui, , readback, Relay 4 Off Setpoint,                    FE14I-VA-IMG-06:RLY4:SPOFF,     =pv("FE14I-VA-IMG-06:RLY4:SPOFF.DESC")
# % gui, , readback, Fast Relay On Setpoint,                  FE14I-VA-IMG-06:FRLY:SP,        =pv("FE14I-VA-IMG-06:FRLY:SP.DESC")

# % gui, , demand,   Pro Setpoint,                            FE14I-VA-IMG-06:PRO:OUTSP,      =pv("FE14I-VA-IMG-06:PRO:SP.DESC")
# % gui, , demand,   Relay 1 On Setpoint,                     FE14I-VA-IMG-06:RLY1:SETSP,     =pv("FE14I-VA-IMG-06:RLY1:SP.DESC")
# % gui, , demand,   Relay 1 Off Setpoint,                    FE14I-VA-IMG-06:RLY1:SETSPOFF,  =pv("FE14I-VA-IMG-06:RLY1:SPOFF.DESC")
# % gui, , demand,   Relay 2 On Setpoint,                     FE14I-VA-IMG-06:RLY2:SETSP,     =pv("FE14I-VA-IMG-06:RLY2:SP.DESC")
# % gui, , demand,   Relay 2 Off Setpoint,                    FE14I-VA-IMG-06:RLY2:SETSPOFF,  =pv("FE14I-VA-IMG-06:RLY2:SPOFF.DESC")
# % gui, , demand,   Relay 3 On Setpoint,                     FE14I-VA-IMG-06:RLY3:SETSP,     =pv("FE14I-VA-IMG-06:RLY3:SP.DESC")
# % gui, , demand,   Relay 3 Off Setpoint,                    FE14I-VA-IMG-06:RLY3:SETSPOFF,  =pv("FE14I-VA-IMG-06:RLY3:SPOFF.DESC")
# % gui, , demand,   Relay 4 On Setpoint,                     FE14I-VA-IMG-06:RLY4:SETSP,     =pv("FE14I-VA-IMG-06:RLY4:SP.DESC")
# % gui, , demand,   Relay 4 Off Setpoint,                    FE14I-VA-IMG-06:RLY4:SETSPOFF,  =pv("FE14I-VA-IMG-06:RLY4:SPOFF.DESC")
# % gui, , demand,   Fast Relay On Setpoint,                  FE14I-VA-IMG-06:FRLY:SETSP,     =pv("FE14I-VA-IMG-06:FRLY:SP.DESC")

# % gui, , readback, Relay 1 SP Mode,                         FE14I-VA-IMG-06:RLY1:MODE,      =concat(pv("FE14I-VA-IMG-06:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Mode,                         FE14I-VA-IMG-06:RLY2:MODE,      =concat(pv("FE14I-VA-IMG-06:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Mode,                         FE14I-VA-IMG-06:RLY3:MODE,      =concat(pv("FE14I-VA-IMG-06:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Mode,                         FE14I-VA-IMG-06:RLY4:MODE,      =concat(pv("FE14I-VA-IMG-06:RLY4:SP.DESC")," Mode")

# % gui, , enum, CTL SP Controlling Gauge,                    FE14I-VA-IMG-06:CTL:SETCCS,     =concat(pv("FE14I-VA-IMG-06:CTL:SP.DESC")," Gauge")
# % gui, , enum, CTL SP MODE,                                 FE14I-VA-IMG-06:CTL:SETMODE,    =concat(pv("FE14I-VA-IMG-06:CTL:SP.DESC")," Mode")
# % gui, , enum, Relay 1 SP Mode,                             FE14I-VA-IMG-06:RLY1:SETMODE,   =concat(pv("FE14I-VA-IMG-06:RLY1:SP.DESC")," Mode")
# % gui, , readback, Relay 1 SP Direction,                    FE14I-VA-IMG-06:RLY1:DIR,       =concat(pv("FE14I-VA-IMG-06:RLY1:SP.DESC")," Dir")
# % gui, , enum, Relay 2 SP Mode,                             FE14I-VA-IMG-06:RLY2:SETMODE,   =concat(pv("FE14I-VA-IMG-06:RLY2:SP.DESC")," Mode")
# % gui, , readback, Relay 2 SP Direction,                    FE14I-VA-IMG-06:RLY2:DIR,       =concat(pv("FE14I-VA-IMG-06:RLY2:SP.DESC")," Dir")
# % gui, , enum, Relay 3 SP Mode,                             FE14I-VA-IMG-06:RLY3:SETMODE,   =concat(pv("FE14I-VA-IMG-06:RLY3:SP.DESC")," Mode")
# % gui, , readback, Relay 3 SP Direction,                    FE14I-VA-IMG-06:RLY3:DIR,       =concat(pv("FE14I-VA-IMG-06:RLY3:SP.DESC")," Dir")
# % gui, , enum, Relay 4 SP Mode,                             FE14I-VA-IMG-06:RLY4:SETMODE,   =concat(pv("FE14I-VA-IMG-06:RLY4:SP.DESC")," Mode")
# % gui, , readback, Relay 4 SP Direction,                    FE14I-VA-IMG-06:RLY4:DIR,       =concat(pv("FE14I-VA-IMG-06:RLY4:SP.DESC")," Dir")

#
#% archiver 10 Monitor
#% controldesk Pressure scon
#
record(bo, "FE14I-VA-IMG-06:CCHV") 
{
  field(DESC, "Cold Cathode Enable")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol ccenable(001,3) ts1_3 0")
  field(FLNK, "FE14I-VA-IMG-06:FANENAB")
  field(ZNAM, "Off")
  field(ONAM, "On")
}

record(mbbi, "FE14I-VA-IMG-06:ISENABLED") {
  field(DESC, "IMG power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_cc_enabled(001,3) ts1_3")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

#  Changing CC HV mode requires associated processing of :STA and :ISENABLED
#  to update the readbacks
record(fanout, "FE14I-VA-IMG-06:FANENAB")
{
    field(DESC, "Distribute enabled")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-06:STA")
    field(LNK2, "FE14I-VA-IMG-06:ISENABLED")
}


record(bi, "FE14I-VA-IMG-06:SWITCHING") 
{
  field(DESC, "Switching")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Switching")
}

################################################################################
# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-IMG-06:STA") 
{
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,3) ts1_3")
#  field(SCAN, "I/O Intr")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-IMG-06:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
#   This record is disabled when :PDIS is 1, i.e. when the status returned is 
#   not a pressure reading.
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-IMG-06:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,3,FE14I-VA-IMG-06) ts1_3")
  field(FLNK, "FE14I-VA-IMG-06:PLOG")
  field(EGU, "mbar")
  field(PREC, "11")
  field(HOPR, "0.01")
  field(LOPR, "1.0E-11")
#  field(SDIS, "FE14I-VA-IMG-06:PDIS")
  field(DISS, "INVALID")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-IMG-06:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-IMG-06:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-IMG-06:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-IMG-06:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-IMG-06:STA PP")
}

record(calcout, "FE14I-VA-IMG-06:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-IMG-06:P.ADEL")
  field(INPA, "FE14I-VA-IMG-06:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IMG-06:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-IMG-06:P MS")
  field(FLNK, "FE14I-VA-IMG-06:PMAX")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}
record(ai, "FE14I-VA-IMG-06:PMAX")
{
    field(DESC, "Max Pressure")
    field(INP,  "FE14I-VA-IMG-06:P MS")
    field(FLNK, "FE14I-VA-IMG-06:PMIN")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
}
record(ai, "FE14I-VA-IMG-06:PMIN")
{
    field(DESC, "Min Pressure")
    field(INP,  "FE14I-VA-IMG-06:P MS")
    field(EGU,  "mbar")
    field(PREC, "11")
    field(HOPR, "0.01")
    field(LOPR, "1.0E-11")
    field(FLNK, "FE14I-VA-IMG-06:PSEQ")
}
################################################################################
# Control - IMG Enable
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-06:CTL:FAN10S")
{
    field(DESC, "CTL 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-06:CTL:MODE PP")
    field(LNK2, "FE14I-VA-IMG-06:CTL:CCS PP")
    field(LNK3, "FE14I-VA-IMG-06:CTL:SP PP")
    field(LNK4, "FE14I-VA-IMG-06:PRO:SP PP")
    field(SELM, "All")
}

#record(ao, "FE14I-VA-IMG-06:CTL:SETSP") {
#  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_3")
#  field(FLNK, "FE14I-VA-IMG-06:CTL:HYST")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "9.5e-1")
#  field(LOPR, "2.7e-3")
#  field(DRVH, "9.5e-1")
#  field(DRVL, "2.7e-3")
#  field(DOL, "1.0e-2")
#}

record(ai, "FE14I-VA-IMG-06:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_sp(001,3) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(HIHI, "9.6e-1")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "9.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# This record sets the setpoint locally
# but doesnt write it to the controller
# as we now need to send a pre-command
# to extend the setpoint range (XCS<n> command)
record(ao, "FE14I-VA-IMG-06:CTL:OUTSP") 
{
  field(DESC, "IMG Enable")
#  field(DTYP, "stream")
#  Device Output now via CTL:SETSP after CTL:SETSPPRESEQ
#  field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_3")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(DOL, "1.0e-2")
#  field(FLNK, "FE14I-VA-IMG-06:CTL:SETSPFAN")
# Insert pre-sequence to set extended setpoint
  field(FLNK, "FE14I-VA-IMG-06:CTL:SETSPPRESEQ")
}

record(ao, "FE14I-VA-IMG-06:CTL:SETSP") 
    {
    field(DESC, "IMG Enable")
    field(DTYP, "stream")
    field(OUT, "@mks937b.protocol setcc_sp(001,3) ts1_3")
    field(EGU, "mbar")
    field(PREC, "1")
    field(HOPR, "9.5e-1")
    field(LOPR, "2.7e-3")
    field(DRVH, "9.5e-1")
    field(DRVL, "2.7e-3")
    field(DOL, "1.0e-2")
    field(FLNK, "FE14I-VA-IMG-06:CTL:SETSPFAN")
    }

record(seq, "FE14I-VA-IMG-06:CTL:SETSPPRESEQ")
    {
    field(DESC, "Preconditions to IMG Setpoint")
    field(SELM, "All")
    field(DOL1, "1")
    field(LNK1, "FE14I-VA-IMG-06:CTL:SETEXTRANGE PP")
    field(DOL2, "FE14I-VA-IMG-06:CTL:OUTSP")
    field(LNK2, "FE14I-VA-IMG-06:CTL:SETSP PP")
    }

record(mbbo, "FE14I-VA-IMG-06:CTL:SETEXTRANGE")
    {
    field(DTYP, "stream")
    field(DESC, "CC Extended Setpoint Enable")
    field(OUT, "@mks937b.protocol setcc_extended_range(001,3) ts1_3")
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(ONSV, "NO_ALARM")
    field(TWSV, "NO_ALARM")
    field(DOL, "1")
#    field(PINI, "YES")
    }

# On setting a new interlock control setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-06:CTL:SETSPFAN")
{
    field(DESC, "CTL Set SP fanout")
    field(LNK1, "FE14I-VA-IMG-06:CTL:HYST PP")
    field(LNK2, "FE14I-VA-IMG-06:CTL:SP PP")
}

record(ao, "FE14I-VA-IMG-06:CTL:SETHYST") 
{
  field(DESC, "CC Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setcc_hyst(001,3) ts1_3")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(FLNK, "FE14I-VA-IMG-06:CTL:HYST PP")
}

record(calc, "FE14I-VA-IMG-06:CTL:MINHYST") 
{
  field(DESC, "Minimum hysteresis")
  field(EGU, "mbar")
  field(CALC, "A*1.2")
  field(INPA, "FE14I-VA-IMG-06:CTL:SP MS")
  field(FLNK, "FE14I-VA-IMG-06:CTL:SETHYST")
  field(HOPR, "-2")
  field(LOPR, "-11")
  field(ADEL, "0.025")
}

record(ai, "FE14I-VA-IMG-06:CTL:HYST") 
{
  field(DESC, "Setpoint Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_hyst(001,3) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-06:CTL:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-IMG-06:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-06:CTL:HYST")
  field(LNK1, "FE14I-VA-IMG-06:CTL:SETHYST.VAL PP")
}


record(bo, "FE14I-VA-IMG-06:CTL:DIS") 
{
  field(DESC, "Disable Control Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol discc_sp(001,3) ts1_3")
}

record(mbbo, "FE14I-VA-IMG-06:CTL:SETMODE") 
{
  field(DTYP, "stream")
  field(DESC, "CC Operating Mode")
  field(OUT, "@mks937b.protocol setcc_ctl(001,3) ts1_3")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:CTL:MODE")
}


record(mbbi, "FE14I-VA-IMG-06:CTL:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctl(001,3) ts1_3")
  field(DESC, "CC Status")
  field(SCAN, "Passive")
  field(ZRST, "Force On")
  field(ONST, "I/L Safe")
  field(TWST, "I/L Operating")
  field(UNSV, "MAJOR")
  field(ZRSV, "MINOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}


record(mbbo, "FE14I-VA-IMG-06:CTL:SETCCS") 
{
  field(DTYP, "stream")
  field(DESC, "Control Channel Status")
  field(OUT, "@mks937b.protocol setcc_ctrl_chan(001,3) ts1_3")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(ZRSV, "MINOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:CTL:CCS")
}


record(mbbi, "FE14I-VA-IMG-06:CTL:CCS") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getcc_ctrl_chan(001,3) ts1_3")
  field(DESC, "Control Channel Status")
  field(SCAN, "Passive")
  field(ZRST, "C1")
  field(ONST, "C2")
  field(TWST, "NONE")
  field(THST, "A1")
  field(FRST, "B1")
  field(FVST, "A2")
  field(SXST, "B2")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
}


################################################################################
# Protection - IMG Overpressure
#
##% archiver 10 Monitor
#
#record(ao, "FE14I-VA-IMG-06:PRO:SETSP") 
#{
#  field(DESC, "IMG Overpressure")
#  field(FLNK, "FE14I-VA-IMG-06:PRO:SEQ")
#  field(EGU, "mbar")
#  field(PREC, "1")
#  field(HOPR, "1.0e-2")
#  field(LOPR, "1.3e-5")
#  field(DRVH, "1.0e-2")
#  field(DRVL, "1.3e-5")
#  field(DOL, "5.0e-4")
#}

#
##% archiver 10 Monitor
#
#record(mbbo, "FE14I-VA-IMG-06:PRO:ENABLE") 
#{
#  field(DESC, "Enable Protection Setpoint")
#  field(FLNK, "FE14I-VA-IMG-06:PRO:SEQ")
#  field(ZRST, "Force On I/L")
#  field(ONST, "I/L Operating")
#  field(ZRVL, "1")
#  field(ONVL, "2")
#  field(ZRSV, "MAJOR")
#  field(ONSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")    field(LNK2, "FE14I-VA-IMG-06:CTL:CCS")

#}

#record(seq, "FE14I-VA-IMG-06:PRO:SEQ") 
#{
#  field(DESC, "Sequence Protection Setpoint")
#  field(SELM, "Specified")
#  field(SELL, "FE14I-VA-IMG-06:PRO:ENABLE.RVAL")
#  field(DOL1, "0")
#  field(LNK1, "FE14I-VA-IMG-06:PRO:DIS PP")
#  field(DOL2, "FE14I-VA-IMG-06:PRO:SETSP")
#  field(LNK2, "FE14I-VA-IMG-06:PRO:OUTSP PP")
#}

#
#% archiver 10 Monitor
#% controldesk IMG Overpressure readback
#
record(ai, "FE14I-VA-IMG-06:PRO:SP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getpro(001,3) ts1_3 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(HIHI, "1.1e-2")
  field(LOLO, "1.2e-5")
  field(HIGH, "5.1e-4")
  field(LOW, "4.9e-4")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-06:PRO:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-06:PRO:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-06:PRO:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-06:PRO:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-06:PRO:OUTSP")
    field(LNK3, "FE14I-VA-IMG-06:PRO:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-06:PRO:OUTSP") 
{
  field(DESC, "IMG Overpressure")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setpro(001,3) ts1_3")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
  field(DRVH, "1.0e-2")
  field(DRVL, "1.3e-5")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-06:PRO:ILKSETSP:NOWRITE")
  field(DOL,  "5.0e-4")
  field(FLNK, "FE14I-VA-IMG-06:PRO:SP PP")
}
# -----------------------------------------------------------------------------------------

record(bo, "FE14I-VA-IMG-06:PRO:DIS") 
{
  field(DESC, "Disable Protection Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dispro(001,3) ts1_3")
}

record(calc, "FE14I-VA-IMG-06:PDIS") {
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-IMG-06:STA")
  field(FLNK, "FE14I-VA-IMG-06:P")
}

record(ai, "FE14I-VA-IMG-06:ERRORNUM") 
{
  field(DESC, "Last error code")
  field(DTYP, "Soft Channel")
  field(INP, "0")
  field(SCAN, "Passive")
}


record(bi, "FE14I-VA-IMG-06:OFFWARN") 
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}


#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-06:PRO:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-06:PRO:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
  #! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bPirg.db
#% macro, __doc__, Template database for a pirani guage connected to
# one channel of an mks937b Multi-Sensor System
# A note on the optional macros: they default to an appropriate hard-coded
# value if no value is passed for expansion.
# They are provided to allow the default set points to be changed.
# Once the set point needs to be changed it may be necessary to alter 
# various other fields defining the range of allowed values.
# For the majority of applications the defaults should be used.  The levels
# should only be changed at the request of the vacuum group for non-standard
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, channel, MKS 937A channel number (1-4)
#% macro, address, Controller address (001 .. 253)
#% macro, name,        Object name, and gui association name
#% macro, offwarn,     Flag to display a warning that switching off the PIRG could trip the beam#

################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bPirg.edl, device=FE14I-VA-PIRG-01

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/pirg_detail.opi, device=FE14I-VA-PIRG-01, desc=FE14I-VA-PIRG-01, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed_box.opi, device=FE14I-VA-PIRG-01, desc=FE14I-VA-PIRG-01, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed.opi, device=FE14I-VA-PIRG-01, desc=FE14I-VA-PIRG-01, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,              FE14I-VA-PIRG-01:P
# % gui, , readback, Status,                FE14I-VA-PIRG-01:STA
# % gui, , readback, Gauge Setpoint Write,  FE14I-VA-PIRG-01:ILKSETSP:NOWRITE
# % gui, , readback, CTL Setpoint Summary,  FE14I-VA-PIRG-01:CTL:SP,            =pv("FE14I-VA-PIRG-01:CTL:SP.DESC")
# % gui, , readback, RLY1 Setpoint Summary, FE14I-VA-PIRG-01:RLY1:SP,           =pv("FE14I-VA-PIRG-01:RLY1:SP.DESC")
# % gui, , readback, RLY2 Setpoint Summary, FE14I-VA-PIRG-01:RLY2:SP,           =pv("FE14I-VA-PIRG-01:RLY2:SP.DESC")
# % gui, , enum,     PirgFilament,          FE14I-VA-PIRG-01:ENABLE
# % gui, , readback, CTL Setpoint On,       FE14I-VA-PIRG-01:CTL:SP,            =pv("FE14I-VA-PIRG-01:CTL:SP.DESC")
# % gui, , readback, CTL Setpoint Off,      FE14I-VA-PIRG-01:CTL:HYST,          =pv("FE14I-VA-PIRG-01:CTL:SETSPOFF.DESC")
# % gui, , readback, RLY1 Setpoint On,      FE14I-VA-PIRG-01:RLY1:SP,           =pv("FE14I-VA-PIRG-01:RLY1:SP.DESC")
# % gui, , readback, RLY1 Setpoint Off,     FE14I-VA-PIRG-01:RLY1:SPOFF,        =pv("FE14I-VA-PIRG-01:RLY1:SPOFF.DESC")
# % gui, , readback, RLY2 Setpoint On,      FE14I-VA-PIRG-01:RLY2:SP,           =pv("FE14I-VA-PIRG-01:RLY2:SP.DESC")
# % gui, , readback, RLY2 Setpoint Off,     FE14I-VA-PIRG-01:RLY2:SPOFF,        =pv("FE14I-VA-PIRG-01:RLY2:SPOFF.DESC")
# % gui, , demand,   CTL Setpoint On,       FE14I-VA-PIRG-01:CTL:SETSP,         =pv("FE14I-VA-PIRG-01:SP.DESC")
# % gui, , demand,   CTL Setpoint Off,      FE14I-VA-PIRG-01:CTL:SETSPOFF,      =pv("FE14I-VA-PIRG-01:SPOFF.DESC")
# % gui, , demand,   RLY1 Setpoint On,      FE14I-VA-PIRG-01:RLY1:SETSP,        =pv("FE14I-VA-PIRG-01:RLY1:SP.DESC")
# % gui, , demand,   RLY1 Setpoint Off,     FE14I-VA-PIRG-01:RLY1:SETSPOFF,     =pv("FE14I-VA-PIRG-01:RLY1:SPOFF.DESC")
# % gui, , demand,   RLY2 Setpoint On,      FE14I-VA-PIRG-01:RLY2:SETSP,        =pv("FE14I-VA-PIRG-01:RLY2:SP.DESC")
# % gui, , demand,   RLY2 Setpoint Off,     FE14I-VA-PIRG-01:RLY2:SETSPOFF,     =pv("FE14I-VA-PIRG-01:RLY2:SPOFF.DESC")
# % gui, , readback, RLY1 Mode,             FE14I-VA-PIRG-01:RLY1:MODE,         =concat(pv("FE14I-VA-PIRG-01:RLY1:SP.DESC")," Mode")
# % gui, , readback, RLY1 Direction,        FE14I-VA-PIRG-01:RLY1:DIR,          =concat(pv("FE14I-VA-PIRG-01:RLY1:SP.DESC")," Dir")
# % gui, , readback, RLY2 Mode,             FE14I-VA-PIRG-01:RLY2:MODE,         =concat(pv("FE14I-VA-PIRG-01:RLY2:SP.DESC")," Mode")
# % gui, , readback, RLY2 Direction,        FE14I-VA-PIRG-01:RLY2:DIR,          =concat(pv("FE14I-VA-PIRG-01:RLY2:SP.DESC")," Dir")
# % gui, , enum,     RLY1 Mode,             FE14I-VA-PIRG-01:RLY1:SETMODE,      =concat(pv("FE14I-VA-PIRG-01:RLY1:SP.DESC")," Mode")
# % gui, , enum,     RLY1 Direction,        FE14I-VA-PIRG-01:RLY1:SETDIR,       =concat(pv("FE14I-VA-PIRG-01:RLY1:SP.DESC")," Dir")
# % gui, , enum,     RLY2 Mode,             FE14I-VA-PIRG-01:RLY2:SETMODE,      =concat(pv("FE14I-VA-PIRG-01:RLY2:SP.DESC")," Mode")
# % gui, , enum,     RLY2 Direction,        FE14I-VA-PIRG-01:RLY2:SETDIR,       =concat(pv("FE14I-VA-PIRG-01:RLY2:SP.DESC")," Dir")

# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-PIRG-01:STA") {
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,5,FE14I-VA-PIRG-01) ts1_1")
#  field(SCAN, "1 second")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-PIRG-01:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
# 
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-PIRG-01:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,5,FE14I-VA-PIRG-01) ts1_1")
  field(FLNK, "FE14I-VA-PIRG-01:PLOG")
  field(EGU, "mbar")
  field(PREC, "3")
  field(HOPR, "1000")
  field(LOPR, "0.001")
  field(SDIS, "FE14I-VA-PIRG-01:PDIS")
  field(DISS, "INVALID")
}

record(calcout, "FE14I-VA-PIRG-01:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-PIRG-01:P.ADEL")
  field(INPA, "FE14I-VA-PIRG-01:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-PIRG-01:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-PIRG-01:P MS")
  field(HOPR, "3")
  field(LOPR, "-3")
  field(ADEL, "0.025")
  field(FLNK, "FE14I-VA-PIRG-01:PSEQ")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-PIRG-01:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-PIRG-01:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-PIRG-01:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-PIRG-01:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-PIRG-01:STA PP")
}


record(calc, "FE14I-VA-PIRG-01:PDIS") 
{
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-PIRG-01:STA")
  field(FLNK, "FE14I-VA-PIRG-01:P")
}

record(mbbo, "FE14I-VA-PIRG-01:ENABLE") {
  field(DESC, "Enable Pirani power")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol pirgenable(001,5) ts1_1")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-01:ISENABLED")
}

record(mbbi, "FE14I-VA-PIRG-01:ISENABLED") {
  field(DESC, "Pirani power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_gauge_enabled(001,5) ts1_1")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bi, "FE14I-VA-PIRG-01:OFFWARN")
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bPirg.db
#% macro, __doc__, Template database for a pirani guage connected to
# one channel of an mks937b Multi-Sensor System
# A note on the optional macros: they default to an appropriate hard-coded
# value if no value is passed for expansion.
# They are provided to allow the default set points to be changed.
# Once the set point needs to be changed it may be necessary to alter 
# various other fields defining the range of allowed values.
# For the majority of applications the defaults should be used.  The levels
# should only be changed at the request of the vacuum group for non-standard
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, channel, MKS 937A channel number (1-4)
#% macro, address, Controller address (001 .. 253)
#% macro, name,        Object name, and gui association name
#% macro, offwarn,     Flag to display a warning that switching off the PIRG could trip the beam#

################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bPirg.edl, device=FE14I-VA-PIRG-02

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/pirg_detail.opi, device=FE14I-VA-PIRG-02, desc=FE14I-VA-PIRG-02, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed_box.opi, device=FE14I-VA-PIRG-02, desc=FE14I-VA-PIRG-02, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed.opi, device=FE14I-VA-PIRG-02, desc=FE14I-VA-PIRG-02, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,              FE14I-VA-PIRG-02:P
# % gui, , readback, Status,                FE14I-VA-PIRG-02:STA
# % gui, , readback, Gauge Setpoint Write,  FE14I-VA-PIRG-02:ILKSETSP:NOWRITE
# % gui, , readback, CTL Setpoint Summary,  FE14I-VA-PIRG-02:CTL:SP,            =pv("FE14I-VA-PIRG-02:CTL:SP.DESC")
# % gui, , readback, RLY1 Setpoint Summary, FE14I-VA-PIRG-02:RLY1:SP,           =pv("FE14I-VA-PIRG-02:RLY1:SP.DESC")
# % gui, , readback, RLY2 Setpoint Summary, FE14I-VA-PIRG-02:RLY2:SP,           =pv("FE14I-VA-PIRG-02:RLY2:SP.DESC")
# % gui, , enum,     PirgFilament,          FE14I-VA-PIRG-02:ENABLE
# % gui, , readback, CTL Setpoint On,       FE14I-VA-PIRG-02:CTL:SP,            =pv("FE14I-VA-PIRG-02:CTL:SP.DESC")
# % gui, , readback, CTL Setpoint Off,      FE14I-VA-PIRG-02:CTL:HYST,          =pv("FE14I-VA-PIRG-02:CTL:SETSPOFF.DESC")
# % gui, , readback, RLY1 Setpoint On,      FE14I-VA-PIRG-02:RLY1:SP,           =pv("FE14I-VA-PIRG-02:RLY1:SP.DESC")
# % gui, , readback, RLY1 Setpoint Off,     FE14I-VA-PIRG-02:RLY1:SPOFF,        =pv("FE14I-VA-PIRG-02:RLY1:SPOFF.DESC")
# % gui, , readback, RLY2 Setpoint On,      FE14I-VA-PIRG-02:RLY2:SP,           =pv("FE14I-VA-PIRG-02:RLY2:SP.DESC")
# % gui, , readback, RLY2 Setpoint Off,     FE14I-VA-PIRG-02:RLY2:SPOFF,        =pv("FE14I-VA-PIRG-02:RLY2:SPOFF.DESC")
# % gui, , demand,   CTL Setpoint On,       FE14I-VA-PIRG-02:CTL:SETSP,         =pv("FE14I-VA-PIRG-02:SP.DESC")
# % gui, , demand,   CTL Setpoint Off,      FE14I-VA-PIRG-02:CTL:SETSPOFF,      =pv("FE14I-VA-PIRG-02:SPOFF.DESC")
# % gui, , demand,   RLY1 Setpoint On,      FE14I-VA-PIRG-02:RLY1:SETSP,        =pv("FE14I-VA-PIRG-02:RLY1:SP.DESC")
# % gui, , demand,   RLY1 Setpoint Off,     FE14I-VA-PIRG-02:RLY1:SETSPOFF,     =pv("FE14I-VA-PIRG-02:RLY1:SPOFF.DESC")
# % gui, , demand,   RLY2 Setpoint On,      FE14I-VA-PIRG-02:RLY2:SETSP,        =pv("FE14I-VA-PIRG-02:RLY2:SP.DESC")
# % gui, , demand,   RLY2 Setpoint Off,     FE14I-VA-PIRG-02:RLY2:SETSPOFF,     =pv("FE14I-VA-PIRG-02:RLY2:SPOFF.DESC")
# % gui, , readback, RLY1 Mode,             FE14I-VA-PIRG-02:RLY1:MODE,         =concat(pv("FE14I-VA-PIRG-02:RLY1:SP.DESC")," Mode")
# % gui, , readback, RLY1 Direction,        FE14I-VA-PIRG-02:RLY1:DIR,          =concat(pv("FE14I-VA-PIRG-02:RLY1:SP.DESC")," Dir")
# % gui, , readback, RLY2 Mode,             FE14I-VA-PIRG-02:RLY2:MODE,         =concat(pv("FE14I-VA-PIRG-02:RLY2:SP.DESC")," Mode")
# % gui, , readback, RLY2 Direction,        FE14I-VA-PIRG-02:RLY2:DIR,          =concat(pv("FE14I-VA-PIRG-02:RLY2:SP.DESC")," Dir")
# % gui, , enum,     RLY1 Mode,             FE14I-VA-PIRG-02:RLY1:SETMODE,      =concat(pv("FE14I-VA-PIRG-02:RLY1:SP.DESC")," Mode")
# % gui, , enum,     RLY1 Direction,        FE14I-VA-PIRG-02:RLY1:SETDIR,       =concat(pv("FE14I-VA-PIRG-02:RLY1:SP.DESC")," Dir")
# % gui, , enum,     RLY2 Mode,             FE14I-VA-PIRG-02:RLY2:SETMODE,      =concat(pv("FE14I-VA-PIRG-02:RLY2:SP.DESC")," Mode")
# % gui, , enum,     RLY2 Direction,        FE14I-VA-PIRG-02:RLY2:SETDIR,       =concat(pv("FE14I-VA-PIRG-02:RLY2:SP.DESC")," Dir")

# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-PIRG-02:STA") {
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,6,FE14I-VA-PIRG-02) ts1_1")
#  field(SCAN, "1 second")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-PIRG-02:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
# 
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-PIRG-02:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,6,FE14I-VA-PIRG-02) ts1_1")
  field(FLNK, "FE14I-VA-PIRG-02:PLOG")
  field(EGU, "mbar")
  field(PREC, "3")
  field(HOPR, "1000")
  field(LOPR, "0.001")
  field(SDIS, "FE14I-VA-PIRG-02:PDIS")
  field(DISS, "INVALID")
}

record(calcout, "FE14I-VA-PIRG-02:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-PIRG-02:P.ADEL")
  field(INPA, "FE14I-VA-PIRG-02:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-PIRG-02:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-PIRG-02:P MS")
  field(HOPR, "3")
  field(LOPR, "-3")
  field(ADEL, "0.025")
  field(FLNK, "FE14I-VA-PIRG-02:PSEQ")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-PIRG-02:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-PIRG-02:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-PIRG-02:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-PIRG-02:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-PIRG-02:STA PP")
}


record(calc, "FE14I-VA-PIRG-02:PDIS") 
{
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-PIRG-02:STA")
  field(FLNK, "FE14I-VA-PIRG-02:P")
}

record(mbbo, "FE14I-VA-PIRG-02:ENABLE") {
  field(DESC, "Enable Pirani power")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol pirgenable(001,6) ts1_1")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-02:ISENABLED")
}

record(mbbi, "FE14I-VA-PIRG-02:ISENABLED") {
  field(DESC, "Pirani power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_gauge_enabled(001,6) ts1_1")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bi, "FE14I-VA-PIRG-02:OFFWARN")
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bPirg.db
#% macro, __doc__, Template database for a pirani guage connected to
# one channel of an mks937b Multi-Sensor System
# A note on the optional macros: they default to an appropriate hard-coded
# value if no value is passed for expansion.
# They are provided to allow the default set points to be changed.
# Once the set point needs to be changed it may be necessary to alter 
# various other fields defining the range of allowed values.
# For the majority of applications the defaults should be used.  The levels
# should only be changed at the request of the vacuum group for non-standard
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, channel, MKS 937A channel number (1-4)
#% macro, address, Controller address (001 .. 253)
#% macro, name,        Object name, and gui association name
#% macro, offwarn,     Flag to display a warning that switching off the PIRG could trip the beam#

################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bPirg.edl, device=FE14I-VA-PIRG-03

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/pirg_detail.opi, device=FE14I-VA-PIRG-03, desc=FE14I-VA-PIRG-03, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed_box.opi, device=FE14I-VA-PIRG-03, desc=FE14I-VA-PIRG-03, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed.opi, device=FE14I-VA-PIRG-03, desc=FE14I-VA-PIRG-03, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,              FE14I-VA-PIRG-03:P
# % gui, , readback, Status,                FE14I-VA-PIRG-03:STA
# % gui, , readback, Gauge Setpoint Write,  FE14I-VA-PIRG-03:ILKSETSP:NOWRITE
# % gui, , readback, CTL Setpoint Summary,  FE14I-VA-PIRG-03:CTL:SP,            =pv("FE14I-VA-PIRG-03:CTL:SP.DESC")
# % gui, , readback, RLY1 Setpoint Summary, FE14I-VA-PIRG-03:RLY1:SP,           =pv("FE14I-VA-PIRG-03:RLY1:SP.DESC")
# % gui, , readback, RLY2 Setpoint Summary, FE14I-VA-PIRG-03:RLY2:SP,           =pv("FE14I-VA-PIRG-03:RLY2:SP.DESC")
# % gui, , enum,     PirgFilament,          FE14I-VA-PIRG-03:ENABLE
# % gui, , readback, CTL Setpoint On,       FE14I-VA-PIRG-03:CTL:SP,            =pv("FE14I-VA-PIRG-03:CTL:SP.DESC")
# % gui, , readback, CTL Setpoint Off,      FE14I-VA-PIRG-03:CTL:HYST,          =pv("FE14I-VA-PIRG-03:CTL:SETSPOFF.DESC")
# % gui, , readback, RLY1 Setpoint On,      FE14I-VA-PIRG-03:RLY1:SP,           =pv("FE14I-VA-PIRG-03:RLY1:SP.DESC")
# % gui, , readback, RLY1 Setpoint Off,     FE14I-VA-PIRG-03:RLY1:SPOFF,        =pv("FE14I-VA-PIRG-03:RLY1:SPOFF.DESC")
# % gui, , readback, RLY2 Setpoint On,      FE14I-VA-PIRG-03:RLY2:SP,           =pv("FE14I-VA-PIRG-03:RLY2:SP.DESC")
# % gui, , readback, RLY2 Setpoint Off,     FE14I-VA-PIRG-03:RLY2:SPOFF,        =pv("FE14I-VA-PIRG-03:RLY2:SPOFF.DESC")
# % gui, , demand,   CTL Setpoint On,       FE14I-VA-PIRG-03:CTL:SETSP,         =pv("FE14I-VA-PIRG-03:SP.DESC")
# % gui, , demand,   CTL Setpoint Off,      FE14I-VA-PIRG-03:CTL:SETSPOFF,      =pv("FE14I-VA-PIRG-03:SPOFF.DESC")
# % gui, , demand,   RLY1 Setpoint On,      FE14I-VA-PIRG-03:RLY1:SETSP,        =pv("FE14I-VA-PIRG-03:RLY1:SP.DESC")
# % gui, , demand,   RLY1 Setpoint Off,     FE14I-VA-PIRG-03:RLY1:SETSPOFF,     =pv("FE14I-VA-PIRG-03:RLY1:SPOFF.DESC")
# % gui, , demand,   RLY2 Setpoint On,      FE14I-VA-PIRG-03:RLY2:SETSP,        =pv("FE14I-VA-PIRG-03:RLY2:SP.DESC")
# % gui, , demand,   RLY2 Setpoint Off,     FE14I-VA-PIRG-03:RLY2:SETSPOFF,     =pv("FE14I-VA-PIRG-03:RLY2:SPOFF.DESC")
# % gui, , readback, RLY1 Mode,             FE14I-VA-PIRG-03:RLY1:MODE,         =concat(pv("FE14I-VA-PIRG-03:RLY1:SP.DESC")," Mode")
# % gui, , readback, RLY1 Direction,        FE14I-VA-PIRG-03:RLY1:DIR,          =concat(pv("FE14I-VA-PIRG-03:RLY1:SP.DESC")," Dir")
# % gui, , readback, RLY2 Mode,             FE14I-VA-PIRG-03:RLY2:MODE,         =concat(pv("FE14I-VA-PIRG-03:RLY2:SP.DESC")," Mode")
# % gui, , readback, RLY2 Direction,        FE14I-VA-PIRG-03:RLY2:DIR,          =concat(pv("FE14I-VA-PIRG-03:RLY2:SP.DESC")," Dir")
# % gui, , enum,     RLY1 Mode,             FE14I-VA-PIRG-03:RLY1:SETMODE,      =concat(pv("FE14I-VA-PIRG-03:RLY1:SP.DESC")," Mode")
# % gui, , enum,     RLY1 Direction,        FE14I-VA-PIRG-03:RLY1:SETDIR,       =concat(pv("FE14I-VA-PIRG-03:RLY1:SP.DESC")," Dir")
# % gui, , enum,     RLY2 Mode,             FE14I-VA-PIRG-03:RLY2:SETMODE,      =concat(pv("FE14I-VA-PIRG-03:RLY2:SP.DESC")," Mode")
# % gui, , enum,     RLY2 Direction,        FE14I-VA-PIRG-03:RLY2:SETDIR,       =concat(pv("FE14I-VA-PIRG-03:RLY2:SP.DESC")," Dir")

# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-PIRG-03:STA") {
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,5,FE14I-VA-PIRG-03) ts1_2")
#  field(SCAN, "1 second")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-PIRG-03:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
# 
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-PIRG-03:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,5,FE14I-VA-PIRG-03) ts1_2")
  field(FLNK, "FE14I-VA-PIRG-03:PLOG")
  field(EGU, "mbar")
  field(PREC, "3")
  field(HOPR, "1000")
  field(LOPR, "0.001")
  field(SDIS, "FE14I-VA-PIRG-03:PDIS")
  field(DISS, "INVALID")
}

record(calcout, "FE14I-VA-PIRG-03:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-PIRG-03:P.ADEL")
  field(INPA, "FE14I-VA-PIRG-03:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-PIRG-03:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-PIRG-03:P MS")
  field(HOPR, "3")
  field(LOPR, "-3")
  field(ADEL, "0.025")
  field(FLNK, "FE14I-VA-PIRG-03:PSEQ")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-PIRG-03:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-PIRG-03:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-PIRG-03:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-PIRG-03:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-PIRG-03:STA PP")
}


record(calc, "FE14I-VA-PIRG-03:PDIS") 
{
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-PIRG-03:STA")
  field(FLNK, "FE14I-VA-PIRG-03:P")
}

record(mbbo, "FE14I-VA-PIRG-03:ENABLE") {
  field(DESC, "Enable Pirani power")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol pirgenable(001,5) ts1_2")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-03:ISENABLED")
}

record(mbbi, "FE14I-VA-PIRG-03:ISENABLED") {
  field(DESC, "Pirani power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_gauge_enabled(001,5) ts1_2")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bi, "FE14I-VA-PIRG-03:OFFWARN")
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bPirg.db
#% macro, __doc__, Template database for a pirani guage connected to
# one channel of an mks937b Multi-Sensor System
# A note on the optional macros: they default to an appropriate hard-coded
# value if no value is passed for expansion.
# They are provided to allow the default set points to be changed.
# Once the set point needs to be changed it may be necessary to alter 
# various other fields defining the range of allowed values.
# For the majority of applications the defaults should be used.  The levels
# should only be changed at the request of the vacuum group for non-standard
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, channel, MKS 937A channel number (1-4)
#% macro, address, Controller address (001 .. 253)
#% macro, name,        Object name, and gui association name
#% macro, offwarn,     Flag to display a warning that switching off the PIRG could trip the beam#

################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bPirg.edl, device=FE14I-VA-PIRG-04

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/pirg_detail.opi, device=FE14I-VA-PIRG-04, desc=FE14I-VA-PIRG-04, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed_box.opi, device=FE14I-VA-PIRG-04, desc=FE14I-VA-PIRG-04, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed.opi, device=FE14I-VA-PIRG-04, desc=FE14I-VA-PIRG-04, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,              FE14I-VA-PIRG-04:P
# % gui, , readback, Status,                FE14I-VA-PIRG-04:STA
# % gui, , readback, Gauge Setpoint Write,  FE14I-VA-PIRG-04:ILKSETSP:NOWRITE
# % gui, , readback, CTL Setpoint Summary,  FE14I-VA-PIRG-04:CTL:SP,            =pv("FE14I-VA-PIRG-04:CTL:SP.DESC")
# % gui, , readback, RLY1 Setpoint Summary, FE14I-VA-PIRG-04:RLY1:SP,           =pv("FE14I-VA-PIRG-04:RLY1:SP.DESC")
# % gui, , readback, RLY2 Setpoint Summary, FE14I-VA-PIRG-04:RLY2:SP,           =pv("FE14I-VA-PIRG-04:RLY2:SP.DESC")
# % gui, , enum,     PirgFilament,          FE14I-VA-PIRG-04:ENABLE
# % gui, , readback, CTL Setpoint On,       FE14I-VA-PIRG-04:CTL:SP,            =pv("FE14I-VA-PIRG-04:CTL:SP.DESC")
# % gui, , readback, CTL Setpoint Off,      FE14I-VA-PIRG-04:CTL:HYST,          =pv("FE14I-VA-PIRG-04:CTL:SETSPOFF.DESC")
# % gui, , readback, RLY1 Setpoint On,      FE14I-VA-PIRG-04:RLY1:SP,           =pv("FE14I-VA-PIRG-04:RLY1:SP.DESC")
# % gui, , readback, RLY1 Setpoint Off,     FE14I-VA-PIRG-04:RLY1:SPOFF,        =pv("FE14I-VA-PIRG-04:RLY1:SPOFF.DESC")
# % gui, , readback, RLY2 Setpoint On,      FE14I-VA-PIRG-04:RLY2:SP,           =pv("FE14I-VA-PIRG-04:RLY2:SP.DESC")
# % gui, , readback, RLY2 Setpoint Off,     FE14I-VA-PIRG-04:RLY2:SPOFF,        =pv("FE14I-VA-PIRG-04:RLY2:SPOFF.DESC")
# % gui, , demand,   CTL Setpoint On,       FE14I-VA-PIRG-04:CTL:SETSP,         =pv("FE14I-VA-PIRG-04:SP.DESC")
# % gui, , demand,   CTL Setpoint Off,      FE14I-VA-PIRG-04:CTL:SETSPOFF,      =pv("FE14I-VA-PIRG-04:SPOFF.DESC")
# % gui, , demand,   RLY1 Setpoint On,      FE14I-VA-PIRG-04:RLY1:SETSP,        =pv("FE14I-VA-PIRG-04:RLY1:SP.DESC")
# % gui, , demand,   RLY1 Setpoint Off,     FE14I-VA-PIRG-04:RLY1:SETSPOFF,     =pv("FE14I-VA-PIRG-04:RLY1:SPOFF.DESC")
# % gui, , demand,   RLY2 Setpoint On,      FE14I-VA-PIRG-04:RLY2:SETSP,        =pv("FE14I-VA-PIRG-04:RLY2:SP.DESC")
# % gui, , demand,   RLY2 Setpoint Off,     FE14I-VA-PIRG-04:RLY2:SETSPOFF,     =pv("FE14I-VA-PIRG-04:RLY2:SPOFF.DESC")
# % gui, , readback, RLY1 Mode,             FE14I-VA-PIRG-04:RLY1:MODE,         =concat(pv("FE14I-VA-PIRG-04:RLY1:SP.DESC")," Mode")
# % gui, , readback, RLY1 Direction,        FE14I-VA-PIRG-04:RLY1:DIR,          =concat(pv("FE14I-VA-PIRG-04:RLY1:SP.DESC")," Dir")
# % gui, , readback, RLY2 Mode,             FE14I-VA-PIRG-04:RLY2:MODE,         =concat(pv("FE14I-VA-PIRG-04:RLY2:SP.DESC")," Mode")
# % gui, , readback, RLY2 Direction,        FE14I-VA-PIRG-04:RLY2:DIR,          =concat(pv("FE14I-VA-PIRG-04:RLY2:SP.DESC")," Dir")
# % gui, , enum,     RLY1 Mode,             FE14I-VA-PIRG-04:RLY1:SETMODE,      =concat(pv("FE14I-VA-PIRG-04:RLY1:SP.DESC")," Mode")
# % gui, , enum,     RLY1 Direction,        FE14I-VA-PIRG-04:RLY1:SETDIR,       =concat(pv("FE14I-VA-PIRG-04:RLY1:SP.DESC")," Dir")
# % gui, , enum,     RLY2 Mode,             FE14I-VA-PIRG-04:RLY2:SETMODE,      =concat(pv("FE14I-VA-PIRG-04:RLY2:SP.DESC")," Mode")
# % gui, , enum,     RLY2 Direction,        FE14I-VA-PIRG-04:RLY2:SETDIR,       =concat(pv("FE14I-VA-PIRG-04:RLY2:SP.DESC")," Dir")

# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-PIRG-04:STA") {
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,5,FE14I-VA-PIRG-04) ts1_3")
#  field(SCAN, "1 second")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-PIRG-04:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
# 
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-PIRG-04:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,5,FE14I-VA-PIRG-04) ts1_3")
  field(FLNK, "FE14I-VA-PIRG-04:PLOG")
  field(EGU, "mbar")
  field(PREC, "3")
  field(HOPR, "1000")
  field(LOPR, "0.001")
  field(SDIS, "FE14I-VA-PIRG-04:PDIS")
  field(DISS, "INVALID")
}

record(calcout, "FE14I-VA-PIRG-04:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-PIRG-04:P.ADEL")
  field(INPA, "FE14I-VA-PIRG-04:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-PIRG-04:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-PIRG-04:P MS")
  field(HOPR, "3")
  field(LOPR, "-3")
  field(ADEL, "0.025")
  field(FLNK, "FE14I-VA-PIRG-04:PSEQ")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-PIRG-04:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-PIRG-04:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-PIRG-04:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-PIRG-04:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-PIRG-04:STA PP")
}


record(calc, "FE14I-VA-PIRG-04:PDIS") 
{
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-PIRG-04:STA")
  field(FLNK, "FE14I-VA-PIRG-04:P")
}

record(mbbo, "FE14I-VA-PIRG-04:ENABLE") {
  field(DESC, "Enable Pirani power")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol pirgenable(001,5) ts1_3")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-04:ISENABLED")
}

record(mbbi, "FE14I-VA-PIRG-04:ISENABLED") {
  field(DESC, "Pirani power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_gauge_enabled(001,5) ts1_3")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bi, "FE14I-VA-PIRG-04:OFFWARN")
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bPirg.db
#% macro, __doc__, Template database for a pirani guage connected to
# one channel of an mks937b Multi-Sensor System
# A note on the optional macros: they default to an appropriate hard-coded
# value if no value is passed for expansion.
# They are provided to allow the default set points to be changed.
# Once the set point needs to be changed it may be necessary to alter 
# various other fields defining the range of allowed values.
# For the majority of applications the defaults should be used.  The levels
# should only be changed at the request of the vacuum group for non-standard
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, channel, MKS 937A channel number (1-4)
#% macro, address, Controller address (001 .. 253)
#% macro, name,        Object name, and gui association name
#% macro, offwarn,     Flag to display a warning that switching off the PIRG could trip the beam#

################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bPirg.edl, device=FE14I-VA-PIRG-05

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/pirg_detail.opi, device=FE14I-VA-PIRG-05, desc=FE14I-VA-PIRG-05, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed_box.opi, device=FE14I-VA-PIRG-05, desc=FE14I-VA-PIRG-05, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed.opi, device=FE14I-VA-PIRG-05, desc=FE14I-VA-PIRG-05, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,              FE14I-VA-PIRG-05:P
# % gui, , readback, Status,                FE14I-VA-PIRG-05:STA
# % gui, , readback, Gauge Setpoint Write,  FE14I-VA-PIRG-05:ILKSETSP:NOWRITE
# % gui, , readback, CTL Setpoint Summary,  FE14I-VA-PIRG-05:CTL:SP,            =pv("FE14I-VA-PIRG-05:CTL:SP.DESC")
# % gui, , readback, RLY1 Setpoint Summary, FE14I-VA-PIRG-05:RLY1:SP,           =pv("FE14I-VA-PIRG-05:RLY1:SP.DESC")
# % gui, , readback, RLY2 Setpoint Summary, FE14I-VA-PIRG-05:RLY2:SP,           =pv("FE14I-VA-PIRG-05:RLY2:SP.DESC")
# % gui, , enum,     PirgFilament,          FE14I-VA-PIRG-05:ENABLE
# % gui, , readback, CTL Setpoint On,       FE14I-VA-PIRG-05:CTL:SP,            =pv("FE14I-VA-PIRG-05:CTL:SP.DESC")
# % gui, , readback, CTL Setpoint Off,      FE14I-VA-PIRG-05:CTL:HYST,          =pv("FE14I-VA-PIRG-05:CTL:SETSPOFF.DESC")
# % gui, , readback, RLY1 Setpoint On,      FE14I-VA-PIRG-05:RLY1:SP,           =pv("FE14I-VA-PIRG-05:RLY1:SP.DESC")
# % gui, , readback, RLY1 Setpoint Off,     FE14I-VA-PIRG-05:RLY1:SPOFF,        =pv("FE14I-VA-PIRG-05:RLY1:SPOFF.DESC")
# % gui, , readback, RLY2 Setpoint On,      FE14I-VA-PIRG-05:RLY2:SP,           =pv("FE14I-VA-PIRG-05:RLY2:SP.DESC")
# % gui, , readback, RLY2 Setpoint Off,     FE14I-VA-PIRG-05:RLY2:SPOFF,        =pv("FE14I-VA-PIRG-05:RLY2:SPOFF.DESC")
# % gui, , demand,   CTL Setpoint On,       FE14I-VA-PIRG-05:CTL:SETSP,         =pv("FE14I-VA-PIRG-05:SP.DESC")
# % gui, , demand,   CTL Setpoint Off,      FE14I-VA-PIRG-05:CTL:SETSPOFF,      =pv("FE14I-VA-PIRG-05:SPOFF.DESC")
# % gui, , demand,   RLY1 Setpoint On,      FE14I-VA-PIRG-05:RLY1:SETSP,        =pv("FE14I-VA-PIRG-05:RLY1:SP.DESC")
# % gui, , demand,   RLY1 Setpoint Off,     FE14I-VA-PIRG-05:RLY1:SETSPOFF,     =pv("FE14I-VA-PIRG-05:RLY1:SPOFF.DESC")
# % gui, , demand,   RLY2 Setpoint On,      FE14I-VA-PIRG-05:RLY2:SETSP,        =pv("FE14I-VA-PIRG-05:RLY2:SP.DESC")
# % gui, , demand,   RLY2 Setpoint Off,     FE14I-VA-PIRG-05:RLY2:SETSPOFF,     =pv("FE14I-VA-PIRG-05:RLY2:SPOFF.DESC")
# % gui, , readback, RLY1 Mode,             FE14I-VA-PIRG-05:RLY1:MODE,         =concat(pv("FE14I-VA-PIRG-05:RLY1:SP.DESC")," Mode")
# % gui, , readback, RLY1 Direction,        FE14I-VA-PIRG-05:RLY1:DIR,          =concat(pv("FE14I-VA-PIRG-05:RLY1:SP.DESC")," Dir")
# % gui, , readback, RLY2 Mode,             FE14I-VA-PIRG-05:RLY2:MODE,         =concat(pv("FE14I-VA-PIRG-05:RLY2:SP.DESC")," Mode")
# % gui, , readback, RLY2 Direction,        FE14I-VA-PIRG-05:RLY2:DIR,          =concat(pv("FE14I-VA-PIRG-05:RLY2:SP.DESC")," Dir")
# % gui, , enum,     RLY1 Mode,             FE14I-VA-PIRG-05:RLY1:SETMODE,      =concat(pv("FE14I-VA-PIRG-05:RLY1:SP.DESC")," Mode")
# % gui, , enum,     RLY1 Direction,        FE14I-VA-PIRG-05:RLY1:SETDIR,       =concat(pv("FE14I-VA-PIRG-05:RLY1:SP.DESC")," Dir")
# % gui, , enum,     RLY2 Mode,             FE14I-VA-PIRG-05:RLY2:SETMODE,      =concat(pv("FE14I-VA-PIRG-05:RLY2:SP.DESC")," Mode")
# % gui, , enum,     RLY2 Direction,        FE14I-VA-PIRG-05:RLY2:SETDIR,       =concat(pv("FE14I-VA-PIRG-05:RLY2:SP.DESC")," Dir")

# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-PIRG-05:STA") {
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,6,FE14I-VA-PIRG-05) ts1_2")
#  field(SCAN, "1 second")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-PIRG-05:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
# 
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-PIRG-05:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,6,FE14I-VA-PIRG-05) ts1_2")
  field(FLNK, "FE14I-VA-PIRG-05:PLOG")
  field(EGU, "mbar")
  field(PREC, "3")
  field(HOPR, "1000")
  field(LOPR, "0.001")
  field(SDIS, "FE14I-VA-PIRG-05:PDIS")
  field(DISS, "INVALID")
}

record(calcout, "FE14I-VA-PIRG-05:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-PIRG-05:P.ADEL")
  field(INPA, "FE14I-VA-PIRG-05:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-PIRG-05:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-PIRG-05:P MS")
  field(HOPR, "3")
  field(LOPR, "-3")
  field(ADEL, "0.025")
  field(FLNK, "FE14I-VA-PIRG-05:PSEQ")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-PIRG-05:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-PIRG-05:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-PIRG-05:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-PIRG-05:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-PIRG-05:STA PP")
}


record(calc, "FE14I-VA-PIRG-05:PDIS") 
{
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-PIRG-05:STA")
  field(FLNK, "FE14I-VA-PIRG-05:P")
}

record(mbbo, "FE14I-VA-PIRG-05:ENABLE") {
  field(DESC, "Enable Pirani power")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol pirgenable(001,6) ts1_2")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-05:ISENABLED")
}

record(mbbi, "FE14I-VA-PIRG-05:ISENABLED") {
  field(DESC, "Pirani power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_gauge_enabled(001,6) ts1_2")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bi, "FE14I-VA-PIRG-05:OFFWARN")
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}#! Generated by VisualDCT v2.5
#! DBDSTART
#! DBDEND


# mks937bPirg.db
#% macro, __doc__, Template database for a pirani guage connected to
# one channel of an mks937b Multi-Sensor System
# A note on the optional macros: they default to an appropriate hard-coded
# value if no value is passed for expansion.
# They are provided to allow the default set points to be changed.
# Once the set point needs to be changed it may be necessary to alter 
# various other fields defining the range of allowed values.
# For the majority of applications the defaults should be used.  The levels
# should only be changed at the request of the vacuum group for non-standard
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, channel, MKS 937A channel number (1-4)
#% macro, address, Controller address (001 .. 253)
#% macro, name,        Object name, and gui association name
#% macro, offwarn,     Flag to display a warning that switching off the PIRG could trip the beam#

################################################################################

# This associates an edm screen with the template
# % gui, , edm, mks937bPirg.edl, device=FE14I-VA-PIRG-06

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/pirg_detail.opi, device=FE14I-VA-PIRG-06, desc=FE14I-VA-PIRG-06, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed_box.opi, device=FE14I-VA-PIRG-06, desc=FE14I-VA-PIRG-06, name=
# % gui, , boyembed, mks937bApp_opi/pirg_embed.opi, device=FE14I-VA-PIRG-06, desc=FE14I-VA-PIRG-06, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,              FE14I-VA-PIRG-06:P
# % gui, , readback, Status,                FE14I-VA-PIRG-06:STA
# % gui, , readback, Gauge Setpoint Write,  FE14I-VA-PIRG-06:ILKSETSP:NOWRITE
# % gui, , readback, CTL Setpoint Summary,  FE14I-VA-PIRG-06:CTL:SP,            =pv("FE14I-VA-PIRG-06:CTL:SP.DESC")
# % gui, , readback, RLY1 Setpoint Summary, FE14I-VA-PIRG-06:RLY1:SP,           =pv("FE14I-VA-PIRG-06:RLY1:SP.DESC")
# % gui, , readback, RLY2 Setpoint Summary, FE14I-VA-PIRG-06:RLY2:SP,           =pv("FE14I-VA-PIRG-06:RLY2:SP.DESC")
# % gui, , enum,     PirgFilament,          FE14I-VA-PIRG-06:ENABLE
# % gui, , readback, CTL Setpoint On,       FE14I-VA-PIRG-06:CTL:SP,            =pv("FE14I-VA-PIRG-06:CTL:SP.DESC")
# % gui, , readback, CTL Setpoint Off,      FE14I-VA-PIRG-06:CTL:HYST,          =pv("FE14I-VA-PIRG-06:CTL:SETSPOFF.DESC")
# % gui, , readback, RLY1 Setpoint On,      FE14I-VA-PIRG-06:RLY1:SP,           =pv("FE14I-VA-PIRG-06:RLY1:SP.DESC")
# % gui, , readback, RLY1 Setpoint Off,     FE14I-VA-PIRG-06:RLY1:SPOFF,        =pv("FE14I-VA-PIRG-06:RLY1:SPOFF.DESC")
# % gui, , readback, RLY2 Setpoint On,      FE14I-VA-PIRG-06:RLY2:SP,           =pv("FE14I-VA-PIRG-06:RLY2:SP.DESC")
# % gui, , readback, RLY2 Setpoint Off,     FE14I-VA-PIRG-06:RLY2:SPOFF,        =pv("FE14I-VA-PIRG-06:RLY2:SPOFF.DESC")
# % gui, , demand,   CTL Setpoint On,       FE14I-VA-PIRG-06:CTL:SETSP,         =pv("FE14I-VA-PIRG-06:SP.DESC")
# % gui, , demand,   CTL Setpoint Off,      FE14I-VA-PIRG-06:CTL:SETSPOFF,      =pv("FE14I-VA-PIRG-06:SPOFF.DESC")
# % gui, , demand,   RLY1 Setpoint On,      FE14I-VA-PIRG-06:RLY1:SETSP,        =pv("FE14I-VA-PIRG-06:RLY1:SP.DESC")
# % gui, , demand,   RLY1 Setpoint Off,     FE14I-VA-PIRG-06:RLY1:SETSPOFF,     =pv("FE14I-VA-PIRG-06:RLY1:SPOFF.DESC")
# % gui, , demand,   RLY2 Setpoint On,      FE14I-VA-PIRG-06:RLY2:SETSP,        =pv("FE14I-VA-PIRG-06:RLY2:SP.DESC")
# % gui, , demand,   RLY2 Setpoint Off,     FE14I-VA-PIRG-06:RLY2:SETSPOFF,     =pv("FE14I-VA-PIRG-06:RLY2:SPOFF.DESC")
# % gui, , readback, RLY1 Mode,             FE14I-VA-PIRG-06:RLY1:MODE,         =concat(pv("FE14I-VA-PIRG-06:RLY1:SP.DESC")," Mode")
# % gui, , readback, RLY1 Direction,        FE14I-VA-PIRG-06:RLY1:DIR,          =concat(pv("FE14I-VA-PIRG-06:RLY1:SP.DESC")," Dir")
# % gui, , readback, RLY2 Mode,             FE14I-VA-PIRG-06:RLY2:MODE,         =concat(pv("FE14I-VA-PIRG-06:RLY2:SP.DESC")," Mode")
# % gui, , readback, RLY2 Direction,        FE14I-VA-PIRG-06:RLY2:DIR,          =concat(pv("FE14I-VA-PIRG-06:RLY2:SP.DESC")," Dir")
# % gui, , enum,     RLY1 Mode,             FE14I-VA-PIRG-06:RLY1:SETMODE,      =concat(pv("FE14I-VA-PIRG-06:RLY1:SP.DESC")," Mode")
# % gui, , enum,     RLY1 Direction,        FE14I-VA-PIRG-06:RLY1:SETDIR,       =concat(pv("FE14I-VA-PIRG-06:RLY1:SP.DESC")," Dir")
# % gui, , enum,     RLY2 Mode,             FE14I-VA-PIRG-06:RLY2:SETMODE,      =concat(pv("FE14I-VA-PIRG-06:RLY2:SP.DESC")," Mode")
# % gui, , enum,     RLY2 Direction,        FE14I-VA-PIRG-06:RLY2:SETDIR,       =concat(pv("FE14I-VA-PIRG-06:RLY2:SP.DESC")," Dir")

# Status
#
#% archiver 10 Monitor
#% controldesk Pressure smon
#
record(mbbi, "FE14I-VA-PIRG-06:STA") {
  field(DTYP, "Soft Channel")
#  field(DTYP, "stream")
#  field(INP, "@mks937b.protocol status(001,6,FE14I-VA-PIRG-06) ts1_3")
#  field(SCAN, "1 second")
  field(DESC, "Status")
#  field(FLNK, "FE14I-VA-PIRG-06:PDIS")
  field(ZRST, "OK")
  field(ONST, "OK")
  field(TWST, "Above Range")
  field(THST, "At Atmosphere")
  field(FRST, "Low Emission")
  field(FVST, "Filament Off")
  field(SXST, "HV Off")
  field(SVST, "Startup Delay")
  field(EIST, "Below Range")
  field(NIST, "Controlled")
  field(TEST, "Protected State")
  field(ELST, "No Gauge")
  field(TVST, "Not Connected")
  field(TTST, "Wrong Gauge")
  field(FTST, "Bad Command")
  field(FFST, "Locked Out")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "MINOR")
  field(THSV, "MINOR")
  field(FRSV, "MAJOR")
  field(FVSV, "MAJOR")
  field(SXSV, "MAJOR")
  field(SVSV, "MINOR")
  field(EISV, "NO_ALARM")
  field(NISV, "MINOR")
  field(TESV, "MINOR")
  field(ELSV, "MAJOR")
  field(TVSV, "MAJOR")
  field(TTSV, "MAJOR")
  field(FTSV, "MAJOR")
  field(FFSV, "MAJOR")
}

#############################################################################
# Pressure
# 
# % archiver 1 Monitor
# % controldesk Pressure readback
record(ai, "FE14I-VA-PIRG-06:P") 
{
  field(DESC, "Pressure")
  field(DTYP, "stream")
  field(SCAN, "1 second")
  field(INP, "@mks937b.protocol pressure(001,6,FE14I-VA-PIRG-06) ts1_3")
  field(FLNK, "FE14I-VA-PIRG-06:PLOG")
  field(EGU, "mbar")
  field(PREC, "3")
  field(HOPR, "1000")
  field(LOPR, "0.001")
  field(SDIS, "FE14I-VA-PIRG-06:PDIS")
  field(DISS, "INVALID")
}

record(calcout, "FE14I-VA-PIRG-06:ADEL") 
{
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-PIRG-06:P.ADEL")
  field(INPA, "FE14I-VA-PIRG-06:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-PIRG-06:PLOG") 
{
  field(DESC, "log Pressure")
  field(EGU, "log")
  field(CALC, "LOG(A)")
  field(INPA, "FE14I-VA-PIRG-06:P MS")
  field(HOPR, "3")
  field(LOPR, "-3")
  field(ADEL, "0.025")
  field(FLNK, "FE14I-VA-PIRG-06:PSEQ")
}

#
# Determine if P is a valid pressure
# if so we can set STA to OK
#
record(calc, "FE14I-VA-PIRG-06:GOODP") 
{
  field(DESC, "Valid pressure calc")
  field(INPA, "FE14I-VA-PIRG-06:P.SEVR")
  field(CALC, "(A>0)?0:1")
}
record(seq, "FE14I-VA-PIRG-06:PSEQ") 
{
  field(DESC, "Seq Pressure & Status")
  field(SELM, "Specified")
  field(SELL, "FE14I-VA-PIRG-06:GOODP PP")
  field(DOL1, "1")
  field(LNK1, "FE14I-VA-PIRG-06:STA PP")
}


record(calc, "FE14I-VA-PIRG-06:PDIS") 
{
  field(PHAS, "1")
  field(CALC, "(A>1)?1:0")
  field(INPA, "FE14I-VA-PIRG-06:STA")
  field(FLNK, "FE14I-VA-PIRG-06:P")
}

record(mbbo, "FE14I-VA-PIRG-06:ENABLE") {
  field(DESC, "Enable Pirani power")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol pirgenable(001,6) ts1_3")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(DOL, "1")
  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-06:ISENABLED")
}

record(mbbi, "FE14I-VA-PIRG-06:ISENABLED") {
  field(DESC, "Pirani power")
  field(DTYP, "stream")
  field(INP,  "@mks937b.protocol get_gauge_enabled(001,6) ts1_3")
  field(ZRST, "Off")
  field(ONST, "On")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(PINI, "YES")
}

record(bi, "FE14I-VA-PIRG-06:OFFWARN")
{
  field(DESC, "Warning for OFF button")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Warning off")
  field(ONAM, "Warning on")
}# mks937bGauge.template
#
#% macro, __doc__, Template database for a combination gauge connected to 
# two channels of an MKS937B Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# Run on PHAS 1 to get most up to date values from IMG and Pirani
# 
# required substitutions:
#% macro, dom,          Domain 5 char string (e.g. BL11I)
#% macro, id,           ID number as 2 digit string (e.g. 01)
#% macro, plog_adc_pv,  Link to ADC record - the ADC records need instantiating
#                       in the application from either the ethercat support module templates
#                       or (if using Hy8401 VME IP) mks937bHy8401.template
#
# gui substitutions:
#% macro, name,        The device's name for gui purposes
#% macro, GCTLR,       The gauge controller PV prefix, for gui purposes
#
# optional substitutions:
#% macro, ctlsp_level, The desired control setpoint value (actually for the Pirg).
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records. 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records. 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records. 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_desc,  The DESC field on control setpoint records. 
#                      (appears as a label on the Pirg EDM screen).
#% macro, ctlspoff_desc,  The DESC field on control setpoint off records. 
#                      (appears as a label on the Pirg CSS screen).
#
# GCTLR used for the controller button
# % gui, , edm, mks937bGauge.edl, dom=FE14I, id=01, GCTLR=

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/gauge_detail.opi, dom=FE14I, id=01, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed_box.opi, dom=FE14I, id=01, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed.opi, dom=FE14I, id=01, GCTLR=, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,   FE14I-VA-GAUGE-01:P
# % gui, , readback, Gauge,  FE14I-VA-GAUGE-01:GAUGE
# % gui, , enum, Setpoints Overwrite,  FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE

# Force processing of slow PP records 
record(fanout, "FE14I-VA-GAUGE-01:FAN10S")
{
    field(DESC, "10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-01:CTL:SP")
    field(LNK2, "FE14I-VA-PIRG-01:CTL:HYST")
    field(SELM, "All")
}


################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(calc, "FE14I-VA-GAUGE-01:SEL") {
  field(DESC, "Select Pressure")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(FLNK, "FE14I-VA-GAUGE-01:GAUGE PP")
  field(CALC, "A<2?0:(B<2?1:(B=8?1:2))")
  field(INPA, "FE14I-VA-IMG-01:STA")
  field(INPB, "FE14I-VA-PIRG-01:STA")
}

record(mbbi, "FE14I-VA-GAUGE-01:GAUGE") {
  field(DESC, "Active Gauge")
  field(INP, "FE14I-VA-GAUGE-01:SEL")
  field(FLNK, "FE14I-VA-GAUGE-01:P")
  field(ZRST, "IMG")
  field(ONST, "Pirani")
  field(TWST, "No Gauge")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "MINOR")
  field(TWSV, "MAJOR")
}

################################################################################
# Pressure
#
#% archiver 0.1 Monitor
#
# CALC: ADC is 16bit representing -10 to +10 V. We only use 0 to 10V from gauge controller.
#       Divide A by 32767 (positive range used) to give fraction of 10V range.
#       Multiply result by 10 to give true input voltage.
#       From MKS937 Operation Manual, log(p)  = (V-B)/A, where B = 7.2 volts and A = 0.6
#       log(p) = (V/0.6) - (7.2/0.6) = (V/0.6) - 12.0
#
record(calc, "FE14I-VA-GAUGE-01:PLOG")
	{
  	field(DESC, "log Pressure")
  	field(INPA, "FE14I-CS-ADC-02:ADC1_VALUE PP MS")
  	field(EGU, "log")
  	field(CALC, "((10.0*(A/32767.0))/0.6) - 12.0")
  	field(HOPR, "3")
  	field(LOPR, "-11")
  	field(HIGH, "-7")
  	field(HSV, "MINOR")
  	field(ADEL, "0.025")
	}

#
#% controldesk Pressure readback
#% archiver 0.1 Monitor
#
record(calc, "FE14I-VA-GAUGE-01:P") {
  field(DESC, "Pressure")
  field(EGU, "mbar")
  field(PREC, "11")
  field(CALC, "10^A")
  field(INPA, "FE14I-VA-GAUGE-01:PLOG PP MS")
  field(SCAN, ".1 second")
  field(HOPR, "1000")
  field(LOPR, "1.0E-11")
}

record(calcout, "FE14I-VA-GAUGE-01:ADEL") {
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-GAUGE-01:P.ADEL")
  field(INPA, "FE14I-VA-GAUGE-01:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#

record(mbbo, "FE14I-VA-IMG-01:CTL:SETMODE") {
  alias("FE14I-VA-PIRG-01:CTL:ENABLE")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-01:CTL:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-01:CTL:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-01:CTL:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-01:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-01:CTL:SETSP")
    field(LNK3, "FE14I-VA-PIRG-01:CTL:INITSETSPSDIS")
    field(SELM, "All")
}


#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-01:CTL:SETSP") 
{
  field(DESC, "IMG Enable")
  field(FLNK, "FE14I-VA-IMG-01:CTL:OUTSP.PROC")
  field(OUT, "FE14I-VA-IMG-01:CTL:OUTSP")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(SDIS, "FE14I-VA-PIRG-01:ILKSETSP:NOWRITE PP")
  #field(PINI, "YES")
  field(DOL, "1.0e-2")
}

#
#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-01:CTL:SETSPOFF") 
{
  field(DESC, "IMG Enable Off")
  field(FLNK, "FE14I-VA-IMG-01:CTL:SETHYST.PROC")
  field(OUT, "FE14I-VA-IMG-01:CTL:SETHYST")
  field(EGU, "mbar")
  field(PREC, "1")
  field(SDIS, "FE14I-VA-PIRG-01:ILKSETSP:NOWRITE")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
}


#
#% archiver 10 Monitor
#% controldesk IMG Enable readback
#
record(ai, "FE14I-VA-PIRG-01:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(INP, "FE14I-VA-IMG-01:CTL:SP MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

#% archiver 10 Monitor
#% controldesk IMG Enable hysteresis readback
#
record(ai, "FE14I-VA-PIRG-01:CTL:HYST") 
{
  field(DESC, "IMG Enable Off")
  field(INP, "FE14I-VA-IMG-01:CTL:HYST MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-PIRG-01:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-01:CTL:HYST PP")
  field(LNK1, "FE14I-VA-PIRG-01:CTL:SETSPOFF.VAL PP")
}

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
# This is essentially a copy of the global record be but in the domain
# of the PIRG instance, so available to EDM screen.
#
record(bi, "FE14I-VA-PIRG-01:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# NB: INP had to be removed to allow autosave to correctly restore.
#
#% autosave 0 VAL
record(bi, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  #field(INP, "0")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  

#! Further lines contain data used by VisualDCT
#! View(0,0,1.0)
#! Record("FE14I-VA-GAUGE-01:SEL",20,46,0,0,"FE14I-VA-GAUGE-01:SEL")
#! Field("FE14I-VA-GAUGE-01:SEL.FLNK",16777215,1,"FE14I-VA-GAUGE-01:SEL.FLNK")
#! Link("FE14I-VA-GAUGE-01:SEL.FLNK","FE14I-VA-GAUGE-01:GAUGE")
#! Field("FE14I-VA-GAUGE-01:SEL.INPA",16777215,1,"FE14I-VA-GAUGE-01:SEL.INPA")
#! Field("FE14I-VA-GAUGE-01:SEL.INPB",16777215,1,"FE14I-VA-GAUGE-01:SEL.INPB")
#! Field("FE14I-VA-GAUGE-01:SEL.VAL",16777215,1,"FE14I-VA-GAUGE-01:SEL.VAL")
#! Record("FE14I-VA-GAUGE-01:GAUGE",300,65,0,0,"FE14I-VA-GAUGE-01:GAUGE")
#! Field("FE14I-VA-GAUGE-01:GAUGE.INP",16777215,0,"FE14I-VA-GAUGE-01:GAUGE.INP")
#! Link("FE14I-VA-GAUGE-01:GAUGE.INP","FE14I-VA-GAUGE-01:SEL.VAL")
#! Field("FE14I-VA-GAUGE-01:GAUGE.FLNK",16777215,1,"FE14I-VA-GAUGE-01:GAUGE.FLNK")
#! Link("FE14I-VA-GAUGE-01:GAUGE.FLNK","FE14I-VA-GAUGE-01:P")
#! Record("FE14I-VA-GAUGE-01:PLOG",500,17,0,0,"FE14I-VA-GAUGE-01:PLOG")
#! Field("FE14I-VA-GAUGE-01:PLOG.VAL",16777215,1,"FE14I-VA-GAUGE-01:PLOG.VAL")
#! Record("FE14I-VA-GAUGE-01:P",780,212,0,0,"FE14I-VA-GAUGE-01:P")
#! Field("FE14I-VA-GAUGE-01:P.INPA",16777215,0,"FE14I-VA-GAUGE-01:P.INPA")
#! Link("FE14I-VA-GAUGE-01:P.INPA","FE14I-VA-GAUGE-01:PLOG.VAL")
#! Field("FE14I-VA-GAUGE-01:P.ADEL",16777215,1,"FE14I-VA-GAUGE-01:P.ADEL")
#! Field("FE14I-VA-GAUGE-01:P.VAL",16777215,1,"FE14I-VA-GAUGE-01:P.VAL")
#! Record("FE14I-VA-GAUGE-01:ADEL",1060,260,0,0,"FE14I-VA-GAUGE-01:ADEL")
#! Field("FE14I-VA-GAUGE-01:ADEL.OUT",16777215,0,"FE14I-VA-GAUGE-01:ADEL.OUT")
#! Link("FE14I-VA-GAUGE-01:ADEL.OUT","FE14I-VA-GAUGE-01:P.ADEL")
#! Field("FE14I-VA-GAUGE-01:ADEL.INPA",16777215,0,"FE14I-VA-GAUGE-01:ADEL.INPA")
#! Link("FE14I-VA-GAUGE-01:ADEL.INPA","FE14I-VA-GAUGE-01:P.VAL")
#! Record("FE14I-VA-PIRG-01:CTL:SETSP",20,345,0,0,"FE14I-VA-PIRG-01:CTL:SETSP")
#! Field("FE14I-VA-PIRG-01:CTL:SETSP.FLNK",16777215,1,"FE14I-VA-PIRG-01:CTL:SETSP.FLNK")
#! Field("FE14I-VA-PIRG-01:CTL:SETSP.OUT",16777215,1,"FE14I-VA-PIRG-01:CTL:SETSP.OUT")
#! Record("FE14I-VA-PIRG-01:CTL:ENABLE",380,331,0,0,"FE14I-VA-PIRG-01:CTL:ENABLE")
#! Field("FE14I-VA-PIRG-01:CTL:ENABLE.FLNK",16777215,1,"FE14I-VA-PIRG-01:CTL:ENABLE.FLNK")
#! Field("FE14I-VA-PIRG-01:CTL:ENABLE.OUT",16777215,1,"FE14I-VA-PIRG-01:CTL:ENABLE.OUT")
#! Record("FE14I-VA-PIRG-01:CTL:SP",200,352,0,0,"FE14I-VA-PIRG-01:CTL:SP")
#! Field("FE14I-VA-PIRG-01:CTL:SP.INP",16777215,1,"FE14I-VA-PIRG-01:CTL:SP.INP")
# mks937bGauge.template
#
#% macro, __doc__, Template database for a combination gauge connected to 
# two channels of an MKS937B Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# Run on PHAS 1 to get most up to date values from IMG and Pirani
# 
# required substitutions:
#% macro, dom,          Domain 5 char string (e.g. BL11I)
#% macro, id,           ID number as 2 digit string (e.g. 01)
#% macro, plog_adc_pv,  Link to ADC record - the ADC records need instantiating
#                       in the application from either the ethercat support module templates
#                       or (if using Hy8401 VME IP) mks937bHy8401.template
#
# gui substitutions:
#% macro, name,        The device's name for gui purposes
#% macro, GCTLR,       The gauge controller PV prefix, for gui purposes
#
# optional substitutions:
#% macro, ctlsp_level, The desired control setpoint value (actually for the Pirg).
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records. 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records. 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records. 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_desc,  The DESC field on control setpoint records. 
#                      (appears as a label on the Pirg EDM screen).
#% macro, ctlspoff_desc,  The DESC field on control setpoint off records. 
#                      (appears as a label on the Pirg CSS screen).
#
# GCTLR used for the controller button
# % gui, , edm, mks937bGauge.edl, dom=FE14I, id=02, GCTLR=

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/gauge_detail.opi, dom=FE14I, id=02, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed_box.opi, dom=FE14I, id=02, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed.opi, dom=FE14I, id=02, GCTLR=, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,   FE14I-VA-GAUGE-02:P
# % gui, , readback, Gauge,  FE14I-VA-GAUGE-02:GAUGE
# % gui, , enum, Setpoints Overwrite,  FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE

# Force processing of slow PP records 
record(fanout, "FE14I-VA-GAUGE-02:FAN10S")
{
    field(DESC, "10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-02:CTL:SP")
    field(LNK2, "FE14I-VA-PIRG-02:CTL:HYST")
    field(SELM, "All")
}


################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(calc, "FE14I-VA-GAUGE-02:SEL") {
  field(DESC, "Select Pressure")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(FLNK, "FE14I-VA-GAUGE-02:GAUGE PP")
  field(CALC, "A<2?0:(B<2?1:(B=8?1:2))")
  field(INPA, "FE14I-VA-IMG-02:STA")
  field(INPB, "FE14I-VA-PIRG-02:STA")
}

record(mbbi, "FE14I-VA-GAUGE-02:GAUGE") {
  field(DESC, "Active Gauge")
  field(INP, "FE14I-VA-GAUGE-02:SEL")
  field(FLNK, "FE14I-VA-GAUGE-02:P")
  field(ZRST, "IMG")
  field(ONST, "Pirani")
  field(TWST, "No Gauge")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "MINOR")
  field(TWSV, "MAJOR")
}

################################################################################
# Pressure
#
#% archiver 0.1 Monitor
#
# CALC: ADC is 16bit representing -10 to +10 V. We only use 0 to 10V from gauge controller.
#       Divide A by 32767 (positive range used) to give fraction of 10V range.
#       Multiply result by 10 to give true input voltage.
#       From MKS937 Operation Manual, log(p)  = (V-B)/A, where B = 7.2 volts and A = 0.6
#       log(p) = (V/0.6) - (7.2/0.6) = (V/0.6) - 12.0
#
record(calc, "FE14I-VA-GAUGE-02:PLOG")
	{
  	field(DESC, "log Pressure")
  	field(INPA, "FE14I-CS-ADC-02:ADC2_VALUE PP MS")
  	field(EGU, "log")
  	field(CALC, "((10.0*(A/32767.0))/0.6) - 12.0")
  	field(HOPR, "3")
  	field(LOPR, "-11")
  	field(HIGH, "-7")
  	field(HSV, "MINOR")
  	field(ADEL, "0.025")
	}

#
#% controldesk Pressure readback
#% archiver 0.1 Monitor
#
record(calc, "FE14I-VA-GAUGE-02:P") {
  field(DESC, "Pressure")
  field(EGU, "mbar")
  field(PREC, "11")
  field(CALC, "10^A")
  field(INPA, "FE14I-VA-GAUGE-02:PLOG PP MS")
  field(SCAN, ".1 second")
  field(HOPR, "1000")
  field(LOPR, "1.0E-11")
}

record(calcout, "FE14I-VA-GAUGE-02:ADEL") {
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-GAUGE-02:P.ADEL")
  field(INPA, "FE14I-VA-GAUGE-02:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#

record(mbbo, "FE14I-VA-IMG-02:CTL:SETMODE") {
  alias("FE14I-VA-PIRG-02:CTL:ENABLE")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-02:CTL:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-02:CTL:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-02:CTL:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-02:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-02:CTL:SETSP")
    field(LNK3, "FE14I-VA-PIRG-02:CTL:INITSETSPSDIS")
    field(SELM, "All")
}


#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-02:CTL:SETSP") 
{
  field(DESC, "IMG Enable")
  field(FLNK, "FE14I-VA-IMG-02:CTL:OUTSP.PROC")
  field(OUT, "FE14I-VA-IMG-02:CTL:OUTSP")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(SDIS, "FE14I-VA-PIRG-02:ILKSETSP:NOWRITE PP")
  #field(PINI, "YES")
  field(DOL, "1.0e-2")
}

#
#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-02:CTL:SETSPOFF") 
{
  field(DESC, "IMG Enable Off")
  field(FLNK, "FE14I-VA-IMG-02:CTL:SETHYST.PROC")
  field(OUT, "FE14I-VA-IMG-02:CTL:SETHYST")
  field(EGU, "mbar")
  field(PREC, "1")
  field(SDIS, "FE14I-VA-PIRG-02:ILKSETSP:NOWRITE")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
}


#
#% archiver 10 Monitor
#% controldesk IMG Enable readback
#
record(ai, "FE14I-VA-PIRG-02:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(INP, "FE14I-VA-IMG-02:CTL:SP MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

#% archiver 10 Monitor
#% controldesk IMG Enable hysteresis readback
#
record(ai, "FE14I-VA-PIRG-02:CTL:HYST") 
{
  field(DESC, "IMG Enable Off")
  field(INP, "FE14I-VA-IMG-02:CTL:HYST MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-PIRG-02:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-02:CTL:HYST PP")
  field(LNK1, "FE14I-VA-PIRG-02:CTL:SETSPOFF.VAL PP")
}

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
# This is essentially a copy of the global record be but in the domain
# of the PIRG instance, so available to EDM screen.
#
record(bi, "FE14I-VA-PIRG-02:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# NB: INP had to be removed to allow autosave to correctly restore.
#
#% autosave 0 VAL
record(bi, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  #field(INP, "0")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  

#! Further lines contain data used by VisualDCT
#! View(0,0,1.0)
#! Record("FE14I-VA-GAUGE-02:SEL",20,46,0,0,"FE14I-VA-GAUGE-02:SEL")
#! Field("FE14I-VA-GAUGE-02:SEL.FLNK",16777215,1,"FE14I-VA-GAUGE-02:SEL.FLNK")
#! Link("FE14I-VA-GAUGE-02:SEL.FLNK","FE14I-VA-GAUGE-02:GAUGE")
#! Field("FE14I-VA-GAUGE-02:SEL.INPA",16777215,1,"FE14I-VA-GAUGE-02:SEL.INPA")
#! Field("FE14I-VA-GAUGE-02:SEL.INPB",16777215,1,"FE14I-VA-GAUGE-02:SEL.INPB")
#! Field("FE14I-VA-GAUGE-02:SEL.VAL",16777215,1,"FE14I-VA-GAUGE-02:SEL.VAL")
#! Record("FE14I-VA-GAUGE-02:GAUGE",300,65,0,0,"FE14I-VA-GAUGE-02:GAUGE")
#! Field("FE14I-VA-GAUGE-02:GAUGE.INP",16777215,0,"FE14I-VA-GAUGE-02:GAUGE.INP")
#! Link("FE14I-VA-GAUGE-02:GAUGE.INP","FE14I-VA-GAUGE-02:SEL.VAL")
#! Field("FE14I-VA-GAUGE-02:GAUGE.FLNK",16777215,1,"FE14I-VA-GAUGE-02:GAUGE.FLNK")
#! Link("FE14I-VA-GAUGE-02:GAUGE.FLNK","FE14I-VA-GAUGE-02:P")
#! Record("FE14I-VA-GAUGE-02:PLOG",500,17,0,0,"FE14I-VA-GAUGE-02:PLOG")
#! Field("FE14I-VA-GAUGE-02:PLOG.VAL",16777215,1,"FE14I-VA-GAUGE-02:PLOG.VAL")
#! Record("FE14I-VA-GAUGE-02:P",780,212,0,0,"FE14I-VA-GAUGE-02:P")
#! Field("FE14I-VA-GAUGE-02:P.INPA",16777215,0,"FE14I-VA-GAUGE-02:P.INPA")
#! Link("FE14I-VA-GAUGE-02:P.INPA","FE14I-VA-GAUGE-02:PLOG.VAL")
#! Field("FE14I-VA-GAUGE-02:P.ADEL",16777215,1,"FE14I-VA-GAUGE-02:P.ADEL")
#! Field("FE14I-VA-GAUGE-02:P.VAL",16777215,1,"FE14I-VA-GAUGE-02:P.VAL")
#! Record("FE14I-VA-GAUGE-02:ADEL",1060,260,0,0,"FE14I-VA-GAUGE-02:ADEL")
#! Field("FE14I-VA-GAUGE-02:ADEL.OUT",16777215,0,"FE14I-VA-GAUGE-02:ADEL.OUT")
#! Link("FE14I-VA-GAUGE-02:ADEL.OUT","FE14I-VA-GAUGE-02:P.ADEL")
#! Field("FE14I-VA-GAUGE-02:ADEL.INPA",16777215,0,"FE14I-VA-GAUGE-02:ADEL.INPA")
#! Link("FE14I-VA-GAUGE-02:ADEL.INPA","FE14I-VA-GAUGE-02:P.VAL")
#! Record("FE14I-VA-PIRG-02:CTL:SETSP",20,345,0,0,"FE14I-VA-PIRG-02:CTL:SETSP")
#! Field("FE14I-VA-PIRG-02:CTL:SETSP.FLNK",16777215,1,"FE14I-VA-PIRG-02:CTL:SETSP.FLNK")
#! Field("FE14I-VA-PIRG-02:CTL:SETSP.OUT",16777215,1,"FE14I-VA-PIRG-02:CTL:SETSP.OUT")
#! Record("FE14I-VA-PIRG-02:CTL:ENABLE",380,331,0,0,"FE14I-VA-PIRG-02:CTL:ENABLE")
#! Field("FE14I-VA-PIRG-02:CTL:ENABLE.FLNK",16777215,1,"FE14I-VA-PIRG-02:CTL:ENABLE.FLNK")
#! Field("FE14I-VA-PIRG-02:CTL:ENABLE.OUT",16777215,1,"FE14I-VA-PIRG-02:CTL:ENABLE.OUT")
#! Record("FE14I-VA-PIRG-02:CTL:SP",200,352,0,0,"FE14I-VA-PIRG-02:CTL:SP")
#! Field("FE14I-VA-PIRG-02:CTL:SP.INP",16777215,1,"FE14I-VA-PIRG-02:CTL:SP.INP")
# mks937bGauge.template
#
#% macro, __doc__, Template database for a combination gauge connected to 
# two channels of an MKS937B Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# Run on PHAS 1 to get most up to date values from IMG and Pirani
# 
# required substitutions:
#% macro, dom,          Domain 5 char string (e.g. BL11I)
#% macro, id,           ID number as 2 digit string (e.g. 01)
#% macro, plog_adc_pv,  Link to ADC record - the ADC records need instantiating
#                       in the application from either the ethercat support module templates
#                       or (if using Hy8401 VME IP) mks937bHy8401.template
#
# gui substitutions:
#% macro, name,        The device's name for gui purposes
#% macro, GCTLR,       The gauge controller PV prefix, for gui purposes
#
# optional substitutions:
#% macro, ctlsp_level, The desired control setpoint value (actually for the Pirg).
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records. 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records. 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records. 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_desc,  The DESC field on control setpoint records. 
#                      (appears as a label on the Pirg EDM screen).
#% macro, ctlspoff_desc,  The DESC field on control setpoint off records. 
#                      (appears as a label on the Pirg CSS screen).
#
# GCTLR used for the controller button
# % gui, , edm, mks937bGauge.edl, dom=FE14I, id=03, GCTLR=

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/gauge_detail.opi, dom=FE14I, id=03, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed_box.opi, dom=FE14I, id=03, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed.opi, dom=FE14I, id=03, GCTLR=, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,   FE14I-VA-GAUGE-03:P
# % gui, , readback, Gauge,  FE14I-VA-GAUGE-03:GAUGE
# % gui, , enum, Setpoints Overwrite,  FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE

# Force processing of slow PP records 
record(fanout, "FE14I-VA-GAUGE-03:FAN10S")
{
    field(DESC, "10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-03:CTL:SP")
    field(LNK2, "FE14I-VA-PIRG-03:CTL:HYST")
    field(SELM, "All")
}


################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(calc, "FE14I-VA-GAUGE-03:SEL") {
  field(DESC, "Select Pressure")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(FLNK, "FE14I-VA-GAUGE-03:GAUGE PP")
  field(CALC, "A<2?0:(B<2?1:(B=8?1:2))")
  field(INPA, "FE14I-VA-IMG-03:STA")
  field(INPB, "FE14I-VA-PIRG-03:STA")
}

record(mbbi, "FE14I-VA-GAUGE-03:GAUGE") {
  field(DESC, "Active Gauge")
  field(INP, "FE14I-VA-GAUGE-03:SEL")
  field(FLNK, "FE14I-VA-GAUGE-03:P")
  field(ZRST, "IMG")
  field(ONST, "Pirani")
  field(TWST, "No Gauge")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "MINOR")
  field(TWSV, "MAJOR")
}

################################################################################
# Pressure
#
#% archiver 0.1 Monitor
#
# CALC: ADC is 16bit representing -10 to +10 V. We only use 0 to 10V from gauge controller.
#       Divide A by 32767 (positive range used) to give fraction of 10V range.
#       Multiply result by 10 to give true input voltage.
#       From MKS937 Operation Manual, log(p)  = (V-B)/A, where B = 7.2 volts and A = 0.6
#       log(p) = (V/0.6) - (7.2/0.6) = (V/0.6) - 12.0
#
record(calc, "FE14I-VA-GAUGE-03:PLOG")
	{
  	field(DESC, "log Pressure")
  	field(INPA, "FE14I-CS-ADC-03:ADC1_VALUE PP MS")
  	field(EGU, "log")
  	field(CALC, "((10.0*(A/32767.0))/0.6) - 12.0")
  	field(HOPR, "3")
  	field(LOPR, "-11")
  	field(HIGH, "-7")
  	field(HSV, "MINOR")
  	field(ADEL, "0.025")
	}

#
#% controldesk Pressure readback
#% archiver 0.1 Monitor
#
record(calc, "FE14I-VA-GAUGE-03:P") {
  field(DESC, "Pressure")
  field(EGU, "mbar")
  field(PREC, "11")
  field(CALC, "10^A")
  field(INPA, "FE14I-VA-GAUGE-03:PLOG PP MS")
  field(SCAN, ".1 second")
  field(HOPR, "1000")
  field(LOPR, "1.0E-11")
}

record(calcout, "FE14I-VA-GAUGE-03:ADEL") {
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-GAUGE-03:P.ADEL")
  field(INPA, "FE14I-VA-GAUGE-03:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#

record(mbbo, "FE14I-VA-IMG-03:CTL:SETMODE") {
  alias("FE14I-VA-PIRG-03:CTL:ENABLE")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-03:CTL:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-03:CTL:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-03:CTL:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-03:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-03:CTL:SETSP")
    field(LNK3, "FE14I-VA-PIRG-03:CTL:INITSETSPSDIS")
    field(SELM, "All")
}


#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-03:CTL:SETSP") 
{
  field(DESC, "IMG Enable")
  field(FLNK, "FE14I-VA-IMG-03:CTL:OUTSP.PROC")
  field(OUT, "FE14I-VA-IMG-03:CTL:OUTSP")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(SDIS, "FE14I-VA-PIRG-03:ILKSETSP:NOWRITE PP")
  #field(PINI, "YES")
  field(DOL, "1.0e-2")
}

#
#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-03:CTL:SETSPOFF") 
{
  field(DESC, "IMG Enable Off")
  field(FLNK, "FE14I-VA-IMG-03:CTL:SETHYST.PROC")
  field(OUT, "FE14I-VA-IMG-03:CTL:SETHYST")
  field(EGU, "mbar")
  field(PREC, "1")
  field(SDIS, "FE14I-VA-PIRG-03:ILKSETSP:NOWRITE")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
}


#
#% archiver 10 Monitor
#% controldesk IMG Enable readback
#
record(ai, "FE14I-VA-PIRG-03:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(INP, "FE14I-VA-IMG-03:CTL:SP MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

#% archiver 10 Monitor
#% controldesk IMG Enable hysteresis readback
#
record(ai, "FE14I-VA-PIRG-03:CTL:HYST") 
{
  field(DESC, "IMG Enable Off")
  field(INP, "FE14I-VA-IMG-03:CTL:HYST MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-PIRG-03:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-03:CTL:HYST PP")
  field(LNK1, "FE14I-VA-PIRG-03:CTL:SETSPOFF.VAL PP")
}

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
# This is essentially a copy of the global record be but in the domain
# of the PIRG instance, so available to EDM screen.
#
record(bi, "FE14I-VA-PIRG-03:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# NB: INP had to be removed to allow autosave to correctly restore.
#
#% autosave 0 VAL
record(bi, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  #field(INP, "0")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  

#! Further lines contain data used by VisualDCT
#! View(0,0,1.0)
#! Record("FE14I-VA-GAUGE-03:SEL",20,46,0,0,"FE14I-VA-GAUGE-03:SEL")
#! Field("FE14I-VA-GAUGE-03:SEL.FLNK",16777215,1,"FE14I-VA-GAUGE-03:SEL.FLNK")
#! Link("FE14I-VA-GAUGE-03:SEL.FLNK","FE14I-VA-GAUGE-03:GAUGE")
#! Field("FE14I-VA-GAUGE-03:SEL.INPA",16777215,1,"FE14I-VA-GAUGE-03:SEL.INPA")
#! Field("FE14I-VA-GAUGE-03:SEL.INPB",16777215,1,"FE14I-VA-GAUGE-03:SEL.INPB")
#! Field("FE14I-VA-GAUGE-03:SEL.VAL",16777215,1,"FE14I-VA-GAUGE-03:SEL.VAL")
#! Record("FE14I-VA-GAUGE-03:GAUGE",300,65,0,0,"FE14I-VA-GAUGE-03:GAUGE")
#! Field("FE14I-VA-GAUGE-03:GAUGE.INP",16777215,0,"FE14I-VA-GAUGE-03:GAUGE.INP")
#! Link("FE14I-VA-GAUGE-03:GAUGE.INP","FE14I-VA-GAUGE-03:SEL.VAL")
#! Field("FE14I-VA-GAUGE-03:GAUGE.FLNK",16777215,1,"FE14I-VA-GAUGE-03:GAUGE.FLNK")
#! Link("FE14I-VA-GAUGE-03:GAUGE.FLNK","FE14I-VA-GAUGE-03:P")
#! Record("FE14I-VA-GAUGE-03:PLOG",500,17,0,0,"FE14I-VA-GAUGE-03:PLOG")
#! Field("FE14I-VA-GAUGE-03:PLOG.VAL",16777215,1,"FE14I-VA-GAUGE-03:PLOG.VAL")
#! Record("FE14I-VA-GAUGE-03:P",780,212,0,0,"FE14I-VA-GAUGE-03:P")
#! Field("FE14I-VA-GAUGE-03:P.INPA",16777215,0,"FE14I-VA-GAUGE-03:P.INPA")
#! Link("FE14I-VA-GAUGE-03:P.INPA","FE14I-VA-GAUGE-03:PLOG.VAL")
#! Field("FE14I-VA-GAUGE-03:P.ADEL",16777215,1,"FE14I-VA-GAUGE-03:P.ADEL")
#! Field("FE14I-VA-GAUGE-03:P.VAL",16777215,1,"FE14I-VA-GAUGE-03:P.VAL")
#! Record("FE14I-VA-GAUGE-03:ADEL",1060,260,0,0,"FE14I-VA-GAUGE-03:ADEL")
#! Field("FE14I-VA-GAUGE-03:ADEL.OUT",16777215,0,"FE14I-VA-GAUGE-03:ADEL.OUT")
#! Link("FE14I-VA-GAUGE-03:ADEL.OUT","FE14I-VA-GAUGE-03:P.ADEL")
#! Field("FE14I-VA-GAUGE-03:ADEL.INPA",16777215,0,"FE14I-VA-GAUGE-03:ADEL.INPA")
#! Link("FE14I-VA-GAUGE-03:ADEL.INPA","FE14I-VA-GAUGE-03:P.VAL")
#! Record("FE14I-VA-PIRG-03:CTL:SETSP",20,345,0,0,"FE14I-VA-PIRG-03:CTL:SETSP")
#! Field("FE14I-VA-PIRG-03:CTL:SETSP.FLNK",16777215,1,"FE14I-VA-PIRG-03:CTL:SETSP.FLNK")
#! Field("FE14I-VA-PIRG-03:CTL:SETSP.OUT",16777215,1,"FE14I-VA-PIRG-03:CTL:SETSP.OUT")
#! Record("FE14I-VA-PIRG-03:CTL:ENABLE",380,331,0,0,"FE14I-VA-PIRG-03:CTL:ENABLE")
#! Field("FE14I-VA-PIRG-03:CTL:ENABLE.FLNK",16777215,1,"FE14I-VA-PIRG-03:CTL:ENABLE.FLNK")
#! Field("FE14I-VA-PIRG-03:CTL:ENABLE.OUT",16777215,1,"FE14I-VA-PIRG-03:CTL:ENABLE.OUT")
#! Record("FE14I-VA-PIRG-03:CTL:SP",200,352,0,0,"FE14I-VA-PIRG-03:CTL:SP")
#! Field("FE14I-VA-PIRG-03:CTL:SP.INP",16777215,1,"FE14I-VA-PIRG-03:CTL:SP.INP")
# mks937bGauge.template
#
#% macro, __doc__, Template database for a combination gauge connected to 
# two channels of an MKS937B Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# Run on PHAS 1 to get most up to date values from IMG and Pirani
# 
# required substitutions:
#% macro, dom,          Domain 5 char string (e.g. BL11I)
#% macro, id,           ID number as 2 digit string (e.g. 01)
#% macro, plog_adc_pv,  Link to ADC record - the ADC records need instantiating
#                       in the application from either the ethercat support module templates
#                       or (if using Hy8401 VME IP) mks937bHy8401.template
#
# gui substitutions:
#% macro, name,        The device's name for gui purposes
#% macro, GCTLR,       The gauge controller PV prefix, for gui purposes
#
# optional substitutions:
#% macro, ctlsp_level, The desired control setpoint value (actually for the Pirg).
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records. 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records. 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records. 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_desc,  The DESC field on control setpoint records. 
#                      (appears as a label on the Pirg EDM screen).
#% macro, ctlspoff_desc,  The DESC field on control setpoint off records. 
#                      (appears as a label on the Pirg CSS screen).
#
# GCTLR used for the controller button
# % gui, , edm, mks937bGauge.edl, dom=FE14I, id=04, GCTLR=

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/gauge_detail.opi, dom=FE14I, id=04, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed_box.opi, dom=FE14I, id=04, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed.opi, dom=FE14I, id=04, GCTLR=, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,   FE14I-VA-GAUGE-04:P
# % gui, , readback, Gauge,  FE14I-VA-GAUGE-04:GAUGE
# % gui, , enum, Setpoints Overwrite,  FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE

# Force processing of slow PP records 
record(fanout, "FE14I-VA-GAUGE-04:FAN10S")
{
    field(DESC, "10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-04:CTL:SP")
    field(LNK2, "FE14I-VA-PIRG-04:CTL:HYST")
    field(SELM, "All")
}


################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(calc, "FE14I-VA-GAUGE-04:SEL") {
  field(DESC, "Select Pressure")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(FLNK, "FE14I-VA-GAUGE-04:GAUGE PP")
  field(CALC, "A<2?0:(B<2?1:(B=8?1:2))")
  field(INPA, "FE14I-VA-IMG-04:STA")
  field(INPB, "FE14I-VA-PIRG-04:STA")
}

record(mbbi, "FE14I-VA-GAUGE-04:GAUGE") {
  field(DESC, "Active Gauge")
  field(INP, "FE14I-VA-GAUGE-04:SEL")
  field(FLNK, "FE14I-VA-GAUGE-04:P")
  field(ZRST, "IMG")
  field(ONST, "Pirani")
  field(TWST, "No Gauge")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "MINOR")
  field(TWSV, "MAJOR")
}

################################################################################
# Pressure
#
#% archiver 0.1 Monitor
#
# CALC: ADC is 16bit representing -10 to +10 V. We only use 0 to 10V from gauge controller.
#       Divide A by 32767 (positive range used) to give fraction of 10V range.
#       Multiply result by 10 to give true input voltage.
#       From MKS937 Operation Manual, log(p)  = (V-B)/A, where B = 7.2 volts and A = 0.6
#       log(p) = (V/0.6) - (7.2/0.6) = (V/0.6) - 12.0
#
record(calc, "FE14I-VA-GAUGE-04:PLOG")
	{
  	field(DESC, "log Pressure")
  	field(INPA, "FE14I-CS-ADC-04:ADC1_VALUE PP MS")
  	field(EGU, "log")
  	field(CALC, "((10.0*(A/32767.0))/0.6) - 12.0")
  	field(HOPR, "3")
  	field(LOPR, "-11")
  	field(HIGH, "-7")
  	field(HSV, "MINOR")
  	field(ADEL, "0.025")
	}

#
#% controldesk Pressure readback
#% archiver 0.1 Monitor
#
record(calc, "FE14I-VA-GAUGE-04:P") {
  field(DESC, "Pressure")
  field(EGU, "mbar")
  field(PREC, "11")
  field(CALC, "10^A")
  field(INPA, "FE14I-VA-GAUGE-04:PLOG PP MS")
  field(SCAN, ".1 second")
  field(HOPR, "1000")
  field(LOPR, "1.0E-11")
}

record(calcout, "FE14I-VA-GAUGE-04:ADEL") {
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-GAUGE-04:P.ADEL")
  field(INPA, "FE14I-VA-GAUGE-04:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#

record(mbbo, "FE14I-VA-IMG-04:CTL:SETMODE") {
  alias("FE14I-VA-PIRG-04:CTL:ENABLE")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-04:CTL:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-04:CTL:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-04:CTL:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-04:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-04:CTL:SETSP")
    field(LNK3, "FE14I-VA-PIRG-04:CTL:INITSETSPSDIS")
    field(SELM, "All")
}


#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-04:CTL:SETSP") 
{
  field(DESC, "IMG Enable")
  field(FLNK, "FE14I-VA-IMG-04:CTL:OUTSP.PROC")
  field(OUT, "FE14I-VA-IMG-04:CTL:OUTSP")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(SDIS, "FE14I-VA-PIRG-04:ILKSETSP:NOWRITE PP")
  #field(PINI, "YES")
  field(DOL, "1.0e-2")
}

#
#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-04:CTL:SETSPOFF") 
{
  field(DESC, "IMG Enable Off")
  field(FLNK, "FE14I-VA-IMG-04:CTL:SETHYST.PROC")
  field(OUT, "FE14I-VA-IMG-04:CTL:SETHYST")
  field(EGU, "mbar")
  field(PREC, "1")
  field(SDIS, "FE14I-VA-PIRG-04:ILKSETSP:NOWRITE")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
}


#
#% archiver 10 Monitor
#% controldesk IMG Enable readback
#
record(ai, "FE14I-VA-PIRG-04:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(INP, "FE14I-VA-IMG-04:CTL:SP MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

#% archiver 10 Monitor
#% controldesk IMG Enable hysteresis readback
#
record(ai, "FE14I-VA-PIRG-04:CTL:HYST") 
{
  field(DESC, "IMG Enable Off")
  field(INP, "FE14I-VA-IMG-04:CTL:HYST MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-PIRG-04:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-04:CTL:HYST PP")
  field(LNK1, "FE14I-VA-PIRG-04:CTL:SETSPOFF.VAL PP")
}

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
# This is essentially a copy of the global record be but in the domain
# of the PIRG instance, so available to EDM screen.
#
record(bi, "FE14I-VA-PIRG-04:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# NB: INP had to be removed to allow autosave to correctly restore.
#
#% autosave 0 VAL
record(bi, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  #field(INP, "0")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  

#! Further lines contain data used by VisualDCT
#! View(0,0,1.0)
#! Record("FE14I-VA-GAUGE-04:SEL",20,46,0,0,"FE14I-VA-GAUGE-04:SEL")
#! Field("FE14I-VA-GAUGE-04:SEL.FLNK",16777215,1,"FE14I-VA-GAUGE-04:SEL.FLNK")
#! Link("FE14I-VA-GAUGE-04:SEL.FLNK","FE14I-VA-GAUGE-04:GAUGE")
#! Field("FE14I-VA-GAUGE-04:SEL.INPA",16777215,1,"FE14I-VA-GAUGE-04:SEL.INPA")
#! Field("FE14I-VA-GAUGE-04:SEL.INPB",16777215,1,"FE14I-VA-GAUGE-04:SEL.INPB")
#! Field("FE14I-VA-GAUGE-04:SEL.VAL",16777215,1,"FE14I-VA-GAUGE-04:SEL.VAL")
#! Record("FE14I-VA-GAUGE-04:GAUGE",300,65,0,0,"FE14I-VA-GAUGE-04:GAUGE")
#! Field("FE14I-VA-GAUGE-04:GAUGE.INP",16777215,0,"FE14I-VA-GAUGE-04:GAUGE.INP")
#! Link("FE14I-VA-GAUGE-04:GAUGE.INP","FE14I-VA-GAUGE-04:SEL.VAL")
#! Field("FE14I-VA-GAUGE-04:GAUGE.FLNK",16777215,1,"FE14I-VA-GAUGE-04:GAUGE.FLNK")
#! Link("FE14I-VA-GAUGE-04:GAUGE.FLNK","FE14I-VA-GAUGE-04:P")
#! Record("FE14I-VA-GAUGE-04:PLOG",500,17,0,0,"FE14I-VA-GAUGE-04:PLOG")
#! Field("FE14I-VA-GAUGE-04:PLOG.VAL",16777215,1,"FE14I-VA-GAUGE-04:PLOG.VAL")
#! Record("FE14I-VA-GAUGE-04:P",780,212,0,0,"FE14I-VA-GAUGE-04:P")
#! Field("FE14I-VA-GAUGE-04:P.INPA",16777215,0,"FE14I-VA-GAUGE-04:P.INPA")
#! Link("FE14I-VA-GAUGE-04:P.INPA","FE14I-VA-GAUGE-04:PLOG.VAL")
#! Field("FE14I-VA-GAUGE-04:P.ADEL",16777215,1,"FE14I-VA-GAUGE-04:P.ADEL")
#! Field("FE14I-VA-GAUGE-04:P.VAL",16777215,1,"FE14I-VA-GAUGE-04:P.VAL")
#! Record("FE14I-VA-GAUGE-04:ADEL",1060,260,0,0,"FE14I-VA-GAUGE-04:ADEL")
#! Field("FE14I-VA-GAUGE-04:ADEL.OUT",16777215,0,"FE14I-VA-GAUGE-04:ADEL.OUT")
#! Link("FE14I-VA-GAUGE-04:ADEL.OUT","FE14I-VA-GAUGE-04:P.ADEL")
#! Field("FE14I-VA-GAUGE-04:ADEL.INPA",16777215,0,"FE14I-VA-GAUGE-04:ADEL.INPA")
#! Link("FE14I-VA-GAUGE-04:ADEL.INPA","FE14I-VA-GAUGE-04:P.VAL")
#! Record("FE14I-VA-PIRG-04:CTL:SETSP",20,345,0,0,"FE14I-VA-PIRG-04:CTL:SETSP")
#! Field("FE14I-VA-PIRG-04:CTL:SETSP.FLNK",16777215,1,"FE14I-VA-PIRG-04:CTL:SETSP.FLNK")
#! Field("FE14I-VA-PIRG-04:CTL:SETSP.OUT",16777215,1,"FE14I-VA-PIRG-04:CTL:SETSP.OUT")
#! Record("FE14I-VA-PIRG-04:CTL:ENABLE",380,331,0,0,"FE14I-VA-PIRG-04:CTL:ENABLE")
#! Field("FE14I-VA-PIRG-04:CTL:ENABLE.FLNK",16777215,1,"FE14I-VA-PIRG-04:CTL:ENABLE.FLNK")
#! Field("FE14I-VA-PIRG-04:CTL:ENABLE.OUT",16777215,1,"FE14I-VA-PIRG-04:CTL:ENABLE.OUT")
#! Record("FE14I-VA-PIRG-04:CTL:SP",200,352,0,0,"FE14I-VA-PIRG-04:CTL:SP")
#! Field("FE14I-VA-PIRG-04:CTL:SP.INP",16777215,1,"FE14I-VA-PIRG-04:CTL:SP.INP")
# mks937bGauge.template
#
#% macro, __doc__, Template database for a combination gauge connected to 
# two channels of an MKS937B Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# Run on PHAS 1 to get most up to date values from IMG and Pirani
# 
# required substitutions:
#% macro, dom,          Domain 5 char string (e.g. BL11I)
#% macro, id,           ID number as 2 digit string (e.g. 01)
#% macro, plog_adc_pv,  Link to ADC record - the ADC records need instantiating
#                       in the application from either the ethercat support module templates
#                       or (if using Hy8401 VME IP) mks937bHy8401.template
#
# gui substitutions:
#% macro, name,        The device's name for gui purposes
#% macro, GCTLR,       The gauge controller PV prefix, for gui purposes
#
# optional substitutions:
#% macro, ctlsp_level, The desired control setpoint value (actually for the Pirg).
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records. 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records. 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records. 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_desc,  The DESC field on control setpoint records. 
#                      (appears as a label on the Pirg EDM screen).
#% macro, ctlspoff_desc,  The DESC field on control setpoint off records. 
#                      (appears as a label on the Pirg CSS screen).
#
# GCTLR used for the controller button
# % gui, , edm, mks937bGauge.edl, dom=FE14I, id=05, GCTLR=

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/gauge_detail.opi, dom=FE14I, id=05, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed_box.opi, dom=FE14I, id=05, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed.opi, dom=FE14I, id=05, GCTLR=, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,   FE14I-VA-GAUGE-05:P
# % gui, , readback, Gauge,  FE14I-VA-GAUGE-05:GAUGE
# % gui, , enum, Setpoints Overwrite,  FE14I-VA-GAUGE-05:ILKSETSP:NOWRITE

# Force processing of slow PP records 
record(fanout, "FE14I-VA-GAUGE-05:FAN10S")
{
    field(DESC, "10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-05:CTL:SP")
    field(LNK2, "FE14I-VA-PIRG-05:CTL:HYST")
    field(SELM, "All")
}


################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(calc, "FE14I-VA-GAUGE-05:SEL") {
  field(DESC, "Select Pressure")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(FLNK, "FE14I-VA-GAUGE-05:GAUGE PP")
  field(CALC, "A<2?0:(B<2?1:(B=8?1:2))")
  field(INPA, "FE14I-VA-IMG-05:STA")
  field(INPB, "FE14I-VA-PIRG-05:STA")
}

record(mbbi, "FE14I-VA-GAUGE-05:GAUGE") {
  field(DESC, "Active Gauge")
  field(INP, "FE14I-VA-GAUGE-05:SEL")
  field(FLNK, "FE14I-VA-GAUGE-05:P")
  field(ZRST, "IMG")
  field(ONST, "Pirani")
  field(TWST, "No Gauge")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "MINOR")
  field(TWSV, "MAJOR")
}

################################################################################
# Pressure
#
#% archiver 0.1 Monitor
#
# CALC: ADC is 16bit representing -10 to +10 V. We only use 0 to 10V from gauge controller.
#       Divide A by 32767 (positive range used) to give fraction of 10V range.
#       Multiply result by 10 to give true input voltage.
#       From MKS937 Operation Manual, log(p)  = (V-B)/A, where B = 7.2 volts and A = 0.6
#       log(p) = (V/0.6) - (7.2/0.6) = (V/0.6) - 12.0
#
record(calc, "FE14I-VA-GAUGE-05:PLOG")
	{
  	field(DESC, "log Pressure")
  	field(INPA, "FE14I-CS-ADC-03:ADC2_VALUE PP MS")
  	field(EGU, "log")
  	field(CALC, "((10.0*(A/32767.0))/0.6) - 12.0")
  	field(HOPR, "3")
  	field(LOPR, "-11")
  	field(HIGH, "-7")
  	field(HSV, "MINOR")
  	field(ADEL, "0.025")
	}

#
#% controldesk Pressure readback
#% archiver 0.1 Monitor
#
record(calc, "FE14I-VA-GAUGE-05:P") {
  field(DESC, "Pressure")
  field(EGU, "mbar")
  field(PREC, "11")
  field(CALC, "10^A")
  field(INPA, "FE14I-VA-GAUGE-05:PLOG PP MS")
  field(SCAN, ".1 second")
  field(HOPR, "1000")
  field(LOPR, "1.0E-11")
}

record(calcout, "FE14I-VA-GAUGE-05:ADEL") {
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-GAUGE-05:P.ADEL")
  field(INPA, "FE14I-VA-GAUGE-05:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#

record(mbbo, "FE14I-VA-IMG-05:CTL:SETMODE") {
  alias("FE14I-VA-PIRG-05:CTL:ENABLE")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-05:CTL:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-05:CTL:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-05:CTL:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-05:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-05:CTL:SETSP")
    field(LNK3, "FE14I-VA-PIRG-05:CTL:INITSETSPSDIS")
    field(SELM, "All")
}


#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-05:CTL:SETSP") 
{
  field(DESC, "IMG Enable")
  field(FLNK, "FE14I-VA-IMG-05:CTL:OUTSP.PROC")
  field(OUT, "FE14I-VA-IMG-05:CTL:OUTSP")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(SDIS, "FE14I-VA-PIRG-05:ILKSETSP:NOWRITE PP")
  #field(PINI, "YES")
  field(DOL, "1.0e-2")
}

#
#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-05:CTL:SETSPOFF") 
{
  field(DESC, "IMG Enable Off")
  field(FLNK, "FE14I-VA-IMG-05:CTL:SETHYST.PROC")
  field(OUT, "FE14I-VA-IMG-05:CTL:SETHYST")
  field(EGU, "mbar")
  field(PREC, "1")
  field(SDIS, "FE14I-VA-PIRG-05:ILKSETSP:NOWRITE")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
}


#
#% archiver 10 Monitor
#% controldesk IMG Enable readback
#
record(ai, "FE14I-VA-PIRG-05:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(INP, "FE14I-VA-IMG-05:CTL:SP MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

#% archiver 10 Monitor
#% controldesk IMG Enable hysteresis readback
#
record(ai, "FE14I-VA-PIRG-05:CTL:HYST") 
{
  field(DESC, "IMG Enable Off")
  field(INP, "FE14I-VA-IMG-05:CTL:HYST MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-PIRG-05:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-05:CTL:HYST PP")
  field(LNK1, "FE14I-VA-PIRG-05:CTL:SETSPOFF.VAL PP")
}

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
# This is essentially a copy of the global record be but in the domain
# of the PIRG instance, so available to EDM screen.
#
record(bi, "FE14I-VA-PIRG-05:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-05:ILKSETSP:NOWRITE CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# NB: INP had to be removed to allow autosave to correctly restore.
#
#% autosave 0 VAL
record(bi, "FE14I-VA-GAUGE-05:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  #field(INP, "0")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  

#! Further lines contain data used by VisualDCT
#! View(0,0,1.0)
#! Record("FE14I-VA-GAUGE-05:SEL",20,46,0,0,"FE14I-VA-GAUGE-05:SEL")
#! Field("FE14I-VA-GAUGE-05:SEL.FLNK",16777215,1,"FE14I-VA-GAUGE-05:SEL.FLNK")
#! Link("FE14I-VA-GAUGE-05:SEL.FLNK","FE14I-VA-GAUGE-05:GAUGE")
#! Field("FE14I-VA-GAUGE-05:SEL.INPA",16777215,1,"FE14I-VA-GAUGE-05:SEL.INPA")
#! Field("FE14I-VA-GAUGE-05:SEL.INPB",16777215,1,"FE14I-VA-GAUGE-05:SEL.INPB")
#! Field("FE14I-VA-GAUGE-05:SEL.VAL",16777215,1,"FE14I-VA-GAUGE-05:SEL.VAL")
#! Record("FE14I-VA-GAUGE-05:GAUGE",300,65,0,0,"FE14I-VA-GAUGE-05:GAUGE")
#! Field("FE14I-VA-GAUGE-05:GAUGE.INP",16777215,0,"FE14I-VA-GAUGE-05:GAUGE.INP")
#! Link("FE14I-VA-GAUGE-05:GAUGE.INP","FE14I-VA-GAUGE-05:SEL.VAL")
#! Field("FE14I-VA-GAUGE-05:GAUGE.FLNK",16777215,1,"FE14I-VA-GAUGE-05:GAUGE.FLNK")
#! Link("FE14I-VA-GAUGE-05:GAUGE.FLNK","FE14I-VA-GAUGE-05:P")
#! Record("FE14I-VA-GAUGE-05:PLOG",500,17,0,0,"FE14I-VA-GAUGE-05:PLOG")
#! Field("FE14I-VA-GAUGE-05:PLOG.VAL",16777215,1,"FE14I-VA-GAUGE-05:PLOG.VAL")
#! Record("FE14I-VA-GAUGE-05:P",780,212,0,0,"FE14I-VA-GAUGE-05:P")
#! Field("FE14I-VA-GAUGE-05:P.INPA",16777215,0,"FE14I-VA-GAUGE-05:P.INPA")
#! Link("FE14I-VA-GAUGE-05:P.INPA","FE14I-VA-GAUGE-05:PLOG.VAL")
#! Field("FE14I-VA-GAUGE-05:P.ADEL",16777215,1,"FE14I-VA-GAUGE-05:P.ADEL")
#! Field("FE14I-VA-GAUGE-05:P.VAL",16777215,1,"FE14I-VA-GAUGE-05:P.VAL")
#! Record("FE14I-VA-GAUGE-05:ADEL",1060,260,0,0,"FE14I-VA-GAUGE-05:ADEL")
#! Field("FE14I-VA-GAUGE-05:ADEL.OUT",16777215,0,"FE14I-VA-GAUGE-05:ADEL.OUT")
#! Link("FE14I-VA-GAUGE-05:ADEL.OUT","FE14I-VA-GAUGE-05:P.ADEL")
#! Field("FE14I-VA-GAUGE-05:ADEL.INPA",16777215,0,"FE14I-VA-GAUGE-05:ADEL.INPA")
#! Link("FE14I-VA-GAUGE-05:ADEL.INPA","FE14I-VA-GAUGE-05:P.VAL")
#! Record("FE14I-VA-PIRG-05:CTL:SETSP",20,345,0,0,"FE14I-VA-PIRG-05:CTL:SETSP")
#! Field("FE14I-VA-PIRG-05:CTL:SETSP.FLNK",16777215,1,"FE14I-VA-PIRG-05:CTL:SETSP.FLNK")
#! Field("FE14I-VA-PIRG-05:CTL:SETSP.OUT",16777215,1,"FE14I-VA-PIRG-05:CTL:SETSP.OUT")
#! Record("FE14I-VA-PIRG-05:CTL:ENABLE",380,331,0,0,"FE14I-VA-PIRG-05:CTL:ENABLE")
#! Field("FE14I-VA-PIRG-05:CTL:ENABLE.FLNK",16777215,1,"FE14I-VA-PIRG-05:CTL:ENABLE.FLNK")
#! Field("FE14I-VA-PIRG-05:CTL:ENABLE.OUT",16777215,1,"FE14I-VA-PIRG-05:CTL:ENABLE.OUT")
#! Record("FE14I-VA-PIRG-05:CTL:SP",200,352,0,0,"FE14I-VA-PIRG-05:CTL:SP")
#! Field("FE14I-VA-PIRG-05:CTL:SP.INP",16777215,1,"FE14I-VA-PIRG-05:CTL:SP.INP")
# mks937bGauge.template
#
#% macro, __doc__, Template database for a combination gauge connected to 
# two channels of an MKS937B Multi-Sensor System 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# Run on PHAS 1 to get most up to date values from IMG and Pirani
# 
# required substitutions:
#% macro, dom,          Domain 5 char string (e.g. BL11I)
#% macro, id,           ID number as 2 digit string (e.g. 01)
#% macro, plog_adc_pv,  Link to ADC record - the ADC records need instantiating
#                       in the application from either the ethercat support module templates
#                       or (if using Hy8401 VME IP) mks937bHy8401.template
#
# gui substitutions:
#% macro, name,        The device's name for gui purposes
#% macro, GCTLR,       The gauge controller PV prefix, for gui purposes
#
# optional substitutions:
#% macro, ctlsp_level, The desired control setpoint value (actually for the Pirg).
#% macro, ctlsp_drvh,  The DRVH field on control setpoint records. 
#                      (limits max value of control setpoint)
#% macro, ctlsp_drvl,  The DRVL field on control setpoint records. 
#                      (limits min value of control setpoint)
#% macro, ctlsp_hopr,  The HOPR field on control setpoint records. 
#                      (high operator value - helps display set correct range).
#% macro, ctlsp_lopr,  The LOPR field on control setpoint records. 
#                      (low operator value - helps display set correct range).
#% macro, ctlsp_desc,  The DESC field on control setpoint records. 
#                      (appears as a label on the Pirg EDM screen).
#% macro, ctlspoff_desc,  The DESC field on control setpoint off records. 
#                      (appears as a label on the Pirg CSS screen).
#
# GCTLR used for the controller button
# % gui, , edm, mks937bGauge.edl, dom=FE14I, id=06, GCTLR=

# This associates BOY screens with the template
# % gui, , boydetail, mks937bApp_opi/gauge_detail.opi, dom=FE14I, id=06, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed_box.opi, dom=FE14I, id=06, GCTLR=, name=
# % gui, , boyembed, mks937bApp_opi/gauge_embed.opi, dom=FE14I, id=06, GCTLR=, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Pressure,   FE14I-VA-GAUGE-06:P
# % gui, , readback, Gauge,  FE14I-VA-GAUGE-06:GAUGE
# % gui, , enum, Setpoints Overwrite,  FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE

# Force processing of slow PP records 
record(fanout, "FE14I-VA-GAUGE-06:FAN10S")
{
    field(DESC, "10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-06:CTL:SP")
    field(LNK2, "FE14I-VA-PIRG-06:CTL:HYST")
    field(SELM, "All")
}


################################################################################
# Select Active Gauge (IMG or PIRG)
#
record(calc, "FE14I-VA-GAUGE-06:SEL") {
  field(DESC, "Select Pressure")
  field(SCAN, "1 second")
  field(PHAS, "1")
  field(FLNK, "FE14I-VA-GAUGE-06:GAUGE PP")
  field(CALC, "A<2?0:(B<2?1:(B=8?1:2))")
  field(INPA, "FE14I-VA-IMG-06:STA")
  field(INPB, "FE14I-VA-PIRG-06:STA")
}

record(mbbi, "FE14I-VA-GAUGE-06:GAUGE") {
  field(DESC, "Active Gauge")
  field(INP, "FE14I-VA-GAUGE-06:SEL")
  field(FLNK, "FE14I-VA-GAUGE-06:P")
  field(ZRST, "IMG")
  field(ONST, "Pirani")
  field(TWST, "No Gauge")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "MINOR")
  field(TWSV, "MAJOR")
}

################################################################################
# Pressure
#
#% archiver 0.1 Monitor
#
# CALC: ADC is 16bit representing -10 to +10 V. We only use 0 to 10V from gauge controller.
#       Divide A by 32767 (positive range used) to give fraction of 10V range.
#       Multiply result by 10 to give true input voltage.
#       From MKS937 Operation Manual, log(p)  = (V-B)/A, where B = 7.2 volts and A = 0.6
#       log(p) = (V/0.6) - (7.2/0.6) = (V/0.6) - 12.0
#
record(calc, "FE14I-VA-GAUGE-06:PLOG")
	{
  	field(DESC, "log Pressure")
  	field(INPA, "FE14I-CS-ADC-04:ADC2_VALUE PP MS")
  	field(EGU, "log")
  	field(CALC, "((10.0*(A/32767.0))/0.6) - 12.0")
  	field(HOPR, "3")
  	field(LOPR, "-11")
  	field(HIGH, "-7")
  	field(HSV, "MINOR")
  	field(ADEL, "0.025")
	}

#
#% controldesk Pressure readback
#% archiver 0.1 Monitor
#
record(calc, "FE14I-VA-GAUGE-06:P") {
  field(DESC, "Pressure")
  field(EGU, "mbar")
  field(PREC, "11")
  field(CALC, "10^A")
  field(INPA, "FE14I-VA-GAUGE-06:PLOG PP MS")
  field(SCAN, ".1 second")
  field(HOPR, "1000")
  field(LOPR, "1.0E-11")
}

record(calcout, "FE14I-VA-GAUGE-06:ADEL") {
  field(DESC, "deadband")
  field(CALC, "A/B")
  field(OUT, "FE14I-VA-GAUGE-06:P.ADEL")
  field(INPA, "FE14I-VA-GAUGE-06:P")
  field(INPB, "20")
  field(SCAN, "10 second")
}

################################################################################
# Control - IMG Enable (link from IMG to PIRG)
#

record(mbbo, "FE14I-VA-IMG-06:CTL:SETMODE") {
  alias("FE14I-VA-PIRG-06:CTL:ENABLE")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-06:CTL:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-06:CTL:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-06:CTL:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-06:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-06:CTL:SETSP")
    field(LNK3, "FE14I-VA-PIRG-06:CTL:INITSETSPSDIS")
    field(SELM, "All")
}


#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-06:CTL:SETSP") 
{
  field(DESC, "IMG Enable")
  field(FLNK, "FE14I-VA-IMG-06:CTL:OUTSP.PROC")
  field(OUT, "FE14I-VA-IMG-06:CTL:OUTSP")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
  field(SDIS, "FE14I-VA-PIRG-06:ILKSETSP:NOWRITE PP")
  #field(PINI, "YES")
  field(DOL, "1.0e-2")
}

#
#% archiver 10 Monitor
#
record(ao, "FE14I-VA-PIRG-06:CTL:SETSPOFF") 
{
  field(DESC, "IMG Enable Off")
  field(FLNK, "FE14I-VA-IMG-06:CTL:SETHYST.PROC")
  field(OUT, "FE14I-VA-IMG-06:CTL:SETHYST")
  field(EGU, "mbar")
  field(PREC, "1")
  field(SDIS, "FE14I-VA-PIRG-06:ILKSETSP:NOWRITE")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
  field(DRVH, "9.5e-1")
  field(DRVL, "2.7e-3")
}


#
#% archiver 10 Monitor
#% controldesk IMG Enable readback
#
record(ai, "FE14I-VA-PIRG-06:CTL:SP") 
{
  field(DESC, "IMG Enable")
  field(INP, "FE14I-VA-IMG-06:CTL:SP MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

#% archiver 10 Monitor
#% controldesk IMG Enable hysteresis readback
#
record(ai, "FE14I-VA-PIRG-06:CTL:HYST") 
{
  field(DESC, "IMG Enable Off")
  field(INP, "FE14I-VA-IMG-06:CTL:HYST MS")
  field(SCAN, "Passive")
  field(PHAS, "1")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "9.5e-1")
  field(LOPR, "2.7e-3")
}

# When the controller hysteresis changes internally
# set the value in the SETHYST text entry box accordingly
record(seq, "FE14I-VA-PIRG-06:CTL:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-06:CTL:HYST PP")
  field(LNK1, "FE14I-VA-PIRG-06:CTL:SETSPOFF.VAL PP")
}

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
# This is essentially a copy of the global record be but in the domain
# of the PIRG instance, so available to EDM screen.
#
record(bi, "FE14I-VA-PIRG-06:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# NB: INP had to be removed to allow autosave to correctly restore.
#
#% autosave 0 VAL
record(bi, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  #field(INP, "0")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  

#! Further lines contain data used by VisualDCT
#! View(0,0,1.0)
#! Record("FE14I-VA-GAUGE-06:SEL",20,46,0,0,"FE14I-VA-GAUGE-06:SEL")
#! Field("FE14I-VA-GAUGE-06:SEL.FLNK",16777215,1,"FE14I-VA-GAUGE-06:SEL.FLNK")
#! Link("FE14I-VA-GAUGE-06:SEL.FLNK","FE14I-VA-GAUGE-06:GAUGE")
#! Field("FE14I-VA-GAUGE-06:SEL.INPA",16777215,1,"FE14I-VA-GAUGE-06:SEL.INPA")
#! Field("FE14I-VA-GAUGE-06:SEL.INPB",16777215,1,"FE14I-VA-GAUGE-06:SEL.INPB")
#! Field("FE14I-VA-GAUGE-06:SEL.VAL",16777215,1,"FE14I-VA-GAUGE-06:SEL.VAL")
#! Record("FE14I-VA-GAUGE-06:GAUGE",300,65,0,0,"FE14I-VA-GAUGE-06:GAUGE")
#! Field("FE14I-VA-GAUGE-06:GAUGE.INP",16777215,0,"FE14I-VA-GAUGE-06:GAUGE.INP")
#! Link("FE14I-VA-GAUGE-06:GAUGE.INP","FE14I-VA-GAUGE-06:SEL.VAL")
#! Field("FE14I-VA-GAUGE-06:GAUGE.FLNK",16777215,1,"FE14I-VA-GAUGE-06:GAUGE.FLNK")
#! Link("FE14I-VA-GAUGE-06:GAUGE.FLNK","FE14I-VA-GAUGE-06:P")
#! Record("FE14I-VA-GAUGE-06:PLOG",500,17,0,0,"FE14I-VA-GAUGE-06:PLOG")
#! Field("FE14I-VA-GAUGE-06:PLOG.VAL",16777215,1,"FE14I-VA-GAUGE-06:PLOG.VAL")
#! Record("FE14I-VA-GAUGE-06:P",780,212,0,0,"FE14I-VA-GAUGE-06:P")
#! Field("FE14I-VA-GAUGE-06:P.INPA",16777215,0,"FE14I-VA-GAUGE-06:P.INPA")
#! Link("FE14I-VA-GAUGE-06:P.INPA","FE14I-VA-GAUGE-06:PLOG.VAL")
#! Field("FE14I-VA-GAUGE-06:P.ADEL",16777215,1,"FE14I-VA-GAUGE-06:P.ADEL")
#! Field("FE14I-VA-GAUGE-06:P.VAL",16777215,1,"FE14I-VA-GAUGE-06:P.VAL")
#! Record("FE14I-VA-GAUGE-06:ADEL",1060,260,0,0,"FE14I-VA-GAUGE-06:ADEL")
#! Field("FE14I-VA-GAUGE-06:ADEL.OUT",16777215,0,"FE14I-VA-GAUGE-06:ADEL.OUT")
#! Link("FE14I-VA-GAUGE-06:ADEL.OUT","FE14I-VA-GAUGE-06:P.ADEL")
#! Field("FE14I-VA-GAUGE-06:ADEL.INPA",16777215,0,"FE14I-VA-GAUGE-06:ADEL.INPA")
#! Link("FE14I-VA-GAUGE-06:ADEL.INPA","FE14I-VA-GAUGE-06:P.VAL")
#! Record("FE14I-VA-PIRG-06:CTL:SETSP",20,345,0,0,"FE14I-VA-PIRG-06:CTL:SETSP")
#! Field("FE14I-VA-PIRG-06:CTL:SETSP.FLNK",16777215,1,"FE14I-VA-PIRG-06:CTL:SETSP.FLNK")
#! Field("FE14I-VA-PIRG-06:CTL:SETSP.OUT",16777215,1,"FE14I-VA-PIRG-06:CTL:SETSP.OUT")
#! Record("FE14I-VA-PIRG-06:CTL:ENABLE",380,331,0,0,"FE14I-VA-PIRG-06:CTL:ENABLE")
#! Field("FE14I-VA-PIRG-06:CTL:ENABLE.FLNK",16777215,1,"FE14I-VA-PIRG-06:CTL:ENABLE.FLNK")
#! Field("FE14I-VA-PIRG-06:CTL:ENABLE.OUT",16777215,1,"FE14I-VA-PIRG-06:CTL:ENABLE.OUT")
#! Record("FE14I-VA-PIRG-06:CTL:SP",200,352,0,0,"FE14I-VA-PIRG-06:CTL:SP")
#! Field("FE14I-VA-PIRG-06:CTL:SP.INP",16777215,1,"FE14I-VA-PIRG-06:CTL:SP.INP")
# mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-01:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY1:MODE")
    field(LNK2, "FE14I-VA-IMG-01:RLY1:DIR")
    field(LNK3, "FE14I-VA-IMG-01:RLY1:SP")
    field(LNK4, "FE14I-VA-IMG-01:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-IMG-01:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-01:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,1) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,1) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-01:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,1) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,1) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-01:RLY1:SP") 
{
  field(DESC, "Valve I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,1) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-01:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-01:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-01:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-01:RLY1:SETSP")
    field(LNK3, "FE14I-VA-IMG-01:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-01:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,1) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-6")
  field(SDIS, "FE14I-VA-IMG-01:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-01:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-01:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-01:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-IMG-01:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-01:RLY1:SP PP")
    field(LNK4, "FE14I-VA-IMG-01:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-01:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-01:RLY1:SPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,1) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-01:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,1) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-01:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-01:RLY1:SETSPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-01:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-01:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-01:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-01:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Valve I/L Off nominal")
  field(INPA, "FE14I-VA-IMG-01:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-01:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,1) ts1_1")
}

record(ao, "FE14I-VA-IMG-01:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,1) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY1:HYST")
  #field(DOL, "1.0e-6")
}

record(ai, "FE14I-VA-IMG-01:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,1) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-01:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-01:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-01:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-IMG-01:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-01:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-01:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-01:RLY1:EXISTS") 
{
  field(DESC, "Relay 1 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-01:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY2:MODE")
    field(LNK2, "FE14I-VA-IMG-01:RLY2:DIR")
    field(LNK3, "FE14I-VA-IMG-01:RLY2:SP")
    field(LNK4, "FE14I-VA-IMG-01:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-IMG-01:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-01:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,2) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,2) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-01:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,2) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,2) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-01:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,2) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-01:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-01:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-01:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-01:RLY2:SETSP")
    field(LNK3, "FE14I-VA-IMG-01:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-01:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,2) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-01:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-01:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-01:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-01:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-IMG-01:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-01:RLY2:SP PP")
    field(LNK4, "FE14I-VA-IMG-01:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-01:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-01:RLY2:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,2) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-01:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,2) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-01:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-01:RLY2:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-01:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-01:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-01:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-01:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-01:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-01:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,2) ts1_1")
}

record(ao, "FE14I-VA-IMG-01:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,2) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY2:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-01:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,2) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-01:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-01:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-01:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-IMG-01:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-01:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-01:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-01:RLY2:EXISTS") 
{
  field(DESC, "Relay 2 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-01:RLY3:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY3:MODE")
    field(LNK2, "FE14I-VA-IMG-01:RLY3:DIR")
    field(LNK3, "FE14I-VA-IMG-01:RLY3:SP")
    field(LNK4, "FE14I-VA-IMG-01:RLY3:SPOFF")
    field(LNK5, "FE14I-VA-IMG-01:RLY3:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-01:RLY3:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,3) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY3:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY3:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,3) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-01:RLY3:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,3) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY3:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY3:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,3) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-01:RLY3:SP") 
{
  field(DESC, "MPS I/L 2")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,3) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-01:RLY3:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-01:RLY3:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-01:RLY3:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY3:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-01:RLY3:SETSP")
    field(LNK3, "FE14I-VA-IMG-01:RLY3:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-01:RLY3:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,3) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-01:RLY3:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-01:RLY3:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-01:RLY3:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-01:RLY3:HYST PP")
    field(LNK2, "FE14I-VA-IMG-01:RLY3:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-01:RLY3:SP PP")
    field(LNK4, "FE14I-VA-IMG-01:RLY3:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-01:RLY3:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-01:RLY3:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,3) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-01:RLY3:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,3) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY3:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-01:RLY3:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-01:RLY3:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY3:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-01:RLY3:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY3:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-01:RLY3:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-01:RLY3:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-01:RLY3:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-01:RLY3:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-01:RLY3:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,3) ts1_1")
}

record(ao, "FE14I-VA-IMG-01:RLY3:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,3) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY3:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-01:RLY3:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,3) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-01:RLY3:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-01:RLY3:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-01:RLY3:SPOFF")
  field(LNK1, "FE14I-VA-IMG-01:RLY3:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-01:RLY3:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-01:RLY3:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-01:RLY3:EXISTS") 
{
  field(DESC, "Relay 3 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-01:RLY4:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY4:MODE")
    field(LNK2, "FE14I-VA-IMG-01:RLY4:DIR")
    field(LNK3, "FE14I-VA-IMG-01:RLY4:SP")
    field(LNK4, "FE14I-VA-IMG-01:RLY4:SPOFF")
    field(LNK5, "FE14I-VA-IMG-01:RLY4:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-01:RLY4:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,4) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY4:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY4:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,4) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-01:RLY4:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,4) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-01:RLY4:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-01:RLY4:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,4) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-01:RLY4:SP") 
{
  field(DESC, "RGA I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,4) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-01:RLY4:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-01:RLY4:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-01:RLY4:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-01:RLY4:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-01:RLY4:SETSP")
    field(LNK3, "FE14I-VA-IMG-01:RLY4:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-01:RLY4:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,4) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-4")
  field(SDIS, "FE14I-VA-IMG-01:RLY4:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-01:RLY4:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-01:RLY4:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-01:RLY4:HYST PP")
    field(LNK2, "FE14I-VA-IMG-01:RLY4:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-01:RLY4:SP PP")
    field(LNK4, "FE14I-VA-IMG-01:RLY4:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-01:RLY4:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-01:RLY4:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,4) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-01:RLY4:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,4) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY4:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-01:RLY4:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-01:RLY4:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY4:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-01:RLY4:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-01:RLY4:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-01:RLY4:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-01:RLY4:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-01:RLY4:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-01:RLY4:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-01:RLY4:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,4) ts1_1")
}

record(ao, "FE14I-VA-IMG-01:RLY4:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,4) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-01:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-01:RLY4:HYST")
  #field(DOL, "1.0e-4")
}

record(ai, "FE14I-VA-IMG-01:RLY4:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,4) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-01:RLY4:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-01:RLY4:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-01:RLY4:SPOFF")
  field(LNK1, "FE14I-VA-IMG-01:RLY4:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-01:RLY4:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-01:RLY4:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-01:RLY4:EXISTS") 
{
  field(DESC, "Relay 4 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-02:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY1:MODE")
    field(LNK2, "FE14I-VA-IMG-02:RLY1:DIR")
    field(LNK3, "FE14I-VA-IMG-02:RLY1:SP")
    field(LNK4, "FE14I-VA-IMG-02:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-IMG-02:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-02:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,5) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,5) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-02:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,5) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,5) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-02:RLY1:SP") 
{
  field(DESC, "Valve I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,5) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-02:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-02:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-02:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-02:RLY1:SETSP")
    field(LNK3, "FE14I-VA-IMG-02:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-02:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,5) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-6")
  field(SDIS, "FE14I-VA-IMG-02:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-02:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-02:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-02:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-IMG-02:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-02:RLY1:SP PP")
    field(LNK4, "FE14I-VA-IMG-02:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-02:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-02:RLY1:SPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,5) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-02:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,5) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-02:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-02:RLY1:SETSPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-02:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-02:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-02:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-02:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Valve I/L Off nominal")
  field(INPA, "FE14I-VA-IMG-02:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-02:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,5) ts1_1")
}

record(ao, "FE14I-VA-IMG-02:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,5) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY1:HYST")
  #field(DOL, "1.0e-6")
}

record(ai, "FE14I-VA-IMG-02:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,5) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-02:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-02:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-02:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-IMG-02:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-02:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-02:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-02:RLY1:EXISTS") 
{
  field(DESC, "Relay 5 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-02:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY2:MODE")
    field(LNK2, "FE14I-VA-IMG-02:RLY2:DIR")
    field(LNK3, "FE14I-VA-IMG-02:RLY2:SP")
    field(LNK4, "FE14I-VA-IMG-02:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-IMG-02:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-02:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,6) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,6) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-02:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,6) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,6) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-02:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,6) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-02:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-02:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-02:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-02:RLY2:SETSP")
    field(LNK3, "FE14I-VA-IMG-02:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-02:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,6) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-02:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-02:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-02:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-02:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-IMG-02:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-02:RLY2:SP PP")
    field(LNK4, "FE14I-VA-IMG-02:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-02:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-02:RLY2:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,6) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-02:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,6) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-02:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-02:RLY2:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-02:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-02:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-02:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-02:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-02:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-02:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,6) ts1_1")
}

record(ao, "FE14I-VA-IMG-02:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,6) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY2:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-02:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,6) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-02:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-02:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-02:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-IMG-02:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-02:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-02:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-02:RLY2:EXISTS") 
{
  field(DESC, "Relay 6 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-02:RLY3:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY3:MODE")
    field(LNK2, "FE14I-VA-IMG-02:RLY3:DIR")
    field(LNK3, "FE14I-VA-IMG-02:RLY3:SP")
    field(LNK4, "FE14I-VA-IMG-02:RLY3:SPOFF")
    field(LNK5, "FE14I-VA-IMG-02:RLY3:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-02:RLY3:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,7) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY3:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY3:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,7) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-02:RLY3:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,7) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY3:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY3:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,7) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-02:RLY3:SP") 
{
  field(DESC, "MPS I/L 2")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,7) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-02:RLY3:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-02:RLY3:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-02:RLY3:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY3:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-02:RLY3:SETSP")
    field(LNK3, "FE14I-VA-IMG-02:RLY3:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-02:RLY3:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,7) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-02:RLY3:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-02:RLY3:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-02:RLY3:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-02:RLY3:HYST PP")
    field(LNK2, "FE14I-VA-IMG-02:RLY3:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-02:RLY3:SP PP")
    field(LNK4, "FE14I-VA-IMG-02:RLY3:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-02:RLY3:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-02:RLY3:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,7) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-02:RLY3:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,7) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY3:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-02:RLY3:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-02:RLY3:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY3:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-02:RLY3:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-02:RLY3:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY3:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-02:RLY3:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-02:RLY3:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-02:RLY3:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-02:RLY3:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,7) ts1_1")
}

record(ao, "FE14I-VA-IMG-02:RLY3:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,7) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY3:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-02:RLY3:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,7) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-02:RLY3:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-02:RLY3:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-02:RLY3:SPOFF")
  field(LNK1, "FE14I-VA-IMG-02:RLY3:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-02:RLY3:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-02:RLY3:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-02:RLY3:EXISTS") 
{
  field(DESC, "Relay 7 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-02:RLY4:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY4:MODE")
    field(LNK2, "FE14I-VA-IMG-02:RLY4:DIR")
    field(LNK3, "FE14I-VA-IMG-02:RLY4:SP")
    field(LNK4, "FE14I-VA-IMG-02:RLY4:SPOFF")
    field(LNK5, "FE14I-VA-IMG-02:RLY4:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-02:RLY4:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,8) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY4:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY4:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,8) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-02:RLY4:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,8) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-02:RLY4:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-02:RLY4:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,8) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-02:RLY4:SP") 
{
  field(DESC, "RGA I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,8) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-02:RLY4:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-02:RLY4:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-02:RLY4:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-02:RLY4:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-02:RLY4:SETSP")
    field(LNK3, "FE14I-VA-IMG-02:RLY4:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-02:RLY4:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,8) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-4")
  field(SDIS, "FE14I-VA-IMG-02:RLY4:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-02:RLY4:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-02:RLY4:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-02:RLY4:HYST PP")
    field(LNK2, "FE14I-VA-IMG-02:RLY4:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-02:RLY4:SP PP")
    field(LNK4, "FE14I-VA-IMG-02:RLY4:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-02:RLY4:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-02:RLY4:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,8) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-02:RLY4:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,8) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY4:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-02:RLY4:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-02:RLY4:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY4:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-02:RLY4:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-02:RLY4:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-02:RLY4:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-02:RLY4:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-02:RLY4:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-02:RLY4:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-02:RLY4:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,8) ts1_1")
}

record(ao, "FE14I-VA-IMG-02:RLY4:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,8) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-02:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-02:RLY4:HYST")
  #field(DOL, "1.0e-4")
}

record(ai, "FE14I-VA-IMG-02:RLY4:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,8) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-02:RLY4:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-02:RLY4:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-02:RLY4:SPOFF")
  field(LNK1, "FE14I-VA-IMG-02:RLY4:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-02:RLY4:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-02:RLY4:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-02:RLY4:EXISTS") 
{
  field(DESC, "Relay 8 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-03:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY1:MODE")
    field(LNK2, "FE14I-VA-IMG-03:RLY1:DIR")
    field(LNK3, "FE14I-VA-IMG-03:RLY1:SP")
    field(LNK4, "FE14I-VA-IMG-03:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-IMG-03:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-03:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,1) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,1) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-03:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,1) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,1) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-03:RLY1:SP") 
{
  field(DESC, "Valve I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,1) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-03:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-03:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-03:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-03:RLY1:SETSP")
    field(LNK3, "FE14I-VA-IMG-03:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-03:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,1) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-6")
  field(SDIS, "FE14I-VA-IMG-03:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-03:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-03:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-03:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-IMG-03:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-03:RLY1:SP PP")
    field(LNK4, "FE14I-VA-IMG-03:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-03:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-03:RLY1:SPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,1) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-03:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,1) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-03:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-03:RLY1:SETSPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-03:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-03:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-03:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-03:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Valve I/L Off nominal")
  field(INPA, "FE14I-VA-IMG-03:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-03:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,1) ts1_2")
}

record(ao, "FE14I-VA-IMG-03:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,1) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY1:HYST")
  #field(DOL, "1.0e-6")
}

record(ai, "FE14I-VA-IMG-03:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,1) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-03:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-03:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-03:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-IMG-03:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-03:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-03:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-03:RLY1:EXISTS") 
{
  field(DESC, "Relay 1 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-03:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY2:MODE")
    field(LNK2, "FE14I-VA-IMG-03:RLY2:DIR")
    field(LNK3, "FE14I-VA-IMG-03:RLY2:SP")
    field(LNK4, "FE14I-VA-IMG-03:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-IMG-03:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-03:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,2) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,2) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-03:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,2) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,2) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-03:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,2) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-03:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-03:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-03:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-03:RLY2:SETSP")
    field(LNK3, "FE14I-VA-IMG-03:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-03:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,2) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-03:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-03:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-03:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-03:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-IMG-03:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-03:RLY2:SP PP")
    field(LNK4, "FE14I-VA-IMG-03:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-03:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-03:RLY2:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,2) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-03:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,2) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-03:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-03:RLY2:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-03:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-03:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-03:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-03:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-03:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-03:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,2) ts1_2")
}

record(ao, "FE14I-VA-IMG-03:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,2) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY2:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-03:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,2) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-03:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-03:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-03:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-IMG-03:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-03:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-03:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-03:RLY2:EXISTS") 
{
  field(DESC, "Relay 2 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-03:RLY3:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY3:MODE")
    field(LNK2, "FE14I-VA-IMG-03:RLY3:DIR")
    field(LNK3, "FE14I-VA-IMG-03:RLY3:SP")
    field(LNK4, "FE14I-VA-IMG-03:RLY3:SPOFF")
    field(LNK5, "FE14I-VA-IMG-03:RLY3:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-03:RLY3:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,3) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY3:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY3:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,3) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-03:RLY3:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,3) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY3:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY3:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,3) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-03:RLY3:SP") 
{
  field(DESC, "MPS I/L 2")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,3) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-03:RLY3:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-03:RLY3:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-03:RLY3:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY3:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-03:RLY3:SETSP")
    field(LNK3, "FE14I-VA-IMG-03:RLY3:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-03:RLY3:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,3) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-03:RLY3:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-03:RLY3:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-03:RLY3:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-03:RLY3:HYST PP")
    field(LNK2, "FE14I-VA-IMG-03:RLY3:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-03:RLY3:SP PP")
    field(LNK4, "FE14I-VA-IMG-03:RLY3:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-03:RLY3:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-03:RLY3:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,3) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-03:RLY3:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,3) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY3:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-03:RLY3:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-03:RLY3:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY3:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-03:RLY3:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY3:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-03:RLY3:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-03:RLY3:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-03:RLY3:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-03:RLY3:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-03:RLY3:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,3) ts1_2")
}

record(ao, "FE14I-VA-IMG-03:RLY3:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,3) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY3:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-03:RLY3:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,3) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-03:RLY3:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-03:RLY3:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-03:RLY3:SPOFF")
  field(LNK1, "FE14I-VA-IMG-03:RLY3:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-03:RLY3:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-03:RLY3:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-03:RLY3:EXISTS") 
{
  field(DESC, "Relay 3 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-03:RLY4:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY4:MODE")
    field(LNK2, "FE14I-VA-IMG-03:RLY4:DIR")
    field(LNK3, "FE14I-VA-IMG-03:RLY4:SP")
    field(LNK4, "FE14I-VA-IMG-03:RLY4:SPOFF")
    field(LNK5, "FE14I-VA-IMG-03:RLY4:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-03:RLY4:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,4) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY4:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY4:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,4) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-03:RLY4:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,4) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-03:RLY4:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-03:RLY4:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,4) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-03:RLY4:SP") 
{
  field(DESC, "RGA I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,4) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-03:RLY4:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-03:RLY4:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-03:RLY4:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-03:RLY4:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-03:RLY4:SETSP")
    field(LNK3, "FE14I-VA-IMG-03:RLY4:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-03:RLY4:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,4) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-4")
  field(SDIS, "FE14I-VA-IMG-03:RLY4:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-03:RLY4:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-03:RLY4:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-03:RLY4:HYST PP")
    field(LNK2, "FE14I-VA-IMG-03:RLY4:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-03:RLY4:SP PP")
    field(LNK4, "FE14I-VA-IMG-03:RLY4:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-03:RLY4:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-03:RLY4:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,4) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-03:RLY4:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,4) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY4:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-03:RLY4:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-03:RLY4:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY4:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-03:RLY4:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-03:RLY4:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-03:RLY4:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-03:RLY4:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-03:RLY4:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-03:RLY4:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-03:RLY4:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,4) ts1_2")
}

record(ao, "FE14I-VA-IMG-03:RLY4:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,4) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-03:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-03:RLY4:HYST")
  #field(DOL, "1.0e-4")
}

record(ai, "FE14I-VA-IMG-03:RLY4:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,4) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-03:RLY4:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-03:RLY4:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-03:RLY4:SPOFF")
  field(LNK1, "FE14I-VA-IMG-03:RLY4:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-03:RLY4:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-03:RLY4:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-03:RLY4:EXISTS") 
{
  field(DESC, "Relay 4 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-05:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY1:MODE")
    field(LNK2, "FE14I-VA-IMG-05:RLY1:DIR")
    field(LNK3, "FE14I-VA-IMG-05:RLY1:SP")
    field(LNK4, "FE14I-VA-IMG-05:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-IMG-05:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-05:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,5) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,5) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-05:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,5) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,5) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-05:RLY1:SP") 
{
  field(DESC, "Valve I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,5) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-05:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-05:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-05:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-05:RLY1:SETSP")
    field(LNK3, "FE14I-VA-IMG-05:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-05:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,5) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-6")
  field(SDIS, "FE14I-VA-IMG-05:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-05:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-05:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-05:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-IMG-05:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-05:RLY1:SP PP")
    field(LNK4, "FE14I-VA-IMG-05:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-05:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-05:RLY1:SPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,5) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-05:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,5) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-05:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-05:RLY1:SETSPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-05:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-05:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-05:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-05:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-05:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Valve I/L Off nominal")
  field(INPA, "FE14I-VA-IMG-05:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-05:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,5) ts1_2")
}

record(ao, "FE14I-VA-IMG-05:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,5) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY1:HYST")
  #field(DOL, "1.0e-6")
}

record(ai, "FE14I-VA-IMG-05:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,5) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-05:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-05:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-05:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-IMG-05:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-05:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-05:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-05:RLY1:EXISTS") 
{
  field(DESC, "Relay 5 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-05:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY2:MODE")
    field(LNK2, "FE14I-VA-IMG-05:RLY2:DIR")
    field(LNK3, "FE14I-VA-IMG-05:RLY2:SP")
    field(LNK4, "FE14I-VA-IMG-05:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-IMG-05:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-05:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,6) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,6) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-05:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,6) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,6) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-05:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,6) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-05:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-05:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-05:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-05:RLY2:SETSP")
    field(LNK3, "FE14I-VA-IMG-05:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-05:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,6) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-05:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-05:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-05:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-05:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-IMG-05:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-05:RLY2:SP PP")
    field(LNK4, "FE14I-VA-IMG-05:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-05:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-05:RLY2:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,6) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-05:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,6) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-05:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-05:RLY2:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-05:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-05:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-05:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-05:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-05:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-05:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-05:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,6) ts1_2")
}

record(ao, "FE14I-VA-IMG-05:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,6) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY2:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-05:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,6) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-05:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-05:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-05:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-IMG-05:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-05:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-05:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-05:RLY2:EXISTS") 
{
  field(DESC, "Relay 6 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-05:RLY3:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY3:MODE")
    field(LNK2, "FE14I-VA-IMG-05:RLY3:DIR")
    field(LNK3, "FE14I-VA-IMG-05:RLY3:SP")
    field(LNK4, "FE14I-VA-IMG-05:RLY3:SPOFF")
    field(LNK5, "FE14I-VA-IMG-05:RLY3:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-05:RLY3:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,7) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY3:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY3:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,7) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-05:RLY3:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,7) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY3:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY3:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,7) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-05:RLY3:SP") 
{
  field(DESC, "MPS I/L 2")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,7) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-05:RLY3:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-05:RLY3:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-05:RLY3:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY3:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-05:RLY3:SETSP")
    field(LNK3, "FE14I-VA-IMG-05:RLY3:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-05:RLY3:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,7) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-05:RLY3:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-05:RLY3:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-05:RLY3:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-05:RLY3:HYST PP")
    field(LNK2, "FE14I-VA-IMG-05:RLY3:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-05:RLY3:SP PP")
    field(LNK4, "FE14I-VA-IMG-05:RLY3:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-05:RLY3:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-05:RLY3:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,7) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-05:RLY3:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,7) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY3:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-05:RLY3:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-05:RLY3:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY3:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-05:RLY3:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-05:RLY3:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-05:RLY3:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-05:RLY3:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-05:RLY3:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-05:RLY3:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-05:RLY3:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,7) ts1_2")
}

record(ao, "FE14I-VA-IMG-05:RLY3:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,7) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY3:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-05:RLY3:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,7) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-05:RLY3:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-05:RLY3:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-05:RLY3:SPOFF")
  field(LNK1, "FE14I-VA-IMG-05:RLY3:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-05:RLY3:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-05:RLY3:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-05:RLY3:EXISTS") 
{
  field(DESC, "Relay 7 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-05:RLY4:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY4:MODE")
    field(LNK2, "FE14I-VA-IMG-05:RLY4:DIR")
    field(LNK3, "FE14I-VA-IMG-05:RLY4:SP")
    field(LNK4, "FE14I-VA-IMG-05:RLY4:SPOFF")
    field(LNK5, "FE14I-VA-IMG-05:RLY4:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-05:RLY4:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,8) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY4:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY4:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,8) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-05:RLY4:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,8) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-05:RLY4:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-05:RLY4:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,8) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-05:RLY4:SP") 
{
  field(DESC, "RGA I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,8) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-05:RLY4:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-05:RLY4:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-05:RLY4:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-05:RLY4:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-05:RLY4:SETSP")
    field(LNK3, "FE14I-VA-IMG-05:RLY4:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-05:RLY4:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,8) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-4")
  field(SDIS, "FE14I-VA-IMG-05:RLY4:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-05:RLY4:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-05:RLY4:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-05:RLY4:HYST PP")
    field(LNK2, "FE14I-VA-IMG-05:RLY4:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-05:RLY4:SP PP")
    field(LNK4, "FE14I-VA-IMG-05:RLY4:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-05:RLY4:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-05:RLY4:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,8) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-05:RLY4:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,8) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY4:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-05:RLY4:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-05:RLY4:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY4:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-05:RLY4:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-05:RLY4:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-05:RLY4:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-05:RLY4:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-05:RLY4:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-05:RLY4:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-05:RLY4:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,8) ts1_2")
}

record(ao, "FE14I-VA-IMG-05:RLY4:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,8) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-05:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-05:RLY4:HYST")
  #field(DOL, "1.0e-4")
}

record(ai, "FE14I-VA-IMG-05:RLY4:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,8) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-05:RLY4:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-05:RLY4:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-05:RLY4:SPOFF")
  field(LNK1, "FE14I-VA-IMG-05:RLY4:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-05:RLY4:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-05:RLY4:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-05:RLY4:EXISTS") 
{
  field(DESC, "Relay 8 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-04:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY1:MODE")
    field(LNK2, "FE14I-VA-IMG-04:RLY1:DIR")
    field(LNK3, "FE14I-VA-IMG-04:RLY1:SP")
    field(LNK4, "FE14I-VA-IMG-04:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-IMG-04:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-04:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,1) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,1) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-04:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,1) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,1) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-04:RLY1:SP") 
{
  field(DESC, "Valve I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,1) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-04:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-04:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-04:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-04:RLY1:SETSP")
    field(LNK3, "FE14I-VA-IMG-04:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-04:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,1) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-6")
  field(SDIS, "FE14I-VA-IMG-04:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-04:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-04:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-04:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-IMG-04:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-04:RLY1:SP PP")
    field(LNK4, "FE14I-VA-IMG-04:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-04:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-04:RLY1:SPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,1) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-04:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,1) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-04:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-04:RLY1:SETSPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-04:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-04:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-04:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-04:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Valve I/L Off nominal")
  field(INPA, "FE14I-VA-IMG-04:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-04:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,1) ts1_3")
}

record(ao, "FE14I-VA-IMG-04:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,1) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY1:HYST")
  #field(DOL, "1.0e-6")
}

record(ai, "FE14I-VA-IMG-04:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,1) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-04:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-04:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-04:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-IMG-04:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-04:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-04:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-04:RLY1:EXISTS") 
{
  field(DESC, "Relay 1 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-04:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY2:MODE")
    field(LNK2, "FE14I-VA-IMG-04:RLY2:DIR")
    field(LNK3, "FE14I-VA-IMG-04:RLY2:SP")
    field(LNK4, "FE14I-VA-IMG-04:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-IMG-04:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-04:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,2) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,2) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-04:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,2) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,2) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-04:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,2) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-04:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-04:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-04:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-04:RLY2:SETSP")
    field(LNK3, "FE14I-VA-IMG-04:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-04:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,2) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-04:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-04:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-04:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-04:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-IMG-04:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-04:RLY2:SP PP")
    field(LNK4, "FE14I-VA-IMG-04:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-04:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-04:RLY2:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,2) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-04:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,2) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-04:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-04:RLY2:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-04:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-04:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-04:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-04:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-04:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-04:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,2) ts1_3")
}

record(ao, "FE14I-VA-IMG-04:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,2) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY2:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-04:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,2) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-04:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-04:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-04:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-IMG-04:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-04:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-04:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-04:RLY2:EXISTS") 
{
  field(DESC, "Relay 2 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-04:RLY3:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY3:MODE")
    field(LNK2, "FE14I-VA-IMG-04:RLY3:DIR")
    field(LNK3, "FE14I-VA-IMG-04:RLY3:SP")
    field(LNK4, "FE14I-VA-IMG-04:RLY3:SPOFF")
    field(LNK5, "FE14I-VA-IMG-04:RLY3:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-04:RLY3:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,3) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY3:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY3:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,3) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-04:RLY3:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,3) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY3:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY3:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,3) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-04:RLY3:SP") 
{
  field(DESC, "MPS I/L 2")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,3) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-04:RLY3:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-04:RLY3:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-04:RLY3:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY3:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-04:RLY3:SETSP")
    field(LNK3, "FE14I-VA-IMG-04:RLY3:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-04:RLY3:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,3) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-04:RLY3:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-04:RLY3:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-04:RLY3:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-04:RLY3:HYST PP")
    field(LNK2, "FE14I-VA-IMG-04:RLY3:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-04:RLY3:SP PP")
    field(LNK4, "FE14I-VA-IMG-04:RLY3:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-04:RLY3:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-04:RLY3:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,3) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-04:RLY3:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,3) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY3:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-04:RLY3:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-04:RLY3:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY3:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-04:RLY3:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-04:RLY3:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY3:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-04:RLY3:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-04:RLY3:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-04:RLY3:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-04:RLY3:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,3) ts1_3")
}

record(ao, "FE14I-VA-IMG-04:RLY3:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,3) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY3:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-04:RLY3:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,3) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-04:RLY3:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-04:RLY3:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-04:RLY3:SPOFF")
  field(LNK1, "FE14I-VA-IMG-04:RLY3:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-04:RLY3:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-04:RLY3:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-04:RLY3:EXISTS") 
{
  field(DESC, "Relay 3 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-04:RLY4:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY4:MODE")
    field(LNK2, "FE14I-VA-IMG-04:RLY4:DIR")
    field(LNK3, "FE14I-VA-IMG-04:RLY4:SP")
    field(LNK4, "FE14I-VA-IMG-04:RLY4:SPOFF")
    field(LNK5, "FE14I-VA-IMG-04:RLY4:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-04:RLY4:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,4) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY4:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY4:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,4) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-04:RLY4:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,4) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-04:RLY4:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-04:RLY4:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,4) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-04:RLY4:SP") 
{
  field(DESC, "RGA I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,4) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-04:RLY4:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-04:RLY4:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-04:RLY4:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-04:RLY4:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-04:RLY4:SETSP")
    field(LNK3, "FE14I-VA-IMG-04:RLY4:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-04:RLY4:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,4) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-4")
  field(SDIS, "FE14I-VA-IMG-04:RLY4:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-04:RLY4:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-04:RLY4:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-04:RLY4:HYST PP")
    field(LNK2, "FE14I-VA-IMG-04:RLY4:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-04:RLY4:SP PP")
    field(LNK4, "FE14I-VA-IMG-04:RLY4:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-04:RLY4:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-04:RLY4:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,4) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-04:RLY4:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,4) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY4:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-04:RLY4:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-04:RLY4:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY4:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-04:RLY4:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-04:RLY4:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-04:RLY4:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-04:RLY4:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-04:RLY4:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-04:RLY4:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-04:RLY4:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,4) ts1_3")
}

record(ao, "FE14I-VA-IMG-04:RLY4:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,4) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-04:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-04:RLY4:HYST")
  #field(DOL, "1.0e-4")
}

record(ai, "FE14I-VA-IMG-04:RLY4:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,4) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-04:RLY4:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-04:RLY4:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-04:RLY4:SPOFF")
  field(LNK1, "FE14I-VA-IMG-04:RLY4:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-04:RLY4:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-04:RLY4:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-04:RLY4:EXISTS") 
{
  field(DESC, "Relay 4 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-06:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY1:MODE")
    field(LNK2, "FE14I-VA-IMG-06:RLY1:DIR")
    field(LNK3, "FE14I-VA-IMG-06:RLY1:SP")
    field(LNK4, "FE14I-VA-IMG-06:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-IMG-06:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-06:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,5) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,5) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-06:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,5) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,5) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-06:RLY1:SP") 
{
  field(DESC, "Valve I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,5) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-06:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-06:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-06:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-06:RLY1:SETSP")
    field(LNK3, "FE14I-VA-IMG-06:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-06:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,5) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-6")
  field(SDIS, "FE14I-VA-IMG-06:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-06:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-06:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-06:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-IMG-06:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-06:RLY1:SP PP")
    field(LNK4, "FE14I-VA-IMG-06:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-06:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-06:RLY1:SPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,5) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-06:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,5) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-06:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-06:RLY1:SETSPOFF") 
{
  field(DESC, "Valve I/L Off")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-06:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-06:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-06:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-06:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-06:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Valve I/L Off nominal")
  field(INPA, "FE14I-VA-IMG-06:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-06:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,5) ts1_3")
}

record(ao, "FE14I-VA-IMG-06:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,5) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY1:HYST")
  #field(DOL, "1.0e-6")
}

record(ai, "FE14I-VA-IMG-06:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,5) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-06:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-06:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-06:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-IMG-06:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-06:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-06:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-06:RLY1:EXISTS") 
{
  field(DESC, "Relay 5 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-06:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY2:MODE")
    field(LNK2, "FE14I-VA-IMG-06:RLY2:DIR")
    field(LNK3, "FE14I-VA-IMG-06:RLY2:SP")
    field(LNK4, "FE14I-VA-IMG-06:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-IMG-06:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-06:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,6) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,6) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-06:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,6) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,6) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-06:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,6) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-06:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-06:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-06:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-06:RLY2:SETSP")
    field(LNK3, "FE14I-VA-IMG-06:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-06:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,6) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-06:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-06:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-06:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-06:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-IMG-06:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-06:RLY2:SP PP")
    field(LNK4, "FE14I-VA-IMG-06:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-06:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-06:RLY2:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,6) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-06:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,6) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-06:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-06:RLY2:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-06:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-06:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-06:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-06:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-06:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-06:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-06:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,6) ts1_3")
}

record(ao, "FE14I-VA-IMG-06:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,6) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY2:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-06:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,6) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-06:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-06:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-06:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-IMG-06:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-06:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-06:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-06:RLY2:EXISTS") 
{
  field(DESC, "Relay 6 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-06:RLY3:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY3:MODE")
    field(LNK2, "FE14I-VA-IMG-06:RLY3:DIR")
    field(LNK3, "FE14I-VA-IMG-06:RLY3:SP")
    field(LNK4, "FE14I-VA-IMG-06:RLY3:SPOFF")
    field(LNK5, "FE14I-VA-IMG-06:RLY3:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-06:RLY3:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,7) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY3:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY3:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,7) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-06:RLY3:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,7) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY3:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY3:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,7) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-06:RLY3:SP") 
{
  field(DESC, "MPS I/L 2")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,7) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-06:RLY3:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-06:RLY3:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-06:RLY3:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY3:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-06:RLY3:SETSP")
    field(LNK3, "FE14I-VA-IMG-06:RLY3:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-06:RLY3:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,7) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-7")
  field(SDIS, "FE14I-VA-IMG-06:RLY3:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-06:RLY3:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-06:RLY3:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-06:RLY3:HYST PP")
    field(LNK2, "FE14I-VA-IMG-06:RLY3:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-06:RLY3:SP PP")
    field(LNK4, "FE14I-VA-IMG-06:RLY3:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-06:RLY3:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-06:RLY3:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,7) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-6")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-06:RLY3:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,7) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY3:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-06:RLY3:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-06:RLY3:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY3:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-06:RLY3:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-06:RLY3:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-06:RLY3:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-06:RLY3:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-06:RLY3:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-06:RLY3:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-06:RLY3:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,7) ts1_3")
}

record(ao, "FE14I-VA-IMG-06:RLY3:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,7) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY3:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY3:HYST")
  #field(DOL, "1.0e-7")
}

record(ai, "FE14I-VA-IMG-06:RLY3:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,7) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-06:RLY3:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-06:RLY3:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-06:RLY3:SPOFF")
  field(LNK1, "FE14I-VA-IMG-06:RLY3:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-06:RLY3:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-06:RLY3:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-06:RLY3:EXISTS") 
{
  field(DESC, "Relay 7 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-06:RLY4:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY4:MODE")
    field(LNK2, "FE14I-VA-IMG-06:RLY4:DIR")
    field(LNK3, "FE14I-VA-IMG-06:RLY4:SP")
    field(LNK4, "FE14I-VA-IMG-06:RLY4:SPOFF")
    field(LNK5, "FE14I-VA-IMG-06:RLY4:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-IMG-06:RLY4:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,8) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY4:MODE PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY4:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,8) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-IMG-06:RLY4:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,8) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-IMG-06:RLY4:DIR PP")
}

record(mbbi, "FE14I-VA-IMG-06:RLY4:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,8) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-IMG-06:RLY4:SP") 
{
  field(DESC, "RGA I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,8) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-06:RLY4:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-06:RLY4:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-06:RLY4:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-06:RLY4:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-06:RLY4:SETSP")
    field(LNK3, "FE14I-VA-IMG-06:RLY4:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-06:RLY4:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,8) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "1.2e-2")
  field(LOPR, "2.7e-10")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-4")
  field(SDIS, "FE14I-VA-IMG-06:RLY4:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-IMG-06:RLY4:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-IMG-06:RLY4:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IMG-06:RLY4:HYST PP")
    field(LNK2, "FE14I-VA-IMG-06:RLY4:SETSPOFF PP")
    field(LNK3, "FE14I-VA-IMG-06:RLY4:SP PP")
    field(LNK4, "FE14I-VA-IMG-06:RLY4:SPOFF PP")
    field(LNK5, "FE14I-VA-IMG-06:RLY4:SELSPOFF PP")
}


record(ai, "FE14I-VA-IMG-06:RLY4:SPOFF") 
{
  field(DESC, "")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,8) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "1.3e-2")
  field(LOLO, "2.6e-10")
  field(HIGH, "1.1e-4")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-IMG-06:RLY4:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,8) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY4:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-IMG-06:RLY4:SELSPOFF")
}


record(ai, "FE14I-VA-IMG-06:RLY4:SETSPOFF") 
{
  field(DESC, "")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY4:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-IMG-06:RLY4:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-IMG-06:RLY4:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-IMG-06:RLY4:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-IMG-06:RLY4:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-IMG-06:RLY4:SPOFFNOMINAL") 
  {
  field(DESC, " nominal")
  field(INPA, "FE14I-VA-IMG-06:RLY4:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-IMG-06:RLY4:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,8) ts1_3")
}

record(ao, "FE14I-VA-IMG-06:RLY4:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,8) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-IMG-06:RLY4:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-IMG-06:RLY4:HYST")
  #field(DOL, "1.0e-4")
}

record(ai, "FE14I-VA-IMG-06:RLY4:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,8) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-IMG-06:RLY4:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-IMG-06:RLY4:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-IMG-06:RLY4:SPOFF")
  field(LNK1, "FE14I-VA-IMG-06:RLY4:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-06:RLY4:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-IMG-06:RLY4:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-IMG-06:RLY4:EXISTS") 
{
  field(DESC, "Relay 8 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-01:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-01:RLY1:MODE")
    field(LNK2, "FE14I-VA-PIRG-01:RLY1:DIR")
    field(LNK3, "FE14I-VA-PIRG-01:RLY1:SP")
    field(LNK4, "FE14I-VA-PIRG-01:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-01:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-01:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,9) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-01:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-01:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,9) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-01:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,9) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-01:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-01:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,9) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-01:RLY1:SP") 
{
  field(DESC, "Ion Pump I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,9) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-01:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-01:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-01:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-01:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-01:RLY1:SETSP")
    field(LNK3, "FE14I-VA-PIRG-01:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-01:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,9) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(DRVH, "950")
  field(DRVL, "2.7e-3")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-01:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-01:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-01:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-01:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-01:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-01:RLY1:SP PP")
    field(LNK4, "FE14I-VA-PIRG-01:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-01:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-01:RLY1:SPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,9) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-01:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,9) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-01:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-01:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-01:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-01:RLY1:SETSPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-01:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-01:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-01:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-01:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-01:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-01:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Ion Pump I/L nominal")
  field(INPA, "FE14I-VA-PIRG-01:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-01:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,9) ts1_1")
}

record(ao, "FE14I-VA-PIRG-01:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,9) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-01:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-01:RLY1:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-01:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,9) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-01:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-01:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-01:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-01:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-01:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-01:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-01:RLY1:EXISTS") 
{
  field(DESC, "Relay 9 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-01:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-01:RLY2:MODE")
    field(LNK2, "FE14I-VA-PIRG-01:RLY2:DIR")
    field(LNK3, "FE14I-VA-PIRG-01:RLY2:SP")
    field(LNK4, "FE14I-VA-PIRG-01:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-01:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-01:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,10) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-01:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-01:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,10) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-01:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,10) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-01:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-01:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,10) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-01:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,10) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-01:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-01:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-01:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-01:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-01:RLY2:SETSP")
    field(LNK3, "FE14I-VA-PIRG-01:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-01:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,10) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(DRVH, "950")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-01:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-01:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-01:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-01:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-01:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-01:RLY2:SP PP")
    field(LNK4, "FE14I-VA-PIRG-01:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-01:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-01:RLY2:SPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,10) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-01:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,10) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-01:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-01:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-01:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-01:RLY2:SETSPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-01:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-01:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-01:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-01:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-01:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-01:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, "MPS I/L nominal")
  field(INPA, "FE14I-VA-PIRG-01:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-01:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,10) ts1_1")
}

record(ao, "FE14I-VA-PIRG-01:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,10) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-01:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-01:RLY2:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-01:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,10) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-01:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-01:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-01:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-01:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-01:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-01:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-01:RLY2:EXISTS") 
{
  field(DESC, "Relay 10 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-02:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-02:RLY1:MODE")
    field(LNK2, "FE14I-VA-PIRG-02:RLY1:DIR")
    field(LNK3, "FE14I-VA-PIRG-02:RLY1:SP")
    field(LNK4, "FE14I-VA-PIRG-02:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-02:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-02:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,11) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-02:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-02:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,11) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-02:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,11) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-02:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-02:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,11) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-02:RLY1:SP") 
{
  field(DESC, "Ion Pump I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,11) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-02:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-02:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-02:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-02:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-02:RLY1:SETSP")
    field(LNK3, "FE14I-VA-PIRG-02:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-02:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,11) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(DRVH, "950")
  field(DRVL, "2.7e-3")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-02:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-02:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-02:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-02:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-02:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-02:RLY1:SP PP")
    field(LNK4, "FE14I-VA-PIRG-02:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-02:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-02:RLY1:SPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,11) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-02:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,11) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-02:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-02:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-02:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-02:RLY1:SETSPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-02:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-02:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-02:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-02:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-02:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-02:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Ion Pump I/L nominal")
  field(INPA, "FE14I-VA-PIRG-02:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-02:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,11) ts1_1")
}

record(ao, "FE14I-VA-PIRG-02:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,11) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-02:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-02:RLY1:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-02:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,11) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-02:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-02:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-02:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-02:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-02:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-02:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-02:RLY1:EXISTS") 
{
  field(DESC, "Relay 11 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-02:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-02:RLY2:MODE")
    field(LNK2, "FE14I-VA-PIRG-02:RLY2:DIR")
    field(LNK3, "FE14I-VA-PIRG-02:RLY2:SP")
    field(LNK4, "FE14I-VA-PIRG-02:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-02:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-02:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,12) ts1_1")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-02:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-02:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,12) ts1_1")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-02:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,12) ts1_1")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-02:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-02:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,12) ts1_1")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-02:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,12) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-02:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-02:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-02:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-02:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-02:RLY2:SETSP")
    field(LNK3, "FE14I-VA-PIRG-02:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-02:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,12) ts1_1")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(DRVH, "950")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-02:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-02:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-02:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-02:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-02:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-02:RLY2:SP PP")
    field(LNK4, "FE14I-VA-PIRG-02:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-02:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-02:RLY2:SPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,12) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-02:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,12) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-02:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-02:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-02:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-02:RLY2:SETSPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-02:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-02:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-02:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-02:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-02:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-02:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, "MPS I/L nominal")
  field(INPA, "FE14I-VA-PIRG-02:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-02:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,12) ts1_1")
}

record(ao, "FE14I-VA-PIRG-02:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,12) ts1_1")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-02:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-02:RLY2:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-02:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,12) ts1_1")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-02:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-02:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-02:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-02:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-02:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-02:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-02:RLY2:EXISTS") 
{
  field(DESC, "Relay 12 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-03:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-03:RLY1:MODE")
    field(LNK2, "FE14I-VA-PIRG-03:RLY1:DIR")
    field(LNK3, "FE14I-VA-PIRG-03:RLY1:SP")
    field(LNK4, "FE14I-VA-PIRG-03:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-03:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-03:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,9) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-03:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-03:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,9) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-03:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,9) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-03:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-03:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,9) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-03:RLY1:SP") 
{
  field(DESC, "Ion Pump I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,9) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-03:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-03:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-03:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-03:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-03:RLY1:SETSP")
    field(LNK3, "FE14I-VA-PIRG-03:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-03:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,9) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(DRVH, "950")
  field(DRVL, "2.7e-3")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-03:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-03:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-03:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-03:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-03:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-03:RLY1:SP PP")
    field(LNK4, "FE14I-VA-PIRG-03:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-03:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-03:RLY1:SPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,9) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-03:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,9) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-03:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-03:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-03:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-03:RLY1:SETSPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-03:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-03:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-03:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-03:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-03:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-03:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Ion Pump I/L nominal")
  field(INPA, "FE14I-VA-PIRG-03:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-03:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,9) ts1_2")
}

record(ao, "FE14I-VA-PIRG-03:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,9) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-03:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-03:RLY1:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-03:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,9) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-03:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-03:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-03:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-03:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-03:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-03:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-03:RLY1:EXISTS") 
{
  field(DESC, "Relay 9 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-03:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-03:RLY2:MODE")
    field(LNK2, "FE14I-VA-PIRG-03:RLY2:DIR")
    field(LNK3, "FE14I-VA-PIRG-03:RLY2:SP")
    field(LNK4, "FE14I-VA-PIRG-03:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-03:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-03:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,10) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-03:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-03:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,10) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-03:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,10) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-03:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-03:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,10) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-03:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,10) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-03:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-03:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-03:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-03:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-03:RLY2:SETSP")
    field(LNK3, "FE14I-VA-PIRG-03:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-03:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,10) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(DRVH, "950")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-03:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-03:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-03:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-03:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-03:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-03:RLY2:SP PP")
    field(LNK4, "FE14I-VA-PIRG-03:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-03:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-03:RLY2:SPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,10) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-03:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,10) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-03:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-03:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-03:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-03:RLY2:SETSPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-03:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-03:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-03:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-03:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-03:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-03:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, "MPS I/L nominal")
  field(INPA, "FE14I-VA-PIRG-03:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-03:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,10) ts1_2")
}

record(ao, "FE14I-VA-PIRG-03:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,10) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-03:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-03:RLY2:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-03:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,10) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-03:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-03:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-03:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-03:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-03:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-03:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-03:RLY2:EXISTS") 
{
  field(DESC, "Relay 10 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-05:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-05:RLY1:MODE")
    field(LNK2, "FE14I-VA-PIRG-05:RLY1:DIR")
    field(LNK3, "FE14I-VA-PIRG-05:RLY1:SP")
    field(LNK4, "FE14I-VA-PIRG-05:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-05:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-05:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,11) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-05:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-05:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,11) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-05:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,11) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-05:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-05:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,11) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-05:RLY1:SP") 
{
  field(DESC, "Ion Pump I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,11) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-05:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-05:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-05:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-05:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-05:RLY1:SETSP")
    field(LNK3, "FE14I-VA-PIRG-05:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-05:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,11) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(DRVH, "950")
  field(DRVL, "2.7e-3")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-05:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-05:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-05:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-05:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-05:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-05:RLY1:SP PP")
    field(LNK4, "FE14I-VA-PIRG-05:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-05:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-05:RLY1:SPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,11) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-05:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,11) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-05:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-05:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-05:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-05:RLY1:SETSPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-05:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-05:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-05:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-05:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-05:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-05:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Ion Pump I/L nominal")
  field(INPA, "FE14I-VA-PIRG-05:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-05:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,11) ts1_2")
}

record(ao, "FE14I-VA-PIRG-05:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,11) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-05:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-05:RLY1:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-05:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,11) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-05:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-05:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-05:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-05:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-05:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-05:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-05:RLY1:EXISTS") 
{
  field(DESC, "Relay 11 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-05:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-05:RLY2:MODE")
    field(LNK2, "FE14I-VA-PIRG-05:RLY2:DIR")
    field(LNK3, "FE14I-VA-PIRG-05:RLY2:SP")
    field(LNK4, "FE14I-VA-PIRG-05:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-05:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-05:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,12) ts1_2")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-05:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-05:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,12) ts1_2")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-05:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,12) ts1_2")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-05:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-05:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,12) ts1_2")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-05:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,12) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-05:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-05:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-05:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-05:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-05:RLY2:SETSP")
    field(LNK3, "FE14I-VA-PIRG-05:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-05:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,12) ts1_2")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(DRVH, "950")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-05:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-05:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-05:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-05:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-05:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-05:RLY2:SP PP")
    field(LNK4, "FE14I-VA-PIRG-05:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-05:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-05:RLY2:SPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,12) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-05:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,12) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-05:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-05:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-05:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-05:RLY2:SETSPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-05:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-05:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-05:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-05:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-05:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-05:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, "MPS I/L nominal")
  field(INPA, "FE14I-VA-PIRG-05:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-05:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,12) ts1_2")
}

record(ao, "FE14I-VA-PIRG-05:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,12) ts1_2")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-05:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-05:RLY2:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-05:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,12) ts1_2")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-05:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-05:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-05:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-05:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-05:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-05:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-05:RLY2:EXISTS") 
{
  field(DESC, "Relay 12 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-04:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-04:RLY1:MODE")
    field(LNK2, "FE14I-VA-PIRG-04:RLY1:DIR")
    field(LNK3, "FE14I-VA-PIRG-04:RLY1:SP")
    field(LNK4, "FE14I-VA-PIRG-04:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-04:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-04:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,9) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-04:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-04:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,9) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-04:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,9) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-04:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-04:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,9) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-04:RLY1:SP") 
{
  field(DESC, "Ion Pump I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,9) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-04:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-04:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-04:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-04:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-04:RLY1:SETSP")
    field(LNK3, "FE14I-VA-PIRG-04:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-04:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,9) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(DRVH, "950")
  field(DRVL, "2.7e-3")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-04:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-04:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-04:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-04:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-04:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-04:RLY1:SP PP")
    field(LNK4, "FE14I-VA-PIRG-04:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-04:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-04:RLY1:SPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,9) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-04:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,9) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-04:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-04:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-04:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-04:RLY1:SETSPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-04:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-04:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-04:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-04:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-04:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-04:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Ion Pump I/L nominal")
  field(INPA, "FE14I-VA-PIRG-04:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-04:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,9) ts1_3")
}

record(ao, "FE14I-VA-PIRG-04:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,9) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-04:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-04:RLY1:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-04:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,9) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-04:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-04:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-04:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-04:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-04:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-04:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-04:RLY1:EXISTS") 
{
  field(DESC, "Relay 9 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-04:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-04:RLY2:MODE")
    field(LNK2, "FE14I-VA-PIRG-04:RLY2:DIR")
    field(LNK3, "FE14I-VA-PIRG-04:RLY2:SP")
    field(LNK4, "FE14I-VA-PIRG-04:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-04:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-04:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,10) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-04:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-04:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,10) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-04:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,10) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-04:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-04:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,10) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-04:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,10) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-04:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-04:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-04:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-04:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-04:RLY2:SETSP")
    field(LNK3, "FE14I-VA-PIRG-04:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-04:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,10) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(DRVH, "950")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-04:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-04:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-04:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-04:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-04:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-04:RLY2:SP PP")
    field(LNK4, "FE14I-VA-PIRG-04:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-04:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-04:RLY2:SPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,10) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-04:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,10) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-04:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-04:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-04:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-04:RLY2:SETSPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-04:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-04:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-04:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-04:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-04:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-04:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, "MPS I/L nominal")
  field(INPA, "FE14I-VA-PIRG-04:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-04:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,10) ts1_3")
}

record(ao, "FE14I-VA-PIRG-04:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,10) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-04:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-04:RLY2:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-04:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,10) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-04:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-04:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-04:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-04:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-04:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-04:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-04:RLY2:EXISTS") 
{
  field(DESC, "Relay 10 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-06:RLY1:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-06:RLY1:MODE")
    field(LNK2, "FE14I-VA-PIRG-06:RLY1:DIR")
    field(LNK3, "FE14I-VA-PIRG-06:RLY1:SP")
    field(LNK4, "FE14I-VA-PIRG-06:RLY1:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-06:RLY1:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-06:RLY1:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,11) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-06:RLY1:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-06:RLY1:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,11) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-06:RLY1:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,11) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-06:RLY1:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-06:RLY1:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,11) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-06:RLY1:SP") 
{
  field(DESC, "Ion Pump I/L On")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,11) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-06:RLY1:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-06:RLY1:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-06:RLY1:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-06:RLY1:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-06:RLY1:SETSP")
    field(LNK3, "FE14I-VA-PIRG-06:RLY1:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-06:RLY1:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,11) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-3")
  field(DRVH, "950")
  field(DRVL, "2.7e-3")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-06:RLY1:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-06:RLY1:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-06:RLY1:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-06:RLY1:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-06:RLY1:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-06:RLY1:SP PP")
    field(LNK4, "FE14I-VA-PIRG-06:RLY1:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-06:RLY1:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-06:RLY1:SPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,11) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-3")
  field(HIGH, "1.1e-2")
  field(LOW, "2.0e-3")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-06:RLY1:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,11) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-06:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-06:RLY1:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-06:RLY1:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-06:RLY1:SETSPOFF") 
{
  field(DESC, "Ion Pump I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-06:RLY1:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-06:RLY1:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-06:RLY1:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-06:RLY1:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-06:RLY1:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-06:RLY1:SPOFFNOMINAL") 
  {
  field(DESC, "Ion Pump I/L nominal")
  field(INPA, "FE14I-VA-PIRG-06:RLY1:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-06:RLY1:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,11) ts1_3")
}

record(ao, "FE14I-VA-PIRG-06:RLY1:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,11) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-06:RLY1:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-06:RLY1:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-06:RLY1:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,11) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-06:RLY1:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-06:RLY1:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-06:RLY1:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-06:RLY1:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-06:RLY1:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-06:RLY1:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-06:RLY1:EXISTS") 
{
  field(DESC, "Relay 11 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bRelays.db
#% macro, __doc__, Template database for an mks937b Multi-Sensor System Relays configuration. 
# When a relay is 'on' then the associated MPS interlock is 'good'.
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#
# optional substitutions:
#% macro, relay_number, The relay number (1..12).
#% macro, relay_desc,   The DESC field on the relay setpoint record 
#% macro, relay_off_desc,   The DESC field on the relay setpoint record 
#                       (appears as a label on the Img EDM screen).
#% macro, relay_level,  The desired relay setpoint value.
# vv================vv  New feature request May 2012.
#% macro, relay_off_level,  The desired relay off setpoint value.
#% macro, relay_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, relay_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, relay_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, relay_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, relay_hihi,   The HIHI alarm field on the relay setpoint record.
#% macro, relay_lolo,   The LOLO alarm field on the relay setpoint record.
#% macro, relay_high,   The HIGH alarm field on the relay setpoint record.
#% macro, relay_low ,   The LOW alarm field on the relay setpoint record.
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################


################################################################################
# Relay - Valve Interlock
#
#% archiver 10 Monitor
#

# Force processing of slow PP records 
record(fanout, "FE14I-VA-PIRG-06:RLY2:FAN10S")
{
    field(DESC, "Relay 10s Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-PIRG-06:RLY2:MODE")
    field(LNK2, "FE14I-VA-PIRG-06:RLY2:DIR")
    field(LNK3, "FE14I-VA-PIRG-06:RLY2:SP")
    field(LNK4, "FE14I-VA-PIRG-06:RLY2:SPOFF")
    field(LNK5, "FE14I-VA-PIRG-06:RLY2:HYST PP")
    field(SELM, "All")
}


record(mbbo, "FE14I-VA-PIRG-06:RLY2:SETMODE") 
{
  field(DESC, "Relay Mode")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_mode(001,12) ts1_3")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(TWVL, "2")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-06:RLY2:MODE PP")
}

record(mbbi, "FE14I-VA-PIRG-06:RLY2:MODE") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_mode(001,12) ts1_3")
  field(DESC, "Relay mode")
  field(SCAN, "Passive")
  field(ZRST, "On")
  field(ONST, "Off")
  field(TWST, "Active")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

record(mbbo, "FE14I-VA-PIRG-06:RLY2:SETDIR") 
{
  field(DESC, "Relay Direction")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_direction(001,12) ts1_3")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
#  field(DOL, "1")
#  field(PINI, "YES")
  field(FLNK, "FE14I-VA-PIRG-06:RLY2:DIR PP")
}

record(mbbi, "FE14I-VA-PIRG-06:RLY2:DIR") 
{
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_direction(001,12) ts1_3")
  field(DESC, "Relay direction")
  field(SCAN, "Passive")
  field(ZRST, "Above")
  field(ONST, "Below")
  field(UNSV, "MAJOR")
  field(ZRSV, "NO_ALARM")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
}

#
#% archiver 10 Monitor
#% controldesk Valve Interlock readback
#
record(ai, "FE14I-VA-PIRG-06:RLY2:SP") 
{
  field(DESC, "MPS I/L 1")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getsp(001,12) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-PIRG-06:RLY2:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-PIRG-06:RLY2:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-PIRG-06:RLY2:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-PIRG-06:RLY2:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-PIRG-06:RLY2:SETSP")
    field(LNK3, "FE14I-VA-PIRG-06:RLY2:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-PIRG-06:RLY2:SETSP") 
{
  field(DESC, "Output Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setsp(001,12) ts1_3")
  field(PREC, "1")
  #field(PINI, "YES")
  field(HOPR, "950")
  field(LOPR, "2.7e-10")
  field(DRVH, "950")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-2")
  field(SDIS, "FE14I-VA-PIRG-06:RLY2:ILKSETSP:NOWRITE")
  field(FLNK, "FE14I-VA-PIRG-06:RLY2:SETSPFAN")
}
# -----------------------------------------------------------------------------------------

# On setting a new interlock relay setpoint, we need to update the 
# default hysteresis value and readback of the new setpoint from the 
# gauge controller.
#
record(fanout, "FE14I-VA-PIRG-06:RLY2:SETSPFAN")
{
    field(DESC, "Relay Set SP fanout")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-PIRG-06:RLY2:HYST PP")
    field(LNK2, "FE14I-VA-PIRG-06:RLY2:SETSPOFF PP")
    field(LNK3, "FE14I-VA-PIRG-06:RLY2:SP PP")
    field(LNK4, "FE14I-VA-PIRG-06:RLY2:SPOFF PP")
    field(LNK5, "FE14I-VA-PIRG-06:RLY2:SELSPOFF PP")
}


record(ai, "FE14I-VA-PIRG-06:RLY2:SPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,12) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HIHI, "119")
  field(LOLO, "2.6e-10")
  field(HIGH, "950")
  field(LOW, "9.0e-7")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
}

#
# Set the required relay OFF setpoint (provides hysteresis)
# The assumed value will be the higher of either the default gauge hysteresis
# or the value given in the relay_off_level macro.
#
record(ao, "FE14I-VA-PIRG-06:RLY2:SPOFFWRITE") 
{
  field(DESC, "Relay Hysteresis Write")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,12) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-06:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-06:RLY2:SPOFF")
  field(OMSL, "closed_loop")
  field(DOL,  "FE14I-VA-PIRG-06:RLY2:SELSPOFF")
}


record(ai, "FE14I-VA-PIRG-06:RLY2:SETSPOFF") 
{
  field(DESC, "MPS I/L")
  field(DTYP, "Soft Channel")
  field(INP, "0.0")
#  field(PINI, "YES")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-06:RLY2:SELSPOFF")
}

# The primary objective is to avoid tripping the MPS interlocks
# unecessarily. So ensure that the higher value is adopted of either the existing SPOFF value in the gauge controller
# or the given relay_off_level macro.
# The lowest permissible value is 1.1 x SPON.
record(sel, "FE14I-VA-PIRG-06:RLY2:SELSPOFF")
{
    field(DESC, "Relay off setpoint select")
    field(SELM, "High Signal")
    field(INPA, "FE14I-VA-PIRG-06:RLY2:SPOFFNOMINAL PP MS")
    field(INPB, "FE14I-VA-PIRG-06:RLY2:SETSPOFF PP)")
    field(EGU,  "mbar")
    field(PREC, "1")
    field(HOPR, "1000")
    field(LOPR, "1e-12")
    field(FLNK, "FE14I-VA-PIRG-06:RLY2:SPOFFWRITE")
}

# :SPOFFNOMINAL calculates the nominal OFF setpoint
# which is simply 10% above :SP
#
record(calc, "FE14I-VA-PIRG-06:RLY2:SPOFFNOMINAL") 
  {
  field(DESC, "MPS I/L nominal")
  field(INPA, "FE14I-VA-PIRG-06:RLY2:SETSP")
  field(CALC, "(A*1.1)")
  }

record(bo, "FE14I-VA-PIRG-06:RLY2:DIS") 
{
  field(DESC, "Disable Relay Setpoint")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol dissp(001,12) ts1_3")
}

record(ao, "FE14I-VA-PIRG-06:RLY2:SETHYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setrelay_hyst(001,12) ts1_3")
  field(EGU, "mbar")
  field(SDIS, "FE14I-VA-PIRG-06:RLY2:ILKSETSP:NOWRITE")
  field(PREC, "2")
  field(FLNK, "FE14I-VA-PIRG-06:RLY2:HYST")
  #field(DOL, "1.0e-2")
}

record(ai, "FE14I-VA-PIRG-06:RLY2:HYST") 
{
  field(DESC, "Relay Hysteresis")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getrelay_hyst(001,12) ts1_3")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
#  field(PINI, "YES")
#  field(FLNK, "FE14I-VA-PIRG-06:RLY2:HYSTSEQ")
}

# When the controller hysteresis changes internally
# set the value in the SETSPOFF text entry box accordingly
record(seq, "FE14I-VA-PIRG-06:RLY2:HYSTSEQ") 
{
  field(DESC, "Hysteresis Sequence")
  field(SELM, "All")
  field(DOL1, "FE14I-VA-PIRG-06:RLY2:SPOFF")
  field(LNK1, "FE14I-VA-PIRG-06:RLY2:SETSPOFF.VAL PP")
}


#--------------------------------------------------------------------------------
#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-PIRG-06:RLY2:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume a zero INP link (from :CONSTZERO above) and do nothing.
#
record(bi, "FE14I-VA-PIRG-06:RLY2:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }

  record(calc, "FE14I-VA-PIRG-06:RLY2:EXISTS") 
{
  field(DESC, "Relay 12 Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}
#--------------------------------------------------------------------------------
  # mks937bFastRelay.template
#% macro, __doc__, Template database for an mks937b Multi-Sensor System fast-relay output trigger configuration. 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)

# optional substitutions:
#% macro, frcsp_desc,   The DESC field on the relay setpoint record 
#% macro, frcsp_level,  The desired relay setpoint value.
#% macro, frcsp_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, frcsp_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, frcsp_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, frcsp_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################
# 
# FRLY triggers
#
#
# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-01:FRLY:FAN10S")
{
    field(DESC, "Fast Relay Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-01:FRLY:SP PP")
    field(SELM, "All")
}


#% archiver 10 Monitor
#% controldesk IMG FRLY trigger readback
#
record(ai, "FE14I-VA-IMG-01:FRLY:SP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getfrc_sp(001,1,FE14I-VA-IMG-01:ERRORNUM) ts1_1 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
}


# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-01:FRLY:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-01:FRLY:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-01:FRLY:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-01:FRLY:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-01:FRLY:SETSP")
    field(LNK3, "FE14I-VA-IMG-01:FRLY:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-01:FRLY:SETSP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setfrc_sp(001,1) ts1_1 0")
  field(EGU, "mbar")
  field(PREC, "1")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-01:FRLY:ILKSETSP:NOWRITE")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-5")
  field(FLNK, "FE14I-VA-IMG-01:FRLY:SP PP")
}

record(calc, "FE14I-VA-IMG-01:FRLY:EXISTS") 
{
  field(DESC, "Fast Relay Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}

#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-01:FRLY:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-01:FRLY:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-01:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
# mks937bFastRelay.template
#% macro, __doc__, Template database for an mks937b Multi-Sensor System fast-relay output trigger configuration. 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)

# optional substitutions:
#% macro, frcsp_desc,   The DESC field on the relay setpoint record 
#% macro, frcsp_level,  The desired relay setpoint value.
#% macro, frcsp_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, frcsp_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, frcsp_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, frcsp_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################
# 
# FRLY triggers
#
#
# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-02:FRLY:FAN10S")
{
    field(DESC, "Fast Relay Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-02:FRLY:SP PP")
    field(SELM, "All")
}


#% archiver 10 Monitor
#% controldesk IMG FRLY trigger readback
#
record(ai, "FE14I-VA-IMG-02:FRLY:SP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getfrc_sp(001,3,FE14I-VA-IMG-02:ERRORNUM) ts1_1 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
}


# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-02:FRLY:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-02:FRLY:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-02:FRLY:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-02:FRLY:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-02:FRLY:SETSP")
    field(LNK3, "FE14I-VA-IMG-02:FRLY:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-02:FRLY:SETSP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setfrc_sp(001,3) ts1_1 0")
  field(EGU, "mbar")
  field(PREC, "1")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-02:FRLY:ILKSETSP:NOWRITE")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-5")
  field(FLNK, "FE14I-VA-IMG-02:FRLY:SP PP")
}

record(calc, "FE14I-VA-IMG-02:FRLY:EXISTS") 
{
  field(DESC, "Fast Relay Output Exists")
  field(CALC, "1")
  field(INPA, "3")
  field(INPB, "1")
  field(PINI, "YES")
}

#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-02:FRLY:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-02:FRLY:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-02:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
# mks937bFastRelay.template
#% macro, __doc__, Template database for an mks937b Multi-Sensor System fast-relay output trigger configuration. 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)

# optional substitutions:
#% macro, frcsp_desc,   The DESC field on the relay setpoint record 
#% macro, frcsp_level,  The desired relay setpoint value.
#% macro, frcsp_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, frcsp_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, frcsp_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, frcsp_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################
# 
# FRLY triggers
#
#
# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-03:FRLY:FAN10S")
{
    field(DESC, "Fast Relay Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-03:FRLY:SP PP")
    field(SELM, "All")
}


#% archiver 10 Monitor
#% controldesk IMG FRLY trigger readback
#
record(ai, "FE14I-VA-IMG-03:FRLY:SP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getfrc_sp(001,1,FE14I-VA-IMG-03:ERRORNUM) ts1_2 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
}


# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-03:FRLY:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-03:FRLY:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-03:FRLY:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-03:FRLY:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-03:FRLY:SETSP")
    field(LNK3, "FE14I-VA-IMG-03:FRLY:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-03:FRLY:SETSP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setfrc_sp(001,1) ts1_2 0")
  field(EGU, "mbar")
  field(PREC, "1")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-03:FRLY:ILKSETSP:NOWRITE")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-5")
  field(FLNK, "FE14I-VA-IMG-03:FRLY:SP PP")
}

record(calc, "FE14I-VA-IMG-03:FRLY:EXISTS") 
{
  field(DESC, "Fast Relay Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}

#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-03:FRLY:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-03:FRLY:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-03:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
# mks937bFastRelay.template
#% macro, __doc__, Template database for an mks937b Multi-Sensor System fast-relay output trigger configuration. 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)

# optional substitutions:
#% macro, frcsp_desc,   The DESC field on the relay setpoint record 
#% macro, frcsp_level,  The desired relay setpoint value.
#% macro, frcsp_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, frcsp_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, frcsp_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, frcsp_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################
# 
# FRLY triggers
#
#
# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-04:FRLY:FAN10S")
{
    field(DESC, "Fast Relay Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-04:FRLY:SP PP")
    field(SELM, "All")
}


#% archiver 10 Monitor
#% controldesk IMG FRLY trigger readback
#
record(ai, "FE14I-VA-IMG-04:FRLY:SP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getfrc_sp(001,1,FE14I-VA-IMG-04:ERRORNUM) ts1_3 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
}


# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-04:FRLY:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-04:FRLY:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-04:FRLY:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-04:FRLY:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-04:FRLY:SETSP")
    field(LNK3, "FE14I-VA-IMG-04:FRLY:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-04:FRLY:SETSP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setfrc_sp(001,1) ts1_3 0")
  field(EGU, "mbar")
  field(PREC, "1")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-04:FRLY:ILKSETSP:NOWRITE")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-5")
  field(FLNK, "FE14I-VA-IMG-04:FRLY:SP PP")
}

record(calc, "FE14I-VA-IMG-04:FRLY:EXISTS") 
{
  field(DESC, "Fast Relay Output Exists")
  field(CALC, "1")
  field(INPA, "1")
  field(INPB, "1")
  field(PINI, "YES")
}

#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-04:FRLY:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-04:FRLY:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-04:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
# mks937bFastRelay.template
#% macro, __doc__, Template database for an mks937b Multi-Sensor System fast-relay output trigger configuration. 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)

# optional substitutions:
#% macro, frcsp_desc,   The DESC field on the relay setpoint record 
#% macro, frcsp_level,  The desired relay setpoint value.
#% macro, frcsp_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, frcsp_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, frcsp_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, frcsp_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################
# 
# FRLY triggers
#
#
# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-05:FRLY:FAN10S")
{
    field(DESC, "Fast Relay Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-05:FRLY:SP PP")
    field(SELM, "All")
}


#% archiver 10 Monitor
#% controldesk IMG FRLY trigger readback
#
record(ai, "FE14I-VA-IMG-05:FRLY:SP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getfrc_sp(001,3,FE14I-VA-IMG-05:ERRORNUM) ts1_2 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
}


# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-05:FRLY:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-05:FRLY:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-05:FRLY:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-05:FRLY:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-05:FRLY:SETSP")
    field(LNK3, "FE14I-VA-IMG-05:FRLY:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-05:FRLY:SETSP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setfrc_sp(001,3) ts1_2 0")
  field(EGU, "mbar")
  field(PREC, "1")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-05:FRLY:ILKSETSP:NOWRITE")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-5")
  field(FLNK, "FE14I-VA-IMG-05:FRLY:SP PP")
}

record(calc, "FE14I-VA-IMG-05:FRLY:EXISTS") 
{
  field(DESC, "Fast Relay Output Exists")
  field(CALC, "1")
  field(INPA, "3")
  field(INPB, "1")
  field(PINI, "YES")
}

#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-05:FRLY:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-05:FRLY:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-05:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
# mks937bFastRelay.template
#% macro, __doc__, Template database for an mks937b Multi-Sensor System fast-relay output trigger configuration. 
# A note on the optional macros: they default to an appropriate hard-coded 
# value if no value is passed for expansion. 
# They are provided to allow the default set points to be changed. 
# Once the set point needs to be changed it may be necessary to alter  
# various other fields defining the range of allowed values. 
# For the majority of applications the defaults should be used.  The levels 
# should only be changed at the request of the vacuum group for non-standard 
# vacuum systems.
#
# required substitutions:
#% macro, device,  device name
#% macro, port,    serial port (steam device code ie /ty/0/1 => ty_0_1)
#% macro, address, Controller address (001 .. 253)
#% macro, channel, MKS 937B channel number (1-4)

# optional substitutions:
#% macro, frcsp_desc,   The DESC field on the relay setpoint record 
#% macro, frcsp_level,  The desired relay setpoint value.
#% macro, frcsp_drvh,   The DRVH field on relay setpoint records 
#                       (limits max value of relay setpoint)
#% macro, frcsp_drvl,   The DRVL field on relay setpoint records. 
#                       (limits min value of relay setpoint)
#% macro, frcsp_hopr,   The HOPR field on relay setpoint records 
#                       (high operator value - helps display set correct range).
#% macro, frcsp_lopr,   The LOPR field on relay setpoint records 
#                       (low operator value - helps display set correct range).
#% macro, ilk_write_access_pv ,   Link to the interlocks setpoint global write access record.
#
################################################################################
# 
# FRLY triggers
#
#
# Force processing of slow PP records 
record(fanout, "FE14I-VA-IMG-06:FRLY:FAN10S")
{
    field(DESC, "Fast Relay Scan fanout")
    field(SCAN, "10 second")
    field(LNK1, "FE14I-VA-IMG-06:FRLY:SP PP")
    field(SELM, "All")
}


#% archiver 10 Monitor
#% controldesk IMG FRLY trigger readback
#
record(ai, "FE14I-VA-IMG-06:FRLY:SP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(INP, "@mks937b.protocol getfrc_sp(001,3,FE14I-VA-IMG-06:ERRORNUM) ts1_3 0")
  field(SCAN, "Passive")
  field(EGU, "mbar")
  field(PREC, "1")
  field(HOPR, "1.0e-2")
  field(LOPR, "1.3e-5")
}


# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSP record just once
# at startup.
#
record(bo, "FE14I-VA-IMG-06:FRLY:INITSETSPSDIS") 
{
  field(DTYP, "Soft Channel")
  field(VAL, "1")
  field(OUT, "FE14I-VA-IMG-06:FRLY:INITSETSPFAN.DISA")
}
record(fanout, "FE14I-VA-IMG-06:FRLY:INITSETSPFAN")
{
    field(DESC, "Relay 1s Scan fanout")
    field(SCAN, "1 second")
    field(LNK1, "FE14I-VA-IMG-06:FRLY:ILKSETSP:NOWRITE")
    field(LNK2, "FE14I-VA-IMG-06:FRLY:SETSP")
    field(LNK3, "FE14I-VA-IMG-06:FRLY:INITSETSPSDIS")
    field(SELM, "All")
}

record(ao, "FE14I-VA-IMG-06:FRLY:SETSP") 
{
  field(DESC, "FastValve I/L")
  field(DTYP, "stream")
  field(OUT, "@mks937b.protocol setfrc_sp(001,3) ts1_3 0")
  field(EGU, "mbar")
  field(PREC, "1")
  #field(PINI, "YES")
  field(SDIS, "FE14I-VA-IMG-06:FRLY:ILKSETSP:NOWRITE")
  field(DRVH, "1.2e-2")
  field(DRVL, "2.7e-10")
  field(DOL,  "1.0e-5")
  field(FLNK, "FE14I-VA-IMG-06:FRLY:SP PP")
}

record(calc, "FE14I-VA-IMG-06:FRLY:EXISTS") 
{
  field(DESC, "Fast Relay Output Exists")
  field(CALC, "1")
  field(INPA, "3")
  field(INPB, "1")
  field(PINI, "YES")
}

#
# The :CONSTZERO record allows the :ILKSETSP:NOWRITE record (below)
# to have a PV link rather than constant zero value, which would be 
# invalid with the "MS CP" modifiers
#
record(bi, "FE14I-VA-IMG-06:FRLY:CONSTZERO")
  {
  field(DESC, "Constant zero value")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  }

# Disable the writing of setpoints to hardware so the machine does not trip
# when the IOC is rebooted with lower default interlock pressures
# This record is local to the relay instance, but controlled by the global
# access record - given in the macro parameters. If not supplied, it will
# assume an empty INP and do nothing.
#
record(bi, "FE14I-VA-IMG-06:FRLY:ILKSETSP:NOWRITE")
  {
  field(DESC, "ILK setpoint access")
  field(SCAN, "Passive")
  field(PINI, "YES")
  field(INP, "FE14I-VA-GAUGE-06:ILKSETSP:NOWRITE MS CP")
  field(ZNAM, "Allow")
  field(ONAM, "Inhibit")
  }
  
# digitelMpc.db
#% macro, __doc__, Template database for digitel MPC - Controller
# Pete Owens - 30/3/04
#
# substitutions:
#% macro, device, device name
#% macro, port, asyn serial port number
#% macro, unit, unit number for multi-drop serial
#% macro, proto, StreamDevice Protocol definition file. Defaults to digitelMpc.proto
################################################################################
# Get Model Number
#
#% controldesk Model Number readback
#
record(mbbi, "FE14I-VA-MPC-01:MODEL")
    {
    field(DESC, "Model Number")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto model(01) ts1_4")
    field(SCAN, "10 second")
    field(ZRST, "MPC2")
    field(ONST, "MPCe")
    field(TWST, "MPCq")
    field(THST, "QPC")
    }
#record(stringin, "FE14I-VA-MPC-01:MODEL")
#{
#    field(DESC, "Model Number")
#    field(DTYP, "stream")
#    field(INP,  "@digitelMpc.proto model(01) ts1_4")
#    field(SCAN, "10 second")
#    field(FLNK, "FE14I-VA-MPC-01:CALCMODEL")
#}

### Check for presence of Digitel MPCq which behaves slightly differently to the MPC DD and MPCe
record(mbbi, "FE14I-VA-MPC-01:MODELENUM")
    {
    field(DESC, "Enumerated Model")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "MPC2")
    field(ONST, "MPCe")
    field(TWST, "MPCq")
    field(THST, "QPC")
    }

#record(aSub, "FE14I-VA-MPC-01:CALCMODEL")
#    {
#    field(SNAM, "modelCalc")
#    field(INAM, "modelInit")
#    field(INPA, "FE14I-VA-MPC-01:MODEL MS")
#    field(FTA,  "STRING")
#    field(FTVA, "SHORT")
#    field(NOA,  "1")
#    field(NOVA, "1")
#    field(OUTA, "FE14I-VA-MPC-01:MODELENUM PP MS")
#    field(EFLG, "ALWAYS")
#    }

################################################################################
# Get Version
#
#% controldesk Firmware Revision readback
#
record(stringin, "FE14I-VA-MPC-01:VERSION") 
{
    field(DESC, "Firmware Revision")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto version(01) ts1_4")
    field(SCAN, "10 second")
}

################################################################################
# Automatically Restart on power up
#
#record(bo, "FE14I-VA-MPC-01:SETAUTOST")
#{
#    field(DESC, "Auto Restart")
#    field(DTYP, "stream")
#    field(OUT,  "@digitelMpc.proto setautost(01) ts1_4")
#    field(ZNAM, "No")
#    field(ONAM, "Yes")
#    field(DOL,  "0")
#    field(PINI, "YES")
#}
#
#% controldesk Auto Restart smon
#
#record(bi, "FE14I-VA-MPC-01:AUTOST")
#{
#    field(DESC, "Auto Restart")
#    field(DTYP, "stream")
#    field(INP,  "@digitelMpc.proto autost(01) ts1_4")
#    field(SCAN, "10 second")
#    field(ZNAM, "No")
#    field(ONAM, "Yes")
#}
################################################################################
# Reset Software
#
#% archiver 10 Monitor
#% controldesk Reset Software scon
#
record(bo, "FE14I-VA-MPC-01:RESET")
{
    field(DESC, "Reset Software")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto reset(01) ts1_4")
    field(ZNAM, "Reset")
    field(ONAM, "Reset")
}
################################################################################

record(stringin, "FE14I-VA-MPC-01:DEBUG")
{
    field(DESC, "Generic command")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto debug(01) ts1_4")
    field(SCAN, "Passive")
}

# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-MPC-01:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-MPC-01:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-MPC-01:MODEL.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-MPC-01:COMMS PP MS")
    }

# digitelMpc.db
#% macro, __doc__, Template database for digitel MPC - Controller
# Pete Owens - 30/3/04
#
# substitutions:
#% macro, device, device name
#% macro, port, asyn serial port number
#% macro, unit, unit number for multi-drop serial
#% macro, proto, StreamDevice Protocol definition file. Defaults to digitelMpc.proto
################################################################################
# Get Model Number
#
#% controldesk Model Number readback
#
record(mbbi, "FE14I-VA-MPC-02:MODEL")
    {
    field(DESC, "Model Number")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto model(01) ts1_5")
    field(SCAN, "10 second")
    field(ZRST, "MPC2")
    field(ONST, "MPCe")
    field(TWST, "MPCq")
    field(THST, "QPC")
    }
#record(stringin, "FE14I-VA-MPC-02:MODEL")
#{
#    field(DESC, "Model Number")
#    field(DTYP, "stream")
#    field(INP,  "@digitelMpc.proto model(01) ts1_5")
#    field(SCAN, "10 second")
#    field(FLNK, "FE14I-VA-MPC-02:CALCMODEL")
#}

### Check for presence of Digitel MPCq which behaves slightly differently to the MPC DD and MPCe
record(mbbi, "FE14I-VA-MPC-02:MODELENUM")
    {
    field(DESC, "Enumerated Model")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "MPC2")
    field(ONST, "MPCe")
    field(TWST, "MPCq")
    field(THST, "QPC")
    }

#record(aSub, "FE14I-VA-MPC-02:CALCMODEL")
#    {
#    field(SNAM, "modelCalc")
#    field(INAM, "modelInit")
#    field(INPA, "FE14I-VA-MPC-02:MODEL MS")
#    field(FTA,  "STRING")
#    field(FTVA, "SHORT")
#    field(NOA,  "1")
#    field(NOVA, "1")
#    field(OUTA, "FE14I-VA-MPC-02:MODELENUM PP MS")
#    field(EFLG, "ALWAYS")
#    }

################################################################################
# Get Version
#
#% controldesk Firmware Revision readback
#
record(stringin, "FE14I-VA-MPC-02:VERSION") 
{
    field(DESC, "Firmware Revision")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto version(01) ts1_5")
    field(SCAN, "10 second")
}

################################################################################
# Automatically Restart on power up
#
#record(bo, "FE14I-VA-MPC-02:SETAUTOST")
#{
#    field(DESC, "Auto Restart")
#    field(DTYP, "stream")
#    field(OUT,  "@digitelMpc.proto setautost(01) ts1_5")
#    field(ZNAM, "No")
#    field(ONAM, "Yes")
#    field(DOL,  "0")
#    field(PINI, "YES")
#}
#
#% controldesk Auto Restart smon
#
#record(bi, "FE14I-VA-MPC-02:AUTOST")
#{
#    field(DESC, "Auto Restart")
#    field(DTYP, "stream")
#    field(INP,  "@digitelMpc.proto autost(01) ts1_5")
#    field(SCAN, "10 second")
#    field(ZNAM, "No")
#    field(ONAM, "Yes")
#}
################################################################################
# Reset Software
#
#% archiver 10 Monitor
#% controldesk Reset Software scon
#
record(bo, "FE14I-VA-MPC-02:RESET")
{
    field(DESC, "Reset Software")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto reset(01) ts1_5")
    field(ZNAM, "Reset")
    field(ONAM, "Reset")
}
################################################################################

record(stringin, "FE14I-VA-MPC-02:DEBUG")
{
    field(DESC, "Generic command")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto debug(01) ts1_5")
    field(SCAN, "Passive")
}

# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-MPC-02:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-MPC-02:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-MPC-02:MODEL.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-MPC-02:COMMS PP MS")
    }

# digitelMpcIonp.template
#% macro, __doc__, Template database for digitel MPC - Ion Pump
# Pete Owens - 30/9/03
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, port, asyn serial port number
#% macro, unit, unit number for multi-drop serial (2 hex digits - 05 by default)
#% macro, pump, ion pump number (1 or 2)
#% macro, size, pump size (l/s)
#% macro, sp1on, setpoint1 on
#% macro, sp1off, setpoint1 off
#% macro, sp2on, setpoint2 on
#% macro, sp2off, setpoint2 off
#% macro, alh,  alarm handler tag (Defaults to None) c.f. mp49's commit 80833
#% macro, text, Text to display in the ion pump controller window.
#% macro, proto, StreamDevice Protocol definition file. Defaults to digitelMpc.proto
################################################################################

# This associates an edm screen with the template
# % gui, , edm, digitelMpcIonp2sp.edl, device=FE14I-VA-IONP-01

# This associates BOY screens with the template
# % gui, , boydetail, digitelMpcApp_opi/ionp_detail.opi, device=FE14I-VA-IONP-01, desc=FE14I-VA-IONP-01, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed_box.opi, device=FE14I-VA-IONP-01, desc=FE14I-VA-IONP-01, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed.opi, device=FE14I-VA-IONP-01, desc=FE14I-VA-IONP-01, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Status,   FE14I-VA-IONP-01:STA
# % gui, , readback, Error Code,  FE14I-VA-IONP-01:ERR
# % gui, , readback, Voltage,  FE14I-VA-IONP-01:V
# % gui, , readback, Current,  FE14I-VA-IONP-01:I
# % gui, , readback, Strapping,  FE14I-VA-IONP-01:HV
# % gui, , enum, Start,  FE14I-VA-IONP-01:START
# % gui, , readback, Pump Size,  FE14I-VA-IONP-01:SIZE
# % gui, , demand, Pump Size,  FE14I-VA-IONP-01:SETSIZE
# % gui, , readback, Calibration,  FE14I-VA-IONP-01:CAL
# % gui, , demand, Calibration,  FE14I-VA-IONP-01:SETCAL
# % gui, , readback, Setpoint 1 On,  FE14I-VA-IONP-01:SP1ON
# % gui, , demand, Setpoint 1 On,  FE14I-VA-IONP-01:SETSP1ON
# % gui, , readback, Setpoint 1 Off,  FE14I-VA-IONP-01:SP1OFF
# % gui, , demand, Setpoint 1 Off,  FE14I-VA-IONP-01:SETSP1OFF
# % gui, , readback, Setpoint 2 On,  FE14I-VA-IONP-01:SP2ON
# % gui, , demand, Setpoint 2 On,  FE14I-VA-IONP-01:SETSP2ON
# % gui, , readback, Setpoint 2 Off,  FE14I-VA-IONP-01:SP2OFF
# % gui, , demand, Setpoint 2 Off,  FE14I-VA-IONP-01:SETSP2OFF

# Read pump current
#
#% controldesk Current readback
#
record(ai, "FE14I-VA-IONP-01:I") {
    field(DESC, "Pump Current")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto current(01,1) ts1_4")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Read pump pressure
#
#% archiver 10 Monitor
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-IONP-01:P") {
    field(DESC, "Pump Pressure")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto pressure(01,1) ts1_4")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IONP-01:PLOG")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calcout, "FE14I-VA-IONP-01:ADEL")
{
    field(DESC, "deadband")
    field(CALC, "A/B")
    field(OUT,  "FE14I-VA-IONP-01:P.ADEL")
    field(INPA, "FE14I-VA-IONP-01:P")
#    field(INPB, "4")
#    field(INPB, "3")
    field(INPB, "2")
    field(SCAN, "10 second")
}
#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IONP-01:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-01:P MS")
    field(HOPR, "3")
    field(LOPR, "-12")
#    field(ADEL, "0.1")
#    field(ADEL, "0.125")
#    field(ADEL, "0.176")
    field(ADEL, "0.25")
}
################################################################################
# Read pump voltage
#
#% controldesk Voltage readback
#
record(longin, "FE14I-VA-IONP-01:V") {
    field(DESC, "Pump Voltage")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto voltage(01,1) ts1_4")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Get HV Strapping
#
#% archiver 1 Monitor
#% controldesk HV Strapping readback
#
record(longin, "FE14I-VA-IONP-01:HV") 
{
    field(DESC, "HV Strapping")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto strap(01,1) ts1_4")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Get supply status
#
#% archiver 10 Monitor
#% controldesk Supply Status smon
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-VA-IONP-01:STA
record(mbbi, "FE14I-VA-IONP-01:STA")
{
    field(DESC, "Supply Status")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto status(01,1) ts1_4")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
    field(UNSV, "MAJOR")
    field(ZRSV, "MAJOR")
    field(ONSV, "MAJOR")
    field(TWSV, "MAJOR")
    field(THSV, "MAJOR")
    field(FRSV, "NO_ALARM")
    field(FVSV, "MINOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MAJOR")
    field(EISV, "MAJOR")
    field(NISV, "MAJOR")
    field(TESV, "MAJOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
    field(FLNK, "FE14I-VA-IONP-01:ERRSEL")
}

record(seq, "FE14I-VA-IONP-01:ERRSEQ")
{
    field(DESC, "Get Error if applicable")
    field(SCAN, "Passive")
    field(SELM, "Specified")
    field(SELN, "1")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-01:ERR PP MS")
    field(DOL2, "FE14I-VA-IONP-01:ERRGET PP MS")
    field(LNK2, "FE14I-VA-IONP-01:ERR PP MS")
}

record(longin, "FE14I-VA-IONP-01:ERRGET")
{
    field(DESC, "Get Error Code")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto err(01,1) ts1_4")
    field(SCAN, "Passive")
}

record(calcout, "FE14I-VA-IONP-01:ERRSEL")
{
    field(DESC, "Choose which error source")
    field(INPA, "FE14I-VA-IONP-01:STA MS")
    field(CALC, "A>=3?2:1")
    field(OUT, "FE14I-VA-IONP-01:ERRSEQ.SELN PP MS")
}

#
#% archiver 10 Monitor
#% controldesk Error Code smon
#
record(mbbi, "FE14I-VA-IONP-01:ERR")
{
    field(DESC, "Error Code")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
################################################################################
# Pump size
#
#% archiver 10 Monitor
#% controldesk Pump Size readback
#
record(longin, "FE14I-VA-IONP-01:SIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto size(01,1) ts1_4")
    field(SCAN, "10 second")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
#
#% archiver 10 Monitor
#% controldesk Pump Size setpoint
#
record(ao, "FE14I-VA-IONP-01:SETSIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsize(01,1) ts1_4")
    field(PINI, "YES")
    field(DOL,  "500")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
#% archiver 10 Monitor
#% controldesk Calibration Factor readback
#
record(ai, "FE14I-VA-IONP-01:CAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto cal(01,1) ts1_4")
    field(SCAN, "10 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
#
#% archiver 10 Monitor
#% controldesk Calibration Factor setpoint
#
record(ao, "FE14I-VA-IONP-01:SETCAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setcal(01,1) ts1_4")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
################################################################################
# Start
#
#% archiver 10 Monitor
#% controldesk Supply Status scon
#
record(bo, "FE14I-VA-IONP-01:START")
{
    field(DESC, "HV on/off")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto start(01,1) ts1_4")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-01:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}

################################################################################
# Setpoints
#
# The MPC and MPCe controllers have four setpoints. Each setpoint has associated
# with it an ON pressure, an OFF pressure and a supply.
# Each pump on the controller is allocated two of the setpoints (pump setpoints 1 & 2).
# The following table describes the mapping of controller setpoints and supplies to
# each pump.
# I Gillingham: April 2015
#
#  Pump number   Pump_Setpoint Controller_Setpoint   Supply  
#      1             1                   1             1
#      2             1                   2             2
#      1             2                   3             1
#      2             2                   4             2

## ----------------- SP1 -------------------------------
#
# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSPS1 and SETSPS2 records just once
# at startup.
#
record(bo, "FE14I-VA-IONP-01:INIT:SETSPSDIS") 
    {
    field(DTYP, "Soft Channel")
    field(VAL, "1")
    field(OUT, "FE14I-VA-IONP-01:INIT:SETSPSEQ.DISA")
    }
#
# 1) Get the instrument value for SP1 ON/OFF
# 1a) Wait one second for :RQSTSP1ON to complete and populate :SP1OFF and :SP1ON
# 2) Disable instrument update of setting SP1 ON/OFF
# 3) LOAD SETSP1OFF with SP1OFF
# 4) LOAD SETSP1ON with SP1ON
# 5) Enable instrument update of setting SP1 ON/OFF
# 6) Process seq for SP2
# 7) Disable this seq record from processing again
record(seq, "FE14I-VA-IONP-01:INIT:SETSPSEQ") 
    {
    field(SCAN, "1 second")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-01:RQSTSP1ON PP")
    field(LNK2, "FE14I-VA-IONP-01:SETSPS1.DISA PP")
    field(LNK3, "FE14I-VA-IONP-01:SETSP1OFF PP")
    field(LNK4, "FE14I-VA-IONP-01:SETSP1ON PP")
    field(LNK5, "FE14I-VA-IONP-01:SETSPS1.DISA PP")
    field(LNK6, "FE14I-VA-IONP-01:INIT:SETSP2SEQ PP")
    field(LNK7, "FE14I-VA-IONP-01:INIT:SETSPSDIS PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY7, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-01:SP1OFF")
    field(DOL4, "FE14I-VA-IONP-01:SP1ON")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "1")
    }
    
# 1) Get the instrument value for SP2 ON/OFF
# 1a) Wait one second for :RQSTSP2ON to complete and populate :SP2OFF and :SP2ON
# 2) Disable instrument update of setting SP2 ON/OFF
# 3) LOAD SETSP2OFF with SP2OFF
# 4) LOAD SETSP2ON with SP2ON
# 5) Enable instrument update of setting SP2 ON/OFF
record(seq, "FE14I-VA-IONP-01:INIT:SETSP2SEQ")
    {
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-01:RQSTSP2ON PP")
    field(LNK2, "FE14I-VA-IONP-01:SETSPS2.DISA PP")
    field(LNK3, "FE14I-VA-IONP-01:SETSP2OFF PP")
    field(LNK4, "FE14I-VA-IONP-01:SETSP2ON PP")
    field(LNK5, "FE14I-VA-IONP-01:SETSPS2.DISA PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-01:SP2OFF")
    field(DOL4, "FE14I-VA-IONP-01:SP2ON")
    field(DOL5, "0")
    }



# Although requesting SPS is logically an input, a calcout has been 
# used here to allow the return values to be injected directly into the 
# given record names via input links.
#
# Record RQSTSP1OFF is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
# Record RQSTSP1STATE is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
 
# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2) - gets converted to actual setpoint in protocol.
record(ai, "FE14I-VA-IONP-01:RQSTSP1ON") 
    {
    field(DESC, "Rqst Setpoint1")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-01,1) ts1_4")
    field(PINI, "NO")
    }

# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2).
record(ai, "FE14I-VA-IONP-01:RQSTSP2ON") 
    {
    field(DESC, "Rqst Setpoint2")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-01,2) ts1_4")
    field(PINI, "NO")
    }


#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
# This PV is written to directly from the protocol (sps) return string
#
record(ai, "FE14I-VA-IONP-01:SP1ON") 
    {
    field(DESC, "Setpoint 1 On")
    field(DTYP, "Soft Channel")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-01:SP1OFF") 
    {
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-01:SP1STATE")
    {
    field(DESC, "Setpoint 1 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 setpoint
#
record(ao, "FE14I-VA-IONP-01:SETSP1ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 1 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-01:SETSPS1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 Off setpoint
#
record(ao, "FE14I-VA-IONP-01:SETSP1OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-01:SETSPS1")
    }

# NB: INPF is written to by :SPNUM1 on PINI
#     The supply number is equivalent to pump number (1 | 2)
#
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-01:SETSPS1") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-01,1) ts1_4")
##    field(OUT,  "@digitelMpc.proto setsps(01,1) ts1_4")
    field(INPA, "FE14I-VA-IONP-01:SETSP1ON")
    field(INPB, "FE14I-VA-IONP-01:SETSP1OFF")
    field(INPC, "1")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-01:SPNUM1")
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-01:RQSTSP1ON")
    }


## ----------------- SP2 -------------------------------

#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-01:SP2ON") 
    {
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-01:SP2OFF") 
    {
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-01:SP2STATE")
    {
    field(DESC, "Setpoint 2 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 setpoint
#
record(ao, "FE14I-VA-IONP-01:SETSP2ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-01:SETSPS2")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 Off setpoint
#
record(ao, "FE14I-VA-IONP-01:SETSP2OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-01:SETSPS2")
    }

# NB: INPF is written to by :SPNUM2 on PINI
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-01:SETSPS2") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-01,1) ts1_4")
##    field(OUT,  "@digitelMpc.proto setsps(01,1) ts1_4")
    field(INPA, "FE14I-VA-IONP-01:SETSP2ON")
    field(INPB, "FE14I-VA-IONP-01:SETSP2OFF")
    field(INPC, "1")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-01:SPNUM2")    
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-01:RQSTSP2ON")
    }


# Calculate the controller setpoint number for this pump
# Each setpoint has an ON and an OFF pressure attribute.
# Pump  Pump Setpoint  Controller Setpoint
#   1       1                    1
#   1       2                    3
#   2       1                    2
#   2       2                    4

record(calc, "FE14I-VA-IONP-01:SPNUM1") 
    {
    field(DESC, "Controller setpoints number Pump 1")
    field(INPA, "1")
    field(CALC, "(A>1)?2:1")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-01:SETSPS1")
    }

record(calc, "FE14I-VA-IONP-01:SPNUM2") 
    {
    field(DESC, "Controller setpoints number Pump 2")
    field(INPA, "1")
    field(CALC, "(A>1)?4:3")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-01:SETSPS2")
    }


################################################################################
# Text string on front panel
#
record(stringout, "FE14I-VA-IONP-01:SETTEXT") {
    field(DESC, "Text String")
    field(VAL , "FE14I-VA-IONP-01")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto settext(01,1,FE14I-VA-IONP-01) ts1_4")
    field(PINI, "YES")
}
################################################################################

################################################################################
# Text error message
#
record(stringin, "FE14I-VA-IONP-01:ERROR") 
    {
    field(DESC, "Last error message")
    }

# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-IONP-01:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-IONP-01:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-IONP-01:P.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-IONP-01:COMMS PP MS")
    }

# digitelMpcIonp.template
#% macro, __doc__, Template database for digitel MPC - Ion Pump
# Pete Owens - 30/9/03
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, port, asyn serial port number
#% macro, unit, unit number for multi-drop serial (2 hex digits - 05 by default)
#% macro, pump, ion pump number (1 or 2)
#% macro, size, pump size (l/s)
#% macro, sp1on, setpoint1 on
#% macro, sp1off, setpoint1 off
#% macro, sp2on, setpoint2 on
#% macro, sp2off, setpoint2 off
#% macro, alh,  alarm handler tag (Defaults to None) c.f. mp49's commit 80833
#% macro, text, Text to display in the ion pump controller window.
#% macro, proto, StreamDevice Protocol definition file. Defaults to digitelMpc.proto
################################################################################

# This associates an edm screen with the template
# % gui, , edm, digitelMpcIonp2sp.edl, device=FE14I-VA-IONP-02

# This associates BOY screens with the template
# % gui, , boydetail, digitelMpcApp_opi/ionp_detail.opi, device=FE14I-VA-IONP-02, desc=FE14I-VA-IONP-02, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed_box.opi, device=FE14I-VA-IONP-02, desc=FE14I-VA-IONP-02, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed.opi, device=FE14I-VA-IONP-02, desc=FE14I-VA-IONP-02, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Status,   FE14I-VA-IONP-02:STA
# % gui, , readback, Error Code,  FE14I-VA-IONP-02:ERR
# % gui, , readback, Voltage,  FE14I-VA-IONP-02:V
# % gui, , readback, Current,  FE14I-VA-IONP-02:I
# % gui, , readback, Strapping,  FE14I-VA-IONP-02:HV
# % gui, , enum, Start,  FE14I-VA-IONP-02:START
# % gui, , readback, Pump Size,  FE14I-VA-IONP-02:SIZE
# % gui, , demand, Pump Size,  FE14I-VA-IONP-02:SETSIZE
# % gui, , readback, Calibration,  FE14I-VA-IONP-02:CAL
# % gui, , demand, Calibration,  FE14I-VA-IONP-02:SETCAL
# % gui, , readback, Setpoint 1 On,  FE14I-VA-IONP-02:SP1ON
# % gui, , demand, Setpoint 1 On,  FE14I-VA-IONP-02:SETSP1ON
# % gui, , readback, Setpoint 1 Off,  FE14I-VA-IONP-02:SP1OFF
# % gui, , demand, Setpoint 1 Off,  FE14I-VA-IONP-02:SETSP1OFF
# % gui, , readback, Setpoint 2 On,  FE14I-VA-IONP-02:SP2ON
# % gui, , demand, Setpoint 2 On,  FE14I-VA-IONP-02:SETSP2ON
# % gui, , readback, Setpoint 2 Off,  FE14I-VA-IONP-02:SP2OFF
# % gui, , demand, Setpoint 2 Off,  FE14I-VA-IONP-02:SETSP2OFF

# Read pump current
#
#% controldesk Current readback
#
record(ai, "FE14I-VA-IONP-02:I") {
    field(DESC, "Pump Current")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto current(01,2) ts1_4")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Read pump pressure
#
#% archiver 10 Monitor
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-IONP-02:P") {
    field(DESC, "Pump Pressure")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto pressure(01,2) ts1_4")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IONP-02:PLOG")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calcout, "FE14I-VA-IONP-02:ADEL")
{
    field(DESC, "deadband")
    field(CALC, "A/B")
    field(OUT,  "FE14I-VA-IONP-02:P.ADEL")
    field(INPA, "FE14I-VA-IONP-02:P")
#    field(INPB, "4")
#    field(INPB, "3")
    field(INPB, "2")
    field(SCAN, "10 second")
}
#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IONP-02:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-02:P MS")
    field(HOPR, "3")
    field(LOPR, "-12")
#    field(ADEL, "0.1")
#    field(ADEL, "0.125")
#    field(ADEL, "0.176")
    field(ADEL, "0.25")
}
################################################################################
# Read pump voltage
#
#% controldesk Voltage readback
#
record(longin, "FE14I-VA-IONP-02:V") {
    field(DESC, "Pump Voltage")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto voltage(01,2) ts1_4")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Get HV Strapping
#
#% archiver 1 Monitor
#% controldesk HV Strapping readback
#
record(longin, "FE14I-VA-IONP-02:HV") 
{
    field(DESC, "HV Strapping")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto strap(01,2) ts1_4")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Get supply status
#
#% archiver 10 Monitor
#% controldesk Supply Status smon
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-VA-IONP-02:STA
record(mbbi, "FE14I-VA-IONP-02:STA")
{
    field(DESC, "Supply Status")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto status(01,2) ts1_4")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
    field(UNSV, "MAJOR")
    field(ZRSV, "MAJOR")
    field(ONSV, "MAJOR")
    field(TWSV, "MAJOR")
    field(THSV, "MAJOR")
    field(FRSV, "NO_ALARM")
    field(FVSV, "MINOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MAJOR")
    field(EISV, "MAJOR")
    field(NISV, "MAJOR")
    field(TESV, "MAJOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
    field(FLNK, "FE14I-VA-IONP-02:ERRSEL")
}

record(seq, "FE14I-VA-IONP-02:ERRSEQ")
{
    field(DESC, "Get Error if applicable")
    field(SCAN, "Passive")
    field(SELM, "Specified")
    field(SELN, "1")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-02:ERR PP MS")
    field(DOL2, "FE14I-VA-IONP-02:ERRGET PP MS")
    field(LNK2, "FE14I-VA-IONP-02:ERR PP MS")
}

record(longin, "FE14I-VA-IONP-02:ERRGET")
{
    field(DESC, "Get Error Code")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto err(01,2) ts1_4")
    field(SCAN, "Passive")
}

record(calcout, "FE14I-VA-IONP-02:ERRSEL")
{
    field(DESC, "Choose which error source")
    field(INPA, "FE14I-VA-IONP-02:STA MS")
    field(CALC, "A>=3?2:1")
    field(OUT, "FE14I-VA-IONP-02:ERRSEQ.SELN PP MS")
}

#
#% archiver 10 Monitor
#% controldesk Error Code smon
#
record(mbbi, "FE14I-VA-IONP-02:ERR")
{
    field(DESC, "Error Code")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
################################################################################
# Pump size
#
#% archiver 10 Monitor
#% controldesk Pump Size readback
#
record(longin, "FE14I-VA-IONP-02:SIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto size(01,2) ts1_4")
    field(SCAN, "10 second")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
#
#% archiver 10 Monitor
#% controldesk Pump Size setpoint
#
record(ao, "FE14I-VA-IONP-02:SETSIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsize(01,2) ts1_4")
    field(PINI, "YES")
    field(DOL,  "500")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
#% archiver 10 Monitor
#% controldesk Calibration Factor readback
#
record(ai, "FE14I-VA-IONP-02:CAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto cal(01,2) ts1_4")
    field(SCAN, "10 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
#
#% archiver 10 Monitor
#% controldesk Calibration Factor setpoint
#
record(ao, "FE14I-VA-IONP-02:SETCAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setcal(01,2) ts1_4")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
################################################################################
# Start
#
#% archiver 10 Monitor
#% controldesk Supply Status scon
#
record(bo, "FE14I-VA-IONP-02:START")
{
    field(DESC, "HV on/off")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto start(01,2) ts1_4")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-02:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}

################################################################################
# Setpoints
#
# The MPC and MPCe controllers have four setpoints. Each setpoint has associated
# with it an ON pressure, an OFF pressure and a supply.
# Each pump on the controller is allocated two of the setpoints (pump setpoints 1 & 2).
# The following table describes the mapping of controller setpoints and supplies to
# each pump.
# I Gillingham: April 2015
#
#  Pump number   Pump_Setpoint Controller_Setpoint   Supply  
#      1             1                   1             1
#      2             1                   2             2
#      1             2                   3             1
#      2             2                   4             2

## ----------------- SP1 -------------------------------
#
# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSPS1 and SETSPS2 records just once
# at startup.
#
record(bo, "FE14I-VA-IONP-02:INIT:SETSPSDIS") 
    {
    field(DTYP, "Soft Channel")
    field(VAL, "1")
    field(OUT, "FE14I-VA-IONP-02:INIT:SETSPSEQ.DISA")
    }
#
# 1) Get the instrument value for SP1 ON/OFF
# 1a) Wait one second for :RQSTSP1ON to complete and populate :SP1OFF and :SP1ON
# 2) Disable instrument update of setting SP1 ON/OFF
# 3) LOAD SETSP1OFF with SP1OFF
# 4) LOAD SETSP1ON with SP1ON
# 5) Enable instrument update of setting SP1 ON/OFF
# 6) Process seq for SP2
# 7) Disable this seq record from processing again
record(seq, "FE14I-VA-IONP-02:INIT:SETSPSEQ") 
    {
    field(SCAN, "1 second")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-02:RQSTSP1ON PP")
    field(LNK2, "FE14I-VA-IONP-02:SETSPS1.DISA PP")
    field(LNK3, "FE14I-VA-IONP-02:SETSP1OFF PP")
    field(LNK4, "FE14I-VA-IONP-02:SETSP1ON PP")
    field(LNK5, "FE14I-VA-IONP-02:SETSPS1.DISA PP")
    field(LNK6, "FE14I-VA-IONP-02:INIT:SETSP2SEQ PP")
    field(LNK7, "FE14I-VA-IONP-02:INIT:SETSPSDIS PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY7, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-02:SP1OFF")
    field(DOL4, "FE14I-VA-IONP-02:SP1ON")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "1")
    }
    
# 1) Get the instrument value for SP2 ON/OFF
# 1a) Wait one second for :RQSTSP2ON to complete and populate :SP2OFF and :SP2ON
# 2) Disable instrument update of setting SP2 ON/OFF
# 3) LOAD SETSP2OFF with SP2OFF
# 4) LOAD SETSP2ON with SP2ON
# 5) Enable instrument update of setting SP2 ON/OFF
record(seq, "FE14I-VA-IONP-02:INIT:SETSP2SEQ")
    {
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-02:RQSTSP2ON PP")
    field(LNK2, "FE14I-VA-IONP-02:SETSPS2.DISA PP")
    field(LNK3, "FE14I-VA-IONP-02:SETSP2OFF PP")
    field(LNK4, "FE14I-VA-IONP-02:SETSP2ON PP")
    field(LNK5, "FE14I-VA-IONP-02:SETSPS2.DISA PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-02:SP2OFF")
    field(DOL4, "FE14I-VA-IONP-02:SP2ON")
    field(DOL5, "0")
    }



# Although requesting SPS is logically an input, a calcout has been 
# used here to allow the return values to be injected directly into the 
# given record names via input links.
#
# Record RQSTSP1OFF is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
# Record RQSTSP1STATE is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
 
# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2) - gets converted to actual setpoint in protocol.
record(ai, "FE14I-VA-IONP-02:RQSTSP1ON") 
    {
    field(DESC, "Rqst Setpoint1")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-02,1) ts1_4")
    field(PINI, "NO")
    }

# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2).
record(ai, "FE14I-VA-IONP-02:RQSTSP2ON") 
    {
    field(DESC, "Rqst Setpoint2")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-02,2) ts1_4")
    field(PINI, "NO")
    }


#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
# This PV is written to directly from the protocol (sps) return string
#
record(ai, "FE14I-VA-IONP-02:SP1ON") 
    {
    field(DESC, "Setpoint 1 On")
    field(DTYP, "Soft Channel")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-02:SP1OFF") 
    {
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-02:SP1STATE")
    {
    field(DESC, "Setpoint 1 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 setpoint
#
record(ao, "FE14I-VA-IONP-02:SETSP1ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 1 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-02:SETSPS1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 Off setpoint
#
record(ao, "FE14I-VA-IONP-02:SETSP1OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-02:SETSPS1")
    }

# NB: INPF is written to by :SPNUM1 on PINI
#     The supply number is equivalent to pump number (1 | 2)
#
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-02:SETSPS1") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-02,1) ts1_4")
##    field(OUT,  "@digitelMpc.proto setsps(01,2) ts1_4")
    field(INPA, "FE14I-VA-IONP-02:SETSP1ON")
    field(INPB, "FE14I-VA-IONP-02:SETSP1OFF")
    field(INPC, "2")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-02:SPNUM1")
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-02:RQSTSP1ON")
    }


## ----------------- SP2 -------------------------------

#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-02:SP2ON") 
    {
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-02:SP2OFF") 
    {
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-02:SP2STATE")
    {
    field(DESC, "Setpoint 2 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 setpoint
#
record(ao, "FE14I-VA-IONP-02:SETSP2ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-02:SETSPS2")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 Off setpoint
#
record(ao, "FE14I-VA-IONP-02:SETSP2OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-02:SETSPS2")
    }

# NB: INPF is written to by :SPNUM2 on PINI
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-02:SETSPS2") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-02,1) ts1_4")
##    field(OUT,  "@digitelMpc.proto setsps(01,2) ts1_4")
    field(INPA, "FE14I-VA-IONP-02:SETSP2ON")
    field(INPB, "FE14I-VA-IONP-02:SETSP2OFF")
    field(INPC, "2")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-02:SPNUM2")    
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-02:RQSTSP2ON")
    }


# Calculate the controller setpoint number for this pump
# Each setpoint has an ON and an OFF pressure attribute.
# Pump  Pump Setpoint  Controller Setpoint
#   1       1                    1
#   1       2                    3
#   2       1                    2
#   2       2                    4

record(calc, "FE14I-VA-IONP-02:SPNUM1") 
    {
    field(DESC, "Controller setpoints number Pump 1")
    field(INPA, "2")
    field(CALC, "(A>1)?2:1")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-02:SETSPS1")
    }

record(calc, "FE14I-VA-IONP-02:SPNUM2") 
    {
    field(DESC, "Controller setpoints number Pump 2")
    field(INPA, "2")
    field(CALC, "(A>1)?4:3")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-02:SETSPS2")
    }


################################################################################
# Text string on front panel
#
record(stringout, "FE14I-VA-IONP-02:SETTEXT") {
    field(DESC, "Text String")
    field(VAL , "FE14I-VA-IONP-02")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto settext(01,2,FE14I-VA-IONP-02) ts1_4")
    field(PINI, "YES")
}
################################################################################

################################################################################
# Text error message
#
record(stringin, "FE14I-VA-IONP-02:ERROR") 
    {
    field(DESC, "Last error message")
    }

# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-IONP-02:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-IONP-02:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-IONP-02:P.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-IONP-02:COMMS PP MS")
    }

# digitelMpcIonp.template
#% macro, __doc__, Template database for digitel MPC - Ion Pump
# Pete Owens - 30/9/03
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, port, asyn serial port number
#% macro, unit, unit number for multi-drop serial (2 hex digits - 05 by default)
#% macro, pump, ion pump number (1 or 2)
#% macro, size, pump size (l/s)
#% macro, sp1on, setpoint1 on
#% macro, sp1off, setpoint1 off
#% macro, sp2on, setpoint2 on
#% macro, sp2off, setpoint2 off
#% macro, alh,  alarm handler tag (Defaults to None) c.f. mp49's commit 80833
#% macro, text, Text to display in the ion pump controller window.
#% macro, proto, StreamDevice Protocol definition file. Defaults to digitelMpc.proto
################################################################################

# This associates an edm screen with the template
# % gui, , edm, digitelMpcIonp2sp.edl, device=FE14I-VA-IONP-03

# This associates BOY screens with the template
# % gui, , boydetail, digitelMpcApp_opi/ionp_detail.opi, device=FE14I-VA-IONP-03, desc=FE14I-VA-IONP-03, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed_box.opi, device=FE14I-VA-IONP-03, desc=FE14I-VA-IONP-03, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed.opi, device=FE14I-VA-IONP-03, desc=FE14I-VA-IONP-03, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Status,   FE14I-VA-IONP-03:STA
# % gui, , readback, Error Code,  FE14I-VA-IONP-03:ERR
# % gui, , readback, Voltage,  FE14I-VA-IONP-03:V
# % gui, , readback, Current,  FE14I-VA-IONP-03:I
# % gui, , readback, Strapping,  FE14I-VA-IONP-03:HV
# % gui, , enum, Start,  FE14I-VA-IONP-03:START
# % gui, , readback, Pump Size,  FE14I-VA-IONP-03:SIZE
# % gui, , demand, Pump Size,  FE14I-VA-IONP-03:SETSIZE
# % gui, , readback, Calibration,  FE14I-VA-IONP-03:CAL
# % gui, , demand, Calibration,  FE14I-VA-IONP-03:SETCAL
# % gui, , readback, Setpoint 1 On,  FE14I-VA-IONP-03:SP1ON
# % gui, , demand, Setpoint 1 On,  FE14I-VA-IONP-03:SETSP1ON
# % gui, , readback, Setpoint 1 Off,  FE14I-VA-IONP-03:SP1OFF
# % gui, , demand, Setpoint 1 Off,  FE14I-VA-IONP-03:SETSP1OFF
# % gui, , readback, Setpoint 2 On,  FE14I-VA-IONP-03:SP2ON
# % gui, , demand, Setpoint 2 On,  FE14I-VA-IONP-03:SETSP2ON
# % gui, , readback, Setpoint 2 Off,  FE14I-VA-IONP-03:SP2OFF
# % gui, , demand, Setpoint 2 Off,  FE14I-VA-IONP-03:SETSP2OFF

# Read pump current
#
#% controldesk Current readback
#
record(ai, "FE14I-VA-IONP-03:I") {
    field(DESC, "Pump Current")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto current(01,1) ts1_5")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Read pump pressure
#
#% archiver 10 Monitor
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-IONP-03:P") {
    field(DESC, "Pump Pressure")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto pressure(01,1) ts1_5")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IONP-03:PLOG")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calcout, "FE14I-VA-IONP-03:ADEL")
{
    field(DESC, "deadband")
    field(CALC, "A/B")
    field(OUT,  "FE14I-VA-IONP-03:P.ADEL")
    field(INPA, "FE14I-VA-IONP-03:P")
#    field(INPB, "4")
#    field(INPB, "3")
    field(INPB, "2")
    field(SCAN, "10 second")
}
#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IONP-03:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-03:P MS")
    field(HOPR, "3")
    field(LOPR, "-12")
#    field(ADEL, "0.1")
#    field(ADEL, "0.125")
#    field(ADEL, "0.176")
    field(ADEL, "0.25")
}
################################################################################
# Read pump voltage
#
#% controldesk Voltage readback
#
record(longin, "FE14I-VA-IONP-03:V") {
    field(DESC, "Pump Voltage")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto voltage(01,1) ts1_5")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Get HV Strapping
#
#% archiver 1 Monitor
#% controldesk HV Strapping readback
#
record(longin, "FE14I-VA-IONP-03:HV") 
{
    field(DESC, "HV Strapping")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto strap(01,1) ts1_5")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Get supply status
#
#% archiver 10 Monitor
#% controldesk Supply Status smon
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-VA-IONP-03:STA
record(mbbi, "FE14I-VA-IONP-03:STA")
{
    field(DESC, "Supply Status")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto status(01,1) ts1_5")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
    field(UNSV, "MAJOR")
    field(ZRSV, "MAJOR")
    field(ONSV, "MAJOR")
    field(TWSV, "MAJOR")
    field(THSV, "MAJOR")
    field(FRSV, "NO_ALARM")
    field(FVSV, "MINOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MAJOR")
    field(EISV, "MAJOR")
    field(NISV, "MAJOR")
    field(TESV, "MAJOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
    field(FLNK, "FE14I-VA-IONP-03:ERRSEL")
}

record(seq, "FE14I-VA-IONP-03:ERRSEQ")
{
    field(DESC, "Get Error if applicable")
    field(SCAN, "Passive")
    field(SELM, "Specified")
    field(SELN, "1")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-03:ERR PP MS")
    field(DOL2, "FE14I-VA-IONP-03:ERRGET PP MS")
    field(LNK2, "FE14I-VA-IONP-03:ERR PP MS")
}

record(longin, "FE14I-VA-IONP-03:ERRGET")
{
    field(DESC, "Get Error Code")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto err(01,1) ts1_5")
    field(SCAN, "Passive")
}

record(calcout, "FE14I-VA-IONP-03:ERRSEL")
{
    field(DESC, "Choose which error source")
    field(INPA, "FE14I-VA-IONP-03:STA MS")
    field(CALC, "A>=3?2:1")
    field(OUT, "FE14I-VA-IONP-03:ERRSEQ.SELN PP MS")
}

#
#% archiver 10 Monitor
#% controldesk Error Code smon
#
record(mbbi, "FE14I-VA-IONP-03:ERR")
{
    field(DESC, "Error Code")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
################################################################################
# Pump size
#
#% archiver 10 Monitor
#% controldesk Pump Size readback
#
record(longin, "FE14I-VA-IONP-03:SIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto size(01,1) ts1_5")
    field(SCAN, "10 second")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
#
#% archiver 10 Monitor
#% controldesk Pump Size setpoint
#
record(ao, "FE14I-VA-IONP-03:SETSIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsize(01,1) ts1_5")
    field(PINI, "YES")
    field(DOL,  "500")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
#% archiver 10 Monitor
#% controldesk Calibration Factor readback
#
record(ai, "FE14I-VA-IONP-03:CAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto cal(01,1) ts1_5")
    field(SCAN, "10 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
#
#% archiver 10 Monitor
#% controldesk Calibration Factor setpoint
#
record(ao, "FE14I-VA-IONP-03:SETCAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setcal(01,1) ts1_5")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
################################################################################
# Start
#
#% archiver 10 Monitor
#% controldesk Supply Status scon
#
record(bo, "FE14I-VA-IONP-03:START")
{
    field(DESC, "HV on/off")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto start(01,1) ts1_5")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-03:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}

################################################################################
# Setpoints
#
# The MPC and MPCe controllers have four setpoints. Each setpoint has associated
# with it an ON pressure, an OFF pressure and a supply.
# Each pump on the controller is allocated two of the setpoints (pump setpoints 1 & 2).
# The following table describes the mapping of controller setpoints and supplies to
# each pump.
# I Gillingham: April 2015
#
#  Pump number   Pump_Setpoint Controller_Setpoint   Supply  
#      1             1                   1             1
#      2             1                   2             2
#      1             2                   3             1
#      2             2                   4             2

## ----------------- SP1 -------------------------------
#
# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSPS1 and SETSPS2 records just once
# at startup.
#
record(bo, "FE14I-VA-IONP-03:INIT:SETSPSDIS") 
    {
    field(DTYP, "Soft Channel")
    field(VAL, "1")
    field(OUT, "FE14I-VA-IONP-03:INIT:SETSPSEQ.DISA")
    }
#
# 1) Get the instrument value for SP1 ON/OFF
# 1a) Wait one second for :RQSTSP1ON to complete and populate :SP1OFF and :SP1ON
# 2) Disable instrument update of setting SP1 ON/OFF
# 3) LOAD SETSP1OFF with SP1OFF
# 4) LOAD SETSP1ON with SP1ON
# 5) Enable instrument update of setting SP1 ON/OFF
# 6) Process seq for SP2
# 7) Disable this seq record from processing again
record(seq, "FE14I-VA-IONP-03:INIT:SETSPSEQ") 
    {
    field(SCAN, "1 second")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-03:RQSTSP1ON PP")
    field(LNK2, "FE14I-VA-IONP-03:SETSPS1.DISA PP")
    field(LNK3, "FE14I-VA-IONP-03:SETSP1OFF PP")
    field(LNK4, "FE14I-VA-IONP-03:SETSP1ON PP")
    field(LNK5, "FE14I-VA-IONP-03:SETSPS1.DISA PP")
    field(LNK6, "FE14I-VA-IONP-03:INIT:SETSP2SEQ PP")
    field(LNK7, "FE14I-VA-IONP-03:INIT:SETSPSDIS PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY7, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-03:SP1OFF")
    field(DOL4, "FE14I-VA-IONP-03:SP1ON")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "1")
    }
    
# 1) Get the instrument value for SP2 ON/OFF
# 1a) Wait one second for :RQSTSP2ON to complete and populate :SP2OFF and :SP2ON
# 2) Disable instrument update of setting SP2 ON/OFF
# 3) LOAD SETSP2OFF with SP2OFF
# 4) LOAD SETSP2ON with SP2ON
# 5) Enable instrument update of setting SP2 ON/OFF
record(seq, "FE14I-VA-IONP-03:INIT:SETSP2SEQ")
    {
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-03:RQSTSP2ON PP")
    field(LNK2, "FE14I-VA-IONP-03:SETSPS2.DISA PP")
    field(LNK3, "FE14I-VA-IONP-03:SETSP2OFF PP")
    field(LNK4, "FE14I-VA-IONP-03:SETSP2ON PP")
    field(LNK5, "FE14I-VA-IONP-03:SETSPS2.DISA PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-03:SP2OFF")
    field(DOL4, "FE14I-VA-IONP-03:SP2ON")
    field(DOL5, "0")
    }



# Although requesting SPS is logically an input, a calcout has been 
# used here to allow the return values to be injected directly into the 
# given record names via input links.
#
# Record RQSTSP1OFF is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
# Record RQSTSP1STATE is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
 
# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2) - gets converted to actual setpoint in protocol.
record(ai, "FE14I-VA-IONP-03:RQSTSP1ON") 
    {
    field(DESC, "Rqst Setpoint1")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-03,1) ts1_5")
    field(PINI, "NO")
    }

# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2).
record(ai, "FE14I-VA-IONP-03:RQSTSP2ON") 
    {
    field(DESC, "Rqst Setpoint2")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-03,2) ts1_5")
    field(PINI, "NO")
    }


#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
# This PV is written to directly from the protocol (sps) return string
#
record(ai, "FE14I-VA-IONP-03:SP1ON") 
    {
    field(DESC, "Setpoint 1 On")
    field(DTYP, "Soft Channel")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-03:SP1OFF") 
    {
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-03:SP1STATE")
    {
    field(DESC, "Setpoint 1 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 setpoint
#
record(ao, "FE14I-VA-IONP-03:SETSP1ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 1 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-03:SETSPS1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 Off setpoint
#
record(ao, "FE14I-VA-IONP-03:SETSP1OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-03:SETSPS1")
    }

# NB: INPF is written to by :SPNUM1 on PINI
#     The supply number is equivalent to pump number (1 | 2)
#
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-03:SETSPS1") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-03,1) ts1_5")
##    field(OUT,  "@digitelMpc.proto setsps(01,1) ts1_5")
    field(INPA, "FE14I-VA-IONP-03:SETSP1ON")
    field(INPB, "FE14I-VA-IONP-03:SETSP1OFF")
    field(INPC, "1")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-03:SPNUM1")
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-03:RQSTSP1ON")
    }


## ----------------- SP2 -------------------------------

#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-03:SP2ON") 
    {
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-03:SP2OFF") 
    {
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-03:SP2STATE")
    {
    field(DESC, "Setpoint 2 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 setpoint
#
record(ao, "FE14I-VA-IONP-03:SETSP2ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-03:SETSPS2")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 Off setpoint
#
record(ao, "FE14I-VA-IONP-03:SETSP2OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-03:SETSPS2")
    }

# NB: INPF is written to by :SPNUM2 on PINI
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-03:SETSPS2") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-03,1) ts1_5")
##    field(OUT,  "@digitelMpc.proto setsps(01,1) ts1_5")
    field(INPA, "FE14I-VA-IONP-03:SETSP2ON")
    field(INPB, "FE14I-VA-IONP-03:SETSP2OFF")
    field(INPC, "1")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-03:SPNUM2")    
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-03:RQSTSP2ON")
    }


# Calculate the controller setpoint number for this pump
# Each setpoint has an ON and an OFF pressure attribute.
# Pump  Pump Setpoint  Controller Setpoint
#   1       1                    1
#   1       2                    3
#   2       1                    2
#   2       2                    4

record(calc, "FE14I-VA-IONP-03:SPNUM1") 
    {
    field(DESC, "Controller setpoints number Pump 1")
    field(INPA, "1")
    field(CALC, "(A>1)?2:1")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-03:SETSPS1")
    }

record(calc, "FE14I-VA-IONP-03:SPNUM2") 
    {
    field(DESC, "Controller setpoints number Pump 2")
    field(INPA, "1")
    field(CALC, "(A>1)?4:3")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-03:SETSPS2")
    }


################################################################################
# Text string on front panel
#
record(stringout, "FE14I-VA-IONP-03:SETTEXT") {
    field(DESC, "Text String")
    field(VAL , "FE14I-VA-IONP-03")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto settext(01,1,FE14I-VA-IONP-03) ts1_5")
    field(PINI, "YES")
}
################################################################################

################################################################################
# Text error message
#
record(stringin, "FE14I-VA-IONP-03:ERROR") 
    {
    field(DESC, "Last error message")
    }

# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-IONP-03:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-IONP-03:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-IONP-03:P.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-IONP-03:COMMS PP MS")
    }

# digitelMpcIonp.template
#% macro, __doc__, Template database for digitel MPC - Ion Pump
# Pete Owens - 30/9/03
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, port, asyn serial port number
#% macro, unit, unit number for multi-drop serial (2 hex digits - 05 by default)
#% macro, pump, ion pump number (1 or 2)
#% macro, size, pump size (l/s)
#% macro, sp1on, setpoint1 on
#% macro, sp1off, setpoint1 off
#% macro, sp2on, setpoint2 on
#% macro, sp2off, setpoint2 off
#% macro, alh,  alarm handler tag (Defaults to None) c.f. mp49's commit 80833
#% macro, text, Text to display in the ion pump controller window.
#% macro, proto, StreamDevice Protocol definition file. Defaults to digitelMpc.proto
################################################################################

# This associates an edm screen with the template
# % gui, , edm, digitelMpcIonp2sp.edl, device=FE14I-VA-IONP-04

# This associates BOY screens with the template
# % gui, , boydetail, digitelMpcApp_opi/ionp_detail.opi, device=FE14I-VA-IONP-04, desc=FE14I-VA-IONP-04, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed_box.opi, device=FE14I-VA-IONP-04, desc=FE14I-VA-IONP-04, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed.opi, device=FE14I-VA-IONP-04, desc=FE14I-VA-IONP-04, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Status,   FE14I-VA-IONP-04:STA
# % gui, , readback, Error Code,  FE14I-VA-IONP-04:ERR
# % gui, , readback, Voltage,  FE14I-VA-IONP-04:V
# % gui, , readback, Current,  FE14I-VA-IONP-04:I
# % gui, , readback, Strapping,  FE14I-VA-IONP-04:HV
# % gui, , enum, Start,  FE14I-VA-IONP-04:START
# % gui, , readback, Pump Size,  FE14I-VA-IONP-04:SIZE
# % gui, , demand, Pump Size,  FE14I-VA-IONP-04:SETSIZE
# % gui, , readback, Calibration,  FE14I-VA-IONP-04:CAL
# % gui, , demand, Calibration,  FE14I-VA-IONP-04:SETCAL
# % gui, , readback, Setpoint 1 On,  FE14I-VA-IONP-04:SP1ON
# % gui, , demand, Setpoint 1 On,  FE14I-VA-IONP-04:SETSP1ON
# % gui, , readback, Setpoint 1 Off,  FE14I-VA-IONP-04:SP1OFF
# % gui, , demand, Setpoint 1 Off,  FE14I-VA-IONP-04:SETSP1OFF
# % gui, , readback, Setpoint 2 On,  FE14I-VA-IONP-04:SP2ON
# % gui, , demand, Setpoint 2 On,  FE14I-VA-IONP-04:SETSP2ON
# % gui, , readback, Setpoint 2 Off,  FE14I-VA-IONP-04:SP2OFF
# % gui, , demand, Setpoint 2 Off,  FE14I-VA-IONP-04:SETSP2OFF

# Read pump current
#
#% controldesk Current readback
#
record(ai, "FE14I-VA-IONP-04:I") {
    field(DESC, "Pump Current")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto current(01,1) ts1_5")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Read pump pressure
#
#% archiver 10 Monitor
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-IONP-04:P") {
    field(DESC, "Pump Pressure")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto pressure(01,1) ts1_5")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IONP-04:PLOG")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calcout, "FE14I-VA-IONP-04:ADEL")
{
    field(DESC, "deadband")
    field(CALC, "A/B")
    field(OUT,  "FE14I-VA-IONP-04:P.ADEL")
    field(INPA, "FE14I-VA-IONP-04:P")
#    field(INPB, "4")
#    field(INPB, "3")
    field(INPB, "2")
    field(SCAN, "10 second")
}
#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IONP-04:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-04:P MS")
    field(HOPR, "3")
    field(LOPR, "-12")
#    field(ADEL, "0.1")
#    field(ADEL, "0.125")
#    field(ADEL, "0.176")
    field(ADEL, "0.25")
}
################################################################################
# Read pump voltage
#
#% controldesk Voltage readback
#
record(longin, "FE14I-VA-IONP-04:V") {
    field(DESC, "Pump Voltage")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto voltage(01,1) ts1_5")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Get HV Strapping
#
#% archiver 1 Monitor
#% controldesk HV Strapping readback
#
record(longin, "FE14I-VA-IONP-04:HV") 
{
    field(DESC, "HV Strapping")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto strap(01,1) ts1_5")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Get supply status
#
#% archiver 10 Monitor
#% controldesk Supply Status smon
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-VA-IONP-04:STA
record(mbbi, "FE14I-VA-IONP-04:STA")
{
    field(DESC, "Supply Status")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto status(01,1) ts1_5")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
    field(UNSV, "MAJOR")
    field(ZRSV, "MAJOR")
    field(ONSV, "MAJOR")
    field(TWSV, "MAJOR")
    field(THSV, "MAJOR")
    field(FRSV, "NO_ALARM")
    field(FVSV, "MINOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MAJOR")
    field(EISV, "MAJOR")
    field(NISV, "MAJOR")
    field(TESV, "MAJOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
    field(FLNK, "FE14I-VA-IONP-04:ERRSEL")
}

record(seq, "FE14I-VA-IONP-04:ERRSEQ")
{
    field(DESC, "Get Error if applicable")
    field(SCAN, "Passive")
    field(SELM, "Specified")
    field(SELN, "1")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-04:ERR PP MS")
    field(DOL2, "FE14I-VA-IONP-04:ERRGET PP MS")
    field(LNK2, "FE14I-VA-IONP-04:ERR PP MS")
}

record(longin, "FE14I-VA-IONP-04:ERRGET")
{
    field(DESC, "Get Error Code")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto err(01,1) ts1_5")
    field(SCAN, "Passive")
}

record(calcout, "FE14I-VA-IONP-04:ERRSEL")
{
    field(DESC, "Choose which error source")
    field(INPA, "FE14I-VA-IONP-04:STA MS")
    field(CALC, "A>=3?2:1")
    field(OUT, "FE14I-VA-IONP-04:ERRSEQ.SELN PP MS")
}

#
#% archiver 10 Monitor
#% controldesk Error Code smon
#
record(mbbi, "FE14I-VA-IONP-04:ERR")
{
    field(DESC, "Error Code")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
################################################################################
# Pump size
#
#% archiver 10 Monitor
#% controldesk Pump Size readback
#
record(longin, "FE14I-VA-IONP-04:SIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto size(01,1) ts1_5")
    field(SCAN, "10 second")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
#
#% archiver 10 Monitor
#% controldesk Pump Size setpoint
#
record(ao, "FE14I-VA-IONP-04:SETSIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsize(01,1) ts1_5")
    field(PINI, "YES")
    field(DOL,  "500")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
#% archiver 10 Monitor
#% controldesk Calibration Factor readback
#
record(ai, "FE14I-VA-IONP-04:CAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto cal(01,1) ts1_5")
    field(SCAN, "10 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
#
#% archiver 10 Monitor
#% controldesk Calibration Factor setpoint
#
record(ao, "FE14I-VA-IONP-04:SETCAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setcal(01,1) ts1_5")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
################################################################################
# Start
#
#% archiver 10 Monitor
#% controldesk Supply Status scon
#
record(bo, "FE14I-VA-IONP-04:START")
{
    field(DESC, "HV on/off")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto start(01,1) ts1_5")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-04:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}

################################################################################
# Setpoints
#
# The MPC and MPCe controllers have four setpoints. Each setpoint has associated
# with it an ON pressure, an OFF pressure and a supply.
# Each pump on the controller is allocated two of the setpoints (pump setpoints 1 & 2).
# The following table describes the mapping of controller setpoints and supplies to
# each pump.
# I Gillingham: April 2015
#
#  Pump number   Pump_Setpoint Controller_Setpoint   Supply  
#      1             1                   1             1
#      2             1                   2             2
#      1             2                   3             1
#      2             2                   4             2

## ----------------- SP1 -------------------------------
#
# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSPS1 and SETSPS2 records just once
# at startup.
#
record(bo, "FE14I-VA-IONP-04:INIT:SETSPSDIS") 
    {
    field(DTYP, "Soft Channel")
    field(VAL, "1")
    field(OUT, "FE14I-VA-IONP-04:INIT:SETSPSEQ.DISA")
    }
#
# 1) Get the instrument value for SP1 ON/OFF
# 1a) Wait one second for :RQSTSP1ON to complete and populate :SP1OFF and :SP1ON
# 2) Disable instrument update of setting SP1 ON/OFF
# 3) LOAD SETSP1OFF with SP1OFF
# 4) LOAD SETSP1ON with SP1ON
# 5) Enable instrument update of setting SP1 ON/OFF
# 6) Process seq for SP2
# 7) Disable this seq record from processing again
record(seq, "FE14I-VA-IONP-04:INIT:SETSPSEQ") 
    {
    field(SCAN, "1 second")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-04:RQSTSP1ON PP")
    field(LNK2, "FE14I-VA-IONP-04:SETSPS1.DISA PP")
    field(LNK3, "FE14I-VA-IONP-04:SETSP1OFF PP")
    field(LNK4, "FE14I-VA-IONP-04:SETSP1ON PP")
    field(LNK5, "FE14I-VA-IONP-04:SETSPS1.DISA PP")
    field(LNK6, "FE14I-VA-IONP-04:INIT:SETSP2SEQ PP")
    field(LNK7, "FE14I-VA-IONP-04:INIT:SETSPSDIS PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY7, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-04:SP1OFF")
    field(DOL4, "FE14I-VA-IONP-04:SP1ON")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "1")
    }
    
# 1) Get the instrument value for SP2 ON/OFF
# 1a) Wait one second for :RQSTSP2ON to complete and populate :SP2OFF and :SP2ON
# 2) Disable instrument update of setting SP2 ON/OFF
# 3) LOAD SETSP2OFF with SP2OFF
# 4) LOAD SETSP2ON with SP2ON
# 5) Enable instrument update of setting SP2 ON/OFF
record(seq, "FE14I-VA-IONP-04:INIT:SETSP2SEQ")
    {
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-04:RQSTSP2ON PP")
    field(LNK2, "FE14I-VA-IONP-04:SETSPS2.DISA PP")
    field(LNK3, "FE14I-VA-IONP-04:SETSP2OFF PP")
    field(LNK4, "FE14I-VA-IONP-04:SETSP2ON PP")
    field(LNK5, "FE14I-VA-IONP-04:SETSPS2.DISA PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-04:SP2OFF")
    field(DOL4, "FE14I-VA-IONP-04:SP2ON")
    field(DOL5, "0")
    }



# Although requesting SPS is logically an input, a calcout has been 
# used here to allow the return values to be injected directly into the 
# given record names via input links.
#
# Record RQSTSP1OFF is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
# Record RQSTSP1STATE is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
 
# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2) - gets converted to actual setpoint in protocol.
record(ai, "FE14I-VA-IONP-04:RQSTSP1ON") 
    {
    field(DESC, "Rqst Setpoint1")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-04,1) ts1_5")
    field(PINI, "NO")
    }

# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2).
record(ai, "FE14I-VA-IONP-04:RQSTSP2ON") 
    {
    field(DESC, "Rqst Setpoint2")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-04,2) ts1_5")
    field(PINI, "NO")
    }


#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
# This PV is written to directly from the protocol (sps) return string
#
record(ai, "FE14I-VA-IONP-04:SP1ON") 
    {
    field(DESC, "Setpoint 1 On")
    field(DTYP, "Soft Channel")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-04:SP1OFF") 
    {
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-04:SP1STATE")
    {
    field(DESC, "Setpoint 1 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 setpoint
#
record(ao, "FE14I-VA-IONP-04:SETSP1ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 1 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-04:SETSPS1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 Off setpoint
#
record(ao, "FE14I-VA-IONP-04:SETSP1OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-04:SETSPS1")
    }

# NB: INPF is written to by :SPNUM1 on PINI
#     The supply number is equivalent to pump number (1 | 2)
#
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-04:SETSPS1") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-04,1) ts1_5")
##    field(OUT,  "@digitelMpc.proto setsps(01,1) ts1_5")
    field(INPA, "FE14I-VA-IONP-04:SETSP1ON")
    field(INPB, "FE14I-VA-IONP-04:SETSP1OFF")
    field(INPC, "1")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-04:SPNUM1")
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-04:RQSTSP1ON")
    }


## ----------------- SP2 -------------------------------

#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-04:SP2ON") 
    {
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-04:SP2OFF") 
    {
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-04:SP2STATE")
    {
    field(DESC, "Setpoint 2 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 setpoint
#
record(ao, "FE14I-VA-IONP-04:SETSP2ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-04:SETSPS2")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 Off setpoint
#
record(ao, "FE14I-VA-IONP-04:SETSP2OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-04:SETSPS2")
    }

# NB: INPF is written to by :SPNUM2 on PINI
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-04:SETSPS2") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-04,1) ts1_5")
##    field(OUT,  "@digitelMpc.proto setsps(01,1) ts1_5")
    field(INPA, "FE14I-VA-IONP-04:SETSP2ON")
    field(INPB, "FE14I-VA-IONP-04:SETSP2OFF")
    field(INPC, "1")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-04:SPNUM2")    
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-04:RQSTSP2ON")
    }


# Calculate the controller setpoint number for this pump
# Each setpoint has an ON and an OFF pressure attribute.
# Pump  Pump Setpoint  Controller Setpoint
#   1       1                    1
#   1       2                    3
#   2       1                    2
#   2       2                    4

record(calc, "FE14I-VA-IONP-04:SPNUM1") 
    {
    field(DESC, "Controller setpoints number Pump 1")
    field(INPA, "1")
    field(CALC, "(A>1)?2:1")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-04:SETSPS1")
    }

record(calc, "FE14I-VA-IONP-04:SPNUM2") 
    {
    field(DESC, "Controller setpoints number Pump 2")
    field(INPA, "1")
    field(CALC, "(A>1)?4:3")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-04:SETSPS2")
    }


################################################################################
# Text string on front panel
#
record(stringout, "FE14I-VA-IONP-04:SETTEXT") {
    field(DESC, "Text String")
    field(VAL , "FE14I-VA-IONP-04")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto settext(01,1,FE14I-VA-IONP-04) ts1_5")
    field(PINI, "YES")
}
################################################################################

################################################################################
# Text error message
#
record(stringin, "FE14I-VA-IONP-04:ERROR") 
    {
    field(DESC, "Last error message")
    }

# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-IONP-04:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-IONP-04:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-IONP-04:P.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-IONP-04:COMMS PP MS")
    }

# digitelMpcIonp.template
#% macro, __doc__, Template database for digitel MPC - Ion Pump
# Pete Owens - 30/9/03
#
# substitutions:
#% macro, device, device name
#% macro, name, Object name and gui association name
#% macro, port, asyn serial port number
#% macro, unit, unit number for multi-drop serial (2 hex digits - 05 by default)
#% macro, pump, ion pump number (1 or 2)
#% macro, size, pump size (l/s)
#% macro, sp1on, setpoint1 on
#% macro, sp1off, setpoint1 off
#% macro, sp2on, setpoint2 on
#% macro, sp2off, setpoint2 off
#% macro, alh,  alarm handler tag (Defaults to None) c.f. mp49's commit 80833
#% macro, text, Text to display in the ion pump controller window.
#% macro, proto, StreamDevice Protocol definition file. Defaults to digitelMpc.proto
################################################################################

# This associates an edm screen with the template
# % gui, , edm, digitelMpcIonp2sp.edl, device=FE14I-VA-IONP-05

# This associates BOY screens with the template
# % gui, , boydetail, digitelMpcApp_opi/ionp_detail.opi, device=FE14I-VA-IONP-05, desc=FE14I-VA-IONP-05, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed_box.opi, device=FE14I-VA-IONP-05, desc=FE14I-VA-IONP-05, name=
# % gui, , boyembed, digitelMpcApp_opi/ionp_embed.opi, device=FE14I-VA-IONP-05, desc=FE14I-VA-IONP-05, name=

# These define what PVs a valve detail screen should contain
# % gui, , readback, Status,   FE14I-VA-IONP-05:STA
# % gui, , readback, Error Code,  FE14I-VA-IONP-05:ERR
# % gui, , readback, Voltage,  FE14I-VA-IONP-05:V
# % gui, , readback, Current,  FE14I-VA-IONP-05:I
# % gui, , readback, Strapping,  FE14I-VA-IONP-05:HV
# % gui, , enum, Start,  FE14I-VA-IONP-05:START
# % gui, , readback, Pump Size,  FE14I-VA-IONP-05:SIZE
# % gui, , demand, Pump Size,  FE14I-VA-IONP-05:SETSIZE
# % gui, , readback, Calibration,  FE14I-VA-IONP-05:CAL
# % gui, , demand, Calibration,  FE14I-VA-IONP-05:SETCAL
# % gui, , readback, Setpoint 1 On,  FE14I-VA-IONP-05:SP1ON
# % gui, , demand, Setpoint 1 On,  FE14I-VA-IONP-05:SETSP1ON
# % gui, , readback, Setpoint 1 Off,  FE14I-VA-IONP-05:SP1OFF
# % gui, , demand, Setpoint 1 Off,  FE14I-VA-IONP-05:SETSP1OFF
# % gui, , readback, Setpoint 2 On,  FE14I-VA-IONP-05:SP2ON
# % gui, , demand, Setpoint 2 On,  FE14I-VA-IONP-05:SETSP2ON
# % gui, , readback, Setpoint 2 Off,  FE14I-VA-IONP-05:SP2OFF
# % gui, , demand, Setpoint 2 Off,  FE14I-VA-IONP-05:SETSP2OFF

# Read pump current
#
#% controldesk Current readback
#
record(ai, "FE14I-VA-IONP-05:I") {
    field(DESC, "Pump Current")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto current(01,2) ts1_5")
    field(SCAN, "1 second")
    field(EGU,  "A")
    field(LOPR, "0.0")
    field(HOPR, "10.0")
    field(PREC, "1")
}
################################################################################
# Read pump pressure
#
#% archiver 10 Monitor
#% controldesk Pressure readback
#
record(ai, "FE14I-VA-IONP-05:P") {
    field(DESC, "Pump Pressure")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto pressure(01,2) ts1_5")
    field(SCAN, "1 second")
    field(FLNK, "FE14I-VA-IONP-05:PLOG")
    field(EGU,  "mbar")
    field(HOPR, "1000")
    field(LOPR, "1.0E-12")
    field(PREC, "11")
}
record(calcout, "FE14I-VA-IONP-05:ADEL")
{
    field(DESC, "deadband")
    field(CALC, "A/B")
    field(OUT,  "FE14I-VA-IONP-05:P.ADEL")
    field(INPA, "FE14I-VA-IONP-05:P")
#    field(INPB, "4")
#    field(INPB, "3")
    field(INPB, "2")
    field(SCAN, "10 second")
}
#
#% archiver 1 Monitor
#
record(calc, "FE14I-VA-IONP-05:PLOG")
{
    field(DESC, "log Pressure")
    field(EGU,  "log")
    field(CALC, "LOG(A)")
    field(INPA, "FE14I-VA-IONP-05:P MS")
    field(HOPR, "3")
    field(LOPR, "-12")
#    field(ADEL, "0.1")
#    field(ADEL, "0.125")
#    field(ADEL, "0.176")
    field(ADEL, "0.25")
}
################################################################################
# Read pump voltage
#
#% controldesk Voltage readback
#
record(longin, "FE14I-VA-IONP-05:V") {
    field(DESC, "Pump Voltage")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto voltage(01,2) ts1_5")
    field(SCAN, "1 second")
    field(EGU,  "V")
    field(LOPR, "0")
    field(HOPR, "10")
}
################################################################################
# Get HV Strapping
#
#% archiver 1 Monitor
#% controldesk HV Strapping readback
#
record(longin, "FE14I-VA-IONP-05:HV") 
{
    field(DESC, "HV Strapping")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto strap(01,2) ts1_5")
    field(SCAN, "10 second")
    field(EGU,  "V")
    field(LOPR, "5600")
    field(HOPR, "7000")
}
################################################################################
# Get supply status
#
#% archiver 10 Monitor
#% controldesk Supply Status smon
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-VA-IONP-05:STA
record(mbbi, "FE14I-VA-IONP-05:STA")
{
    field(DESC, "Supply Status")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto status(01,2) ts1_5")
    field(SCAN, "1 second")
    field(ZRST, "Unknown")
    field(ONST, "Waiting")
    field(TWST, "Standby")
    field(THST, "Safe-Conn")
    field(FRST, "Running")
    field(FVST, "Cool Down")
    field(SXST, "Pump Error")
    field(SVST, "HV Switched Off")
    field(EIST, "Interlock")
    field(NIST, "Shut Down")
    field(TEST, "Calibration")
    field(ELST, "Invalid")
    field(TVST, "Invalid")
    field(TTST, "Invalid")
    field(FTST, "Invalid")
    field(FFST, "Invalid")
    field(UNSV, "MAJOR")
    field(ZRSV, "MAJOR")
    field(ONSV, "MAJOR")
    field(TWSV, "MAJOR")
    field(THSV, "MAJOR")
    field(FRSV, "NO_ALARM")
    field(FVSV, "MINOR")
    field(SXSV, "MAJOR")
    field(SVSV, "MAJOR")
    field(EISV, "MAJOR")
    field(NISV, "MAJOR")
    field(TESV, "MAJOR")
    field(ELSV, "MAJOR")
    field(TVSV, "MAJOR")
    field(TTSV, "MAJOR")
    field(FTSV, "MAJOR")
    field(FFSV, "MAJOR")
    field(FLNK, "FE14I-VA-IONP-05:ERRSEL")
}

record(seq, "FE14I-VA-IONP-05:ERRSEQ")
{
    field(DESC, "Get Error if applicable")
    field(SCAN, "Passive")
    field(SELM, "Specified")
    field(SELN, "1")
    field(DOL1, "0")
    field(LNK1, "FE14I-VA-IONP-05:ERR PP MS")
    field(DOL2, "FE14I-VA-IONP-05:ERRGET PP MS")
    field(LNK2, "FE14I-VA-IONP-05:ERR PP MS")
}

record(longin, "FE14I-VA-IONP-05:ERRGET")
{
    field(DESC, "Get Error Code")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto err(01,2) ts1_5")
    field(SCAN, "Passive")
}

record(calcout, "FE14I-VA-IONP-05:ERRSEL")
{
    field(DESC, "Choose which error source")
    field(INPA, "FE14I-VA-IONP-05:STA MS")
    field(CALC, "A>=3?2:1")
    field(OUT, "FE14I-VA-IONP-05:ERRSEQ.SELN PP MS")
}

#
#% archiver 10 Monitor
#% controldesk Error Code smon
#
record(mbbi, "FE14I-VA-IONP-05:ERR")
{
    field(DESC, "Error Code")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "OK")
    field(ONST, "Too many cycles")
    field(TWST, "High pressure")
    field(THST, "High current")
    field(FRST, "High pressure")
    field(FVST, "Pump power")
    field(SXST, "High current")
    field(SVST, "Short circuit")
    field(EIST, "Malfunction")
    field(NIST, "Low voltage")
    field(TEST, "Arc detect")
    field(ELST, "11")
    field(TVST, "12")
    field(TTST, "13")
    field(FTST, "14")
    field(FFST, "15")
    field(UNSV, "MINOR")
    field(ZRSV, "NO_ALARM")
    field(ONSV, "MINOR")
    field(TWSV, "MINOR")
    field(THSV, "MINOR")
    field(FRSV, "MINOR")
    field(FVSV, "MINOR")
    field(SXSV, "MINOR")
    field(SVSV, "MINOR")
    field(EISV, "MINOR")
    field(NISV, "MINOR")
    field(TESV, "MINOR")
    field(ELSV, "MINOR")
    field(TVSV, "MINOR")
    field(TTSV, "MINOR")
    field(FTSV, "MINOR")
    field(FFSV, "MINOR")
}
################################################################################
# Pump size
#
#% archiver 10 Monitor
#% controldesk Pump Size readback
#
record(longin, "FE14I-VA-IONP-05:SIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto size(01,2) ts1_5")
    field(SCAN, "10 second")
    field(EGU,  "l/s")
    field(LOPR, "0")
    field(HOPR, "1200")
}
#
#% archiver 10 Monitor
#% controldesk Pump Size setpoint
#
record(ao, "FE14I-VA-IONP-05:SETSIZE") {
    field(DESC, "Pump Size")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsize(01,2) ts1_5")
    field(PINI, "YES")
    field(DOL,  "150")
    field(EGU,  "l/s")
    field(DRVL, "0")
    field(DRVH, "1200")
    field(LOPR, "0")
    field(HOPR, "1200")
    field(PREC, "0")
}
################################################################################
# Calibration factor
#
#% archiver 10 Monitor
#% controldesk Calibration Factor readback
#
record(ai, "FE14I-VA-IONP-05:CAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(INP,  "@digitelMpc.proto cal(01,2) ts1_5")
    field(SCAN, "10 second")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
#
#% archiver 10 Monitor
#% controldesk Calibration Factor setpoint
#
record(ao, "FE14I-VA-IONP-05:SETCAL") {
    field(DESC, "Calibration Factor")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setcal(01,2) ts1_5")
    field(DRVL, "0.0")
    field(DRVH, "9.99")
    field(LOPR, "0.0")
    field(HOPR, "9.99")
    field(PREC, "2")
}
################################################################################
# Start
#
#% archiver 10 Monitor
#% controldesk Supply Status scon
#
record(bo, "FE14I-VA-IONP-05:START")
{
    field(DESC, "HV on/off")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto start(01,2) ts1_5")
    field(ZNAM, "Stop")
    field(ONAM, "Start")
}
record(bi,"FE14I-VA-IONP-05:STARTING")
{
    field(DESC, "Starting Pumps")
    field(PINI, "YES")
    field(INP,  "0")
    field(ZNAM, "")
    field(ONAM, "Starting")
}

################################################################################
# Setpoints
#
# The MPC and MPCe controllers have four setpoints. Each setpoint has associated
# with it an ON pressure, an OFF pressure and a supply.
# Each pump on the controller is allocated two of the setpoints (pump setpoints 1 & 2).
# The following table describes the mapping of controller setpoints and supplies to
# each pump.
# I Gillingham: April 2015
#
#  Pump number   Pump_Setpoint Controller_Setpoint   Supply  
#      1             1                   1             1
#      2             1                   2             2
#      1             2                   3             1
#      2             2                   4             2

## ----------------- SP1 -------------------------------
#
# -----------------------------------------------------------------------------------------
# These two records work together to provide one scan
# to correctly initialise the SETSPS1 and SETSPS2 records just once
# at startup.
#
record(bo, "FE14I-VA-IONP-05:INIT:SETSPSDIS") 
    {
    field(DTYP, "Soft Channel")
    field(VAL, "1")
    field(OUT, "FE14I-VA-IONP-05:INIT:SETSPSEQ.DISA")
    }
#
# 1) Get the instrument value for SP1 ON/OFF
# 1a) Wait one second for :RQSTSP1ON to complete and populate :SP1OFF and :SP1ON
# 2) Disable instrument update of setting SP1 ON/OFF
# 3) LOAD SETSP1OFF with SP1OFF
# 4) LOAD SETSP1ON with SP1ON
# 5) Enable instrument update of setting SP1 ON/OFF
# 6) Process seq for SP2
# 7) Disable this seq record from processing again
record(seq, "FE14I-VA-IONP-05:INIT:SETSPSEQ") 
    {
    field(SCAN, "1 second")
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-05:RQSTSP1ON PP")
    field(LNK2, "FE14I-VA-IONP-05:SETSPS1.DISA PP")
    field(LNK3, "FE14I-VA-IONP-05:SETSP1OFF PP")
    field(LNK4, "FE14I-VA-IONP-05:SETSP1ON PP")
    field(LNK5, "FE14I-VA-IONP-05:SETSPS1.DISA PP")
    field(LNK6, "FE14I-VA-IONP-05:INIT:SETSP2SEQ PP")
    field(LNK7, "FE14I-VA-IONP-05:INIT:SETSPSDIS PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DLY7, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-05:SP1OFF")
    field(DOL4, "FE14I-VA-IONP-05:SP1ON")
    field(DOL5, "0")
    field(DOL6, "0")
    field(DOL7, "1")
    }
    
# 1) Get the instrument value for SP2 ON/OFF
# 1a) Wait one second for :RQSTSP2ON to complete and populate :SP2OFF and :SP2ON
# 2) Disable instrument update of setting SP2 ON/OFF
# 3) LOAD SETSP2OFF with SP2OFF
# 4) LOAD SETSP2ON with SP2ON
# 5) Enable instrument update of setting SP2 ON/OFF
record(seq, "FE14I-VA-IONP-05:INIT:SETSP2SEQ")
    {
    field(SELM, "All")
    field(LNK1, "FE14I-VA-IONP-05:RQSTSP2ON PP")
    field(LNK2, "FE14I-VA-IONP-05:SETSPS2.DISA PP")
    field(LNK3, "FE14I-VA-IONP-05:SETSP2OFF PP")
    field(LNK4, "FE14I-VA-IONP-05:SETSP2ON PP")
    field(LNK5, "FE14I-VA-IONP-05:SETSPS2.DISA PP")
    field(DLY1, "0")
    field(DLY2, "3.0")
    field(DLY3, "0")
    field(DLY4, "0")
    field(DOL1, "0")
    field(DOL2, "1")
    field(DOL3, "FE14I-VA-IONP-05:SP2OFF")
    field(DOL4, "FE14I-VA-IONP-05:SP2ON")
    field(DOL5, "0")
    }



# Although requesting SPS is logically an input, a calcout has been 
# used here to allow the return values to be injected directly into the 
# given record names via input links.
#
# Record RQSTSP1OFF is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
# Record RQSTSP1STATE is I/O Intr and gets (a copy of) any input, including input that was directed to record RQSTSP1ON
 
# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2) - gets converted to actual setpoint in protocol.
record(ai, "FE14I-VA-IONP-05:RQSTSP1ON") 
    {
    field(DESC, "Rqst Setpoint1")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-05,1) ts1_5")
    field(PINI, "NO")
    }

# sps: Parameter 1) Unit number   2) Device base name    3) Logical setpoint number for this pump (1 | 2).
record(ai, "FE14I-VA-IONP-05:RQSTSP2ON") 
    {
    field(DESC, "Rqst Setpoint2")
    field(DTYP, "stream")
    field(SCAN, "Passive")
    field(INP,  "@digitelMpc.proto getsps(01,FE14I-VA-IONP-05,2) ts1_5")
    field(PINI, "NO")
    }


#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
# This PV is written to directly from the protocol (sps) return string
#
record(ai, "FE14I-VA-IONP-05:SP1ON") 
    {
    field(DESC, "Setpoint 1 On")
    field(DTYP, "Soft Channel")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-05:SP1OFF") 
    {
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-05:SP1STATE")
    {
    field(DESC, "Setpoint 1 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 setpoint
#
record(ao, "FE14I-VA-IONP-05:SETSP1ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 1 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-05:SETSPS1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 1 Off setpoint
#
record(ao, "FE14I-VA-IONP-05:SETSP1OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 1 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-05:SETSPS1")
    }

# NB: INPF is written to by :SPNUM1 on PINI
#     The supply number is equivalent to pump number (1 | 2)
#
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-05:SETSPS1") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-05,1) ts1_5")
##    field(OUT,  "@digitelMpc.proto setsps(01,2) ts1_5")
    field(INPA, "FE14I-VA-IONP-05:SETSP1ON")
    field(INPB, "FE14I-VA-IONP-05:SETSP1OFF")
    field(INPC, "2")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-05:SPNUM1")
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-05:RQSTSP1ON")
    }


## ----------------- SP2 -------------------------------

#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-05:SP2ON") 
    {
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 readback
#
# This PV is written to directly from the protocol (sps) return string
record(ai, "FE14I-VA-IONP-05:SP2OFF") 
    {
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    }
# This PV is written to directly from the protocol (sps) return string
record(bi,"FE14I-VA-IONP-05:SP2STATE")
    {
    field(DESC, "Setpoint 2 State")
    field(PINI, "NO")
    field(INP,  "0")
    field(ZNAM, "Off")
    field(ONAM, "On")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 setpoint
#
record(ao, "FE14I-VA-IONP-05:SETSP2ON") 
    {
    field(VAL,  "1.0E-7")
    field(DESC, "Setpoint 2 On")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-05:SETSPS2")
    }
#
#% archiver 10 Monitor
#% controldesk Setpoint 2 Off setpoint
#
record(ao, "FE14I-VA-IONP-05:SETSP2OFF") 
    {
    field(VAL,  "2.0E-7")
    field(DESC, "Setpoint 2 Off")
    field(EGU,  "mbar")
    field(DRVL, "1.0E-10")
    field(DRVH, "1.0E-4")
    field(LOPR, "0.0")
    field(HOPR, "1000.0")
    field(PREC, "1")
    field(FLNK, "FE14I-VA-IONP-05:SETSPS2")
    }

# NB: INPF is written to by :SPNUM2 on PINI
# INPA => Setpoint ON pressure
# INPB => Setpoint OFF pressure
# INPC => Source (usually equivalent to pump [1|2])
# INPD => Lower pressure working limit
# INPE => Upper pressure working limit
# INPF => Setpoint interlock number [1..4]
#
record(calcout, "FE14I-VA-IONP-05:SETSPS2") 
    {
    field(DESC, "Output Setpoints")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto setsps(01,FE14I-VA-IONP-05,1) ts1_5")
##    field(OUT,  "@digitelMpc.proto setsps(01,2) ts1_5")
    field(INPA, "FE14I-VA-IONP-05:SETSP2ON")
    field(INPB, "FE14I-VA-IONP-05:SETSP2OFF")
    field(INPC, "2")
    field(INPD, "1.01E-10")
    field(INPE, "9.99E-5")
    field(INPF, "FE14I-VA-IONP-05:SPNUM2")    
    field(CALC, "((A<D)||(B>E)||(F<1))?0:F")
    field(OOPT, "When Non-zero")
    field(PINI, "NO")
    field(FLNK, "FE14I-VA-IONP-05:RQSTSP2ON")
    }


# Calculate the controller setpoint number for this pump
# Each setpoint has an ON and an OFF pressure attribute.
# Pump  Pump Setpoint  Controller Setpoint
#   1       1                    1
#   1       2                    3
#   2       1                    2
#   2       2                    4

record(calc, "FE14I-VA-IONP-05:SPNUM1") 
    {
    field(DESC, "Controller setpoints number Pump 1")
    field(INPA, "2")
    field(CALC, "(A>1)?2:1")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-05:SETSPS1")
    }

record(calc, "FE14I-VA-IONP-05:SPNUM2") 
    {
    field(DESC, "Controller setpoints number Pump 2")
    field(INPA, "2")
    field(CALC, "(A>1)?4:3")
    field(PINI, "YES")
    # field(FLNK, "FE14I-VA-IONP-05:SETSPS2")
    }


################################################################################
# Text string on front panel
#
record(stringout, "FE14I-VA-IONP-05:SETTEXT") {
    field(DESC, "Text String")
    field(VAL , "FE14I-VA-IONP-05")
    field(DTYP, "stream")
    field(OUT,  "@digitelMpc.proto settext(01,2,FE14I-VA-IONP-05) ts1_5")
    field(PINI, "YES")
}
################################################################################

################################################################################
# Text error message
#
record(stringin, "FE14I-VA-IONP-05:ERROR") 
    {
    field(DESC, "Last error message")
    }

# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-IONP-05:COMMS")
    {
    field(DESC, "Communication Status")
    field(DTYP, "Soft Channel")
    field(SCAN, "Passive")
    field(ZRST, "TIMEOUT")
    field(ONST, "OK")
    field(INP, "0")
    field(PINI, "YES")
    }

record(scalcout, "FE14I-VA-IONP-05:COMMSMATCH")
    {
    field(INAA, "FE14I-VA-IONP-05:P.STAT MS CP")
    field(CALC, "printf('%d',AA!='TIMEOUT'?1:0)")
    field(OOPT, "Every Time")
    field(DOPT, "Use CALC")
    field(OUT, "FE14I-VA-IONP-05:COMMS PP MS")
    }

#! Generated by VisualDCT v2.7.1-SNAPSHOT

# vacuumValve.template
#% macro, __doc__, Template database for a vacuum valve without debounce or raw air records
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate
# % macro, port, asyn port name of FINS driver
#% macro, addr, First address in the DM variable range decade. E.g. if pump is in DM110..118 then addr=110
#% macro, allowpv, If specified, then only write an open command when this is non-zero. MUST have CP at the end of it
#% macro, whylocked, String to output to EDM synoptic as to precisely why the device is locked and by whom
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, valvetype, Determines which icon is shown in css GUI
#% macro, ilk0, Interlock description 0
#% macro, ilk1, Interlock description 1
#% macro, ilk2, Interlock description 2
#% macro, ilk3, Interlock description 3
#% macro, ilk4, Interlock description 4
#% macro, ilk5, Interlock description 5
#% macro, ilk6, Interlock description 6
#% macro, ilk7, Interlock description 7
#% macro, ilk8, Interlock description 8
#% macro, ilk9, Interlock description 9
#% macro, ilk10, Interlock description 10
#% macro, ilk11, Interlock description 11
#% macro, ilk12, Interlock description 12
#% macro, ilk13, Interlock description 13
#% macro, ilk14, Interlock description 14
#% macro, ilk15, Interlock description 15
#% macro, gilk0, Gauge interlock description 0
#% macro, gilk1, Gauge interlock description 1
#% macro, gilk2, Gauge interlock description 2
#% macro, gilk3, Gauge interlock description 3
#% macro, gilk4, Gauge interlock description 4
#% macro, gilk5, Gauge interlock description 5
#% macro, gilk6, Gauge interlock description 6
#% macro, gilk7, Gauge interlock description 7
#% macro, gilk8, Gauge interlock description 8
#% macro, gilk9, Gauge interlock description 9
#% macro, gilk10, Gauge interlock description 10
#% macro, gilk11, Gauge interlock description 11
#% macro, gilk12, Gauge interlock description 12
#% macro, gilk13, Gauge interlock description 13
#% macro, gilk14, Gauge interlock description 14
#% macro, gilk15, Gauge interlock description 15
#% macro, con_label0, Label string for control value 0 (Optional - defaults to Open)
#% macro, con_label1, Label string for control value 1 (Optional - defaults to Close)
#% macro, con_label2, Label string for control value 2 (Optional - defaults to Reset)
#% macro, con_label3, Label string for control value 3 (Optional - defaults to "")
#% macro, con_label4, Label string for control value 4 (Optional - defaults to "")
#% macro, con_label5, Label string for control value 5 (Optional - defaults to "")
#% macro, con_label6, Label string for control value 6 (Optional - defaults to "")
#% macro, sta_label0, Label string for status value 0 (Optional - defaults to Fault)
#% macro, sta_label1, Label string for status value 1 (Optional - defaults to Open)
#% macro, sta_label2, Label string for status value 2 (Optional - defaults to Opening)
#% macro, sta_label3, Label string for status value 3 (Optional - defaults to Closed)
#% macro, sta_label4, Label string for status value 4 (Optional - defaults to Closing)
#% macro, sta_label5, Label string for status value 5 (Optional - defaults to "")
#% macro, sta_label6, Label string for status value 6 (Optional - defaults to "")
#% macro, name, Object name and associated gui name
#% macro, gda_name, GDA name to export to gda as if it exists
#% macro, gda_desc, GDA description
#% macro, desc, Box label for gui
#% macro, mode1, name of remote operational mode (:MODE)
#% macro, mode2, name of local operational mode (:MODE)
#% macro, EMPTY, Empty substitution to satisfy VDCT
# This associates an edm screen with the template
# % gui, , edm, vacuumValve.edl, device=FE14I-RS-ABSB-01
# % gui, , edmembed, vacuumValve-embed.edl, device=FE14I-RS-ABSB-01,box-label=FE14I-RS-ABSB-01
# This associates BOY screens with the template
# % gui, , boydetail, dlsPLCApp_opi/vacValve_detail.opi, device=FE14I-RS-ABSB-01, DESC=FE14I-RS-ABSB-01, ilk0=Air press. OK,ilk1=Limits Healthy,ilk2=Open Limit OK,ilk3=Move time OK,ilk4=VALVE-01 open,ilk5=FVALV-01 open,ilk6=SHTR-01 Open,ilk7=SHTR-02 Open,ilk8=VALVE-02 Open,ilk9=PBPM-02 cooled,ilk10=APTR-02 cooled,ilk11=unused,ilk12=APTR-02 TMON OK,ilk13=BL MPS Non-crit.,ilk14=RIO Healthy,ilk15=V2 Air Pressure,gilk0=FE14I-VA-GAUGE-01,gilk1=FE14I-VA-GAUGE-02,gilk2=FE14I-VA-GAUGE-03,gilk3=FE14I-VA-GAUGE-04,gilk4=FE14I-VA-GAUGE-05,gilk5=FE14I-VA-GAUGE-06,gilk6=FE14I-VA-FVI-01,gilk7=FE14I-VA-FVI-02,gilk8=FE14I-VA-FVI-03,gilk9=FE14I-VA-FVI-04,gilk10=,gilk11=,gilk12=,gilk13=,gilk14=,gilk15=, name=, valvetype=valve, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed_box.opi, device=FE14I-RS-ABSB-01, DESC=FE14I-RS-ABSB-01, name=, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed.opi, device=FE14I-RS-ABSB-01, DESC=FE14I-RS-ABSB-01, name=, valvetype=valve
# These define what PVs a valve detail screen should contain
# % gui, , enum, Control,   FE14I-RS-ABSB-01:CON
# % gui, , readback, Status,  FE14I-RS-ABSB-01:STA
# % gui, , readback, Mode,  FE14I-RS-ABSB-01:MODE
# % gui, , readback, Interlock Stat,  FE14I-RS-ABSB-01:ILKSTA
# % gui, , readback, Operations,  FE14I-RS-ABSB-01:OPS
# % gui, , readback, De-bounce,  FE14I-RS-ABSB-01:ADB
# % gui, , demand, De-bounce,  FE14I-RS-ABSB-01:SETADB
# % gui, , statusbits, Interlocks Latched,  FE14I-RS-ABSB-01:ILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,VALVE-01 open,FVALV-01 open,SHTR-01 Open,SHTR-02 Open,VALVE-02 Open,PBPM-02 cooled,APTR-02 cooled,unused,APTR-02 TMON OK,BL MPS Non-crit.,RIO Healthy,V2 Air Pressure
# % gui, , statusbits, Interlocks Initial,  FE14I-RS-ABSB-01:INIILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,VALVE-01 open,FVALV-01 open,SHTR-01 Open,SHTR-02 Open,VALVE-02 Open,PBPM-02 cooled,APTR-02 cooled,unused,APTR-02 TMON OK,BL MPS Non-crit.,RIO Healthy,V2 Air Pressure
# % gui, , statusbits, Interlocks Current,  FE14I-RS-ABSB-01:RAWILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,VALVE-01 open,FVALV-01 open,SHTR-01 Open,SHTR-02 Open,VALVE-02 Open,PBPM-02 cooled,APTR-02 cooled,unused,APTR-02 TMON OK,BL MPS Non-crit.,RIO Healthy,V2 Air Pressure
# % gui, , statusbits, Interlocks IMG,  FE14I-RS-ABSB-01:IMGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
# % gui, , statusbits, Interlocks PIRG,  FE14I-RS-ABSB-01:PIRGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
record(ai, "FE14I-RS-ABSB-01:HASDEBOUNCE") {
  field(VAL, "1")
  field(PINI, "YES")
}

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveCtrl.vdb", valveCtrl)

# ##############################################################################
# Control
# 
# % archiver 10 Monitor
# % controldesk Status scon
# % gdatag,template,pneumaticCallback,,
# % gdatag,mbbinary,rw,,CONTROL
## Use this PV to request the valve to open or close
# The request will be checked by FE14I-RS-ABSB-01:CALCCON
record(mbbo, "FE14I-RS-ABSB-01:CON") {
  field(DESC, "Control")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(VAL, "0")
  field(OUT, "FE14I-RS-ABSB-01:CALCCON.A PP")
}

record(seq, "FE14I-RS-ABSB-01:OPENSEQ") {
  field(LNK1, "FE14I-RS-ABSB-01:CON PP")
  field(LNK2, "FE14I-RS-ABSB-01:CON PP")
  field(DO1, "2")
# reset
  field(DO2, "0")
# open
  field(DLY2, "1")
}

## If this PV is non-zero then an open request will be allowed by 
# FE14I-RS-ABSB-01:CALCCON
record(bi, "FE14I-RS-ABSB-01:OPENALLOWED") {
  field(DESC, "Allow/inhibit valve opening")
  field(INP, "")
  field(VAL, "1")
  field(ONAM, "Yes")
  field(ZNAM, "No")
}

record(stringout, "FE14I-RS-ABSB-01:WHYLOCKED") {
  field(DESC, "Reason why device is locked")
  field(VAL, "")
}

## Pass all requests through to the PLC unless it is an open request and 
# FE14I-RS-ABSB-01:OPENALLOWED is zero
record(calcout, "FE14I-RS-ABSB-01:CALCCON") {
  field(INPB, "FE14I-RS-ABSB-01:OPENALLOWED")
  field(OUT, "FE14I-RS-ABSB-01:ACTUALCON PP")
  field(CALC, "(B=0&A=0)?0:1")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A")
}

## Send the request down to the PLC
record(ao, "FE14I-RS-ABSB-01:ACTUALCON") {
  field(DESC, "Control")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 10, 0) FINS_DM_WRITE")
  field(PRIO, "HIGH")
  field(FLNK, "FE14I-RS-ABSB-01:SETBUSY")
}

record(bi, "FE14I-RS-ABSB-01:OPENING") {
  field(DESC, "Opening Valves")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Opening")
}

record(calcout, "FE14I-RS-ABSB-01:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-RS-ABSB-01:BUSY PP NMS")
  field(FLNK, "FE14I-RS-ABSB-01:DONECALC")
}

record(busy, "FE14I-RS-ABSB-01:BUSY") {
}

record(calcout, "FE14I-RS-ABSB-01:DONECALC") {
  field(INPA, "FE14I-RS-ABSB-01:CON MS")
  field(INPB, "FE14I-RS-ABSB-01:STA CPP MS")
  field(INPC, "FE14I-RS-ABSB-01:ILKSTA CPP MS")
  field(INPD, "FE14I-RS-ABSB-01:LASTCON CPP MS")
  field(CALC, "((A=D)&(((A*2+1)=B)|A=2|C=0))?0:1")
  field(OOPT, "When Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-RS-ABSB-01:BUSY CA NMS")
}

# % archiver 10 Monitor
record(mbbi, "FE14I-RS-ABSB-01:LASTCON") {
  field(DESC, "Control Readback")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(INP, "FE14I-RS-ABSB-01:GETLASTCON.VAL MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETLASTCON") {
  field(DESC, "Get control readback")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:LASTCON")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# LASTCON is in DM10+1. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:LASTCONINDX") {
  field(CALC, "10%100+1")
  field(OUT, "FE14I-RS-ABSB-01:GETLASTCON.INDX PP")
  field(PINI, "YES")
}

# LASTCON is in DM10+1. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:LASTCONINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETLASTCON.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:LASTCONINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:LASTCONINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:LASTCONINP.DISA")
}

# ###################################################################
# Interlock Status
# 
# % archiver 10 Monitor
# % controldesk Interlock Status smon
record(mbbi, "FE14I-RS-ABSB-01:ILKSTA") {
  field(DESC, "Interlock Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Failed")
  field(ONST, "Run Ilks Ok")
  field(TWST, "OK")
  field(THST, "Disarmed")
  field(FRST, "")
  field(FVST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(INP, "FE14I-RS-ABSB-01:GETILKSTA.VAL MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETILKSTA") {
  field(DESC, "Get interlock status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:ILKSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ILKSTA is in DM10+2. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:ILKSTAINDX") {
  field(CALC, "10%100+2")
  field(OUT, "FE14I-RS-ABSB-01:GETILKSTA.INDX PP")
  field(PINI, "YES")
}

# ILKSTA is in DM10+2. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:ILKSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETILKSTA.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:ILKSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:ILKSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:ILKSTAINP.DISA")
}

# #########################################################################
# Status
# 
# % archiver 10 Monitor
# % controldesk Status smon
# This makes the component icon reflect the status
# % gui, , sevr
#% gdatag,mbbinary,ro,,STA
record(mbbi, "FE14I-RS-ABSB-01:STA") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(FVST, "")
  field(SXST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(INP, "FE14I-RS-ABSB-01:GETSTA MS")
}

# this tells the gui that this device is moving if STA is Opening or Closing
# % gui, , status
record(calcout, "FE14I-RS-ABSB-01:MOVN") {
  field(DTYP, "Soft Channel")
  field(DESC, "Is valve moving")
  field(INPA, "FE14I-RS-ABSB-01:STA CP")
  field(CALC, "A=2|A=4")
}

record(subArray, "FE14I-RS-ABSB-01:GETSTA") {
  field(DESC, "Get status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:STA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM10+3. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:STAINDX") {
  field(CALC, "10%100+3")
  field(OUT, "FE14I-RS-ABSB-01:GETSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM10+3. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:STAINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETSTA.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:STAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:STAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:STAINP.DISA")
}

# ############################################################################
# Number of Operations
# 
# % archiver 10 Monitor
# % controldesk Number of Operations readback
record(longin, "FE14I-RS-ABSB-01:OPS") {
  field(DESC, "Operations")
  field(DTYP, "Soft Channel")
  field(HOPR, "10000")
  field(LOPR, "0")
  field(HIHI, "10000")
  field(HIGH, "9000")
  field(LOW, "0")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(LLSV, "MAJOR")
  field(INP, "FE14I-RS-ABSB-01:GETOPS.VAL MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETOPS") {
  field(DESC, "Get operations")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:OPS")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# OPS is in DM10+4. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:OPSINDX") {
  field(CALC, "10%100+4")
  field(OUT, "FE14I-RS-ABSB-01:GETOPS.INDX PP")
  field(PINI, "YES")
}

# OPS is in DM10+4. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:OPSINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETOPS.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:OPSINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:OPSINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:OPSINP.DISA")
}

# #########################################################################
# Mode Status (individual bits pulled off in each valve template
record(mbbiDirect, "FE14I-RS-ABSB-01:MODSTA") {
  field(DESC, "Mode")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-RS-ABSB-01:GETMODSTA MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETMODSTA") {
  field(DESC, "Get mode")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:MODSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# MODSTA is in DM10+5. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:MODSTAINDX") {
  field(CALC, "10%100+5")
  field(OUT, "FE14I-RS-ABSB-01:GETMODSTA.INDX PP")
  field(PINI, "YES")
}

# MODSTA is in DM10+5. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:MODSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETMODSTA.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:MODSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:MODSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:MODSTAINP.DISA")
}

# end(valveCtrl)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveIlk.vdb", valveIlk)

# % archiver 10 Monitor
# % controldesk Latched Interlock Status smon
record(mbbiDirect, "FE14I-RS-ABSB-01:ILK") {
  field(DESC, "Latched Interlocks - tpfx :")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-RS-ABSB-01:GETILK.VAL MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETILK") {
  field(DESC, "Get latched interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:ILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ilk is in DM10+6. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:ILKINDX") {
  field(CALC, "10%100+6")
  field(OUT, "FE14I-RS-ABSB-01:GETILK.INDX PP")
  field(PINI, "YES")
}

# ilk is in DM10+6. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:ILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETILK.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:ILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:ILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:ILKINP.DISA")
}

# Individual Interlocks
record(bi, "FE14I-RS-ABSB-01:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-RS-ABSB-01:ILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Air press. OK")
  field(ONAM, "Air press. OK")
}

record(bi, "FE14I-RS-ABSB-01:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-RS-ABSB-01:ILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Limits Healthy")
  field(ONAM, "Limits Healthy")
}

record(bi, "FE14I-RS-ABSB-01:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-RS-ABSB-01:ILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Open Limit OK")
  field(ONAM, "Open Limit OK")
}

record(bi, "FE14I-RS-ABSB-01:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-RS-ABSB-01:ILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Move time OK")
  field(ONAM, "Move time OK")
}

record(bi, "FE14I-RS-ABSB-01:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-RS-ABSB-01:ILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "VALVE-01 open")
  field(ONAM, "VALVE-01 open")
}

record(bi, "FE14I-RS-ABSB-01:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-RS-ABSB-01:ILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FVALV-01 open")
  field(ONAM, "FVALV-01 open")
}

record(bi, "FE14I-RS-ABSB-01:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-RS-ABSB-01:ILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "SHTR-01 Open")
  field(ONAM, "SHTR-01 Open")
}

record(bi, "FE14I-RS-ABSB-01:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-RS-ABSB-01:ILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "SHTR-02 Open")
  field(ONAM, "SHTR-02 Open")
}

record(bi, "FE14I-RS-ABSB-01:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-RS-ABSB-01:ILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "VALVE-02 Open")
  field(ONAM, "VALVE-02 Open")
}

record(bi, "FE14I-RS-ABSB-01:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-RS-ABSB-01:ILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PBPM-02 cooled")
  field(ONAM, "PBPM-02 cooled")
}

record(bi, "FE14I-RS-ABSB-01:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-RS-ABSB-01:ILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "APTR-02 cooled")
  field(ONAM, "APTR-02 cooled")
}

record(bi, "FE14I-RS-ABSB-01:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-RS-ABSB-01:ILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-RS-ABSB-01:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-RS-ABSB-01:ILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "APTR-02 TMON OK")
  field(ONAM, "APTR-02 TMON OK")
}

record(bi, "FE14I-RS-ABSB-01:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-RS-ABSB-01:ILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "BL MPS Non-crit.")
  field(ONAM, "BL MPS Non-crit.")
}

record(bi, "FE14I-RS-ABSB-01:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-RS-ABSB-01:ILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "RIO Healthy")
  field(ONAM, "RIO Healthy")
}

record(bi, "FE14I-RS-ABSB-01:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-RS-ABSB-01:ILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "V2 Air Pressure")
  field(ONAM, "V2 Air Pressure")
}

# % archiver 10 Monitor
# % controldesk Initial Interlock Status smon
record(mbbiDirect, "FE14I-RS-ABSB-01:INIILK") {
  field(DESC, "Initial Interlock")
  field(INP, "FE14I-RS-ABSB-01:GETINIILK MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETINIILK") {
  field(DESC, "Get initial interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:INIILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ini ilk is in DM10+7. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:INIILKINDX") {
  field(CALC, "10%100+7")
  field(OUT, "FE14I-RS-ABSB-01:GETINIILK.INDX PP")
  field(PINI, "YES")
}

# ini ilk is in DM10+7. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:INIILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETINIILK.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:INIILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:INIILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:INIILKINP.DISA")
}

# % archiver 10 Monitor
# % controldesk Current Interlock Status smon
record(mbbiDirect, "FE14I-RS-ABSB-01:RAWILK") {
  field(DESC, "Current Interlocks")
  field(INP, "FE14I-RS-ABSB-01:GETRAWILK MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETRAWILK") {
  field(DESC, "Get current interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:RAWILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# raw ilk is in DM10+8. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:RAWILKINDX") {
  field(CALC, "10%100+8")
  field(OUT, "FE14I-RS-ABSB-01:GETRAWILK.INDX PP")
  field(PINI, "YES")
}

# raw ilk is in DM10+8. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:RAWILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETRAWILK.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:RAWILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:RAWILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:RAWILKINP.DISA")
}

# end(valveIlk)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveGilk.vdb", valveGilk)

################################################################################
# % archiver 10 Monitor
# % controldesk Gauge Interlock Status smon
record(mbbiDirect, "FE14I-RS-ABSB-01:GILK") {
  field(DESC, "Gauge Interlocks")
  field(INP, "FE14I-RS-ABSB-01:GETGILK MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETGILK") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:GILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# gilk is in DM10+9. Calc the index into the 
# century record
record(calcout, "FE14I-RS-ABSB-01:GILKINDX") {
  field(CALC, "10%100+9")
  field(OUT, "FE14I-RS-ABSB-01:GETGILK.INDX PP")
  field(PINI, "YES")
}

# gilk is in DM10+9. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:GILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(10/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:GETGILK.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:GILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:GILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:GILKINP.DISA")
}

################################################################################
#% archiver 10 Monitor
#% controldesk IMG Interlock Status smon
#
record(mbbiDirect, "FE14I-RS-ABSB-01:IMGILK") {
  field(DESC, "IMG Interlocks")
  field(INP, "FE14I-RS-ABSB-01:GETIMGILK MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETIMGILK") {
  field(DESC, "IMG Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:IMGILK")
  field(FTVL, "USHORT")
  field(INDX, "5")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
#% archiver 10 Monitor
#% controldesk Pirani Interlock Status smon
#
record(mbbiDirect, "FE14I-RS-ABSB-01:PIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(INP, "FE14I-RS-ABSB-01:GETPIRGILK MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETPIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:PIRGILK")
  field(FTVL, "USHORT")
  field(INDX, "6")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
# Individual Gauge Interlocks
#
#% archiver 10 Monitor
record(mbbiDirect, "FE14I-RS-ABSB-01:GAUGEILK") {
  field(DESC, "Combined Gauge Interlock")
  field(INP, "FE14I-RS-ABSB-01:CALGILK MS")
}

record(calc, "FE14I-RS-ABSB-01:CALGILK") {
  field(CALC, "A&B")
  field(FLNK, "FE14I-RS-ABSB-01:GAUGEILK")
  field(INPA, "FE14I-RS-ABSB-01:IMGILK CP MS")
  field(INPB, "FE14I-RS-ABSB-01:PIRGILK CP MS")
}

record(bi, "FE14I-RS-ABSB-01:GILK0") {
  field(DESC, "Gauge ILK 0")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-01")
  field(ONAM, "FE14I-VA-GAUGE-01")
}

record(bi, "FE14I-RS-ABSB-01:GILK1") {
  field(DESC, "Gauge ILK 1")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-02")
  field(ONAM, "FE14I-VA-GAUGE-02")
}

record(bi, "FE14I-RS-ABSB-01:GILK2") {
  field(DESC, "Gauge ILK 2")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-03")
  field(ONAM, "FE14I-VA-GAUGE-03")
}

record(bi, "FE14I-RS-ABSB-01:GILK3") {
  field(DESC, "Gauge ILK 3")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-04")
  field(ONAM, "FE14I-VA-GAUGE-04")
}

record(bi, "FE14I-RS-ABSB-01:GILK4") {
  field(DESC, "Gauge ILK 4")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-05")
  field(ONAM, "FE14I-VA-GAUGE-05")
}

record(bi, "FE14I-RS-ABSB-01:GILK5") {
  field(DESC, "Gauge ILK 5")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-06")
  field(ONAM, "FE14I-VA-GAUGE-06")
}

record(bi, "FE14I-RS-ABSB-01:GILK6") {
  field(DESC, "Gauge ILK 6")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-01")
  field(ONAM, "FE14I-VA-FVI-01")
}

record(bi, "FE14I-RS-ABSB-01:GILK7") {
  field(DESC, "Gauge ILK 7")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-02")
  field(ONAM, "FE14I-VA-FVI-02")
}

record(bi, "FE14I-RS-ABSB-01:GILK8") {
  field(DESC, "Gauge ILK 8")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-03")
  field(ONAM, "FE14I-VA-FVI-03")
}

record(bi, "FE14I-RS-ABSB-01:GILK9") {
  field(DESC, "Gauge ILK 9")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-04")
  field(ONAM, "FE14I-VA-FVI-04")
}

record(bi, "FE14I-RS-ABSB-01:GILK10") {
  field(DESC, "Gauge ILK 10")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-RS-ABSB-01:GILK11") {
  field(DESC, "Gauge ILK 11")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-RS-ABSB-01:GILK12") {
  field(DESC, "Gauge ILK 12")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-RS-ABSB-01:GILK13") {
  field(DESC, "Gauge ILK 13")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-RS-ABSB-01:GILK14") {
  field(DESC, "Gauge ILK 14")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-RS-ABSB-01:GILK15") {
  field(DESC, "Gauge ILK 15")
  field(INP, "FE14I-RS-ABSB-01:GAUGEILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

# end(valveGilk)

# Operational/Service Mode
#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "FE14I-RS-ABSB-01:MODE") {
  field(DESC, "Mode")
  field(INP, "FE14I-RS-ABSB-01:MODSTA.B0 CP MS")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

# ######################################################################
# Close time trip
#
#% controldesk Close Timeout setpoint
#
# NB: This section may be better rejoining the TCLOSE records, which were
#     below, but now extracted to their own template (dlsPLC_vacValveTclose.vdb)
#     which was done to better support ABSB-01 for front-ends close time metrics.
# IJG 24 July 2018
#
record(longin, "FE14I-RS-ABSB-01:INPMINTCLS") {
  field(INP, "FE14I-RS-ABSB-01:GETINPMINTCLS PP MS")
}

# INDX calculation DM10+n. Calc the index into the century record
record(calcout, "FE14I-RS-ABSB-01:INPMINTCLSINDX") {
  field(CALC, "10+7")
  field(OUT, "FE14I-RS-ABSB-01:GETINPMINTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-RS-ABSB-01:GETINPMINTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Minimum Close Time readback
#
record(calc, "FE14I-RS-ABSB-01:MINTCLS") {
  field(DESC, "Min Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-RS-ABSB-01:INPMINTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MAJOR")
}

record(longin, "FE14I-RS-ABSB-01:INPMAXTCLS") {
  field(INP, "FE14I-RS-ABSB-01:GETINPMAXTCLS PP MS")
}

# INDX calculation DM10+n. Calc the index into the century record
record(calcout, "FE14I-RS-ABSB-01:INPMAXTCLSINDX") {
  field(CALC, "10+5")
  field(OUT, "FE14I-RS-ABSB-01:GETINPMAXTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-RS-ABSB-01:GETINPMAXTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Maximum Close Time readback
#
record(calc, "FE14I-RS-ABSB-01:MAXTCLS") {
  field(DESC, "Max Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-RS-ABSB-01:INPMAXTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MINOR")
}

################################################################################
# Air Pressure De-bounce Time
#
#% controldesk Air Pressure De-bounce Time setpoint
#
record(ao, "FE14I-RS-ABSB-01:SETADB") {
  field(DTYP, "Raw Soft Channel")
  field(DESC, "De-bounce Time")
  field(EGU, "s")
  field(PREC, "1")
  field(DOL, "10.0")
  field(ASLO, "0.1")
  field(PINI, "YES")
  field(OUT, "FE14I-RS-ABSB-01:OUTTIMEOUT PP")
}

#
#% archiver 10 Monitor
#% controldesk Air Pressure De-bounce Time readback
#
record(calc, "FE14I-RS-ABSB-01:ADB") {
  field(DESC, "De-bounce Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-RS-ABSB-01:INPTIMEOUT PP MS")
  field(SCAN, "1 second")
  field(EGU, "s")
  field(PREC, "1")
}

record(ao, "FE14I-RS-ABSB-01:OUTTIMEOUT") {
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 103, 0) FINS_DM_WRITE")
}

# INDX calculation DM10+n. Calc the index into the century record
#record(calcout, "FE14I-RS-ABSB-01:INPTIMEOUTINDX") 
#  {
#  field(CALC, "0")
#  field(OUT, "FE14I-RS-ABSB-01:INPTIMEOUT.INDX PP")
#  field(PINI, "YES")
#  }
# DX00
record(subArray, "FE14I-RS-ABSB-01:INPTIMEOUT") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM100")
  field(INDX, "0")
  field(MALM, "100")
}

# addr is the valve (device) number x10
# the ADB and timeouts are in centuries corresponding to
# device number (1XX, 2XX, etc.)
# 
# Calculate the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-RS-ABSB-01:SCALCCENTURY") {
  field(CALC, "PRINTF(AA,FLOOR(10/10))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-RS-ABSB-01:INPTIMEOUT.INP CA")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:CENTURYDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:SCALCCENTURY.DISA")
}

################################################################################
# NOTE: only valid for valves 0..9
#% archiver 10 Monitor
#% controldesk Raw Air Pressure Status smon
#
record(mbbiDirect, "FE14I-RS-ABSB-01:RAWAIRALL") {
  field(DESC, "Raw air pressure all valves")
  field(INP, "FE14I-RS-ABSB-01:GETRAWAIR MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETRAWAIR") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:RAWAIRALL")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(INDX, "3")
  field(MALM, "100")
}

record(bi, "FE14I-RS-ABSB-01:RAWAIRSTA") {
  field(DESC, "Raw Air Pressure Status")
  field(ZNAM, "Low")
  field(ONAM, "Good")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
}

# Turn valve 15 (addr=150) into the letter F to get raw air status
record(scalcout, "FE14I-RS-ABSB-01:RAWAIRSTAINP") {
  field(CALC, "PRINTF(AA,MIN(FLOOR(10/10),15))")
  field(AA, "FE14I-RS-ABSB-01:RAWAIRALL.B%1X CP MS")
  field(OUT, "FE14I-RS-ABSB-01:RAWAIRSTA.INP CA")
  field(FLNK, "FE14I-RS-ABSB-01:RAWAIRSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-RS-ABSB-01:RAWAIRSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-RS-ABSB-01:RAWAIRSTAINP.DISA")
}

################################################################################
# % archiver 10 Monitor
# % controldesk Initial/Run Vacuum Status smon
#
record(mbbiDirect, "FE14I-RS-ABSB-01:IRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(INP, "FE14I-RS-ABSB-01:GETIRVAC MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETIRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-RS-ABSB-01:IRVAC")
  field(FTVL, "USHORT")
  field(INDX, "7")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# vacuumValve.template
#% macro, __doc__, Template database for a vacuum valve without debounce or raw air records
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate
# % macro, port, asyn port name of FINS driver
#% macro, addr, First address in the DM variable range decade. E.g. if pump is in DM110..118 then addr=110
#% macro, allowpv, If specified, then only write an open command when this is non-zero. MUST have CP at the end of it
#% macro, whylocked, String to output to EDM synoptic as to precisely why the device is locked and by whom
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, valvetype, Determines which icon is shown in css GUI
#% macro, ilk0, Interlock description 0
#% macro, ilk1, Interlock description 1
#% macro, ilk2, Interlock description 2
#% macro, ilk3, Interlock description 3
#% macro, ilk4, Interlock description 4
#% macro, ilk5, Interlock description 5
#% macro, ilk6, Interlock description 6
#% macro, ilk7, Interlock description 7
#% macro, ilk8, Interlock description 8
#% macro, ilk9, Interlock description 9
#% macro, ilk10, Interlock description 10
#% macro, ilk11, Interlock description 11
#% macro, ilk12, Interlock description 12
#% macro, ilk13, Interlock description 13
#% macro, ilk14, Interlock description 14
#% macro, ilk15, Interlock description 15
#% macro, gilk0, Gauge interlock description 0
#% macro, gilk1, Gauge interlock description 1
#% macro, gilk2, Gauge interlock description 2
#% macro, gilk3, Gauge interlock description 3
#% macro, gilk4, Gauge interlock description 4
#% macro, gilk5, Gauge interlock description 5
#% macro, gilk6, Gauge interlock description 6
#% macro, gilk7, Gauge interlock description 7
#% macro, gilk8, Gauge interlock description 8
#% macro, gilk9, Gauge interlock description 9
#% macro, gilk10, Gauge interlock description 10
#% macro, gilk11, Gauge interlock description 11
#% macro, gilk12, Gauge interlock description 12
#% macro, gilk13, Gauge interlock description 13
#% macro, gilk14, Gauge interlock description 14
#% macro, gilk15, Gauge interlock description 15
#% macro, con_label0, Label string for control value 0 (Optional - defaults to Open)
#% macro, con_label1, Label string for control value 1 (Optional - defaults to Close)
#% macro, con_label2, Label string for control value 2 (Optional - defaults to Reset)
#% macro, con_label3, Label string for control value 3 (Optional - defaults to "")
#% macro, con_label4, Label string for control value 4 (Optional - defaults to "")
#% macro, con_label5, Label string for control value 5 (Optional - defaults to "")
#% macro, con_label6, Label string for control value 6 (Optional - defaults to "")
#% macro, sta_label0, Label string for status value 0 (Optional - defaults to Fault)
#% macro, sta_label1, Label string for status value 1 (Optional - defaults to Open)
#% macro, sta_label2, Label string for status value 2 (Optional - defaults to Opening)
#% macro, sta_label3, Label string for status value 3 (Optional - defaults to Closed)
#% macro, sta_label4, Label string for status value 4 (Optional - defaults to Closing)
#% macro, sta_label5, Label string for status value 5 (Optional - defaults to "")
#% macro, sta_label6, Label string for status value 6 (Optional - defaults to "")
#% macro, name, Object name and associated gui name
#% macro, gda_name, GDA name to export to gda as if it exists
#% macro, gda_desc, GDA description
#% macro, desc, Box label for gui
#% macro, mode1, name of remote operational mode (:MODE)
#% macro, mode2, name of local operational mode (:MODE)
#% macro, EMPTY, Empty substitution to satisfy VDCT
# This associates an edm screen with the template
# % gui, , edm, vacuumValve.edl, device=FE14I-VA-VALVE-01
# % gui, , edmembed, vacuumValve-embed.edl, device=FE14I-VA-VALVE-01,box-label=FE14I-VA-VALVE-01
# This associates BOY screens with the template
# % gui, , boydetail, dlsPLCApp_opi/vacValve_detail.opi, device=FE14I-VA-VALVE-01, DESC=FE14I-VA-VALVE-01, ilk0=Air press. OK,ilk1=Limits Healthy,ilk2=Open Limit OK,ilk3=Move time OK,ilk4=FE Init. Vac. OK,ilk5=FE Run Vac. OK,ilk6=FVALV-01 open,ilk7=FVALV-01 Armed,ilk8=/FVALV Triggrd,ilk9=PIRG-02 OK,ilk10=PIRG-03 OK,ilk11=IMG-02/IMG-03,ilk12=IMG-04/IMG-05,ilk13=ABS not clsd/5of6 IMG,ilk14=unused,ilk15=unused,gilk0=FE14I-VA-GAUGE-01,gilk1=FE14I-VA-GAUGE-02,gilk2=FE14I-VA-GAUGE-03,gilk3=FE14I-VA-GAUGE-04,gilk4=FE14I-VA-GAUGE-05,gilk5=FE14I-VA-GAUGE-06,gilk6=FE14I-VA-FVI-01,gilk7=FE14I-VA-FVI-02,gilk8=FE14I-VA-FVI-03,gilk9=FE14I-VA-FVI-04,gilk10=,gilk11=,gilk12=,gilk13=,gilk14=,gilk15=, name=, valvetype=valve, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed_box.opi, device=FE14I-VA-VALVE-01, DESC=FE14I-VA-VALVE-01, name=, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed.opi, device=FE14I-VA-VALVE-01, DESC=FE14I-VA-VALVE-01, name=, valvetype=valve
# These define what PVs a valve detail screen should contain
# % gui, , enum, Control,   FE14I-VA-VALVE-01:CON
# % gui, , readback, Status,  FE14I-VA-VALVE-01:STA
# % gui, , readback, Mode,  FE14I-VA-VALVE-01:MODE
# % gui, , readback, Interlock Stat,  FE14I-VA-VALVE-01:ILKSTA
# % gui, , readback, Operations,  FE14I-VA-VALVE-01:OPS
# % gui, , readback, De-bounce,  FE14I-VA-VALVE-01:ADB
# % gui, , demand, De-bounce,  FE14I-VA-VALVE-01:SETADB
# % gui, , statusbits, Interlocks Latched,  FE14I-VA-VALVE-01:ILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,FE Init. Vac. OK,FE Run Vac. OK,FVALV-01 open,FVALV-01 Armed,/FVALV Triggrd,PIRG-02 OK,PIRG-03 OK,IMG-02/IMG-03,IMG-04/IMG-05,ABS not clsd/5of6 IMG,unused,unused
# % gui, , statusbits, Interlocks Initial,  FE14I-VA-VALVE-01:INIILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,FE Init. Vac. OK,FE Run Vac. OK,FVALV-01 open,FVALV-01 Armed,/FVALV Triggrd,PIRG-02 OK,PIRG-03 OK,IMG-02/IMG-03,IMG-04/IMG-05,ABS not clsd/5of6 IMG,unused,unused
# % gui, , statusbits, Interlocks Current,  FE14I-VA-VALVE-01:RAWILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,FE Init. Vac. OK,FE Run Vac. OK,FVALV-01 open,FVALV-01 Armed,/FVALV Triggrd,PIRG-02 OK,PIRG-03 OK,IMG-02/IMG-03,IMG-04/IMG-05,ABS not clsd/5of6 IMG,unused,unused
# % gui, , statusbits, Interlocks IMG,  FE14I-VA-VALVE-01:IMGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
# % gui, , statusbits, Interlocks PIRG,  FE14I-VA-VALVE-01:PIRGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
record(ai, "FE14I-VA-VALVE-01:HASDEBOUNCE") {
  field(VAL, "1")
  field(PINI, "YES")
}

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveCtrl.vdb", valveCtrl)

# ##############################################################################
# Control
# 
# % archiver 10 Monitor
# % controldesk Status scon
# % gdatag,template,pneumaticCallback,,
# % gdatag,mbbinary,rw,,CONTROL
## Use this PV to request the valve to open or close
# The request will be checked by FE14I-VA-VALVE-01:CALCCON
record(mbbo, "FE14I-VA-VALVE-01:CON") {
  field(DESC, "Control")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(VAL, "0")
  field(OUT, "FE14I-VA-VALVE-01:CALCCON.A PP")
}

record(seq, "FE14I-VA-VALVE-01:OPENSEQ") {
  field(LNK1, "FE14I-VA-VALVE-01:CON PP")
  field(LNK2, "FE14I-VA-VALVE-01:CON PP")
  field(DO1, "2")
# reset
  field(DO2, "0")
# open
  field(DLY2, "1")
}

## If this PV is non-zero then an open request will be allowed by 
# FE14I-VA-VALVE-01:CALCCON
record(bi, "FE14I-VA-VALVE-01:OPENALLOWED") {
  field(DESC, "Allow/inhibit valve opening")
  field(INP, "")
  field(VAL, "1")
  field(ONAM, "Yes")
  field(ZNAM, "No")
}

record(stringout, "FE14I-VA-VALVE-01:WHYLOCKED") {
  field(DESC, "Reason why device is locked")
  field(VAL, "")
}

## Pass all requests through to the PLC unless it is an open request and 
# FE14I-VA-VALVE-01:OPENALLOWED is zero
record(calcout, "FE14I-VA-VALVE-01:CALCCON") {
  field(INPB, "FE14I-VA-VALVE-01:OPENALLOWED")
  field(OUT, "FE14I-VA-VALVE-01:ACTUALCON PP")
  field(CALC, "(B=0&A=0)?0:1")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A")
}

## Send the request down to the PLC
record(ao, "FE14I-VA-VALVE-01:ACTUALCON") {
  field(DESC, "Control")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 20, 0) FINS_DM_WRITE")
  field(PRIO, "HIGH")
  field(FLNK, "FE14I-VA-VALVE-01:SETBUSY")
}

record(bi, "FE14I-VA-VALVE-01:OPENING") {
  field(DESC, "Opening Valves")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Opening")
}

record(calcout, "FE14I-VA-VALVE-01:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-VA-VALVE-01:BUSY PP NMS")
  field(FLNK, "FE14I-VA-VALVE-01:DONECALC")
}

record(busy, "FE14I-VA-VALVE-01:BUSY") {
}

record(calcout, "FE14I-VA-VALVE-01:DONECALC") {
  field(INPA, "FE14I-VA-VALVE-01:CON MS")
  field(INPB, "FE14I-VA-VALVE-01:STA CPP MS")
  field(INPC, "FE14I-VA-VALVE-01:ILKSTA CPP MS")
  field(INPD, "FE14I-VA-VALVE-01:LASTCON CPP MS")
  field(CALC, "((A=D)&(((A*2+1)=B)|A=2|C=0))?0:1")
  field(OOPT, "When Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-VA-VALVE-01:BUSY CA NMS")
}

# % archiver 10 Monitor
record(mbbi, "FE14I-VA-VALVE-01:LASTCON") {
  field(DESC, "Control Readback")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(INP, "FE14I-VA-VALVE-01:GETLASTCON.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETLASTCON") {
  field(DESC, "Get control readback")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:LASTCON")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# LASTCON is in DM20+1. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:LASTCONINDX") {
  field(CALC, "20%100+1")
  field(OUT, "FE14I-VA-VALVE-01:GETLASTCON.INDX PP")
  field(PINI, "YES")
}

# LASTCON is in DM20+1. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:LASTCONINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETLASTCON.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:LASTCONINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:LASTCONINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:LASTCONINP.DISA")
}

# ###################################################################
# Interlock Status
# 
# % archiver 10 Monitor
# % controldesk Interlock Status smon
record(mbbi, "FE14I-VA-VALVE-01:ILKSTA") {
  field(DESC, "Interlock Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Failed")
  field(ONST, "Run Ilks Ok")
  field(TWST, "OK")
  field(THST, "Disarmed")
  field(FRST, "")
  field(FVST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(INP, "FE14I-VA-VALVE-01:GETILKSTA.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETILKSTA") {
  field(DESC, "Get interlock status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:ILKSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ILKSTA is in DM20+2. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:ILKSTAINDX") {
  field(CALC, "20%100+2")
  field(OUT, "FE14I-VA-VALVE-01:GETILKSTA.INDX PP")
  field(PINI, "YES")
}

# ILKSTA is in DM20+2. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:ILKSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETILKSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:ILKSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:ILKSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:ILKSTAINP.DISA")
}

# #########################################################################
# Status
# 
# % archiver 10 Monitor
# % controldesk Status smon
# This makes the component icon reflect the status
# % gui, , sevr
#% gdatag,mbbinary,ro,,STA
record(mbbi, "FE14I-VA-VALVE-01:STA") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(FVST, "")
  field(SXST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(INP, "FE14I-VA-VALVE-01:GETSTA MS")
}

# this tells the gui that this device is moving if STA is Opening or Closing
# % gui, , status
record(calcout, "FE14I-VA-VALVE-01:MOVN") {
  field(DTYP, "Soft Channel")
  field(DESC, "Is valve moving")
  field(INPA, "FE14I-VA-VALVE-01:STA CP")
  field(CALC, "A=2|A=4")
}

record(subArray, "FE14I-VA-VALVE-01:GETSTA") {
  field(DESC, "Get status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:STA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM20+3. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:STAINDX") {
  field(CALC, "20%100+3")
  field(OUT, "FE14I-VA-VALVE-01:GETSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM20+3. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:STAINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:STAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:STAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:STAINP.DISA")
}

# ############################################################################
# Number of Operations
# 
# % archiver 10 Monitor
# % controldesk Number of Operations readback
record(longin, "FE14I-VA-VALVE-01:OPS") {
  field(DESC, "Operations")
  field(DTYP, "Soft Channel")
  field(HOPR, "10000")
  field(LOPR, "0")
  field(HIHI, "10000")
  field(HIGH, "9000")
  field(LOW, "0")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(LLSV, "MAJOR")
  field(INP, "FE14I-VA-VALVE-01:GETOPS.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETOPS") {
  field(DESC, "Get operations")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:OPS")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# OPS is in DM20+4. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:OPSINDX") {
  field(CALC, "20%100+4")
  field(OUT, "FE14I-VA-VALVE-01:GETOPS.INDX PP")
  field(PINI, "YES")
}

# OPS is in DM20+4. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:OPSINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETOPS.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:OPSINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:OPSINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:OPSINP.DISA")
}

# #########################################################################
# Mode Status (individual bits pulled off in each valve template
record(mbbiDirect, "FE14I-VA-VALVE-01:MODSTA") {
  field(DESC, "Mode")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-VA-VALVE-01:GETMODSTA MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETMODSTA") {
  field(DESC, "Get mode")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:MODSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# MODSTA is in DM20+5. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:MODSTAINDX") {
  field(CALC, "20%100+5")
  field(OUT, "FE14I-VA-VALVE-01:GETMODSTA.INDX PP")
  field(PINI, "YES")
}

# MODSTA is in DM20+5. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:MODSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETMODSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:MODSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:MODSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:MODSTAINP.DISA")
}

# end(valveCtrl)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveIlk.vdb", valveIlk)

# % archiver 10 Monitor
# % controldesk Latched Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-01:ILK") {
  field(DESC, "Latched Interlocks - tpfx :")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-VA-VALVE-01:GETILK.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETILK") {
  field(DESC, "Get latched interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:ILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ilk is in DM20+6. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:ILKINDX") {
  field(CALC, "20%100+6")
  field(OUT, "FE14I-VA-VALVE-01:GETILK.INDX PP")
  field(PINI, "YES")
}

# ilk is in DM20+6. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:ILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:ILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:ILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:ILKINP.DISA")
}

# Individual Interlocks
record(bi, "FE14I-VA-VALVE-01:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-VA-VALVE-01:ILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Air press. OK")
  field(ONAM, "Air press. OK")
}

record(bi, "FE14I-VA-VALVE-01:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-VA-VALVE-01:ILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Limits Healthy")
  field(ONAM, "Limits Healthy")
}

record(bi, "FE14I-VA-VALVE-01:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-VA-VALVE-01:ILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Open Limit OK")
  field(ONAM, "Open Limit OK")
}

record(bi, "FE14I-VA-VALVE-01:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-VA-VALVE-01:ILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Move time OK")
  field(ONAM, "Move time OK")
}

record(bi, "FE14I-VA-VALVE-01:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-VA-VALVE-01:ILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE Init. Vac. OK")
  field(ONAM, "FE Init. Vac. OK")
}

record(bi, "FE14I-VA-VALVE-01:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-VA-VALVE-01:ILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE Run Vac. OK")
  field(ONAM, "FE Run Vac. OK")
}

record(bi, "FE14I-VA-VALVE-01:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-VA-VALVE-01:ILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FVALV-01 open")
  field(ONAM, "FVALV-01 open")
}

record(bi, "FE14I-VA-VALVE-01:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-VA-VALVE-01:ILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FVALV-01 Armed")
  field(ONAM, "FVALV-01 Armed")
}

record(bi, "FE14I-VA-VALVE-01:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-VA-VALVE-01:ILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "/FVALV Triggrd")
  field(ONAM, "/FVALV Triggrd")
}

record(bi, "FE14I-VA-VALVE-01:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-VA-VALVE-01:ILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PIRG-02 OK")
  field(ONAM, "PIRG-02 OK")
}

record(bi, "FE14I-VA-VALVE-01:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-VA-VALVE-01:ILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PIRG-03 OK")
  field(ONAM, "PIRG-03 OK")
}

record(bi, "FE14I-VA-VALVE-01:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-VA-VALVE-01:ILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "IMG-02/IMG-03")
  field(ONAM, "IMG-02/IMG-03")
}

record(bi, "FE14I-VA-VALVE-01:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-VA-VALVE-01:ILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "IMG-04/IMG-05")
  field(ONAM, "IMG-04/IMG-05")
}

record(bi, "FE14I-VA-VALVE-01:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-VA-VALVE-01:ILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "ABS not clsd/5of6 IMG")
  field(ONAM, "ABS not clsd/5of6 IMG")
}

record(bi, "FE14I-VA-VALVE-01:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-VA-VALVE-01:ILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-VA-VALVE-01:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-VA-VALVE-01:ILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

# % archiver 10 Monitor
# % controldesk Initial Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-01:INIILK") {
  field(DESC, "Initial Interlock")
  field(INP, "FE14I-VA-VALVE-01:GETINIILK MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETINIILK") {
  field(DESC, "Get initial interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:INIILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ini ilk is in DM20+7. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:INIILKINDX") {
  field(CALC, "20%100+7")
  field(OUT, "FE14I-VA-VALVE-01:GETINIILK.INDX PP")
  field(PINI, "YES")
}

# ini ilk is in DM20+7. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:INIILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETINIILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:INIILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:INIILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:INIILKINP.DISA")
}

# % archiver 10 Monitor
# % controldesk Current Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-01:RAWILK") {
  field(DESC, "Current Interlocks")
  field(INP, "FE14I-VA-VALVE-01:GETRAWILK MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETRAWILK") {
  field(DESC, "Get current interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:RAWILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# raw ilk is in DM20+8. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:RAWILKINDX") {
  field(CALC, "20%100+8")
  field(OUT, "FE14I-VA-VALVE-01:GETRAWILK.INDX PP")
  field(PINI, "YES")
}

# raw ilk is in DM20+8. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:RAWILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETRAWILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:RAWILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:RAWILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:RAWILKINP.DISA")
}

# end(valveIlk)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveGilk.vdb", valveGilk)

################################################################################
# % archiver 10 Monitor
# % controldesk Gauge Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-01:GILK") {
  field(DESC, "Gauge Interlocks")
  field(INP, "FE14I-VA-VALVE-01:GETGILK MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETGILK") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:GILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# gilk is in DM20+9. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-01:GILKINDX") {
  field(CALC, "20%100+9")
  field(OUT, "FE14I-VA-VALVE-01:GETGILK.INDX PP")
  field(PINI, "YES")
}

# gilk is in DM20+9. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:GILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(20/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:GETGILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:GILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:GILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:GILKINP.DISA")
}

################################################################################
#% archiver 10 Monitor
#% controldesk IMG Interlock Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-01:IMGILK") {
  field(DESC, "IMG Interlocks")
  field(INP, "FE14I-VA-VALVE-01:GETIMGILK MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETIMGILK") {
  field(DESC, "IMG Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:IMGILK")
  field(FTVL, "USHORT")
  field(INDX, "5")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
#% archiver 10 Monitor
#% controldesk Pirani Interlock Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-01:PIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(INP, "FE14I-VA-VALVE-01:GETPIRGILK MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETPIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:PIRGILK")
  field(FTVL, "USHORT")
  field(INDX, "6")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
# Individual Gauge Interlocks
#
#% archiver 10 Monitor
record(mbbiDirect, "FE14I-VA-VALVE-01:GAUGEILK") {
  field(DESC, "Combined Gauge Interlock")
  field(INP, "FE14I-VA-VALVE-01:CALGILK MS")
}

record(calc, "FE14I-VA-VALVE-01:CALGILK") {
  field(CALC, "A&B")
  field(FLNK, "FE14I-VA-VALVE-01:GAUGEILK")
  field(INPA, "FE14I-VA-VALVE-01:IMGILK CP MS")
  field(INPB, "FE14I-VA-VALVE-01:PIRGILK CP MS")
}

record(bi, "FE14I-VA-VALVE-01:GILK0") {
  field(DESC, "Gauge ILK 0")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-01")
  field(ONAM, "FE14I-VA-GAUGE-01")
}

record(bi, "FE14I-VA-VALVE-01:GILK1") {
  field(DESC, "Gauge ILK 1")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-02")
  field(ONAM, "FE14I-VA-GAUGE-02")
}

record(bi, "FE14I-VA-VALVE-01:GILK2") {
  field(DESC, "Gauge ILK 2")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-03")
  field(ONAM, "FE14I-VA-GAUGE-03")
}

record(bi, "FE14I-VA-VALVE-01:GILK3") {
  field(DESC, "Gauge ILK 3")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-04")
  field(ONAM, "FE14I-VA-GAUGE-04")
}

record(bi, "FE14I-VA-VALVE-01:GILK4") {
  field(DESC, "Gauge ILK 4")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-05")
  field(ONAM, "FE14I-VA-GAUGE-05")
}

record(bi, "FE14I-VA-VALVE-01:GILK5") {
  field(DESC, "Gauge ILK 5")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-06")
  field(ONAM, "FE14I-VA-GAUGE-06")
}

record(bi, "FE14I-VA-VALVE-01:GILK6") {
  field(DESC, "Gauge ILK 6")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-01")
  field(ONAM, "FE14I-VA-FVI-01")
}

record(bi, "FE14I-VA-VALVE-01:GILK7") {
  field(DESC, "Gauge ILK 7")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-02")
  field(ONAM, "FE14I-VA-FVI-02")
}

record(bi, "FE14I-VA-VALVE-01:GILK8") {
  field(DESC, "Gauge ILK 8")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-03")
  field(ONAM, "FE14I-VA-FVI-03")
}

record(bi, "FE14I-VA-VALVE-01:GILK9") {
  field(DESC, "Gauge ILK 9")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-04")
  field(ONAM, "FE14I-VA-FVI-04")
}

record(bi, "FE14I-VA-VALVE-01:GILK10") {
  field(DESC, "Gauge ILK 10")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-01:GILK11") {
  field(DESC, "Gauge ILK 11")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-01:GILK12") {
  field(DESC, "Gauge ILK 12")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-01:GILK13") {
  field(DESC, "Gauge ILK 13")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-01:GILK14") {
  field(DESC, "Gauge ILK 14")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-01:GILK15") {
  field(DESC, "Gauge ILK 15")
  field(INP, "FE14I-VA-VALVE-01:GAUGEILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

# end(valveGilk)

# Operational/Service Mode
#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "FE14I-VA-VALVE-01:MODE") {
  field(DESC, "Mode")
  field(INP, "FE14I-VA-VALVE-01:MODSTA.B0 CP MS")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

# ######################################################################
# Close time trip
#
#% controldesk Close Timeout setpoint
#
# NB: This section may be better rejoining the TCLOSE records, which were
#     below, but now extracted to their own template (dlsPLC_vacValveTclose.vdb)
#     which was done to better support ABSB-01 for front-ends close time metrics.
# IJG 24 July 2018
#
record(longin, "FE14I-VA-VALVE-01:INPMINTCLS") {
  field(INP, "FE14I-VA-VALVE-01:GETINPMINTCLS PP MS")
}

# INDX calculation DM20+n. Calc the index into the century record
record(calcout, "FE14I-VA-VALVE-01:INPMINTCLSINDX") {
  field(CALC, "20+7")
  field(OUT, "FE14I-VA-VALVE-01:GETINPMINTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-VA-VALVE-01:GETINPMINTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Minimum Close Time readback
#
record(calc, "FE14I-VA-VALVE-01:MINTCLS") {
  field(DESC, "Min Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-VA-VALVE-01:INPMINTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MAJOR")
}

record(longin, "FE14I-VA-VALVE-01:INPMAXTCLS") {
  field(INP, "FE14I-VA-VALVE-01:GETINPMAXTCLS PP MS")
}

# INDX calculation DM20+n. Calc the index into the century record
record(calcout, "FE14I-VA-VALVE-01:INPMAXTCLSINDX") {
  field(CALC, "20+5")
  field(OUT, "FE14I-VA-VALVE-01:GETINPMAXTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-VA-VALVE-01:GETINPMAXTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Maximum Close Time readback
#
record(calc, "FE14I-VA-VALVE-01:MAXTCLS") {
  field(DESC, "Max Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-VA-VALVE-01:INPMAXTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MINOR")
}

################################################################################
# Air Pressure De-bounce Time
#
#% controldesk Air Pressure De-bounce Time setpoint
#
record(ao, "FE14I-VA-VALVE-01:SETADB") {
  field(DTYP, "Raw Soft Channel")
  field(DESC, "De-bounce Time")
  field(EGU, "s")
  field(PREC, "1")
  field(DOL, "10.0")
  field(ASLO, "0.1")
  field(PINI, "YES")
  field(OUT, "FE14I-VA-VALVE-01:OUTTIMEOUT PP")
}

#
#% archiver 10 Monitor
#% controldesk Air Pressure De-bounce Time readback
#
record(calc, "FE14I-VA-VALVE-01:ADB") {
  field(DESC, "De-bounce Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-VA-VALVE-01:INPTIMEOUT PP MS")
  field(SCAN, "1 second")
  field(EGU, "s")
  field(PREC, "1")
}

record(ao, "FE14I-VA-VALVE-01:OUTTIMEOUT") {
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 203, 0) FINS_DM_WRITE")
}

# INDX calculation DM20+n. Calc the index into the century record
#record(calcout, "FE14I-VA-VALVE-01:INPTIMEOUTINDX") 
#  {
#  field(CALC, "0")
#  field(OUT, "FE14I-VA-VALVE-01:INPTIMEOUT.INDX PP")
#  field(PINI, "YES")
#  }
# DX00
record(subArray, "FE14I-VA-VALVE-01:INPTIMEOUT") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM200")
  field(INDX, "0")
  field(MALM, "100")
}

# addr is the valve (device) number x10
# the ADB and timeouts are in centuries corresponding to
# device number (1XX, 2XX, etc.)
# 
# Calculate the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-01:SCALCCENTURY") {
  field(CALC, "PRINTF(AA,FLOOR(20/10))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-01:INPTIMEOUT.INP CA")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:CENTURYDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:SCALCCENTURY.DISA")
}

################################################################################
# NOTE: only valid for valves 0..9
#% archiver 10 Monitor
#% controldesk Raw Air Pressure Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-01:RAWAIRALL") {
  field(DESC, "Raw air pressure all valves")
  field(INP, "FE14I-VA-VALVE-01:GETRAWAIR MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETRAWAIR") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:RAWAIRALL")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(INDX, "3")
  field(MALM, "100")
}

record(bi, "FE14I-VA-VALVE-01:RAWAIRSTA") {
  field(DESC, "Raw Air Pressure Status")
  field(ZNAM, "Low")
  field(ONAM, "Good")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
}

# Turn valve 15 (addr=150) into the letter F to get raw air status
record(scalcout, "FE14I-VA-VALVE-01:RAWAIRSTAINP") {
  field(CALC, "PRINTF(AA,MIN(FLOOR(20/10),15))")
  field(AA, "FE14I-VA-VALVE-01:RAWAIRALL.B%1X CP MS")
  field(OUT, "FE14I-VA-VALVE-01:RAWAIRSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-01:RAWAIRSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-01:RAWAIRSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-01:RAWAIRSTAINP.DISA")
}

################################################################################
# % archiver 10 Monitor
# % controldesk Initial/Run Vacuum Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-01:IRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(INP, "FE14I-VA-VALVE-01:GETIRVAC MS")
}

record(subArray, "FE14I-VA-VALVE-01:GETIRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-01:IRVAC")
  field(FTVL, "USHORT")
  field(INDX, "7")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# vacuumValve.template
#% macro, __doc__, Template database for a vacuum valve without debounce or raw air records
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate
# % macro, port, asyn port name of FINS driver
#% macro, addr, First address in the DM variable range decade. E.g. if pump is in DM110..118 then addr=110
#% macro, allowpv, If specified, then only write an open command when this is non-zero. MUST have CP at the end of it
#% macro, whylocked, String to output to EDM synoptic as to precisely why the device is locked and by whom
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, valvetype, Determines which icon is shown in css GUI
#% macro, ilk0, Interlock description 0
#% macro, ilk1, Interlock description 1
#% macro, ilk2, Interlock description 2
#% macro, ilk3, Interlock description 3
#% macro, ilk4, Interlock description 4
#% macro, ilk5, Interlock description 5
#% macro, ilk6, Interlock description 6
#% macro, ilk7, Interlock description 7
#% macro, ilk8, Interlock description 8
#% macro, ilk9, Interlock description 9
#% macro, ilk10, Interlock description 10
#% macro, ilk11, Interlock description 11
#% macro, ilk12, Interlock description 12
#% macro, ilk13, Interlock description 13
#% macro, ilk14, Interlock description 14
#% macro, ilk15, Interlock description 15
#% macro, gilk0, Gauge interlock description 0
#% macro, gilk1, Gauge interlock description 1
#% macro, gilk2, Gauge interlock description 2
#% macro, gilk3, Gauge interlock description 3
#% macro, gilk4, Gauge interlock description 4
#% macro, gilk5, Gauge interlock description 5
#% macro, gilk6, Gauge interlock description 6
#% macro, gilk7, Gauge interlock description 7
#% macro, gilk8, Gauge interlock description 8
#% macro, gilk9, Gauge interlock description 9
#% macro, gilk10, Gauge interlock description 10
#% macro, gilk11, Gauge interlock description 11
#% macro, gilk12, Gauge interlock description 12
#% macro, gilk13, Gauge interlock description 13
#% macro, gilk14, Gauge interlock description 14
#% macro, gilk15, Gauge interlock description 15
#% macro, con_label0, Label string for control value 0 (Optional - defaults to Open)
#% macro, con_label1, Label string for control value 1 (Optional - defaults to Close)
#% macro, con_label2, Label string for control value 2 (Optional - defaults to Reset)
#% macro, con_label3, Label string for control value 3 (Optional - defaults to "")
#% macro, con_label4, Label string for control value 4 (Optional - defaults to "")
#% macro, con_label5, Label string for control value 5 (Optional - defaults to "")
#% macro, con_label6, Label string for control value 6 (Optional - defaults to "")
#% macro, sta_label0, Label string for status value 0 (Optional - defaults to Fault)
#% macro, sta_label1, Label string for status value 1 (Optional - defaults to Open)
#% macro, sta_label2, Label string for status value 2 (Optional - defaults to Opening)
#% macro, sta_label3, Label string for status value 3 (Optional - defaults to Closed)
#% macro, sta_label4, Label string for status value 4 (Optional - defaults to Closing)
#% macro, sta_label5, Label string for status value 5 (Optional - defaults to "")
#% macro, sta_label6, Label string for status value 6 (Optional - defaults to "")
#% macro, name, Object name and associated gui name
#% macro, gda_name, GDA name to export to gda as if it exists
#% macro, gda_desc, GDA description
#% macro, desc, Box label for gui
#% macro, mode1, name of remote operational mode (:MODE)
#% macro, mode2, name of local operational mode (:MODE)
#% macro, EMPTY, Empty substitution to satisfy VDCT
# This associates an edm screen with the template
# % gui, , edm, vacuumValve.edl, device=FE14I-VA-VALVE-02
# % gui, , edmembed, vacuumValve-embed.edl, device=FE14I-VA-VALVE-02,box-label=FE14I-VA-VALVE-02
# This associates BOY screens with the template
# % gui, , boydetail, dlsPLCApp_opi/vacValve_detail.opi, device=FE14I-VA-VALVE-02, DESC=FE14I-VA-VALVE-02, ilk0=Air press. OK,ilk1=Limits Healthy,ilk2=Open Limit OK,ilk3=Move time OK,ilk4=FE Init Vac (6of6),ilk5=FE Run Vac (4of6),ilk6=FVALV open,ilk7=FVALV-01 Full Arm.,ilk8=/FVALV Triggered,ilk9=BL Init. Vac. OK,ilk10=BL Run Vac. OK,ilk11=PIRG-06 OK,ilk12=Not Service Mode,ilk13=Grd A or /V2 Close,ilk14=Grd B or /V2 Close,ilk15=FE-IMG6 & BL-IMG1,gilk0=FE14I-VA-GAUGE-01,gilk1=FE14I-VA-GAUGE-02,gilk2=FE14I-VA-GAUGE-03,gilk3=FE14I-VA-GAUGE-04,gilk4=FE14I-VA-GAUGE-05,gilk5=FE14I-VA-GAUGE-06,gilk6=FE14I-VA-FVI-01,gilk7=FE14I-VA-FVI-02,gilk8=FE14I-VA-FVI-03,gilk9=FE14I-VA-FVI-04,gilk10=,gilk11=,gilk12=,gilk13=,gilk14=,gilk15=, name=, valvetype=valve, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed_box.opi, device=FE14I-VA-VALVE-02, DESC=FE14I-VA-VALVE-02, name=, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed.opi, device=FE14I-VA-VALVE-02, DESC=FE14I-VA-VALVE-02, name=, valvetype=valve
# These define what PVs a valve detail screen should contain
# % gui, , enum, Control,   FE14I-VA-VALVE-02:CON
# % gui, , readback, Status,  FE14I-VA-VALVE-02:STA
# % gui, , readback, Mode,  FE14I-VA-VALVE-02:MODE
# % gui, , readback, Interlock Stat,  FE14I-VA-VALVE-02:ILKSTA
# % gui, , readback, Operations,  FE14I-VA-VALVE-02:OPS
# % gui, , readback, De-bounce,  FE14I-VA-VALVE-02:ADB
# % gui, , demand, De-bounce,  FE14I-VA-VALVE-02:SETADB
# % gui, , statusbits, Interlocks Latched,  FE14I-VA-VALVE-02:ILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,FE Init Vac (6of6),FE Run Vac (4of6),FVALV open,FVALV-01 Full Arm.,/FVALV Triggered,BL Init. Vac. OK,BL Run Vac. OK,PIRG-06 OK,Not Service Mode,Grd A or /V2 Close,Grd B or /V2 Close,FE-IMG6 & BL-IMG1
# % gui, , statusbits, Interlocks Initial,  FE14I-VA-VALVE-02:INIILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,FE Init Vac (6of6),FE Run Vac (4of6),FVALV open,FVALV-01 Full Arm.,/FVALV Triggered,BL Init. Vac. OK,BL Run Vac. OK,PIRG-06 OK,Not Service Mode,Grd A or /V2 Close,Grd B or /V2 Close,FE-IMG6 & BL-IMG1
# % gui, , statusbits, Interlocks Current,  FE14I-VA-VALVE-02:RAWILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,FE Init Vac (6of6),FE Run Vac (4of6),FVALV open,FVALV-01 Full Arm.,/FVALV Triggered,BL Init. Vac. OK,BL Run Vac. OK,PIRG-06 OK,Not Service Mode,Grd A or /V2 Close,Grd B or /V2 Close,FE-IMG6 & BL-IMG1
# % gui, , statusbits, Interlocks IMG,  FE14I-VA-VALVE-02:IMGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
# % gui, , statusbits, Interlocks PIRG,  FE14I-VA-VALVE-02:PIRGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
record(ai, "FE14I-VA-VALVE-02:HASDEBOUNCE") {
  field(VAL, "1")
  field(PINI, "YES")
}

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveCtrl.vdb", valveCtrl)

# ##############################################################################
# Control
# 
# % archiver 10 Monitor
# % controldesk Status scon
# % gdatag,template,pneumaticCallback,,
# % gdatag,mbbinary,rw,,CONTROL
## Use this PV to request the valve to open or close
# The request will be checked by FE14I-VA-VALVE-02:CALCCON
record(mbbo, "FE14I-VA-VALVE-02:CON") {
  field(DESC, "Control")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(VAL, "0")
  field(OUT, "FE14I-VA-VALVE-02:CALCCON.A PP")
}

record(seq, "FE14I-VA-VALVE-02:OPENSEQ") {
  field(LNK1, "FE14I-VA-VALVE-02:CON PP")
  field(LNK2, "FE14I-VA-VALVE-02:CON PP")
  field(DO1, "2")
# reset
  field(DO2, "0")
# open
  field(DLY2, "1")
}

## If this PV is non-zero then an open request will be allowed by 
# FE14I-VA-VALVE-02:CALCCON
record(bi, "FE14I-VA-VALVE-02:OPENALLOWED") {
  field(DESC, "Allow/inhibit valve opening")
  field(INP, "")
  field(VAL, "1")
  field(ONAM, "Yes")
  field(ZNAM, "No")
}

record(stringout, "FE14I-VA-VALVE-02:WHYLOCKED") {
  field(DESC, "Reason why device is locked")
  field(VAL, "")
}

## Pass all requests through to the PLC unless it is an open request and 
# FE14I-VA-VALVE-02:OPENALLOWED is zero
record(calcout, "FE14I-VA-VALVE-02:CALCCON") {
  field(INPB, "FE14I-VA-VALVE-02:OPENALLOWED")
  field(OUT, "FE14I-VA-VALVE-02:ACTUALCON PP")
  field(CALC, "(B=0&A=0)?0:1")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A")
}

## Send the request down to the PLC
record(ao, "FE14I-VA-VALVE-02:ACTUALCON") {
  field(DESC, "Control")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 60, 0) FINS_DM_WRITE")
  field(PRIO, "HIGH")
  field(FLNK, "FE14I-VA-VALVE-02:SETBUSY")
}

record(bi, "FE14I-VA-VALVE-02:OPENING") {
  field(DESC, "Opening Valves")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Opening")
}

record(calcout, "FE14I-VA-VALVE-02:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-VA-VALVE-02:BUSY PP NMS")
  field(FLNK, "FE14I-VA-VALVE-02:DONECALC")
}

record(busy, "FE14I-VA-VALVE-02:BUSY") {
}

record(calcout, "FE14I-VA-VALVE-02:DONECALC") {
  field(INPA, "FE14I-VA-VALVE-02:CON MS")
  field(INPB, "FE14I-VA-VALVE-02:STA CPP MS")
  field(INPC, "FE14I-VA-VALVE-02:ILKSTA CPP MS")
  field(INPD, "FE14I-VA-VALVE-02:LASTCON CPP MS")
  field(CALC, "((A=D)&(((A*2+1)=B)|A=2|C=0))?0:1")
  field(OOPT, "When Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-VA-VALVE-02:BUSY CA NMS")
}

# % archiver 10 Monitor
record(mbbi, "FE14I-VA-VALVE-02:LASTCON") {
  field(DESC, "Control Readback")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(INP, "FE14I-VA-VALVE-02:GETLASTCON.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETLASTCON") {
  field(DESC, "Get control readback")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:LASTCON")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# LASTCON is in DM60+1. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:LASTCONINDX") {
  field(CALC, "60%100+1")
  field(OUT, "FE14I-VA-VALVE-02:GETLASTCON.INDX PP")
  field(PINI, "YES")
}

# LASTCON is in DM60+1. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:LASTCONINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETLASTCON.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:LASTCONINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:LASTCONINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:LASTCONINP.DISA")
}

# ###################################################################
# Interlock Status
# 
# % archiver 10 Monitor
# % controldesk Interlock Status smon
record(mbbi, "FE14I-VA-VALVE-02:ILKSTA") {
  field(DESC, "Interlock Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Failed")
  field(ONST, "Run Ilks Ok")
  field(TWST, "OK")
  field(THST, "Disarmed")
  field(FRST, "")
  field(FVST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(INP, "FE14I-VA-VALVE-02:GETILKSTA.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETILKSTA") {
  field(DESC, "Get interlock status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:ILKSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ILKSTA is in DM60+2. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:ILKSTAINDX") {
  field(CALC, "60%100+2")
  field(OUT, "FE14I-VA-VALVE-02:GETILKSTA.INDX PP")
  field(PINI, "YES")
}

# ILKSTA is in DM60+2. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:ILKSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETILKSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:ILKSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:ILKSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:ILKSTAINP.DISA")
}

# #########################################################################
# Status
# 
# % archiver 10 Monitor
# % controldesk Status smon
# This makes the component icon reflect the status
# % gui, , sevr
#% gdatag,mbbinary,ro,,STA
record(mbbi, "FE14I-VA-VALVE-02:STA") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(FVST, "")
  field(SXST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(INP, "FE14I-VA-VALVE-02:GETSTA MS")
}

# this tells the gui that this device is moving if STA is Opening or Closing
# % gui, , status
record(calcout, "FE14I-VA-VALVE-02:MOVN") {
  field(DTYP, "Soft Channel")
  field(DESC, "Is valve moving")
  field(INPA, "FE14I-VA-VALVE-02:STA CP")
  field(CALC, "A=2|A=4")
}

record(subArray, "FE14I-VA-VALVE-02:GETSTA") {
  field(DESC, "Get status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:STA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM60+3. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:STAINDX") {
  field(CALC, "60%100+3")
  field(OUT, "FE14I-VA-VALVE-02:GETSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM60+3. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:STAINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:STAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:STAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:STAINP.DISA")
}

# ############################################################################
# Number of Operations
# 
# % archiver 10 Monitor
# % controldesk Number of Operations readback
record(longin, "FE14I-VA-VALVE-02:OPS") {
  field(DESC, "Operations")
  field(DTYP, "Soft Channel")
  field(HOPR, "10000")
  field(LOPR, "0")
  field(HIHI, "10000")
  field(HIGH, "9000")
  field(LOW, "0")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(LLSV, "MAJOR")
  field(INP, "FE14I-VA-VALVE-02:GETOPS.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETOPS") {
  field(DESC, "Get operations")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:OPS")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# OPS is in DM60+4. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:OPSINDX") {
  field(CALC, "60%100+4")
  field(OUT, "FE14I-VA-VALVE-02:GETOPS.INDX PP")
  field(PINI, "YES")
}

# OPS is in DM60+4. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:OPSINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETOPS.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:OPSINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:OPSINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:OPSINP.DISA")
}

# #########################################################################
# Mode Status (individual bits pulled off in each valve template
record(mbbiDirect, "FE14I-VA-VALVE-02:MODSTA") {
  field(DESC, "Mode")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-VA-VALVE-02:GETMODSTA MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETMODSTA") {
  field(DESC, "Get mode")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:MODSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# MODSTA is in DM60+5. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:MODSTAINDX") {
  field(CALC, "60%100+5")
  field(OUT, "FE14I-VA-VALVE-02:GETMODSTA.INDX PP")
  field(PINI, "YES")
}

# MODSTA is in DM60+5. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:MODSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETMODSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:MODSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:MODSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:MODSTAINP.DISA")
}

# end(valveCtrl)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveIlk.vdb", valveIlk)

# % archiver 10 Monitor
# % controldesk Latched Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-02:ILK") {
  field(DESC, "Latched Interlocks - tpfx :")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-VA-VALVE-02:GETILK.VAL MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETILK") {
  field(DESC, "Get latched interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:ILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ilk is in DM60+6. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:ILKINDX") {
  field(CALC, "60%100+6")
  field(OUT, "FE14I-VA-VALVE-02:GETILK.INDX PP")
  field(PINI, "YES")
}

# ilk is in DM60+6. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:ILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:ILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:ILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:ILKINP.DISA")
}

# Individual Interlocks
record(bi, "FE14I-VA-VALVE-02:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-VA-VALVE-02:ILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Air press. OK")
  field(ONAM, "Air press. OK")
}

record(bi, "FE14I-VA-VALVE-02:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-VA-VALVE-02:ILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Limits Healthy")
  field(ONAM, "Limits Healthy")
}

record(bi, "FE14I-VA-VALVE-02:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-VA-VALVE-02:ILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Open Limit OK")
  field(ONAM, "Open Limit OK")
}

record(bi, "FE14I-VA-VALVE-02:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-VA-VALVE-02:ILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Move time OK")
  field(ONAM, "Move time OK")
}

record(bi, "FE14I-VA-VALVE-02:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-VA-VALVE-02:ILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE Init Vac (6of6)")
  field(ONAM, "FE Init Vac (6of6)")
}

record(bi, "FE14I-VA-VALVE-02:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-VA-VALVE-02:ILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE Run Vac (4of6)")
  field(ONAM, "FE Run Vac (4of6)")
}

record(bi, "FE14I-VA-VALVE-02:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-VA-VALVE-02:ILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FVALV open")
  field(ONAM, "FVALV open")
}

record(bi, "FE14I-VA-VALVE-02:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-VA-VALVE-02:ILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FVALV-01 Full Arm.")
  field(ONAM, "FVALV-01 Full Arm.")
}

record(bi, "FE14I-VA-VALVE-02:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-VA-VALVE-02:ILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "/FVALV Triggered")
  field(ONAM, "/FVALV Triggered")
}

record(bi, "FE14I-VA-VALVE-02:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-VA-VALVE-02:ILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "BL Init. Vac. OK")
  field(ONAM, "BL Init. Vac. OK")
}

record(bi, "FE14I-VA-VALVE-02:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-VA-VALVE-02:ILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "BL Run Vac. OK")
  field(ONAM, "BL Run Vac. OK")
}

record(bi, "FE14I-VA-VALVE-02:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-VA-VALVE-02:ILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PIRG-06 OK")
  field(ONAM, "PIRG-06 OK")
}

record(bi, "FE14I-VA-VALVE-02:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-VA-VALVE-02:ILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Not Service Mode")
  field(ONAM, "Not Service Mode")
}

record(bi, "FE14I-VA-VALVE-02:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-VA-VALVE-02:ILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Grd A or /V2 Close")
  field(ONAM, "Grd A or /V2 Close")
}

record(bi, "FE14I-VA-VALVE-02:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-VA-VALVE-02:ILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Grd B or /V2 Close")
  field(ONAM, "Grd B or /V2 Close")
}

record(bi, "FE14I-VA-VALVE-02:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-VA-VALVE-02:ILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE-IMG6 & BL-IMG1")
  field(ONAM, "FE-IMG6 & BL-IMG1")
}

# % archiver 10 Monitor
# % controldesk Initial Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-02:INIILK") {
  field(DESC, "Initial Interlock")
  field(INP, "FE14I-VA-VALVE-02:GETINIILK MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETINIILK") {
  field(DESC, "Get initial interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:INIILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ini ilk is in DM60+7. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:INIILKINDX") {
  field(CALC, "60%100+7")
  field(OUT, "FE14I-VA-VALVE-02:GETINIILK.INDX PP")
  field(PINI, "YES")
}

# ini ilk is in DM60+7. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:INIILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETINIILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:INIILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:INIILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:INIILKINP.DISA")
}

# % archiver 10 Monitor
# % controldesk Current Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-02:RAWILK") {
  field(DESC, "Current Interlocks")
  field(INP, "FE14I-VA-VALVE-02:GETRAWILK MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETRAWILK") {
  field(DESC, "Get current interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:RAWILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# raw ilk is in DM60+8. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:RAWILKINDX") {
  field(CALC, "60%100+8")
  field(OUT, "FE14I-VA-VALVE-02:GETRAWILK.INDX PP")
  field(PINI, "YES")
}

# raw ilk is in DM60+8. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:RAWILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETRAWILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:RAWILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:RAWILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:RAWILKINP.DISA")
}

# end(valveIlk)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveGilk.vdb", valveGilk)

################################################################################
# % archiver 10 Monitor
# % controldesk Gauge Interlock Status smon
record(mbbiDirect, "FE14I-VA-VALVE-02:GILK") {
  field(DESC, "Gauge Interlocks")
  field(INP, "FE14I-VA-VALVE-02:GETGILK MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETGILK") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:GILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# gilk is in DM60+9. Calc the index into the 
# century record
record(calcout, "FE14I-VA-VALVE-02:GILKINDX") {
  field(CALC, "60%100+9")
  field(OUT, "FE14I-VA-VALVE-02:GETGILK.INDX PP")
  field(PINI, "YES")
}

# gilk is in DM60+9. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:GILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(60/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:GETGILK.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:GILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:GILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:GILKINP.DISA")
}

################################################################################
#% archiver 10 Monitor
#% controldesk IMG Interlock Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-02:IMGILK") {
  field(DESC, "IMG Interlocks")
  field(INP, "FE14I-VA-VALVE-02:GETIMGILK MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETIMGILK") {
  field(DESC, "IMG Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:IMGILK")
  field(FTVL, "USHORT")
  field(INDX, "5")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
#% archiver 10 Monitor
#% controldesk Pirani Interlock Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-02:PIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(INP, "FE14I-VA-VALVE-02:GETPIRGILK MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETPIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:PIRGILK")
  field(FTVL, "USHORT")
  field(INDX, "6")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
# Individual Gauge Interlocks
#
#% archiver 10 Monitor
record(mbbiDirect, "FE14I-VA-VALVE-02:GAUGEILK") {
  field(DESC, "Combined Gauge Interlock")
  field(INP, "FE14I-VA-VALVE-02:CALGILK MS")
}

record(calc, "FE14I-VA-VALVE-02:CALGILK") {
  field(CALC, "A&B")
  field(FLNK, "FE14I-VA-VALVE-02:GAUGEILK")
  field(INPA, "FE14I-VA-VALVE-02:IMGILK CP MS")
  field(INPB, "FE14I-VA-VALVE-02:PIRGILK CP MS")
}

record(bi, "FE14I-VA-VALVE-02:GILK0") {
  field(DESC, "Gauge ILK 0")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-01")
  field(ONAM, "FE14I-VA-GAUGE-01")
}

record(bi, "FE14I-VA-VALVE-02:GILK1") {
  field(DESC, "Gauge ILK 1")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-02")
  field(ONAM, "FE14I-VA-GAUGE-02")
}

record(bi, "FE14I-VA-VALVE-02:GILK2") {
  field(DESC, "Gauge ILK 2")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-03")
  field(ONAM, "FE14I-VA-GAUGE-03")
}

record(bi, "FE14I-VA-VALVE-02:GILK3") {
  field(DESC, "Gauge ILK 3")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-04")
  field(ONAM, "FE14I-VA-GAUGE-04")
}

record(bi, "FE14I-VA-VALVE-02:GILK4") {
  field(DESC, "Gauge ILK 4")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-05")
  field(ONAM, "FE14I-VA-GAUGE-05")
}

record(bi, "FE14I-VA-VALVE-02:GILK5") {
  field(DESC, "Gauge ILK 5")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-06")
  field(ONAM, "FE14I-VA-GAUGE-06")
}

record(bi, "FE14I-VA-VALVE-02:GILK6") {
  field(DESC, "Gauge ILK 6")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-01")
  field(ONAM, "FE14I-VA-FVI-01")
}

record(bi, "FE14I-VA-VALVE-02:GILK7") {
  field(DESC, "Gauge ILK 7")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-02")
  field(ONAM, "FE14I-VA-FVI-02")
}

record(bi, "FE14I-VA-VALVE-02:GILK8") {
  field(DESC, "Gauge ILK 8")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-03")
  field(ONAM, "FE14I-VA-FVI-03")
}

record(bi, "FE14I-VA-VALVE-02:GILK9") {
  field(DESC, "Gauge ILK 9")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-04")
  field(ONAM, "FE14I-VA-FVI-04")
}

record(bi, "FE14I-VA-VALVE-02:GILK10") {
  field(DESC, "Gauge ILK 10")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-02:GILK11") {
  field(DESC, "Gauge ILK 11")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-02:GILK12") {
  field(DESC, "Gauge ILK 12")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-02:GILK13") {
  field(DESC, "Gauge ILK 13")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-02:GILK14") {
  field(DESC, "Gauge ILK 14")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-VALVE-02:GILK15") {
  field(DESC, "Gauge ILK 15")
  field(INP, "FE14I-VA-VALVE-02:GAUGEILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

# end(valveGilk)

# Operational/Service Mode
#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "FE14I-VA-VALVE-02:MODE") {
  field(DESC, "Mode")
  field(INP, "FE14I-VA-VALVE-02:MODSTA.B0 CP MS")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

# ######################################################################
# Close time trip
#
#% controldesk Close Timeout setpoint
#
# NB: This section may be better rejoining the TCLOSE records, which were
#     below, but now extracted to their own template (dlsPLC_vacValveTclose.vdb)
#     which was done to better support ABSB-01 for front-ends close time metrics.
# IJG 24 July 2018
#
record(longin, "FE14I-VA-VALVE-02:INPMINTCLS") {
  field(INP, "FE14I-VA-VALVE-02:GETINPMINTCLS PP MS")
}

# INDX calculation DM60+n. Calc the index into the century record
record(calcout, "FE14I-VA-VALVE-02:INPMINTCLSINDX") {
  field(CALC, "60+7")
  field(OUT, "FE14I-VA-VALVE-02:GETINPMINTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-VA-VALVE-02:GETINPMINTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Minimum Close Time readback
#
record(calc, "FE14I-VA-VALVE-02:MINTCLS") {
  field(DESC, "Min Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-VA-VALVE-02:INPMINTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MAJOR")
}

record(longin, "FE14I-VA-VALVE-02:INPMAXTCLS") {
  field(INP, "FE14I-VA-VALVE-02:GETINPMAXTCLS PP MS")
}

# INDX calculation DM60+n. Calc the index into the century record
record(calcout, "FE14I-VA-VALVE-02:INPMAXTCLSINDX") {
  field(CALC, "60+5")
  field(OUT, "FE14I-VA-VALVE-02:GETINPMAXTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-VA-VALVE-02:GETINPMAXTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Maximum Close Time readback
#
record(calc, "FE14I-VA-VALVE-02:MAXTCLS") {
  field(DESC, "Max Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-VA-VALVE-02:INPMAXTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MINOR")
}

################################################################################
# Air Pressure De-bounce Time
#
#% controldesk Air Pressure De-bounce Time setpoint
#
record(ao, "FE14I-VA-VALVE-02:SETADB") {
  field(DTYP, "Raw Soft Channel")
  field(DESC, "De-bounce Time")
  field(EGU, "s")
  field(PREC, "1")
  field(DOL, "10.0")
  field(ASLO, "0.1")
  field(PINI, "YES")
  field(OUT, "FE14I-VA-VALVE-02:OUTTIMEOUT PP")
}

#
#% archiver 10 Monitor
#% controldesk Air Pressure De-bounce Time readback
#
record(calc, "FE14I-VA-VALVE-02:ADB") {
  field(DESC, "De-bounce Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-VA-VALVE-02:INPTIMEOUT PP MS")
  field(SCAN, "1 second")
  field(EGU, "s")
  field(PREC, "1")
}

record(ao, "FE14I-VA-VALVE-02:OUTTIMEOUT") {
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 603, 0) FINS_DM_WRITE")
}

# INDX calculation DM60+n. Calc the index into the century record
#record(calcout, "FE14I-VA-VALVE-02:INPTIMEOUTINDX") 
#  {
#  field(CALC, "0")
#  field(OUT, "FE14I-VA-VALVE-02:INPTIMEOUT.INDX PP")
#  field(PINI, "YES")
#  }
# DX00
record(subArray, "FE14I-VA-VALVE-02:INPTIMEOUT") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM600")
  field(INDX, "0")
  field(MALM, "100")
}

# addr is the valve (device) number x10
# the ADB and timeouts are in centuries corresponding to
# device number (1XX, 2XX, etc.)
# 
# Calculate the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-VALVE-02:SCALCCENTURY") {
  field(CALC, "PRINTF(AA,FLOOR(60/10))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-VALVE-02:INPTIMEOUT.INP CA")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:CENTURYDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:SCALCCENTURY.DISA")
}

################################################################################
# NOTE: only valid for valves 0..9
#% archiver 10 Monitor
#% controldesk Raw Air Pressure Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-02:RAWAIRALL") {
  field(DESC, "Raw air pressure all valves")
  field(INP, "FE14I-VA-VALVE-02:GETRAWAIR MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETRAWAIR") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:RAWAIRALL")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(INDX, "3")
  field(MALM, "100")
}

record(bi, "FE14I-VA-VALVE-02:RAWAIRSTA") {
  field(DESC, "Raw Air Pressure Status")
  field(ZNAM, "Low")
  field(ONAM, "Good")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
}

# Turn valve 15 (addr=150) into the letter F to get raw air status
record(scalcout, "FE14I-VA-VALVE-02:RAWAIRSTAINP") {
  field(CALC, "PRINTF(AA,MIN(FLOOR(60/10),15))")
  field(AA, "FE14I-VA-VALVE-02:RAWAIRALL.B%1X CP MS")
  field(OUT, "FE14I-VA-VALVE-02:RAWAIRSTA.INP CA")
  field(FLNK, "FE14I-VA-VALVE-02:RAWAIRSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-VALVE-02:RAWAIRSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-VALVE-02:RAWAIRSTAINP.DISA")
}

################################################################################
# % archiver 10 Monitor
# % controldesk Initial/Run Vacuum Status smon
#
record(mbbiDirect, "FE14I-VA-VALVE-02:IRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(INP, "FE14I-VA-VALVE-02:GETIRVAC MS")
}

record(subArray, "FE14I-VA-VALVE-02:GETIRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-VALVE-02:IRVAC")
  field(FTVL, "USHORT")
  field(INDX, "7")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}
## Enable archiving for valve PVs which are not automatically archived
## from the vacuumValve support package.
## Also set autosave metadata for inclusion in xxx_1.req file
##
## $Author: $
## $Date: $
## $Id:  $
## $Name:  $
## $Revision: $

## Archiving SETADB allows Autosave-Restore to be established for the
#  air debounce time.
# % macro, device, full valve name 
#% archiver 10 Monitor VAL
#% autosave 1 VAL
record(ao,"FE14I-RS-ABSB-01:SETADB") 
{
}
## Enable archiving for valve PVs which are not automatically archived
## from the vacuumValve support package.
## Also set autosave metadata for inclusion in xxx_1.req file
##
## $Author: $
## $Date: $
## $Id:  $
## $Name:  $
## $Revision: $

## Archiving SETADB allows Autosave-Restore to be established for the
#  air debounce time.
# % macro, device, full valve name 
#% archiver 10 Monitor VAL
#% autosave 1 VAL
record(ao,"FE14I-VA-VALVE-01:SETADB") 
{
}
## Enable archiving for valve PVs which are not automatically archived
## from the vacuumValve support package.
## Also set autosave metadata for inclusion in xxx_1.req file
##
## $Author: $
## $Date: $
## $Id:  $
## $Name:  $
## $Revision: $

## Archiving SETADB allows Autosave-Restore to be established for the
#  air debounce time.
# % macro, device, full valve name 
#% archiver 10 Monitor VAL
#% autosave 1 VAL
record(ao,"FE14I-VA-VALVE-02:SETADB") 
{
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# dlsPLC_feFastValve.template
#% macro, __doc__, Template database for a front-end fast valve without debounce or raw air records
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate
#% macro, port, asyn port name of FINS driver
#% macro, addr, First address in the DM variable range decade. E.g. if valve is in DM110..118 then addr=110
#% macro, allowpv, If specified, then only write an open command when this is non-zero. MUST have CP at the end of it
#% macro, whylocked, String to output to EDM synoptic as to precisely why the device is locked and by whom
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, ilk0, Interlock description 0
#% macro, ilk1, Interlock description 1
#% macro, ilk2, Interlock description 2
#% macro, ilk3, Interlock description 3
#% macro, ilk4, Interlock description 4
#% macro, ilk5, Interlock description 5
#% macro, ilk6, Interlock description 6
#% macro, ilk7, Interlock description 7
#% macro, ilk8, Interlock description 8
#% macro, ilk9, Interlock description 9
#% macro, ilk10, Interlock description 10
#% macro, ilk11, Interlock description 11
#% macro, ilk12, Interlock description 12
#% macro, ilk13, Interlock description 13
#% macro, ilk14, Interlock description 14
#% macro, ilk15, Interlock description 15
#% macro, gilk0, Gauge interlock description 0
#% macro, gilk1, Gauge interlock description 1
#% macro, gilk2, Gauge interlock description 2
#% macro, gilk3, Gauge interlock description 3
#% macro, gilk4, Gauge interlock description 4
#% macro, gilk5, Gauge interlock description 5
#% macro, gilk6, Gauge interlock description 6
#% macro, gilk7, Gauge interlock description 7
#% macro, gilk8, Gauge interlock description 8
#% macro, gilk9, Gauge interlock description 9
#% macro, gilk10, Gauge interlock description 10
#% macro, gilk11, Gauge interlock description 11
#% macro, gilk12, Gauge interlock description 12
#% macro, gilk13, Gauge interlock description 13
#% macro, gilk14, Gauge interlock description 14
#% macro, gilk15, Gauge interlock description 15
#% macro, con_label0, Label string for control value 0 (Optional - defaults to Open)
#% macro, con_label1, Label string for control value 1 (Optional - defaults to Close)
#% macro, con_label2, Label string for control value 2 (Optional - defaults to Reset)
#% macro, con_label3, Label string for control value 3 (Optional - defaults to "")
#% macro, con_label4, Label string for control value 4 (Optional - defaults to "")
#% macro, con_label5, Label string for control value 5 (Optional - defaults to "")
#% macro, con_label6, Label string for control value 6 (Optional - defaults to "")
#% macro, sta_label0, Label string for status value 0 (Optional - defaults to Fault)
#% macro, sta_label1, Label string for status value 1 (Optional - defaults to Open)
#% macro, sta_label2, Label string for status value 2 (Optional - defaults to Opening)
#% macro, sta_label3, Label string for status value 3 (Optional - defaults to Closed)
#% macro, sta_label4, Label string for status value 4 (Optional - defaults to Closing)
#% macro, sta_label5, Label string for status value 5 (Optional - defaults to "")
#% macro, sta_label6, Label string for status value 6 (Optional - defaults to "")
#% macro, name, Object name and associated gui name
#% macro, gda_name, GDA name to export to gda as if it exists
#% macro, gda_desc, GDA description
#% macro, desc, Box label for gui
#% macro, EMPTY, Empty substitution to satisfy VDCT
#% macro, showlilk, 0 (default) => Gauge, 1 => Arm
#% macro, farmbits, 16 (default) Number of interlock bits for fully armed fast-valve
#% macro, parmbits, 16 (default) Number of interlock bits for partially armed fast-valve
# This associates an edm screen with the template
# % gui, , edm, vacuumValve.edl, device=FE14I-VA-FVALV-01
# % gui, , edmembed, vacuumValve-embed.edl, device=FE14I-VA-FVALV-01,box-label=FE14I-VA-FVALV-01
# This tells the gui that we don't have debounce records
record(ai, "FE14I-VA-FVALV-01:HASDEBOUNCE") {
  field(VAL, "0")
  field(PINI, "YES")
}

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveCtrl.vdb", valveCtrl)

# ##############################################################################
# Control
# 
# % archiver 10 Monitor
# % controldesk Status scon
# % gdatag,template,pneumaticCallback,,
# % gdatag,mbbinary,rw,,CONTROL
## Use this PV to request the valve to open or close
# The request will be checked by FE14I-VA-FVALV-01:CALCCON
record(mbbo, "FE14I-VA-FVALV-01:CON") {
  field(DESC, "Control")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "Arm")
  field(FRST, "Partially Arm")
  field(FVST, "")
  field(SXST, "")
  field(VAL, "0")
  field(OUT, "FE14I-VA-FVALV-01:CALCCON.A PP")
}

record(seq, "FE14I-VA-FVALV-01:OPENSEQ") {
  field(LNK1, "FE14I-VA-FVALV-01:CON PP")
  field(LNK2, "FE14I-VA-FVALV-01:CON PP")
  field(DO1, "2")
# reset
  field(DO2, "0")
# open
  field(DLY2, "1")
}

## If this PV is non-zero then an open request will be allowed by 
# FE14I-VA-FVALV-01:CALCCON
record(bi, "FE14I-VA-FVALV-01:OPENALLOWED") {
  field(DESC, "Allow/inhibit valve opening")
  field(INP, "")
  field(VAL, "1")
  field(ONAM, "Yes")
  field(ZNAM, "No")
}

record(stringout, "FE14I-VA-FVALV-01:WHYLOCKED") {
  field(DESC, "Reason why device is locked")
  field(VAL, "Open command not allowed")
}

## Pass all requests through to the PLC unless it is an open request and 
# FE14I-VA-FVALV-01:OPENALLOWED is zero
record(calcout, "FE14I-VA-FVALV-01:CALCCON") {
  field(INPB, "FE14I-VA-FVALV-01:OPENALLOWED")
  field(OUT, "FE14I-VA-FVALV-01:ACTUALCON PP")
  field(CALC, "(B=0&A=0)?0:1")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A")
}

## Send the request down to the PLC
record(ao, "FE14I-VA-FVALV-01:ACTUALCON") {
  field(DESC, "Control")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 70, 0) FINS_DM_WRITE")
  field(PRIO, "HIGH")
  field(FLNK, "FE14I-VA-FVALV-01:SETBUSY")
}

record(bi, "FE14I-VA-FVALV-01:OPENING") {
  field(DESC, "Opening Valves")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Opening")
}

record(calcout, "FE14I-VA-FVALV-01:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-VA-FVALV-01:BUSY PP NMS")
  field(FLNK, "FE14I-VA-FVALV-01:DONECALC")
}

record(busy, "FE14I-VA-FVALV-01:BUSY") {
}

record(calcout, "FE14I-VA-FVALV-01:DONECALC") {
  field(INPA, "FE14I-VA-FVALV-01:CON MS")
  field(INPB, "FE14I-VA-FVALV-01:STA CPP MS")
  field(INPC, "FE14I-VA-FVALV-01:ILKSTA CPP MS")
  field(INPD, "FE14I-VA-FVALV-01:LASTCON CPP MS")
  field(CALC, "0")
  field(OOPT, "When Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-VA-FVALV-01:BUSY CA NMS")
}

# % archiver 10 Monitor
record(mbbi, "FE14I-VA-FVALV-01:LASTCON") {
  field(DESC, "Control Readback")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "Arm")
  field(FRST, "Partially Arm")
  field(FVST, "")
  field(SXST, "")
  field(INP, "FE14I-VA-FVALV-01:GETLASTCON.VAL MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETLASTCON") {
  field(DESC, "Get control readback")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:LASTCON")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# LASTCON is in DM70+1. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:LASTCONINDX") {
  field(CALC, "70%100+1")
  field(OUT, "FE14I-VA-FVALV-01:GETLASTCON.INDX PP")
  field(PINI, "YES")
}

# LASTCON is in DM70+1. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:LASTCONINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETLASTCON.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:LASTCONINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:LASTCONINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:LASTCONINP.DISA")
}

# ###################################################################
# Interlock Status
# 
# % archiver 10 Monitor
# % controldesk Interlock Status smon
record(mbbi, "FE14I-VA-FVALV-01:ILKSTA") {
  field(DESC, "Interlock Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Failed")
  field(ONST, "Run Ilks Ok")
  field(TWST, "OK")
  field(THST, "Disarmed")
  field(FRST, "")
  field(FVST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(INP, "FE14I-VA-FVALV-01:GETILKSTA.VAL MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETILKSTA") {
  field(DESC, "Get interlock status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:ILKSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ILKSTA is in DM70+2. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:ILKSTAINDX") {
  field(CALC, "70%100+2")
  field(OUT, "FE14I-VA-FVALV-01:GETILKSTA.INDX PP")
  field(PINI, "YES")
}

# ILKSTA is in DM70+2. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:ILKSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETILKSTA.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:ILKSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:ILKSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:ILKSTAINP.DISA")
}

# #########################################################################
# Status
# 
# % archiver 10 Monitor
# % controldesk Status smon
# This makes the component icon reflect the status
# % gui, , sevr
#% gdatag,mbbinary,ro,,STA
record(mbbi, "FE14I-VA-FVALV-01:STA") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Fault")
  field(ONST, "Open Armed")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(FVST, "Open Disarmed")
  field(SXST, "Partially Armed")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(INP, "FE14I-VA-FVALV-01:GETSTA MS")
}

# this tells the gui that this device is moving if STA is Opening or Closing
# % gui, , status
record(calcout, "FE14I-VA-FVALV-01:MOVN") {
  field(DTYP, "Soft Channel")
  field(DESC, "Is valve moving")
  field(INPA, "FE14I-VA-FVALV-01:STA CP")
  field(CALC, "A=2|A=4")
}

record(subArray, "FE14I-VA-FVALV-01:GETSTA") {
  field(DESC, "Get status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:STA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM70+3. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:STAINDX") {
  field(CALC, "70%100+3")
  field(OUT, "FE14I-VA-FVALV-01:GETSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM70+3. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:STAINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETSTA.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:STAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:STAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:STAINP.DISA")
}

# ############################################################################
# Number of Operations
# 
# % archiver 10 Monitor
# % controldesk Number of Operations readback
record(longin, "FE14I-VA-FVALV-01:OPS") {
  field(DESC, "Operations")
  field(DTYP, "Soft Channel")
  field(HOPR, "10000")
  field(LOPR, "0")
  field(HIHI, "10000")
  field(HIGH, "9000")
  field(LOW, "0")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(LLSV, "MAJOR")
  field(INP, "FE14I-VA-FVALV-01:GETOPS.VAL MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETOPS") {
  field(DESC, "Get operations")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:OPS")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# OPS is in DM70+4. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:OPSINDX") {
  field(CALC, "70%100+4")
  field(OUT, "FE14I-VA-FVALV-01:GETOPS.INDX PP")
  field(PINI, "YES")
}

# OPS is in DM70+4. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:OPSINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETOPS.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:OPSINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:OPSINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:OPSINP.DISA")
}

# #########################################################################
# Mode Status (individual bits pulled off in each valve template
record(mbbiDirect, "FE14I-VA-FVALV-01:MODSTA") {
  field(DESC, "Mode")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-VA-FVALV-01:GETMODSTA MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETMODSTA") {
  field(DESC, "Get mode")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:MODSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# MODSTA is in DM70+5. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:MODSTAINDX") {
  field(CALC, "70%100+5")
  field(OUT, "FE14I-VA-FVALV-01:GETMODSTA.INDX PP")
  field(PINI, "YES")
}

# MODSTA is in DM70+5. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:MODSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETMODSTA.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:MODSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:MODSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:MODSTAINP.DISA")
}

# end(valveCtrl)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveIlk.vdb", valveIlk)

# % archiver 10 Monitor
# % controldesk Latched Interlock Status smon
record(mbbiDirect, "FE14I-VA-FVALV-01:ILK") {
  field(DESC, "Latched Interlocks - tpfx :")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-VA-FVALV-01:GETILK.VAL MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETILK") {
  field(DESC, "Get latched interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:ILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ilk is in DM70+6. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:ILKINDX") {
  field(CALC, "70%100+6")
  field(OUT, "FE14I-VA-FVALV-01:GETILK.INDX PP")
  field(PINI, "YES")
}

# ilk is in DM70+6. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:ILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETILK.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:ILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:ILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:ILKINP.DISA")
}

# Individual Interlocks
record(bi, "FE14I-VA-FVALV-01:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-VA-FVALV-01:ILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Remote mode")
  field(ONAM, "Remote mode")
}

record(bi, "FE14I-VA-FVALV-01:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-VA-FVALV-01:ILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Limits Healthy")
  field(ONAM, "Limits Healthy")
}

record(bi, "FE14I-VA-FVALV-01:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-VA-FVALV-01:ILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Open Limit OK")
  field(ONAM, "Open Limit OK")
}

record(bi, "FE14I-VA-FVALV-01:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-VA-FVALV-01:ILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Move time OK")
  field(ONAM, "Move time OK")
}

record(bi, "FE14I-VA-FVALV-01:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-VA-FVALV-01:ILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE Init. Vac. OK")
  field(ONAM, "FE Init. Vac. OK")
}

record(bi, "FE14I-VA-FVALV-01:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-VA-FVALV-01:ILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PIRG-03 OK")
  field(ONAM, "PIRG-03 OK")
}

record(bi, "FE14I-VA-FVALV-01:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-VA-FVALV-01:ILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PIRG-04 OK")
  field(ONAM, "PIRG-04 OK")
}

record(bi, "FE14I-VA-FVALV-01:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-VA-FVALV-01:ILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "/FCTRL-01 Triggrd")
  field(ONAM, "/FCTRL-01 Triggrd")
}

record(bi, "FE14I-VA-FVALV-01:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-VA-FVALV-01:ILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "/FCTRL-02 Triggrd")
  field(ONAM, "/FCTRL-02 Triggrd")
}

record(bi, "FE14I-VA-FVALV-01:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-VA-FVALV-01:ILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-VA-FVALV-01:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-VA-FVALV-01:ILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-VA-FVALV-01:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-VA-FVALV-01:ILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-VA-FVALV-01:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-VA-FVALV-01:ILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-VA-FVALV-01:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-VA-FVALV-01:ILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-VA-FVALV-01:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-VA-FVALV-01:ILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-VA-FVALV-01:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-VA-FVALV-01:ILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

# % archiver 10 Monitor
# % controldesk Initial Interlock Status smon
record(mbbiDirect, "FE14I-VA-FVALV-01:INIILK") {
  field(DESC, "Initial Interlock")
  field(INP, "FE14I-VA-FVALV-01:GETINIILK MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETINIILK") {
  field(DESC, "Get initial interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:INIILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ini ilk is in DM70+7. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:INIILKINDX") {
  field(CALC, "70%100+7")
  field(OUT, "FE14I-VA-FVALV-01:GETINIILK.INDX PP")
  field(PINI, "YES")
}

# ini ilk is in DM70+7. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:INIILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETINIILK.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:INIILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:INIILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:INIILKINP.DISA")
}

# % archiver 10 Monitor
# % controldesk Current Interlock Status smon
record(mbbiDirect, "FE14I-VA-FVALV-01:RAWILK") {
  field(DESC, "Current Interlocks")
  field(INP, "FE14I-VA-FVALV-01:GETRAWILK MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETRAWILK") {
  field(DESC, "Get current interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:RAWILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# raw ilk is in DM70+8. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:RAWILKINDX") {
  field(CALC, "70%100+8")
  field(OUT, "FE14I-VA-FVALV-01:GETRAWILK.INDX PP")
  field(PINI, "YES")
}

# raw ilk is in DM70+8. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:RAWILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETRAWILK.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:RAWILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:RAWILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:RAWILKINP.DISA")
}

# end(valveIlk)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_fastvalveGilk.vdb", valveGilk)

#
# Derived from dlsPLC_valveGilk.vdb
#
# Actually represents the fast valve Arm and Partially Arm interlocks
# Although it referes to 'G' for Gauge in GILK, this is only for 
# backward compatibility with existing EDM synoptics.
#
# Ian Gillingham: 2 April 2014
#
################################################################################
# % archiver 10 Monitor
# % controldesk Gauge Interlock Status smon
record(mbbiDirect, "FE14I-VA-FVALV-01:GILK") {
  field(DESC, "Gauge Interlocks")
  field(INP, "FE14I-VA-FVALV-01:GETGILK MS")
  field(FLNK, "FE14I-VA-FVALV-01:GAUGEILK")
}

record(subArray, "FE14I-VA-FVALV-01:GETGILK") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:GILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# gilk is in DM70+9. Calc the index into the 
# century record
record(calcout, "FE14I-VA-FVALV-01:GILKINDX") {
  field(CALC, "70%100+9")
  field(OUT, "FE14I-VA-FVALV-01:GETGILK.INDX PP")
  field(PINI, "YES")
}

# gilk is in DM70+9. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-VA-FVALV-01:GILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(70/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-VA-FVALV-01:GETGILK.INP CA")
  field(FLNK, "FE14I-VA-FVALV-01:GILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-VA-FVALV-01:GILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-VA-FVALV-01:GILKINP.DISA")
}

################################################################################
#% archiver 10 Monitor
#% controldesk IMG Interlock Status smon
#
record(mbbiDirect, "FE14I-VA-FVALV-01:IMGILK") {
  field(DESC, "IMG Interlocks")
  field(INP, "FE14I-VA-FVALV-01:GETIMGILK MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETIMGILK") {
  field(DESC, "IMG Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:IMGILK")
  field(FTVL, "USHORT")
  field(INDX, "5")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
#% archiver 10 Monitor
#% controldesk Pirani Interlock Status smon
#
record(mbbiDirect, "FE14I-VA-FVALV-01:PIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(INP, "FE14I-VA-FVALV-01:GETPIRGILK MS")
}

record(subArray, "FE14I-VA-FVALV-01:GETPIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-VA-FVALV-01:PIRGILK")
  field(FTVL, "USHORT")
  field(INDX, "6")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
# Individual Gauge Interlocks
#
record(mbbiDirect, "FE14I-VA-FVALV-01:GAUGEILK") {
  field(DESC, "Arm Interlocks")
  field(INP, "FE14I-VA-FVALV-01:GETGILK MS")
}

record(bi, "FE14I-VA-FVALV-01:GILK0") {
  field(DESC, "Gauge ILK 0")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-01")
  field(ONAM, "FE14I-VA-GAUGE-01")
}

record(bi, "FE14I-VA-FVALV-01:GILK1") {
  field(DESC, "Gauge ILK 1")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-02")
  field(ONAM, "FE14I-VA-GAUGE-02")
}

record(bi, "FE14I-VA-FVALV-01:GILK2") {
  field(DESC, "Gauge ILK 2")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-03")
  field(ONAM, "FE14I-VA-GAUGE-03")
}

record(bi, "FE14I-VA-FVALV-01:GILK3") {
  field(DESC, "Gauge ILK 3")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-04")
  field(ONAM, "FE14I-VA-GAUGE-04")
}

record(bi, "FE14I-VA-FVALV-01:GILK4") {
  field(DESC, "Gauge ILK 4")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-05")
  field(ONAM, "FE14I-VA-GAUGE-05")
}

record(bi, "FE14I-VA-FVALV-01:GILK5") {
  field(DESC, "Gauge ILK 5")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-06")
  field(ONAM, "FE14I-VA-GAUGE-06")
}

record(bi, "FE14I-VA-FVALV-01:GILK6") {
  field(DESC, "Gauge ILK 6")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-01")
  field(ONAM, "FE14I-VA-FVI-01")
}

record(bi, "FE14I-VA-FVALV-01:GILK7") {
  field(DESC, "Gauge ILK 7")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-02")
  field(ONAM, "FE14I-VA-FVI-02")
}

record(bi, "FE14I-VA-FVALV-01:GILK8") {
  field(DESC, "Gauge ILK 8")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-03")
  field(ONAM, "FE14I-VA-FVI-03")
}

record(bi, "FE14I-VA-FVALV-01:GILK9") {
  field(DESC, "Gauge ILK 9")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-04")
  field(ONAM, "FE14I-VA-FVI-04")
}

record(bi, "FE14I-VA-FVALV-01:GILK10") {
  field(DESC, "Gauge ILK 10")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-FVALV-01:GILK11") {
  field(DESC, "Gauge ILK 11")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-FVALV-01:GILK12") {
  field(DESC, "Gauge ILK 12")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-FVALV-01:GILK13") {
  field(DESC, "Gauge ILK 13")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-FVALV-01:GILK14") {
  field(DESC, "Gauge ILK 14")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-VA-FVALV-01:GILK15") {
  field(DESC, "Gauge ILK 15")
  field(INP, "FE14I-VA-FVALV-01:GAUGEILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

# end(valveGilk)

# Operational/Service Mode
#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "FE14I-VA-FVALV-01:MODE") {
  field(DESC, "Mode")
  field(INP, "FE14I-VA-FVALV-01:MODSTA.B0 CP MS")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

# #########################################################################
# Which interlocks to show on gui
#
record(bi, "FE14I-VA-FVALV-01:SHOWILK") {
  field(DESC, "Which interlocks to display")
  field(DTYP, "Soft Channel")
  field(PINI, "YES")
  field(INP, "0")
  field(ZNAM, "Gauge")
  field(ONAM, "Arm")
}

# #########################################################################
# How many interlocks for Full and Partial Arm
#
record(ai, "FE14I-VA-FVALV-01:FARMBITS") {
  field(DESC, "Number of Full Arm interlocks")
  field(DTYP, "Soft Channel")
  field(PINI, "YES")
  field(INP, "16")
}

record(ai, "FE14I-VA-FVALV-01:PARMBITS") {
  field(DESC, "Number of Partial Arm interlocks")
  field(DTYP, "Soft Channel")
  field(PINI, "YES")
  field(INP, "16")
}
## Enable archiving for valve PVs which are not automatically archived
## from the vacuumValve support package.
## Also set autosave metadata for inclusion in xxx_1.req file
##
## $Author: $
## $Date: $
## $Id:  $
## $Name:  $
## $Revision: $

## Archiving SETADB allows Autosave-Restore to be established for the
#  air debounce time.
# % macro, device, full valve name 
#% archiver 10 Monitor VAL
#% autosave 1 VAL
record(ao,"FE14I-VA-FVALV-01:SETADB") 
{
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# vacuumValve.template
#% macro, __doc__, Template database for a vacuum valve without debounce or raw air records
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate
# % macro, port, asyn port name of FINS driver
#% macro, addr, First address in the DM variable range decade. E.g. if pump is in DM110..118 then addr=110
#% macro, allowpv, If specified, then only write an open command when this is non-zero. MUST have CP at the end of it
#% macro, whylocked, String to output to EDM synoptic as to precisely why the device is locked and by whom
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, valvetype, Determines which icon is shown in css GUI
#% macro, ilk0, Interlock description 0
#% macro, ilk1, Interlock description 1
#% macro, ilk2, Interlock description 2
#% macro, ilk3, Interlock description 3
#% macro, ilk4, Interlock description 4
#% macro, ilk5, Interlock description 5
#% macro, ilk6, Interlock description 6
#% macro, ilk7, Interlock description 7
#% macro, ilk8, Interlock description 8
#% macro, ilk9, Interlock description 9
#% macro, ilk10, Interlock description 10
#% macro, ilk11, Interlock description 11
#% macro, ilk12, Interlock description 12
#% macro, ilk13, Interlock description 13
#% macro, ilk14, Interlock description 14
#% macro, ilk15, Interlock description 15
#% macro, gilk0, Gauge interlock description 0
#% macro, gilk1, Gauge interlock description 1
#% macro, gilk2, Gauge interlock description 2
#% macro, gilk3, Gauge interlock description 3
#% macro, gilk4, Gauge interlock description 4
#% macro, gilk5, Gauge interlock description 5
#% macro, gilk6, Gauge interlock description 6
#% macro, gilk7, Gauge interlock description 7
#% macro, gilk8, Gauge interlock description 8
#% macro, gilk9, Gauge interlock description 9
#% macro, gilk10, Gauge interlock description 10
#% macro, gilk11, Gauge interlock description 11
#% macro, gilk12, Gauge interlock description 12
#% macro, gilk13, Gauge interlock description 13
#% macro, gilk14, Gauge interlock description 14
#% macro, gilk15, Gauge interlock description 15
#% macro, con_label0, Label string for control value 0 (Optional - defaults to Open)
#% macro, con_label1, Label string for control value 1 (Optional - defaults to Close)
#% macro, con_label2, Label string for control value 2 (Optional - defaults to Reset)
#% macro, con_label3, Label string for control value 3 (Optional - defaults to "")
#% macro, con_label4, Label string for control value 4 (Optional - defaults to "")
#% macro, con_label5, Label string for control value 5 (Optional - defaults to "")
#% macro, con_label6, Label string for control value 6 (Optional - defaults to "")
#% macro, sta_label0, Label string for status value 0 (Optional - defaults to Fault)
#% macro, sta_label1, Label string for status value 1 (Optional - defaults to Open)
#% macro, sta_label2, Label string for status value 2 (Optional - defaults to Opening)
#% macro, sta_label3, Label string for status value 3 (Optional - defaults to Closed)
#% macro, sta_label4, Label string for status value 4 (Optional - defaults to Closing)
#% macro, sta_label5, Label string for status value 5 (Optional - defaults to "")
#% macro, sta_label6, Label string for status value 6 (Optional - defaults to "")
#% macro, name, Object name and associated gui name
#% macro, gda_name, GDA name to export to gda as if it exists
#% macro, gda_desc, GDA description
#% macro, desc, Box label for gui
#% macro, mode1, name of remote operational mode (:MODE)
#% macro, mode2, name of local operational mode (:MODE)
#% macro, EMPTY, Empty substitution to satisfy VDCT
# This associates an edm screen with the template
# % gui, , edm, vacuumValve.edl, device=FE14I-PS-SHTR-01
# % gui, , edmembed, vacuumValve-embed.edl, device=FE14I-PS-SHTR-01,box-label=FE14I-PS-SHTR-01
# This associates BOY screens with the template
# % gui, , boydetail, dlsPLCApp_opi/vacValve_detail.opi, device=FE14I-PS-SHTR-01, DESC=FE14I-PS-SHTR-01, ilk0=Air press. OK,ilk1=Limits Healthy,ilk2=Open Limit OK,ilk3=Move time OK,ilk4=PSS FE PShtr Pmt,ilk5=PSS BL G Pmt3 PShtr,ilk6=Gas Brem. ID Gap,ilk7=unused,ilk8=unused,ilk9=unused,ilk10=unused,ilk11=unused,ilk12=unused,ilk13=unused,ilk14=unused,ilk15=unused,gilk0=FE14I-VA-GAUGE-01,gilk1=FE14I-VA-GAUGE-02,gilk2=FE14I-VA-GAUGE-03,gilk3=FE14I-VA-GAUGE-04,gilk4=FE14I-VA-GAUGE-05,gilk5=FE14I-VA-GAUGE-06,gilk6=FE14I-VA-FVI-01,gilk7=FE14I-VA-FVI-02,gilk8=FE14I-VA-FVI-03,gilk9=FE14I-VA-FVI-04,gilk10=,gilk11=,gilk12=,gilk13=,gilk14=,gilk15=, name=, valvetype=valve, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed_box.opi, device=FE14I-PS-SHTR-01, DESC=FE14I-PS-SHTR-01, name=, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed.opi, device=FE14I-PS-SHTR-01, DESC=FE14I-PS-SHTR-01, name=, valvetype=valve
# These define what PVs a valve detail screen should contain
# % gui, , enum, Control,   FE14I-PS-SHTR-01:CON
# % gui, , readback, Status,  FE14I-PS-SHTR-01:STA
# % gui, , readback, Mode,  FE14I-PS-SHTR-01:MODE
# % gui, , readback, Interlock Stat,  FE14I-PS-SHTR-01:ILKSTA
# % gui, , readback, Operations,  FE14I-PS-SHTR-01:OPS
# % gui, , readback, De-bounce,  FE14I-PS-SHTR-01:ADB
# % gui, , demand, De-bounce,  FE14I-PS-SHTR-01:SETADB
# % gui, , statusbits, Interlocks Latched,  FE14I-PS-SHTR-01:ILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,PSS FE PShtr Pmt,PSS BL G Pmt3 PShtr,Gas Brem. ID Gap,unused,unused,unused,unused,unused,unused,unused,unused,unused
# % gui, , statusbits, Interlocks Initial,  FE14I-PS-SHTR-01:INIILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,PSS FE PShtr Pmt,PSS BL G Pmt3 PShtr,Gas Brem. ID Gap,unused,unused,unused,unused,unused,unused,unused,unused,unused
# % gui, , statusbits, Interlocks Current,  FE14I-PS-SHTR-01:RAWILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,PSS FE PShtr Pmt,PSS BL G Pmt3 PShtr,Gas Brem. ID Gap,unused,unused,unused,unused,unused,unused,unused,unused,unused
# % gui, , statusbits, Interlocks IMG,  FE14I-PS-SHTR-01:IMGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
# % gui, , statusbits, Interlocks PIRG,  FE14I-PS-SHTR-01:PIRGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
record(ai, "FE14I-PS-SHTR-01:HASDEBOUNCE") {
  field(VAL, "1")
  field(PINI, "YES")
}

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveCtrl.vdb", valveCtrl)

# ##############################################################################
# Control
# 
# % archiver 10 Monitor
# % controldesk Status scon
# % gdatag,template,pneumaticCallback,,
# % gdatag,mbbinary,rw,,CONTROL
## Use this PV to request the valve to open or close
# The request will be checked by FE14I-PS-SHTR-01:CALCCON
record(mbbo, "FE14I-PS-SHTR-01:CON") {
  field(DESC, "Control")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(VAL, "0")
  field(OUT, "FE14I-PS-SHTR-01:CALCCON.A PP")
}

record(seq, "FE14I-PS-SHTR-01:OPENSEQ") {
  field(LNK1, "FE14I-PS-SHTR-01:CON PP")
  field(LNK2, "FE14I-PS-SHTR-01:CON PP")
  field(DO1, "2")
# reset
  field(DO2, "0")
# open
  field(DLY2, "1")
}

## If this PV is non-zero then an open request will be allowed by 
# FE14I-PS-SHTR-01:CALCCON
record(bi, "FE14I-PS-SHTR-01:OPENALLOWED") {
  field(DESC, "Allow/inhibit valve opening")
  field(INP, "")
  field(VAL, "1")
  field(ONAM, "Yes")
  field(ZNAM, "No")
}

record(stringout, "FE14I-PS-SHTR-01:WHYLOCKED") {
  field(DESC, "Reason why device is locked")
  field(VAL, "")
}

## Pass all requests through to the PLC unless it is an open request and 
# FE14I-PS-SHTR-01:OPENALLOWED is zero
record(calcout, "FE14I-PS-SHTR-01:CALCCON") {
  field(INPB, "FE14I-PS-SHTR-01:OPENALLOWED")
  field(OUT, "FE14I-PS-SHTR-01:ACTUALCON PP")
  field(CALC, "(B=0&A=0)?0:1")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A")
}

## Send the request down to the PLC
record(ao, "FE14I-PS-SHTR-01:ACTUALCON") {
  field(DESC, "Control")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 40, 0) FINS_DM_WRITE")
  field(PRIO, "HIGH")
  field(FLNK, "FE14I-PS-SHTR-01:SETBUSY")
}

record(bi, "FE14I-PS-SHTR-01:OPENING") {
  field(DESC, "Opening Valves")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Opening")
}

record(calcout, "FE14I-PS-SHTR-01:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-PS-SHTR-01:BUSY PP NMS")
  field(FLNK, "FE14I-PS-SHTR-01:DONECALC")
}

record(busy, "FE14I-PS-SHTR-01:BUSY") {
}

record(calcout, "FE14I-PS-SHTR-01:DONECALC") {
  field(INPA, "FE14I-PS-SHTR-01:CON MS")
  field(INPB, "FE14I-PS-SHTR-01:STA CPP MS")
  field(INPC, "FE14I-PS-SHTR-01:ILKSTA CPP MS")
  field(INPD, "FE14I-PS-SHTR-01:LASTCON CPP MS")
  field(CALC, "((A=D)&(((A*2+1)=B)|A=2|C=0))?0:1")
  field(OOPT, "When Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-PS-SHTR-01:BUSY CA NMS")
}

# % archiver 10 Monitor
record(mbbi, "FE14I-PS-SHTR-01:LASTCON") {
  field(DESC, "Control Readback")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(INP, "FE14I-PS-SHTR-01:GETLASTCON.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETLASTCON") {
  field(DESC, "Get control readback")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:LASTCON")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# LASTCON is in DM40+1. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:LASTCONINDX") {
  field(CALC, "40%100+1")
  field(OUT, "FE14I-PS-SHTR-01:GETLASTCON.INDX PP")
  field(PINI, "YES")
}

# LASTCON is in DM40+1. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:LASTCONINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETLASTCON.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:LASTCONINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:LASTCONINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:LASTCONINP.DISA")
}

# ###################################################################
# Interlock Status
# 
# % archiver 10 Monitor
# % controldesk Interlock Status smon
record(mbbi, "FE14I-PS-SHTR-01:ILKSTA") {
  field(DESC, "Interlock Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Failed")
  field(ONST, "Run Ilks Ok")
  field(TWST, "OK")
  field(THST, "Disarmed")
  field(FRST, "")
  field(FVST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(INP, "FE14I-PS-SHTR-01:GETILKSTA.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETILKSTA") {
  field(DESC, "Get interlock status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:ILKSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ILKSTA is in DM40+2. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:ILKSTAINDX") {
  field(CALC, "40%100+2")
  field(OUT, "FE14I-PS-SHTR-01:GETILKSTA.INDX PP")
  field(PINI, "YES")
}

# ILKSTA is in DM40+2. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:ILKSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETILKSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:ILKSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:ILKSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:ILKSTAINP.DISA")
}

# #########################################################################
# Status
# 
# % archiver 10 Monitor
# % controldesk Status smon
# This makes the component icon reflect the status
# % gui, , sevr
#% gdatag,mbbinary,ro,,STA
record(mbbi, "FE14I-PS-SHTR-01:STA") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(FVST, "")
  field(SXST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(INP, "FE14I-PS-SHTR-01:GETSTA MS")
}

# this tells the gui that this device is moving if STA is Opening or Closing
# % gui, , status
record(calcout, "FE14I-PS-SHTR-01:MOVN") {
  field(DTYP, "Soft Channel")
  field(DESC, "Is valve moving")
  field(INPA, "FE14I-PS-SHTR-01:STA CP")
  field(CALC, "A=2|A=4")
}

record(subArray, "FE14I-PS-SHTR-01:GETSTA") {
  field(DESC, "Get status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:STA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM40+3. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:STAINDX") {
  field(CALC, "40%100+3")
  field(OUT, "FE14I-PS-SHTR-01:GETSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM40+3. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:STAINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:STAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:STAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:STAINP.DISA")
}

# ############################################################################
# Number of Operations
# 
# % archiver 10 Monitor
# % controldesk Number of Operations readback
record(longin, "FE14I-PS-SHTR-01:OPS") {
  field(DESC, "Operations")
  field(DTYP, "Soft Channel")
  field(HOPR, "10000")
  field(LOPR, "0")
  field(HIHI, "10000")
  field(HIGH, "9000")
  field(LOW, "0")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(LLSV, "MAJOR")
  field(INP, "FE14I-PS-SHTR-01:GETOPS.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETOPS") {
  field(DESC, "Get operations")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:OPS")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# OPS is in DM40+4. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:OPSINDX") {
  field(CALC, "40%100+4")
  field(OUT, "FE14I-PS-SHTR-01:GETOPS.INDX PP")
  field(PINI, "YES")
}

# OPS is in DM40+4. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:OPSINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETOPS.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:OPSINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:OPSINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:OPSINP.DISA")
}

# #########################################################################
# Mode Status (individual bits pulled off in each valve template
record(mbbiDirect, "FE14I-PS-SHTR-01:MODSTA") {
  field(DESC, "Mode")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-PS-SHTR-01:GETMODSTA MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETMODSTA") {
  field(DESC, "Get mode")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:MODSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# MODSTA is in DM40+5. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:MODSTAINDX") {
  field(CALC, "40%100+5")
  field(OUT, "FE14I-PS-SHTR-01:GETMODSTA.INDX PP")
  field(PINI, "YES")
}

# MODSTA is in DM40+5. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:MODSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETMODSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:MODSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:MODSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:MODSTAINP.DISA")
}

# end(valveCtrl)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveIlk.vdb", valveIlk)

# % archiver 10 Monitor
# % controldesk Latched Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-01:ILK") {
  field(DESC, "Latched Interlocks - tpfx :")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-PS-SHTR-01:GETILK.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETILK") {
  field(DESC, "Get latched interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:ILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ilk is in DM40+6. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:ILKINDX") {
  field(CALC, "40%100+6")
  field(OUT, "FE14I-PS-SHTR-01:GETILK.INDX PP")
  field(PINI, "YES")
}

# ilk is in DM40+6. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:ILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:ILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:ILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:ILKINP.DISA")
}

# Individual Interlocks
record(bi, "FE14I-PS-SHTR-01:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-PS-SHTR-01:ILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Air press. OK")
  field(ONAM, "Air press. OK")
}

record(bi, "FE14I-PS-SHTR-01:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-PS-SHTR-01:ILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Limits Healthy")
  field(ONAM, "Limits Healthy")
}

record(bi, "FE14I-PS-SHTR-01:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-PS-SHTR-01:ILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Open Limit OK")
  field(ONAM, "Open Limit OK")
}

record(bi, "FE14I-PS-SHTR-01:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-PS-SHTR-01:ILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Move time OK")
  field(ONAM, "Move time OK")
}

record(bi, "FE14I-PS-SHTR-01:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-PS-SHTR-01:ILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PSS FE PShtr Pmt")
  field(ONAM, "PSS FE PShtr Pmt")
}

record(bi, "FE14I-PS-SHTR-01:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-PS-SHTR-01:ILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PSS BL G Pmt3 PShtr")
  field(ONAM, "PSS BL G Pmt3 PShtr")
}

record(bi, "FE14I-PS-SHTR-01:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-PS-SHTR-01:ILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Gas Brem. ID Gap")
  field(ONAM, "Gas Brem. ID Gap")
}

record(bi, "FE14I-PS-SHTR-01:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-PS-SHTR-01:ILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-PS-SHTR-01:ILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-PS-SHTR-01:ILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-PS-SHTR-01:ILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-PS-SHTR-01:ILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-PS-SHTR-01:ILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-PS-SHTR-01:ILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-PS-SHTR-01:ILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-01:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-PS-SHTR-01:ILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

# % archiver 10 Monitor
# % controldesk Initial Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-01:INIILK") {
  field(DESC, "Initial Interlock")
  field(INP, "FE14I-PS-SHTR-01:GETINIILK MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETINIILK") {
  field(DESC, "Get initial interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:INIILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ini ilk is in DM40+7. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:INIILKINDX") {
  field(CALC, "40%100+7")
  field(OUT, "FE14I-PS-SHTR-01:GETINIILK.INDX PP")
  field(PINI, "YES")
}

# ini ilk is in DM40+7. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:INIILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETINIILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:INIILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:INIILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:INIILKINP.DISA")
}

# % archiver 10 Monitor
# % controldesk Current Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-01:RAWILK") {
  field(DESC, "Current Interlocks")
  field(INP, "FE14I-PS-SHTR-01:GETRAWILK MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETRAWILK") {
  field(DESC, "Get current interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:RAWILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# raw ilk is in DM40+8. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:RAWILKINDX") {
  field(CALC, "40%100+8")
  field(OUT, "FE14I-PS-SHTR-01:GETRAWILK.INDX PP")
  field(PINI, "YES")
}

# raw ilk is in DM40+8. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:RAWILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETRAWILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:RAWILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:RAWILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:RAWILKINP.DISA")
}

# end(valveIlk)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveGilk.vdb", valveGilk)

################################################################################
# % archiver 10 Monitor
# % controldesk Gauge Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-01:GILK") {
  field(DESC, "Gauge Interlocks")
  field(INP, "FE14I-PS-SHTR-01:GETGILK MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETGILK") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:GILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# gilk is in DM40+9. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-01:GILKINDX") {
  field(CALC, "40%100+9")
  field(OUT, "FE14I-PS-SHTR-01:GETGILK.INDX PP")
  field(PINI, "YES")
}

# gilk is in DM40+9. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:GILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(40/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:GETGILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:GILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:GILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:GILKINP.DISA")
}

################################################################################
#% archiver 10 Monitor
#% controldesk IMG Interlock Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-01:IMGILK") {
  field(DESC, "IMG Interlocks")
  field(INP, "FE14I-PS-SHTR-01:GETIMGILK MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETIMGILK") {
  field(DESC, "IMG Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:IMGILK")
  field(FTVL, "USHORT")
  field(INDX, "5")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
#% archiver 10 Monitor
#% controldesk Pirani Interlock Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-01:PIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(INP, "FE14I-PS-SHTR-01:GETPIRGILK MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETPIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:PIRGILK")
  field(FTVL, "USHORT")
  field(INDX, "6")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
# Individual Gauge Interlocks
#
#% archiver 10 Monitor
record(mbbiDirect, "FE14I-PS-SHTR-01:GAUGEILK") {
  field(DESC, "Combined Gauge Interlock")
  field(INP, "FE14I-PS-SHTR-01:CALGILK MS")
}

record(calc, "FE14I-PS-SHTR-01:CALGILK") {
  field(CALC, "A&B")
  field(FLNK, "FE14I-PS-SHTR-01:GAUGEILK")
  field(INPA, "FE14I-PS-SHTR-01:IMGILK CP MS")
  field(INPB, "FE14I-PS-SHTR-01:PIRGILK CP MS")
}

record(bi, "FE14I-PS-SHTR-01:GILK0") {
  field(DESC, "Gauge ILK 0")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-01")
  field(ONAM, "FE14I-VA-GAUGE-01")
}

record(bi, "FE14I-PS-SHTR-01:GILK1") {
  field(DESC, "Gauge ILK 1")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-02")
  field(ONAM, "FE14I-VA-GAUGE-02")
}

record(bi, "FE14I-PS-SHTR-01:GILK2") {
  field(DESC, "Gauge ILK 2")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-03")
  field(ONAM, "FE14I-VA-GAUGE-03")
}

record(bi, "FE14I-PS-SHTR-01:GILK3") {
  field(DESC, "Gauge ILK 3")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-04")
  field(ONAM, "FE14I-VA-GAUGE-04")
}

record(bi, "FE14I-PS-SHTR-01:GILK4") {
  field(DESC, "Gauge ILK 4")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-05")
  field(ONAM, "FE14I-VA-GAUGE-05")
}

record(bi, "FE14I-PS-SHTR-01:GILK5") {
  field(DESC, "Gauge ILK 5")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-06")
  field(ONAM, "FE14I-VA-GAUGE-06")
}

record(bi, "FE14I-PS-SHTR-01:GILK6") {
  field(DESC, "Gauge ILK 6")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-01")
  field(ONAM, "FE14I-VA-FVI-01")
}

record(bi, "FE14I-PS-SHTR-01:GILK7") {
  field(DESC, "Gauge ILK 7")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-02")
  field(ONAM, "FE14I-VA-FVI-02")
}

record(bi, "FE14I-PS-SHTR-01:GILK8") {
  field(DESC, "Gauge ILK 8")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-03")
  field(ONAM, "FE14I-VA-FVI-03")
}

record(bi, "FE14I-PS-SHTR-01:GILK9") {
  field(DESC, "Gauge ILK 9")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-04")
  field(ONAM, "FE14I-VA-FVI-04")
}

record(bi, "FE14I-PS-SHTR-01:GILK10") {
  field(DESC, "Gauge ILK 10")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-01:GILK11") {
  field(DESC, "Gauge ILK 11")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-01:GILK12") {
  field(DESC, "Gauge ILK 12")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-01:GILK13") {
  field(DESC, "Gauge ILK 13")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-01:GILK14") {
  field(DESC, "Gauge ILK 14")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-01:GILK15") {
  field(DESC, "Gauge ILK 15")
  field(INP, "FE14I-PS-SHTR-01:GAUGEILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

# end(valveGilk)

# Operational/Service Mode
#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "FE14I-PS-SHTR-01:MODE") {
  field(DESC, "Mode")
  field(INP, "FE14I-PS-SHTR-01:MODSTA.B0 CP MS")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

# ######################################################################
# Close time trip
#
#% controldesk Close Timeout setpoint
#
# NB: This section may be better rejoining the TCLOSE records, which were
#     below, but now extracted to their own template (dlsPLC_vacValveTclose.vdb)
#     which was done to better support ABSB-01 for front-ends close time metrics.
# IJG 24 July 2018
#
record(longin, "FE14I-PS-SHTR-01:INPMINTCLS") {
  field(INP, "FE14I-PS-SHTR-01:GETINPMINTCLS PP MS")
}

# INDX calculation DM40+n. Calc the index into the century record
record(calcout, "FE14I-PS-SHTR-01:INPMINTCLSINDX") {
  field(CALC, "40+7")
  field(OUT, "FE14I-PS-SHTR-01:GETINPMINTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-PS-SHTR-01:GETINPMINTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Minimum Close Time readback
#
record(calc, "FE14I-PS-SHTR-01:MINTCLS") {
  field(DESC, "Min Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-PS-SHTR-01:INPMINTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MAJOR")
}

record(longin, "FE14I-PS-SHTR-01:INPMAXTCLS") {
  field(INP, "FE14I-PS-SHTR-01:GETINPMAXTCLS PP MS")
}

# INDX calculation DM40+n. Calc the index into the century record
record(calcout, "FE14I-PS-SHTR-01:INPMAXTCLSINDX") {
  field(CALC, "40+5")
  field(OUT, "FE14I-PS-SHTR-01:GETINPMAXTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-PS-SHTR-01:GETINPMAXTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Maximum Close Time readback
#
record(calc, "FE14I-PS-SHTR-01:MAXTCLS") {
  field(DESC, "Max Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-PS-SHTR-01:INPMAXTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MINOR")
}

################################################################################
# Air Pressure De-bounce Time
#
#% controldesk Air Pressure De-bounce Time setpoint
#
record(ao, "FE14I-PS-SHTR-01:SETADB") {
  field(DTYP, "Raw Soft Channel")
  field(DESC, "De-bounce Time")
  field(EGU, "s")
  field(PREC, "1")
  field(DOL, "10.0")
  field(ASLO, "0.1")
  field(PINI, "YES")
  field(OUT, "FE14I-PS-SHTR-01:OUTTIMEOUT PP")
}

#
#% archiver 10 Monitor
#% controldesk Air Pressure De-bounce Time readback
#
record(calc, "FE14I-PS-SHTR-01:ADB") {
  field(DESC, "De-bounce Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-PS-SHTR-01:INPTIMEOUT PP MS")
  field(SCAN, "1 second")
  field(EGU, "s")
  field(PREC, "1")
}

record(ao, "FE14I-PS-SHTR-01:OUTTIMEOUT") {
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 403, 0) FINS_DM_WRITE")
}

# INDX calculation DM40+n. Calc the index into the century record
#record(calcout, "FE14I-PS-SHTR-01:INPTIMEOUTINDX") 
#  {
#  field(CALC, "0")
#  field(OUT, "FE14I-PS-SHTR-01:INPTIMEOUT.INDX PP")
#  field(PINI, "YES")
#  }
# DX00
record(subArray, "FE14I-PS-SHTR-01:INPTIMEOUT") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM400")
  field(INDX, "0")
  field(MALM, "100")
}

# addr is the valve (device) number x10
# the ADB and timeouts are in centuries corresponding to
# device number (1XX, 2XX, etc.)
# 
# Calculate the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-01:SCALCCENTURY") {
  field(CALC, "PRINTF(AA,FLOOR(40/10))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-01:INPTIMEOUT.INP CA")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:CENTURYDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:SCALCCENTURY.DISA")
}

################################################################################
# NOTE: only valid for valves 0..9
#% archiver 10 Monitor
#% controldesk Raw Air Pressure Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-01:RAWAIRALL") {
  field(DESC, "Raw air pressure all valves")
  field(INP, "FE14I-PS-SHTR-01:GETRAWAIR MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETRAWAIR") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:RAWAIRALL")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(INDX, "3")
  field(MALM, "100")
}

record(bi, "FE14I-PS-SHTR-01:RAWAIRSTA") {
  field(DESC, "Raw Air Pressure Status")
  field(ZNAM, "Low")
  field(ONAM, "Good")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
}

# Turn valve 15 (addr=150) into the letter F to get raw air status
record(scalcout, "FE14I-PS-SHTR-01:RAWAIRSTAINP") {
  field(CALC, "PRINTF(AA,MIN(FLOOR(40/10),15))")
  field(AA, "FE14I-PS-SHTR-01:RAWAIRALL.B%1X CP MS")
  field(OUT, "FE14I-PS-SHTR-01:RAWAIRSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-01:RAWAIRSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-01:RAWAIRSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-01:RAWAIRSTAINP.DISA")
}

################################################################################
# % archiver 10 Monitor
# % controldesk Initial/Run Vacuum Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-01:IRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(INP, "FE14I-PS-SHTR-01:GETIRVAC MS")
}

record(subArray, "FE14I-PS-SHTR-01:GETIRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-01:IRVAC")
  field(FTVL, "USHORT")
  field(INDX, "7")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# vacuumValve.template
#% macro, __doc__, Template database for a vacuum valve without debounce or raw air records
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate
# % macro, port, asyn port name of FINS driver
#% macro, addr, First address in the DM variable range decade. E.g. if pump is in DM110..118 then addr=110
#% macro, allowpv, If specified, then only write an open command when this is non-zero. MUST have CP at the end of it
#% macro, whylocked, String to output to EDM synoptic as to precisely why the device is locked and by whom
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, valvetype, Determines which icon is shown in css GUI
#% macro, ilk0, Interlock description 0
#% macro, ilk1, Interlock description 1
#% macro, ilk2, Interlock description 2
#% macro, ilk3, Interlock description 3
#% macro, ilk4, Interlock description 4
#% macro, ilk5, Interlock description 5
#% macro, ilk6, Interlock description 6
#% macro, ilk7, Interlock description 7
#% macro, ilk8, Interlock description 8
#% macro, ilk9, Interlock description 9
#% macro, ilk10, Interlock description 10
#% macro, ilk11, Interlock description 11
#% macro, ilk12, Interlock description 12
#% macro, ilk13, Interlock description 13
#% macro, ilk14, Interlock description 14
#% macro, ilk15, Interlock description 15
#% macro, gilk0, Gauge interlock description 0
#% macro, gilk1, Gauge interlock description 1
#% macro, gilk2, Gauge interlock description 2
#% macro, gilk3, Gauge interlock description 3
#% macro, gilk4, Gauge interlock description 4
#% macro, gilk5, Gauge interlock description 5
#% macro, gilk6, Gauge interlock description 6
#% macro, gilk7, Gauge interlock description 7
#% macro, gilk8, Gauge interlock description 8
#% macro, gilk9, Gauge interlock description 9
#% macro, gilk10, Gauge interlock description 10
#% macro, gilk11, Gauge interlock description 11
#% macro, gilk12, Gauge interlock description 12
#% macro, gilk13, Gauge interlock description 13
#% macro, gilk14, Gauge interlock description 14
#% macro, gilk15, Gauge interlock description 15
#% macro, con_label0, Label string for control value 0 (Optional - defaults to Open)
#% macro, con_label1, Label string for control value 1 (Optional - defaults to Close)
#% macro, con_label2, Label string for control value 2 (Optional - defaults to Reset)
#% macro, con_label3, Label string for control value 3 (Optional - defaults to "")
#% macro, con_label4, Label string for control value 4 (Optional - defaults to "")
#% macro, con_label5, Label string for control value 5 (Optional - defaults to "")
#% macro, con_label6, Label string for control value 6 (Optional - defaults to "")
#% macro, sta_label0, Label string for status value 0 (Optional - defaults to Fault)
#% macro, sta_label1, Label string for status value 1 (Optional - defaults to Open)
#% macro, sta_label2, Label string for status value 2 (Optional - defaults to Opening)
#% macro, sta_label3, Label string for status value 3 (Optional - defaults to Closed)
#% macro, sta_label4, Label string for status value 4 (Optional - defaults to Closing)
#% macro, sta_label5, Label string for status value 5 (Optional - defaults to "")
#% macro, sta_label6, Label string for status value 6 (Optional - defaults to "")
#% macro, name, Object name and associated gui name
#% macro, gda_name, GDA name to export to gda as if it exists
#% macro, gda_desc, GDA description
#% macro, desc, Box label for gui
#% macro, mode1, name of remote operational mode (:MODE)
#% macro, mode2, name of local operational mode (:MODE)
#% macro, EMPTY, Empty substitution to satisfy VDCT
# This associates an edm screen with the template
# % gui, , edm, vacuumValve.edl, device=FE14I-PS-SHTR-02
# % gui, , edmembed, vacuumValve-embed.edl, device=FE14I-PS-SHTR-02,box-label=FE14I-PS-SHTR-02
# This associates BOY screens with the template
# % gui, , boydetail, dlsPLCApp_opi/vacValve_detail.opi, device=FE14I-PS-SHTR-02, DESC=FE14I-PS-SHTR-02, ilk0=Air press. OK,ilk1=Limits Healthy,ilk2=Open Limit OK,ilk3=Move time OK,ilk4=PSS BL OH1 Shtr GLA,ilk5=PSS BL OH1 Shtr GLB,ilk6=unused,ilk7=unused,ilk8=unused,ilk9=unused,ilk10=unused,ilk11=unused,ilk12=unused,ilk13=unused,ilk14=unused,ilk15=unused,gilk0=FE14I-VA-GAUGE-01,gilk1=FE14I-VA-GAUGE-02,gilk2=FE14I-VA-GAUGE-03,gilk3=FE14I-VA-GAUGE-04,gilk4=FE14I-VA-GAUGE-05,gilk5=FE14I-VA-GAUGE-06,gilk6=FE14I-VA-FVI-01,gilk7=FE14I-VA-FVI-02,gilk8=FE14I-VA-FVI-03,gilk9=FE14I-VA-FVI-04,gilk10=,gilk11=,gilk12=,gilk13=,gilk14=,gilk15=, name=, valvetype=valve, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed_box.opi, device=FE14I-PS-SHTR-02, DESC=FE14I-PS-SHTR-02, name=, valvetype=valve
# % gui, , boyembed, dlsPLCApp_opi/vacValve_embed.opi, device=FE14I-PS-SHTR-02, DESC=FE14I-PS-SHTR-02, name=, valvetype=valve
# These define what PVs a valve detail screen should contain
# % gui, , enum, Control,   FE14I-PS-SHTR-02:CON
# % gui, , readback, Status,  FE14I-PS-SHTR-02:STA
# % gui, , readback, Mode,  FE14I-PS-SHTR-02:MODE
# % gui, , readback, Interlock Stat,  FE14I-PS-SHTR-02:ILKSTA
# % gui, , readback, Operations,  FE14I-PS-SHTR-02:OPS
# % gui, , readback, De-bounce,  FE14I-PS-SHTR-02:ADB
# % gui, , demand, De-bounce,  FE14I-PS-SHTR-02:SETADB
# % gui, , statusbits, Interlocks Latched,  FE14I-PS-SHTR-02:ILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,PSS BL OH1 Shtr GLA,PSS BL OH1 Shtr GLB,unused,unused,unused,unused,unused,unused,unused,unused,unused,unused
# % gui, , statusbits, Interlocks Initial,  FE14I-PS-SHTR-02:INIILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,PSS BL OH1 Shtr GLA,PSS BL OH1 Shtr GLB,unused,unused,unused,unused,unused,unused,unused,unused,unused,unused
# % gui, , statusbits, Interlocks Current,  FE14I-PS-SHTR-02:RAWILK, Air press. OK,Limits Healthy,Open Limit OK,Move time OK,PSS BL OH1 Shtr GLA,PSS BL OH1 Shtr GLB,unused,unused,unused,unused,unused,unused,unused,unused,unused,unused
# % gui, , statusbits, Interlocks IMG,  FE14I-PS-SHTR-02:IMGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
# % gui, , statusbits, Interlocks PIRG,  FE14I-PS-SHTR-02:PIRGILK, FE14I-VA-GAUGE-01,FE14I-VA-GAUGE-02,FE14I-VA-GAUGE-03,FE14I-VA-GAUGE-04,FE14I-VA-GAUGE-05,FE14I-VA-GAUGE-06,FE14I-VA-FVI-01,FE14I-VA-FVI-02,FE14I-VA-FVI-03,FE14I-VA-FVI-04,,,,,,
record(ai, "FE14I-PS-SHTR-02:HASDEBOUNCE") {
  field(VAL, "1")
  field(PINI, "YES")
}

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveCtrl.vdb", valveCtrl)

# ##############################################################################
# Control
# 
# % archiver 10 Monitor
# % controldesk Status scon
# % gdatag,template,pneumaticCallback,,
# % gdatag,mbbinary,rw,,CONTROL
## Use this PV to request the valve to open or close
# The request will be checked by FE14I-PS-SHTR-02:CALCCON
record(mbbo, "FE14I-PS-SHTR-02:CON") {
  field(DESC, "Control")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(VAL, "0")
  field(OUT, "FE14I-PS-SHTR-02:CALCCON.A PP")
}

record(seq, "FE14I-PS-SHTR-02:OPENSEQ") {
  field(LNK1, "FE14I-PS-SHTR-02:CON PP")
  field(LNK2, "FE14I-PS-SHTR-02:CON PP")
  field(DO1, "2")
# reset
  field(DO2, "0")
# open
  field(DLY2, "1")
}

## If this PV is non-zero then an open request will be allowed by 
# FE14I-PS-SHTR-02:CALCCON
record(bi, "FE14I-PS-SHTR-02:OPENALLOWED") {
  field(DESC, "Allow/inhibit valve opening")
  field(INP, "")
  field(VAL, "1")
  field(ONAM, "Yes")
  field(ZNAM, "No")
}

record(stringout, "FE14I-PS-SHTR-02:WHYLOCKED") {
  field(DESC, "Reason why device is locked")
  field(VAL, "")
}

## Pass all requests through to the PLC unless it is an open request and 
# FE14I-PS-SHTR-02:OPENALLOWED is zero
record(calcout, "FE14I-PS-SHTR-02:CALCCON") {
  field(INPB, "FE14I-PS-SHTR-02:OPENALLOWED")
  field(OUT, "FE14I-PS-SHTR-02:ACTUALCON PP")
  field(CALC, "(B=0&A=0)?0:1")
  field(OOPT, "When Non-zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A")
}

## Send the request down to the PLC
record(ao, "FE14I-PS-SHTR-02:ACTUALCON") {
  field(DESC, "Control")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 50, 0) FINS_DM_WRITE")
  field(PRIO, "HIGH")
  field(FLNK, "FE14I-PS-SHTR-02:SETBUSY")
}

record(bi, "FE14I-PS-SHTR-02:OPENING") {
  field(DESC, "Opening Valves")
  field(PINI, "YES")
  field(INP, "0")
  field(ONAM, "Opening")
}

record(calcout, "FE14I-PS-SHTR-02:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-PS-SHTR-02:BUSY PP NMS")
  field(FLNK, "FE14I-PS-SHTR-02:DONECALC")
}

record(busy, "FE14I-PS-SHTR-02:BUSY") {
}

record(calcout, "FE14I-PS-SHTR-02:DONECALC") {
  field(INPA, "FE14I-PS-SHTR-02:CON MS")
  field(INPB, "FE14I-PS-SHTR-02:STA CPP MS")
  field(INPC, "FE14I-PS-SHTR-02:ILKSTA CPP MS")
  field(INPD, "FE14I-PS-SHTR-02:LASTCON CPP MS")
  field(CALC, "((A=D)&(((A*2+1)=B)|A=2|C=0))?0:1")
  field(OOPT, "When Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-PS-SHTR-02:BUSY CA NMS")
}

# % archiver 10 Monitor
record(mbbi, "FE14I-PS-SHTR-02:LASTCON") {
  field(DESC, "Control Readback")
  field(DTYP, "Soft Channel")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(THST, "")
  field(FRST, "")
  field(FVST, "")
  field(SXST, "")
  field(INP, "FE14I-PS-SHTR-02:GETLASTCON.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETLASTCON") {
  field(DESC, "Get control readback")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:LASTCON")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# LASTCON is in DM50+1. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:LASTCONINDX") {
  field(CALC, "50%100+1")
  field(OUT, "FE14I-PS-SHTR-02:GETLASTCON.INDX PP")
  field(PINI, "YES")
}

# LASTCON is in DM50+1. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:LASTCONINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETLASTCON.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:LASTCONINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:LASTCONINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:LASTCONINP.DISA")
}

# ###################################################################
# Interlock Status
# 
# % archiver 10 Monitor
# % controldesk Interlock Status smon
record(mbbi, "FE14I-PS-SHTR-02:ILKSTA") {
  field(DESC, "Interlock Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Failed")
  field(ONST, "Run Ilks Ok")
  field(TWST, "OK")
  field(THST, "Disarmed")
  field(FRST, "")
  field(FVST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(INP, "FE14I-PS-SHTR-02:GETILKSTA.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETILKSTA") {
  field(DESC, "Get interlock status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:ILKSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ILKSTA is in DM50+2. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:ILKSTAINDX") {
  field(CALC, "50%100+2")
  field(OUT, "FE14I-PS-SHTR-02:GETILKSTA.INDX PP")
  field(PINI, "YES")
}

# ILKSTA is in DM50+2. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:ILKSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETILKSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:ILKSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:ILKSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:ILKSTAINP.DISA")
}

# #########################################################################
# Status
# 
# % archiver 10 Monitor
# % controldesk Status smon
# This makes the component icon reflect the status
# % gui, , sevr
#% gdatag,mbbinary,ro,,STA
record(mbbi, "FE14I-PS-SHTR-02:STA") {
  field(DESC, "Status")
  field(DTYP, "Soft Channel")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
  field(FVST, "")
  field(SXST, "")
  field(ZRSV, "MAJOR")
  field(ONSV, "NO_ALARM")
  field(TWSV, "NO_ALARM")
  field(THSV, "NO_ALARM")
  field(FRSV, "NO_ALARM")
  field(FVSV, "NO_ALARM")
  field(SXSV, "NO_ALARM")
  field(INP, "FE14I-PS-SHTR-02:GETSTA MS")
}

# this tells the gui that this device is moving if STA is Opening or Closing
# % gui, , status
record(calcout, "FE14I-PS-SHTR-02:MOVN") {
  field(DTYP, "Soft Channel")
  field(DESC, "Is valve moving")
  field(INPA, "FE14I-PS-SHTR-02:STA CP")
  field(CALC, "A=2|A=4")
}

record(subArray, "FE14I-PS-SHTR-02:GETSTA") {
  field(DESC, "Get status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:STA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM50+3. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:STAINDX") {
  field(CALC, "50%100+3")
  field(OUT, "FE14I-PS-SHTR-02:GETSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM50+3. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:STAINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:STAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:STAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:STAINP.DISA")
}

# ############################################################################
# Number of Operations
# 
# % archiver 10 Monitor
# % controldesk Number of Operations readback
record(longin, "FE14I-PS-SHTR-02:OPS") {
  field(DESC, "Operations")
  field(DTYP, "Soft Channel")
  field(HOPR, "10000")
  field(LOPR, "0")
  field(HIHI, "10000")
  field(HIGH, "9000")
  field(LOW, "0")
  field(LOLO, "-1")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(LLSV, "MAJOR")
  field(INP, "FE14I-PS-SHTR-02:GETOPS.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETOPS") {
  field(DESC, "Get operations")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:OPS")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# OPS is in DM50+4. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:OPSINDX") {
  field(CALC, "50%100+4")
  field(OUT, "FE14I-PS-SHTR-02:GETOPS.INDX PP")
  field(PINI, "YES")
}

# OPS is in DM50+4. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:OPSINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETOPS.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:OPSINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:OPSINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:OPSINP.DISA")
}

# #########################################################################
# Mode Status (individual bits pulled off in each valve template
record(mbbiDirect, "FE14I-PS-SHTR-02:MODSTA") {
  field(DESC, "Mode")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-PS-SHTR-02:GETMODSTA MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETMODSTA") {
  field(DESC, "Get mode")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:MODSTA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# MODSTA is in DM50+5. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:MODSTAINDX") {
  field(CALC, "50%100+5")
  field(OUT, "FE14I-PS-SHTR-02:GETMODSTA.INDX PP")
  field(PINI, "YES")
}

# MODSTA is in DM50+5. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:MODSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETMODSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:MODSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:MODSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:MODSTAINP.DISA")
}

# end(valveCtrl)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveIlk.vdb", valveIlk)

# % archiver 10 Monitor
# % controldesk Latched Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-02:ILK") {
  field(DESC, "Latched Interlocks - tpfx :")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-PS-SHTR-02:GETILK.VAL MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETILK") {
  field(DESC, "Get latched interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:ILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ilk is in DM50+6. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:ILKINDX") {
  field(CALC, "50%100+6")
  field(OUT, "FE14I-PS-SHTR-02:GETILK.INDX PP")
  field(PINI, "YES")
}

# ilk is in DM50+6. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:ILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:ILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:ILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:ILKINP.DISA")
}

# Individual Interlocks
record(bi, "FE14I-PS-SHTR-02:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-PS-SHTR-02:ILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Air press. OK")
  field(ONAM, "Air press. OK")
}

record(bi, "FE14I-PS-SHTR-02:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-PS-SHTR-02:ILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Limits Healthy")
  field(ONAM, "Limits Healthy")
}

record(bi, "FE14I-PS-SHTR-02:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-PS-SHTR-02:ILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Open Limit OK")
  field(ONAM, "Open Limit OK")
}

record(bi, "FE14I-PS-SHTR-02:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-PS-SHTR-02:ILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Move time OK")
  field(ONAM, "Move time OK")
}

record(bi, "FE14I-PS-SHTR-02:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-PS-SHTR-02:ILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PSS BL OH1 Shtr GLA")
  field(ONAM, "PSS BL OH1 Shtr GLA")
}

record(bi, "FE14I-PS-SHTR-02:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-PS-SHTR-02:ILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PSS BL OH1 Shtr GLB")
  field(ONAM, "PSS BL OH1 Shtr GLB")
}

record(bi, "FE14I-PS-SHTR-02:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-PS-SHTR-02:ILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-PS-SHTR-02:ILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-PS-SHTR-02:ILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-PS-SHTR-02:ILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-PS-SHTR-02:ILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-PS-SHTR-02:ILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-PS-SHTR-02:ILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-PS-SHTR-02:ILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-PS-SHTR-02:ILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-PS-SHTR-02:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-PS-SHTR-02:ILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

# % archiver 10 Monitor
# % controldesk Initial Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-02:INIILK") {
  field(DESC, "Initial Interlock")
  field(INP, "FE14I-PS-SHTR-02:GETINIILK MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETINIILK") {
  field(DESC, "Get initial interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:INIILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ini ilk is in DM50+7. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:INIILKINDX") {
  field(CALC, "50%100+7")
  field(OUT, "FE14I-PS-SHTR-02:GETINIILK.INDX PP")
  field(PINI, "YES")
}

# ini ilk is in DM50+7. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:INIILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETINIILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:INIILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:INIILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:INIILKINP.DISA")
}

# % archiver 10 Monitor
# % controldesk Current Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-02:RAWILK") {
  field(DESC, "Current Interlocks")
  field(INP, "FE14I-PS-SHTR-02:GETRAWILK MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETRAWILK") {
  field(DESC, "Get current interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:RAWILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# raw ilk is in DM50+8. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:RAWILKINDX") {
  field(CALC, "50%100+8")
  field(OUT, "FE14I-PS-SHTR-02:GETRAWILK.INDX PP")
  field(PINI, "YES")
}

# raw ilk is in DM50+8. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:RAWILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETRAWILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:RAWILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:RAWILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:RAWILKINP.DISA")
}

# end(valveIlk)

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveGilk.vdb", valveGilk)

################################################################################
# % archiver 10 Monitor
# % controldesk Gauge Interlock Status smon
record(mbbiDirect, "FE14I-PS-SHTR-02:GILK") {
  field(DESC, "Gauge Interlocks")
  field(INP, "FE14I-PS-SHTR-02:GETGILK MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETGILK") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:GILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# gilk is in DM50+9. Calc the index into the 
# century record
record(calcout, "FE14I-PS-SHTR-02:GILKINDX") {
  field(CALC, "50%100+9")
  field(OUT, "FE14I-PS-SHTR-02:GETGILK.INDX PP")
  field(PINI, "YES")
}

# gilk is in DM50+9. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:GILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(50/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:GETGILK.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:GILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:GILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:GILKINP.DISA")
}

################################################################################
#% archiver 10 Monitor
#% controldesk IMG Interlock Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-02:IMGILK") {
  field(DESC, "IMG Interlocks")
  field(INP, "FE14I-PS-SHTR-02:GETIMGILK MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETIMGILK") {
  field(DESC, "IMG Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:IMGILK")
  field(FTVL, "USHORT")
  field(INDX, "5")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
#% archiver 10 Monitor
#% controldesk Pirani Interlock Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-02:PIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(INP, "FE14I-PS-SHTR-02:GETPIRGILK MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETPIRGILK") {
  field(DESC, "Pirani Interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:PIRGILK")
  field(FTVL, "USHORT")
  field(INDX, "6")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

################################################################################
# Individual Gauge Interlocks
#
#% archiver 10 Monitor
record(mbbiDirect, "FE14I-PS-SHTR-02:GAUGEILK") {
  field(DESC, "Combined Gauge Interlock")
  field(INP, "FE14I-PS-SHTR-02:CALGILK MS")
}

record(calc, "FE14I-PS-SHTR-02:CALGILK") {
  field(CALC, "A&B")
  field(FLNK, "FE14I-PS-SHTR-02:GAUGEILK")
  field(INPA, "FE14I-PS-SHTR-02:IMGILK CP MS")
  field(INPB, "FE14I-PS-SHTR-02:PIRGILK CP MS")
}

record(bi, "FE14I-PS-SHTR-02:GILK0") {
  field(DESC, "Gauge ILK 0")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-01")
  field(ONAM, "FE14I-VA-GAUGE-01")
}

record(bi, "FE14I-PS-SHTR-02:GILK1") {
  field(DESC, "Gauge ILK 1")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-02")
  field(ONAM, "FE14I-VA-GAUGE-02")
}

record(bi, "FE14I-PS-SHTR-02:GILK2") {
  field(DESC, "Gauge ILK 2")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-03")
  field(ONAM, "FE14I-VA-GAUGE-03")
}

record(bi, "FE14I-PS-SHTR-02:GILK3") {
  field(DESC, "Gauge ILK 3")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-04")
  field(ONAM, "FE14I-VA-GAUGE-04")
}

record(bi, "FE14I-PS-SHTR-02:GILK4") {
  field(DESC, "Gauge ILK 4")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-05")
  field(ONAM, "FE14I-VA-GAUGE-05")
}

record(bi, "FE14I-PS-SHTR-02:GILK5") {
  field(DESC, "Gauge ILK 5")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-GAUGE-06")
  field(ONAM, "FE14I-VA-GAUGE-06")
}

record(bi, "FE14I-PS-SHTR-02:GILK6") {
  field(DESC, "Gauge ILK 6")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-01")
  field(ONAM, "FE14I-VA-FVI-01")
}

record(bi, "FE14I-PS-SHTR-02:GILK7") {
  field(DESC, "Gauge ILK 7")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-02")
  field(ONAM, "FE14I-VA-FVI-02")
}

record(bi, "FE14I-PS-SHTR-02:GILK8") {
  field(DESC, "Gauge ILK 8")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-03")
  field(ONAM, "FE14I-VA-FVI-03")
}

record(bi, "FE14I-PS-SHTR-02:GILK9") {
  field(DESC, "Gauge ILK 9")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FE14I-VA-FVI-04")
  field(ONAM, "FE14I-VA-FVI-04")
}

record(bi, "FE14I-PS-SHTR-02:GILK10") {
  field(DESC, "Gauge ILK 10")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-02:GILK11") {
  field(DESC, "Gauge ILK 11")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-02:GILK12") {
  field(DESC, "Gauge ILK 12")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-02:GILK13") {
  field(DESC, "Gauge ILK 13")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-02:GILK14") {
  field(DESC, "Gauge ILK 14")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

record(bi, "FE14I-PS-SHTR-02:GILK15") {
  field(DESC, "Gauge ILK 15")
  field(INP, "FE14I-PS-SHTR-02:GAUGEILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "")
  field(ONAM, "")
}

# end(valveGilk)

# Operational/Service Mode
#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "FE14I-PS-SHTR-02:MODE") {
  field(DESC, "Mode")
  field(INP, "FE14I-PS-SHTR-02:MODSTA.B0 CP MS")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

# ######################################################################
# Close time trip
#
#% controldesk Close Timeout setpoint
#
# NB: This section may be better rejoining the TCLOSE records, which were
#     below, but now extracted to their own template (dlsPLC_vacValveTclose.vdb)
#     which was done to better support ABSB-01 for front-ends close time metrics.
# IJG 24 July 2018
#
record(longin, "FE14I-PS-SHTR-02:INPMINTCLS") {
  field(INP, "FE14I-PS-SHTR-02:GETINPMINTCLS PP MS")
}

# INDX calculation DM50+n. Calc the index into the century record
record(calcout, "FE14I-PS-SHTR-02:INPMINTCLSINDX") {
  field(CALC, "50+7")
  field(OUT, "FE14I-PS-SHTR-02:GETINPMINTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-PS-SHTR-02:GETINPMINTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Minimum Close Time readback
#
record(calc, "FE14I-PS-SHTR-02:MINTCLS") {
  field(DESC, "Min Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-PS-SHTR-02:INPMINTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MAJOR")
}

record(longin, "FE14I-PS-SHTR-02:INPMAXTCLS") {
  field(INP, "FE14I-PS-SHTR-02:GETINPMAXTCLS PP MS")
}

# INDX calculation DM50+n. Calc the index into the century record
record(calcout, "FE14I-PS-SHTR-02:INPMAXTCLSINDX") {
  field(CALC, "50+5")
  field(OUT, "FE14I-PS-SHTR-02:GETINPMAXTCLS.INDX PP")
  field(PINI, "YES")
}

record(subArray, "FE14I-PS-SHTR-02:GETINPMAXTCLS") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Maximum Close Time readback
#
record(calc, "FE14I-PS-SHTR-02:MAXTCLS") {
  field(DESC, "Max Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-PS-SHTR-02:INPMAXTCLS PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIHI, "10")
  field(HHSV, "MINOR")
}

################################################################################
# Air Pressure De-bounce Time
#
#% controldesk Air Pressure De-bounce Time setpoint
#
record(ao, "FE14I-PS-SHTR-02:SETADB") {
  field(DTYP, "Raw Soft Channel")
  field(DESC, "De-bounce Time")
  field(EGU, "s")
  field(PREC, "1")
  field(DOL, "10.0")
  field(ASLO, "0.1")
  field(PINI, "YES")
  field(OUT, "FE14I-PS-SHTR-02:OUTTIMEOUT PP")
}

#
#% archiver 10 Monitor
#% controldesk Air Pressure De-bounce Time readback
#
record(calc, "FE14I-PS-SHTR-02:ADB") {
  field(DESC, "De-bounce Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-PS-SHTR-02:INPTIMEOUT PP MS")
  field(SCAN, "1 second")
  field(EGU, "s")
  field(PREC, "1")
}

record(ao, "FE14I-PS-SHTR-02:OUTTIMEOUT") {
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 503, 0) FINS_DM_WRITE")
}

# INDX calculation DM50+n. Calc the index into the century record
#record(calcout, "FE14I-PS-SHTR-02:INPTIMEOUTINDX") 
#  {
#  field(CALC, "0")
#  field(OUT, "FE14I-PS-SHTR-02:INPTIMEOUT.INDX PP")
#  field(PINI, "YES")
#  }
# DX00
record(subArray, "FE14I-PS-SHTR-02:INPTIMEOUT") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM500")
  field(INDX, "0")
  field(MALM, "100")
}

# addr is the valve (device) number x10
# the ADB and timeouts are in centuries corresponding to
# device number (1XX, 2XX, etc.)
# 
# Calculate the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-PS-SHTR-02:SCALCCENTURY") {
  field(CALC, "PRINTF(AA,FLOOR(50/10))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-PS-SHTR-02:INPTIMEOUT.INP CA")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:CENTURYDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:SCALCCENTURY.DISA")
}

################################################################################
# NOTE: only valid for valves 0..9
#% archiver 10 Monitor
#% controldesk Raw Air Pressure Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-02:RAWAIRALL") {
  field(DESC, "Raw air pressure all valves")
  field(INP, "FE14I-PS-SHTR-02:GETRAWAIR MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETRAWAIR") {
  field(DESC, "Get gauge interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:RAWAIRALL")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(INDX, "3")
  field(MALM, "100")
}

record(bi, "FE14I-PS-SHTR-02:RAWAIRSTA") {
  field(DESC, "Raw Air Pressure Status")
  field(ZNAM, "Low")
  field(ONAM, "Good")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
}

# Turn valve 15 (addr=150) into the letter F to get raw air status
record(scalcout, "FE14I-PS-SHTR-02:RAWAIRSTAINP") {
  field(CALC, "PRINTF(AA,MIN(FLOOR(50/10),15))")
  field(AA, "FE14I-PS-SHTR-02:RAWAIRALL.B%1X CP MS")
  field(OUT, "FE14I-PS-SHTR-02:RAWAIRSTA.INP CA")
  field(FLNK, "FE14I-PS-SHTR-02:RAWAIRSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-PS-SHTR-02:RAWAIRSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-PS-SHTR-02:RAWAIRSTAINP.DISA")
}

################################################################################
# % archiver 10 Monitor
# % controldesk Initial/Run Vacuum Status smon
#
record(mbbiDirect, "FE14I-PS-SHTR-02:IRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(INP, "FE14I-PS-SHTR-02:GETIRVAC MS")
}

record(subArray, "FE14I-PS-SHTR-02:GETIRVAC") {
  field(DESC, "Initial/Run Vacuum")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-PS-SHTR-02:IRVAC")
  field(FTVL, "USHORT")
  field(INDX, "7")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
}
## Enable archiving for valve PVs which are not automatically archived
## from the vacuumValve support package.
## Also set autosave metadata for inclusion in xxx_1.req file
##
## $Author: $
## $Date: $
## $Id:  $
## $Name:  $
## $Revision: $

## Archiving SETADB allows Autosave-Restore to be established for the
#  air debounce time.
# % macro, device, full valve name 
#% archiver 10 Monitor VAL
#% autosave 1 VAL
record(ao,"FE14I-PS-SHTR-01:SETADB") 
{
}
## Enable archiving for valve PVs which are not automatically archived
## from the vacuumValve support package.
## Also set autosave metadata for inclusion in xxx_1.req file
##
## $Author: $
## $Date: $
## $Id:  $
## $Name:  $
## $Revision: $

## Archiving SETADB allows Autosave-Restore to be established for the
#  air debounce time.
# % macro, device, full valve name 
#% archiver 10 Monitor VAL
#% autosave 1 VAL
record(ao,"FE14I-PS-SHTR-02:SETADB") 
{
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# expand("/dls_sw/prod/R3.14.12.7/support/dlsPLC/2-8-5/dlsPLCApp/Db/O.linux-x86_64/../dlsPLC_valveIlk.vdb", valveIlk)

# % archiver 10 Monitor
# % controldesk Latched Interlock Status smon
record(mbbiDirect, "FE14I-MP-PERMT-01:ILK") {
  field(DESC, "Latched Interlocks - tpfx :")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-MP-PERMT-01:GETILK.VAL MS")
}

record(subArray, "FE14I-MP-PERMT-01:GETILK") {
  field(DESC, "Get latched interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-MP-PERMT-01:ILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ilk is in DM80+6. Calc the index into the 
# century record
record(calcout, "FE14I-MP-PERMT-01:ILKINDX") {
  field(CALC, "80%100+6")
  field(OUT, "FE14I-MP-PERMT-01:GETILK.INDX PP")
  field(PINI, "YES")
}

# ilk is in DM80+6. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-MP-PERMT-01:ILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(80/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-MP-PERMT-01:GETILK.INP CA")
  field(FLNK, "FE14I-MP-PERMT-01:ILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-MP-PERMT-01:ILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-MP-PERMT-01:ILKINP.DISA")
}

# Individual Interlocks
record(bi, "FE14I-MP-PERMT-01:ILK0") {
  field(DESC, "Interlock 0")
  field(INP, "FE14I-MP-PERMT-01:ILK.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "ABSB-01 OK")
  field(ONAM, "ABSB-01 OK")
}

record(bi, "FE14I-MP-PERMT-01:ILK1") {
  field(DESC, "Interlock 1")
  field(INP, "FE14I-MP-PERMT-01:ILK.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Operational Mode")
  field(ONAM, "Operational Mode")
}

record(bi, "FE14I-MP-PERMT-01:ILK2") {
  field(DESC, "Interlock 2")
  field(INP, "FE14I-MP-PERMT-01:ILK.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Beamline MPS OK")
  field(ONAM, "Beamline MPS OK")
}

record(bi, "FE14I-MP-PERMT-01:ILK3") {
  field(DESC, "Interlock 3")
  field(INP, "FE14I-MP-PERMT-01:ILK.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FVCTRL IN-RUSH 01")
  field(ONAM, "FVCTRL IN-RUSH 01")
}

record(bi, "FE14I-MP-PERMT-01:ILK4") {
  field(DESC, "Interlock 4")
  field(INP, "FE14I-MP-PERMT-01:ILK.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FVCTRL IN-RUSH 02")
  field(ONAM, "FVCTRL IN-RUSH 02")
}

record(bi, "FE14I-MP-PERMT-01:ILK5") {
  field(DESC, "Interlock 5")
  field(INP, "FE14I-MP-PERMT-01:ILK.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "V1 CLOSED UNEXP")
  field(ONAM, "V1 CLOSED UNEXP")
}

record(bi, "FE14I-MP-PERMT-01:ILK6") {
  field(DESC, "Interlock 6")
  field(INP, "FE14I-MP-PERMT-01:ILK.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "FFLAP CLSD UNEXP")
  field(ONAM, "FFLAP CLSD UNEXP")
}

record(bi, "FE14I-MP-PERMT-01:ILK7") {
  field(DESC, "Interlock 7")
  field(INP, "FE14I-MP-PERMT-01:ILK.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-MP-PERMT-01:ILK8") {
  field(DESC, "Interlock 8")
  field(INP, "FE14I-MP-PERMT-01:ILK.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-MP-PERMT-01:ILK9") {
  field(DESC, "Interlock 9")
  field(INP, "FE14I-MP-PERMT-01:ILK.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "V2 Closed UNEXP")
  field(ONAM, "V2 Closed UNEXP")
}

record(bi, "FE14I-MP-PERMT-01:ILK10") {
  field(DESC, "Interlock 10")
  field(INP, "FE14I-MP-PERMT-01:ILK.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "ABSB-01 cool. OK")
  field(ONAM, "ABSB-01 cool. OK")
}

record(bi, "FE14I-MP-PERMT-01:ILK11") {
  field(DESC, "Interlock 11")
  field(INP, "FE14I-MP-PERMT-01:ILK.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "PBPMs Cool OK")
  field(ONAM, "PBPMs Cool OK")
}

record(bi, "FE14I-MP-PERMT-01:ILK12") {
  field(DESC, "Interlock 12")
  field(INP, "FE14I-MP-PERMT-01:ILK.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "ABSB-01 Temps OK")
  field(ONAM, "ABSB-01 Temps OK")
}

record(bi, "FE14I-MP-PERMT-01:ILK13") {
  field(DESC, "Interlock 13")
  field(INP, "FE14I-MP-PERMT-01:ILK.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

record(bi, "FE14I-MP-PERMT-01:ILK14") {
  field(DESC, "Interlock 14")
  field(INP, "FE14I-MP-PERMT-01:ILK.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "RIO Healthy")
  field(ONAM, "RIO Healthy")
}

record(bi, "FE14I-MP-PERMT-01:ILK15") {
  field(DESC, "Interlock 15")
  field(INP, "FE14I-MP-PERMT-01:ILK.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "unused")
  field(ONAM, "unused")
}

# % archiver 10 Monitor
# % controldesk Initial Interlock Status smon
record(mbbiDirect, "FE14I-MP-PERMT-01:INIILK") {
  field(DESC, "Initial Interlock")
  field(INP, "FE14I-MP-PERMT-01:GETINIILK MS")
}

record(subArray, "FE14I-MP-PERMT-01:GETINIILK") {
  field(DESC, "Get initial interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-MP-PERMT-01:INIILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# ini ilk is in DM80+7. Calc the index into the 
# century record
record(calcout, "FE14I-MP-PERMT-01:INIILKINDX") {
  field(CALC, "80%100+7")
  field(OUT, "FE14I-MP-PERMT-01:GETINIILK.INDX PP")
  field(PINI, "YES")
}

# ini ilk is in DM80+7. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-MP-PERMT-01:INIILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(80/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-MP-PERMT-01:GETINIILK.INP CA")
  field(FLNK, "FE14I-MP-PERMT-01:INIILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-MP-PERMT-01:INIILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-MP-PERMT-01:INIILKINP.DISA")
}

# % archiver 10 Monitor
# % controldesk Current Interlock Status smon
record(mbbiDirect, "FE14I-MP-PERMT-01:RAWILK") {
  field(DESC, "Current Interlocks")
  field(INP, "FE14I-MP-PERMT-01:GETRAWILK MS")
}

record(subArray, "FE14I-MP-PERMT-01:GETRAWILK") {
  field(DESC, "Get current interlocks")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-MP-PERMT-01:RAWILK")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# raw ilk is in DM80+8. Calc the index into the 
# century record
record(calcout, "FE14I-MP-PERMT-01:RAWILKINDX") {
  field(CALC, "80%100+8")
  field(OUT, "FE14I-MP-PERMT-01:GETRAWILK.INDX PP")
  field(PINI, "YES")
}

# raw ilk is in DM80+8. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-MP-PERMT-01:RAWILKINP") {
  field(CALC, "PRINTF(AA,FLOOR(80/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-MP-PERMT-01:GETRAWILK.INP CA")
  field(FLNK, "FE14I-MP-PERMT-01:RAWILKINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-MP-PERMT-01:RAWILKINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-MP-PERMT-01:RAWILKINP.DISA")
}

# end(valveIlk)

################################################################################
# Reset
#
#% controldesk Status scon
#
record(mbbo, "FE14I-MP-PERMT-01:RESET") {
  field(DESC, "Reset")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 80, 0) FINS_DM_WRITE")
  field(TWST, "Reset")
  field(PRIO, "HIGH")
}

################################################################################
# Interlock Status
#
#% archiver 10 Monitor
#% controldesk Status smon
#
record(bi, "FE14I-MP-PERMT-01:STA") {
  field(DESC, "Interlock Status")
  field(DTYP, "Soft Channel")
  field(ZNAM, "Disabled")
  field(ONAM, "OK")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(INP, "FE14I-MP-PERMT-01:GETSTA")
}

#% archiver 10 Monitor
#% controldesk Mode smon
#
record(bi, "FE14I-MP-PERMT-01:MODE") {
  field(DESC, "Mode")
  field(DTYP, "Raw Soft Channel")
  field(INP, "FE14I-MP-PERMT-01:GETMODSTA")
  field(PHAS, "1")
  field(ZNAM, "Operational")
  field(ONAM, "Service")
}

record(subArray, "FE14I-MP-PERMT-01:GETSTA") {
  field(DESC, "Get status")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-MP-PERMT-01:STA")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM80+2. Calc the index into the 
# century record
record(calcout, "FE14I-MP-PERMT-01:STAINDX") {
  field(CALC, "80%100+2")
  field(OUT, "FE14I-MP-PERMT-01:GETSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM80+3. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-MP-PERMT-01:STAINP") {
  field(CALC, "PRINTF(AA,FLOOR(80/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-MP-PERMT-01:GETSTA.INP CA")
  field(FLNK, "FE14I-MP-PERMT-01:STAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-MP-PERMT-01:STAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-MP-PERMT-01:STAINP.DISA")
}

record(subArray, "FE14I-MP-PERMT-01:GETMODSTA") {
  field(DESC, "Get mode")
  field(DTYP, "Soft Channel")
  field(FLNK, "FE14I-MP-PERMT-01:MODE")
  field(FTVL, "USHORT")
  field(MALM, "100")
}

# STA is in DM80+5. Calc the index into the 
# century record
record(calcout, "FE14I-MP-PERMT-01:MODSTAINDX") {
  field(CALC, "80%100+5")
  field(OUT, "FE14I-MP-PERMT-01:GETMODSTA.INDX PP")
  field(PINI, "YES")
}

# STA is in DM80+5. Calc the inp link to the 
# century record. Needs to be done after PINI, so note
# the flnk
record(scalcout, "FE14I-MP-PERMT-01:MODSTAINP") {
  field(CALC, "PRINTF(AA,FLOOR(80/100))")
  field(AA, "FE14I-VA-VLVCC-01:DM%dXX CP MS")
  field(OUT, "FE14I-MP-PERMT-01:GETMODSTA.INP CA")
  field(FLNK, "FE14I-MP-PERMT-01:MODSTAINPDIS")
  field(SCAN, "1 second")
}

# Disable the scalcout record so we don't keep writing values
record(ao, "FE14I-MP-PERMT-01:MODSTAINPDIS") {
  field(VAL, "1")
  field(OUT, "FE14I-MP-PERMT-01:MODSTAINP.DISA")
}
################################################################################
# asynRec.template
# Template to generate a single asynRecord instance to allow
# connection and control of any asyn device at run-time;
# e.g. to control diagnostic output.
#
# Ian Gillingham 18 Sept. 2007
#
################################################################################


record(asyn,"FE14I-CS-IOC-01:ASYN")
{
    field(DTYP,"asynRecordDevice")
    field(PORT,"")
    field(ADDR,"")
    field(OMAX,"")
    field(IMAX,"")
}


# This associates an edm screen with the template
# % gui, , edm, save_restoreStatus_more.edl, P=FE14I-CS-IOC-01

# This associates BOY screens with the template
# % gui, $(name,undefined), boydetail, asApp_opi/autosave_detail.opi, desc=FE14I-CS-IOC-01, device=FE14I-CS-IOC-01, name=$(name,undefined)
# % gui, $(name,undefined), boyembed, asApp_opi/autosave_embed.opi, desc=FE14I-CS-IOC-01, device=FE14I-CS-IOC-01, name=$(name,undefined)
# % gui, $(name,undefined), boyembed, asApp_opi/autosave_embed_box.opi, desc=FE14I-CS-IOC-01, device=FE14I-CS-IOC-01, name=$(name,undefined)

# These define what PVs a detail screen should contain
# % gui, $(name,undefined), readback, General Status, FE14I-CS-IOC-01:SRSTATUSST
# % gui, $(name,undefined), readback, Recently, FE14I-CS-IOC-01:SRRECENTST
# % gui, $(name,undefined), readback, Reboot Status, FE14I-CS-IOC-01:RRSTATUSST
# % gui, $(name,undefined), readback, Reboot time, FE14I-CS-IOC-01:RRTIME
# % gui, $(name,undefined), readback, File 0 Status, FE14I-CS-IOC-01:0:STATUSST
# % gui, $(name,undefined), readback, File 0 Name, FE14I-CS-IOC-01:0:NAME
# % gui, $(name,undefined), readback, File 0 Written, FE14I-CS-IOC-01:0:TIME
# % gui, $(name,undefined), readback, File 1 Status, FE14I-CS-IOC-01:1:STATUSST
# % gui, $(name,undefined), readback, File 1 Name, FE14I-CS-IOC-01:1:NAME
# % gui, $(name,undefined), readback, File 1 Written, FE14I-CS-IOC-01:1:TIME
# % gui, $(name,undefined), readback, File 2 Status, FE14I-CS-IOC-01:2:STATUSST
# % gui, $(name,undefined), readback, File 2 Name, FE14I-CS-IOC-01:2:NAME
# % gui, $(name,undefined), readback, File 2 Written, FE14I-CS-IOC-01:2:TIME


# This makes the component icon reflect the status and severity
# % gui, , sevr
#% archiver 10 Monitor VAL
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-CS-IOC-01:RRSTATUS
record(mbbo,"FE14I-CS-IOC-01:RRSTATUS") {
	field(DTYP,"Soft Channel")
	field(NOBT,"3")
	field(ONVL,"1")
	field(TWVL,"2")
	field(THVL,"3")
	field(FRVL,"4")
	field(ZRST,"No Status")
	field(ONST,"Failure")
	field(TWST,"Warning")
	field(THST,"Seq Fail")
	field(FRST,"Ok")
	field(ONSV, "MAJOR")
	field(TWSV, "MINOR")
	field(THSV, "MINOR")
}

record(stringout,"FE14I-CS-IOC-01:RRSTATUSST") {
	field(DTYP,"Soft Channel")
	field(VAL,"Status unknown")
}

record(stringout,"FE14I-CS-IOC-01:RRTIME") {
	field(DTYP,"Soft Channel")
	field(VAL,"Not yet saved")
}

# % gui, , sevr
#% archiver 10 Monitor VAL
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-CS-IOC-01:SRSTATUS
record(mbbo,"FE14I-CS-IOC-01:SRSTATUS") {
	field(DTYP,"Soft Channel")
	field(NOBT,"3")
	field(ONVL,"1")
	field(TWVL,"2")
	field(THVL,"3")
	field(FRST,"4")
	field(ZRST,"No Status")
	field(ONST,"Failure")
	field(TWST,"Warning")
	field(THST,"Seq Fail")
	field(FRST,"Ok")
	field(ONSV, "MAJOR")
	field(TWSV, "MINOR")
	field(THSV, "MINOR")
}

record(bo,"FE14I-CS-IOC-01:SRHEARTBT") {
	field(DTYP,"Soft Channel")
}

record(stringout,"FE14I-CS-IOC-01:SRSTATUSST") {
	field(DTYP,"Soft Channel")
	field(VAL,"Status unknown")
}

record(stringout,"FE14I-CS-IOC-01:SRRECENTST") {
	field(DTYP,"Soft Channel")
	field(VAL,"Status unknown")
}
record(stringout,"FE14I-CS-IOC-01:0:NAME") {
	field(VAL,"Not In Use")
	field(DTYP,"Soft Channel")
}
record(longout,"FE14I-CS-IOC-01:0:STATE") {
	field(DTYP,"Soft Channel")
}

#% archiver 10 Monitor VAL
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-CS-IOC-01:0:STATUS
record(mbbo,"FE14I-CS-IOC-01:0:STATUS") {
	field(DTYP,"Soft Channel")
	field(NOBT,"3")
	field(ONVL,"1")
	field(TWVL,"2")
	field(THVL,"3")
	field(FRVL,"4")
	field(ZRST,"No Status")
	field(ONST,"Failure")
	field(TWST,"Warning")
	field(THST,"Seq Fail")
	field(FRST,"Ok")
	field(ONSV, "MAJOR")
	field(TWSV, "MINOR")
	field(THSV, "MINOR")
}
record(stringout,"FE14I-CS-IOC-01:0:STATUSST") {
	field(DTYP,"Soft Channel")
	field(VAL,"Status unknown")
}
record(stringout,"FE14I-CS-IOC-01:0:TIME") {
	field(DTYP,"Soft Channel")
	field(VAL,"Not yet saved")
}
record(stringout,"FE14I-CS-IOC-01:1:NAME") {
	field(VAL,"Not In Use")
	field(DTYP,"Soft Channel")
}
record(longout,"FE14I-CS-IOC-01:1:STATE") {
	field(DTYP,"Soft Channel")
}

#% archiver 10 Monitor VAL
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-CS-IOC-01:1:STATUS
record(mbbo,"FE14I-CS-IOC-01:1:STATUS") {
	field(DTYP,"Soft Channel")
	field(NOBT,"3")
	field(ONVL,"1")
	field(TWVL,"2")
	field(THVL,"3")
	field(FRVL,"4")
	field(ZRST,"No Status")
	field(ONST,"Failure")
	field(TWST,"Warning")
	field(THST,"Seq Fail")
	field(FRST,"Ok")
	field(ONSV, "MAJOR")
	field(TWSV, "MINOR")
	field(THSV, "MINOR")
}
record(stringout,"FE14I-CS-IOC-01:1:STATUSST") {
	field(DTYP,"Soft Channel")
	field(VAL,"Status unknown")
}
record(stringout,"FE14I-CS-IOC-01:1:TIME") {
	field(DTYP,"Soft Channel")
	field(VAL,"Not yet saved")
}
record(stringout,"FE14I-CS-IOC-01:2:NAME") {
	field(VAL,"Not In Use")
	field(DTYP,"Soft Channel")
}
record(longout,"FE14I-CS-IOC-01:2:STATE") {
	field(DTYP,"Soft Channel")
}

#% archiver 10 Monitor VAL
#% None $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-CS-IOC-01:2:STATUS
record(mbbo,"FE14I-CS-IOC-01:2:STATUS") {
	field(DTYP,"Soft Channel")
	field(NOBT,"3")
	field(ONVL,"1")
	field(TWVL,"2")
	field(THVL,"3")
	field(FRVL,"4")
	field(ZRST,"No Status")
	field(ONST,"Failure")
	field(TWST,"Warning")
	field(THST,"Seq Fail")
	field(FRST,"Ok")
	field(ONSV, "MAJOR")
	field(TWSV, "MINOR")
	field(THSV, "MINOR")
}
record(stringout,"FE14I-CS-IOC-01:2:STATUSST") {
	field(DTYP,"Soft Channel")
	field(VAL,"Status unknown")
}
record(stringout,"FE14I-CS-IOC-01:2:TIME") {
	field(DTYP,"Soft Channel")
	field(VAL,"Not yet saved")
}
# FINS default template
#
# % macro, __doc__, This template provides some basic CPU information
#
# Macros:
# % macro, device, record device name
# % macro, port, asyn port name
# % macro, etn, PLC Ethernet module address (Default = 0x10)

#---------------------------------------------------------------------------------------------------

# address 0x00 is the CPU

record(waveform, "FE14I-VA-VLVCC-01:MODEL:CPU")
{
	field(DTYP, "asynOctetRead")
	field(INP,  "@asyn(vlvcc_fins_port, 0x00, 0) FINS_MODEL")
	field(NELM, "20")
	field(FTVL, "CHAR")
	field(PINI, "YES")
}

# address 0x10 is the first CPU bus unit
# address 0x11 is the second CPU bus unit

record(waveform, "FE14I-VA-VLVCC-01:MODEL:ETN")
{
	field(DTYP, "asynOctetRead")
	field(INP,  "@asyn(vlvcc_fins_port, 0x10, 0) FINS_MODEL")
	field(NELM, "20")
	field(FTVL, "CHAR")
	field(PINI, "YES")
}

#---------------------------------------------------------------------------------------------------

record(ai, "FE14I-VA-VLVCC-01:CPU:MODE")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CPU_MODE")
	field(SCAN, "2 second")

	field(FLNK, "FE14I-VA-VLVCC-01:MODE")
}

# 00 Program, 02 Monitor, 04 Run

record(mbbi, "FE14I-VA-VLVCC-01:MODE")
{
	field(DTYP, "Raw Soft Channel")
	field(ZRVL, "0")
	field(TWVL, "2")
	field(FRVL, "4")
	field(ZRST, "Program")
	field(ZRSV, "MAJOR")
	field(TWST, "Monitor")
	field(TWSV, "NO_ALARM")
	field(FRST, "Run")
	field(FRSV, "MINOR")
	field(NOBT, "3")
	field(INP,  "FE14I-VA-VLVCC-01:CPU:MODE MS")
}

record(ai, "FE14I-VA-VLVCC-01:CPU:STATUS")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CPU_STATUS")
	field(SCAN, "10 second")
}

#---------------------------------------------------------------------------------------------------

# cycle times

record(waveform, "FE14I-VA-VLVCC-01:CYCLE")
{
	field(DTYP, "asynInt32ArrayIn")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CYCLE_TIME")
	field(SCAN, "10 second")
	field(FTVL, "ULONG")
	field(NELM, "3")
}

record(subArray, "FE14I-VA-VLVCC-01:CYCLE:SUB0")
{
	field(INP,  "FE14I-VA-VLVCC-01:CYCLE MS CP")
	field(INDX, "0")
	field(MALM, "3")
	field(NELM, "1")
	field(FTVL, "ULONG")

	field(FLNK, "FE14I-VA-VLVCC-01:CYCLE:MEAN")
}

record(ai, "FE14I-VA-VLVCC-01:CYCLE:MEAN")
{
	field(DTYP, "Raw Soft Channel")
	field(INP,  "FE14I-VA-VLVCC-01:CYCLE:SUB0 MS")
	field(ASLO, "0.1")
	field(HOPR, "5")
	field(LOPR, "0")
	field(EGU,  "ms")
	field(PREC, "1")
}

record(subArray, "FE14I-VA-VLVCC-01:CYCLE:SUB1")
{
	field(INP,  "FE14I-VA-VLVCC-01:CYCLE MS CP")
	field(INDX, "1")
	field(MALM, "3")
	field(NELM, "1")
	field(FTVL, "ULONG")

	field(FLNK, "FE14I-VA-VLVCC-01:CYCLE:MAX")
}

record(ai, "FE14I-VA-VLVCC-01:CYCLE:MAX")
{
	field(DTYP, "Raw Soft Channel")
	field(INP,  "FE14I-VA-VLVCC-01:CYCLE:SUB1 MS")
	field(ASLO, "0.1")
	field(HOPR, "5")
	field(LOPR, "0")
	field(EGU,  "ms")
	field(PREC, "1")
}

record(subArray, "FE14I-VA-VLVCC-01:CYCLE:SUB2")
{
	field(INP,  "FE14I-VA-VLVCC-01:CYCLE MS CP")
	field(INDX, "2")
	field(MALM, "3")
	field(NELM, "1")
	field(FTVL, "ULONG")

	field(FLNK, "FE14I-VA-VLVCC-01:CYCLE:MIN")
}

record(ai, "FE14I-VA-VLVCC-01:CYCLE:MIN")
{
	field(DTYP, "Raw Soft Channel")
	field(INP,  "FE14I-VA-VLVCC-01:CYCLE:SUB2 MS")
	field(ASLO, "0.1")
	field(HOPR, "5")
	field(LOPR, "0")
	field(EGU,  "ms")
	field(PREC, "1")
}

#record(ai, "FE14I-VA-VLVCC-01:CYCLE:MEAN")
#{
#	field(DTYP, "asynInt32")
#	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CYCLE_TIME_MEAN")
#	field(ASLO, "0.1")
#	field(PREC, "1")
#	field(EGU,  "ms")
#	field(HOPR, "5")
#	field(LOPR, "0")
#	field(DESC, "CPU mean cycle time")
#	field(SCAN, "10 second")

#	field(FLNK, "FE14I-VA-VLVCC-01:CYCLE:MAX")
#}

#record(ai, "FE14I-VA-VLVCC-01:CYCLE:MAX")
#{
#	field(DTYP, "asynInt32")
#	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CYCLE_TIME_MAX")
#	field(ASLO, "0.1")
#	field(PREC, "1")
#	field(EGU,  "ms")
#	field(HOPR, "5")
#	field(LOPR, "0")
#	field(DESC, "CPU max cycle time")

#	field(FLNK, "FE14I-VA-VLVCC-01:CYCLE:MIN")
#}

#record(ai, "FE14I-VA-VLVCC-01:CYCLE:MIN")
#{
#	field(DTYP, "asynInt32")
#	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CYCLE_TIME_MIN")
#	field(ASLO, "0.1")
#	field(PREC, "1")
#	field(EGU,  "ms")
#	field(HOPR, "5")
#	field(LOPR, "0")
#	field(DESC, "CPU min cycle time")
#}

record(waveform, "FE14I-VA-VLVCC-01:CYCLE:RESET")
{
	field(DTYP, "asynOctetWrite")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CYCLE_TIME_RESET")
	field(NELM, "2")
	field(FTVL, "UCHAR")
}

#---------------------------------------------------------------------------------------------------

record(ai, "FE14I-VA-VLVCC-01:AR336")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 336, 0) FINS_AR_READ")
	field(PINI, "YES")
}

# A510 & 511 start up
# A512 & 513 power interruption time 
# W339 section 9-16

record(ai, "FE14I-VA-VLVCC-01:AR510")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 510, 0) FINS_AR_READ")
	field(PINI, "YES")
	field(SCAN, "10 second")
}

record(ai, "FE14I-VA-VLVCC-01:AR511")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 511, 0) FINS_AR_READ")
	field(PINI, "YES")
	field(SCAN, "10 second")
}

record(ai, "FE14I-VA-VLVCC-01:AR514")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 514, 0) FINS_AR_READ")
	field(PINI, "YES")
	field(SCAN, "10 second")
}

record(ai, "FE14I-VA-VLVCC-01:AR523")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 523, 0) FINS_AR_READ")
	field(PINI, "YES")
	field(SCAN, "10 second")
}

#---------------------------------------------------------------------------------------------------

record(calc, "FE14I-VA-VLVCC-01:UNITS")
{
	field(INPA, "FE14I-VA-VLVCC-01:AR336 MS CP")
	field(DESC, "I/O Units")
	field(HOPR, "10")
	field(LOPR, "0")
	field(CALC, "A&15")
}

record(longin, "FE14I-VA-VLVCC-01:POWERINTS")
{
	field(INP,  "FE14I-VA-VLVCC-01:AR514 MS CP")
	field(DESC, "Power Cycles")
	field(HOPR, "1000")
	field(LOPR, "0")
}

record(ai, "FE14I-VA-VLVCC-01:POWERON")
{
	field(DTYP, "Raw Soft Channel")
	field(INP,  "FE14I-VA-VLVCC-01:AR523 MS CP")
	field(DESC, "Power On Time")
	field(EGU,  "hours")
	field(HOPR, "10000")
	field(LOPR, "0")
	field(ASLO, "10")
}

#---------------------------------------------------------------------------------------------------

# BCD - display as Hex

record(calc, "FE14I-VA-VLVCC-01:START:SECS")
{
	field(INPA, "FE14I-VA-VLVCC-01:AR510 MS CP")
	field(CALC, "(A&0x00ff) >> 0")
}

record(calc, "FE14I-VA-VLVCC-01:START:MINS")
{
	field(INPA, "FE14I-VA-VLVCC-01:AR510 MS CP")
	field(CALC, "(A&0xff00) >> 8")
}

record(calc, "FE14I-VA-VLVCC-01:START:HOUR")
{
	field(INPA, "FE14I-VA-VLVCC-01:AR511 MS CP")
	field(CALC, "(A&0x00ff) >> 0")
}

record(calc, "FE14I-VA-VLVCC-01:START:DAYS")
{
	field(INPA, "FE14I-VA-VLVCC-01:AR511 MS CP")
	field(CALC, "(A&0xff00) >> 8")
}

#---------------------------------------------------------------------------------------------------

record(waveform, "FE14I-VA-VLVCC-01:CLOCK")
{
	field(DTYP, "asynInt16ArrayIn")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CLOCK_READ")
	field(NELM, "7")
	field(FTVL, "SHORT")
	field(SCAN, "10 second")
}

record(subArray, "FE14I-VA-VLVCC-01:CLOCK:YEAR")
{
	field(INP,  "FE14I-VA-VLVCC-01:CLOCK MS CP")
	field(INDX, "0")
	field(MALM, "7")
	field(NELM, "1")
	field(FTVL, "SHORT")
}

record(subArray, "FE14I-VA-VLVCC-01:CLOCK:MON")
{
	field(INP,  "FE14I-VA-VLVCC-01:CLOCK MS CP")
	field(INDX, "1")
	field(MALM, "7")
	field(NELM, "1")
	field(FTVL, "SHORT")
}

record(subArray, "FE14I-VA-VLVCC-01:CLOCK:DAY")
{
	field(INP,  "FE14I-VA-VLVCC-01:CLOCK MS CP")
	field(INDX, "2")
	field(MALM, "7")
	field(NELM, "1")
	field(FTVL, "SHORT")
}

record(subArray, "FE14I-VA-VLVCC-01:CLOCK:HOUR")
{
	field(INP,  "FE14I-VA-VLVCC-01:CLOCK MS CP")
	field(INDX, "3")
	field(MALM, "7")
	field(NELM, "1")
	field(FTVL, "SHORT")
}

record(subArray, "FE14I-VA-VLVCC-01:CLOCK:MIN")
{
	field(INP,  "FE14I-VA-VLVCC-01:CLOCK MS CP")
	field(INDX, "4")
	field(MALM, "7")
	field(NELM, "1")
	field(FTVL, "SHORT")
}

record(subArray, "FE14I-VA-VLVCC-01:CLOCK:SEC")
{
	field(INP,  "FE14I-VA-VLVCC-01:CLOCK MS CP")
	field(INDX, "5")
	field(MALM, "7")
	field(NELM, "1")
	field(FTVL, "SHORT")
}

#---------------------------------------------------------------------------------------------------

record(ai, "FE14I-VA-VLVCC-01:CPU:FATAL:0601")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CPU_FATAL")
	field(SCAN, "10 second")
}

record(ai, "FE14I-VA-VLVCC-01:CPU:NONFATAL:0601")
{
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_CPU_NONFATAL")
	field(SCAN, "10 second")
}

# 6 - FALS
# 8 - Cycle time
# 9 - Program
# A - I/O setting
# B - I/O point
# C - Inner board
# D - Duplication
# E - I/O bus
# F - Memory

record(mbbiDirect, "FE14I-VA-VLVCC-01:CPU:FATAL")
{
	field(DESC, "CPU Fatal Errors")
	field(INP,  "FE14I-VA-VLVCC-01:CPU:FATAL:0601 MS CP")
	field(NOBT, "16")
}

# 2 - Special I/O unit setting
# 3 - CS1 CPU bus unit setting
# 4 - Battery
# 5 - SYSMAC BUS
# 6 - Special I/O
# 7 - CPU bus unit
# 8 - Inner board
# 9 - I/O verification
# A - PC setup
# C - Basic I/O
# D - Interrupt task
# F - FAL

record(mbbiDirect, "FE14I-VA-VLVCC-01:CPU:NONFATAL")
{
	field(DESC, "CPU Non Fatal Errors")
	field(INP,  "FE14I-VA-VLVCC-01:CPU:NONFATAL:0601 MS CP")
	field(NOBT, "16")
}

#---------------------------------------------------------------------------------------------------

record(waveform, "FE14I-VA-VLVCC-01:DMREAD00")
{
	field(DTYP, "asynInt16ArrayIn")
	field(INP,  "@asyn(vlvcc_fins_port, 0x00, 5) FINS_DM_READ")
	field(NELM, "3")
	field(FTVL, "SHORT")
	field(PINI, "YES")
	
	field(FLNK, "FE14I-VA-VLVCC-01:SERIALID")
}

#---------------------------------------------------------------------------------------------------

record(subArray, "FE14I-VA-VLVCC-01:SERIALID")
{
	field(DESC, "DLS Serial number")
	field(INP,  "FE14I-VA-VLVCC-01:DMREAD00 MS")
	field(INDX, "0")
	field(MALM, "3")
	field(NELM, "1")
	field(FTVL, "SHORT")
	
	field(FLNK, "FE14I-VA-VLVCC-01:SOFTWARE")
}

record(subArray, "FE14I-VA-VLVCC-01:SOFTWARE")
{
	field(DESC, "Software version")
	field(INP,  "FE14I-VA-VLVCC-01:DMREAD00 MS")
	field(INDX, "1")
	field(MALM, "3")
	field(NELM, "1")
	field(FTVL, "SHORT")
	
	field(FLNK, "FE14I-VA-VLVCC-01:SOFTMOD")
}

record(calc, "FE14I-VA-VLVCC-01:SOFTMOD")
{
	field(INPA, "FE14I-VA-VLVCC-01:SOFTWARE MS")
	field(CALC, "A >> 12")
	
	field(FLNK, "FE14I-VA-VLVCC-01:REVISION")
}

record(subArray, "FE14I-VA-VLVCC-01:REVISION")
{
	field(DESC, "Software revision")
	field(INP,  "FE14I-VA-VLVCC-01:DMREAD00 MS")
	field(INDX, "2")
	field(MALM, "3")
	field(NELM, "1")
	field(FTVL, "SHORT")
	
	field(FLNK, "FE14I-VA-VLVCC-01:PLCTYPE")
}

record(mbbi, "FE14I-VA-VLVCC-01:PLCTYPE")
{
	field(DTYP, "Raw Soft Channel")
	field(NOBT, "4")
	field(INP,  "FE14I-VA-VLVCC-01:SOFTMOD MS")
	field(ZRVL, "0")
	field(ONVL, "1")
	field(TWVL, "2")
	field(THVL, "3")
	field(FRVL, "4")
	field(FVVL, "5")
	field(SXVL, "6")
	field(SVVL, "7")
	field(EIVL, "8")
	field(ZRST, "Invalid")
	field(ONST, "Linac")
	field(TWST, "Machine Prot")
	field(THST, "Gas Brem")
	field(FRST, "Vac Four Valve")
	field(FVST, "Undefined")
	field(SXST, "Vac Six Valve")
	field(SVST, "Vacuum Cart")
	field(EIST, "Temperature")
	field(ZRSV, "MINOR")
	field(ONSV, "NO_ALARM")
	field(TWSV, "NO_ALARM")
	field(THSV, "NO_ALARM")
	field(FRSV, "NO_ALARM")
	field(FVSV, "MINOR")
	field(SXSV, "NO_ALARM")
	field(SVST, "NO_ALARM")
	field(EIST, "NO_ALARM")
	field(UNSV, "MINOR")
}

#---------------------------------------------------------------------------------------------------

record(bo, "FE14I-VA-VLVCC-01:FORCE:RESET")
{
	field(DESC, "Clear all forced bits")
	field(DTYP, "asynInt32")
	field(OUT,  "@asyn(vlvcc_fins_port, 0, 0) FINS_SET_RESET_CANCEL")
	field(HIGH, "0.1")
}

#---------------------------------------------------------------------------------------------------

record(longin, "FE14I-VA-VLVCC-01:ECHOTEST")
{
	field(DESC, "PLC returns nodes number")
	field(DTYP, "asynInt32")
	field(INP,  "@asyn(vlvcc_fins_port, 0, 0) FINS_ECHO_TEST")
}
#! Generated by VisualDCT v2.6

# Template to provide beamline control of FE vacuum components
# through a read/write gateway.
# % macro, BEAMLINE, Beamline number, (e.g. 11I)
# % macro, ABSB, Absorber number (normally 01 or 02). Default is 02.

# This record is written to directly from the beamline
# % archiver 300 Monitor
record(mbbo, "FE14I-CS-BEAM-01:BLCON") {
  field(DESC, "Beamline Permit Beam Control")
  field(OUT, "FE14I-CS-BEAM-01:IFCON.A PP")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Abort")
  field(VAL, "3")
  field(THST, "Unknown")
  field(FLNK, "FE14I-CS-BEAM-01:SETBUSY")
  field(PINI, "YES")
}

record(calcout, "FE14I-CS-BEAM-01:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-CS-BEAM-01:BUSY.VAL PP NMS")
  field(FLNK, "FE14I-CS-BEAM-01:DONECALC")
}

# Sets the busy record back to 'done' when the operation is complete
record(calcout, "FE14I-CS-BEAM-01:DONECALC") {
  field(INPA, "FE14I-CS-BEAM-01:STS CPP")
  field(CALC, "A>>31")
  field(OOPT, "Transition To Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-CS-BEAM-01:BUSY.VAL CA NMS")
}

# Use a busy record so that the beamline will get a callback
record(busy, "FE14I-CS-BEAM-01:BUSY") {
}

record(mbbi, "FE14I-CS-BEAM-01:STA") {
  field(INP, "FE14I-CS-BEAM-01:PATH CPP MS")
  field(ZRST, "Fault")
  field(ONST, "Open")
  field(TWST, "Opening")
  field(THST, "Closed")
  field(FRST, "Closing")
}

# This record is written to directly from the beamline
# % archiver 300 Monitor
record(mbbo, "FE14I-RS-ABSB-01:BLCON") {
  field(DESC, "Beamline Absorber Control")
  field(OUT, "FE14I-RS-ABSB-01:IFCON.A PP")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Reset")
  field(VAL, "3")
  field(THST, "Unknown")
  field(FLNK, "FE14I-RS-ABSB-01:SETBUSY")
}

record(calcout, "FE14I-RS-ABSB-01:SETBUSY") {
  field(CALC, "1")
  field(OUT, "FE14I-RS-ABSB-01:BUSY PP NMS")
  field(FLNK, "FE14I-RS-ABSB-01:DONECALC")
}

# Use a busy record so that the beamline will get a callback
record(busy, "FE14I-RS-ABSB-01:BUSY") {
}

# Sets the busy record back to 'done' when the operation is complete
record(calcout, "FE14I-RS-ABSB-01:DONECALC") {
  field(INPA, "FE14I-RS-ABSB-01:BLCON MS")
  field(INPB, "FE14I-RS-ABSB-01:STA CPP MS")
  field(INPC, "FE14I-RS-ABSB-01:ILKSTA CPP MS")
  field(INPD, "FE14I-RS-ABSB-01:LASTCON CPP MS")
  field(CALC, "((A=D)&(((A*2+1)=B)|A=2|C=0))?0:1")
  field(OOPT, "When Zero")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-RS-ABSB-01:BUSY CA NMS")
}

record(bo, "FE14I-VA-GROUP-01:BLENABLE") {
  field(DESC, "BL control enable switch")
  field(ZNAM, "BL control enabled")
  field(ONAM, "BL control disabled")
  field(VAL, "1")
}

# % archiver 300 Monitor
# Don't output on initial 'unknown' state 3
record(calcout, "FE14I-RS-ABSB-01:IFCON") {
  field(DESC, "Beamline Absorber Interface")
  field(CALC, "A=3")
  field(OUT, "FE14I-RS-ABSB-01:CON PP")
  field(OOPT, "When Zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A")
  field(SDIS, "FE14I-VA-GROUP-01:BLENABLE")
}

# % archiver 300 Monitor
record(calcout, "FE14I-CS-BEAM-01:IFCON") {
  field(DESC, "Permit Beam Interface")
  field(CALC, "A=3")
  field(OUT, "FE14I-CS-BEAM-01:CTL PP")
  field(OOPT, "When Zero")
  field(DOPT, "Use OCAL")
  field(OCAL, "A+1")
  field(SDIS, "FE14I-VA-GROUP-01:BLENABLE")
}

#! Further lines contain data used by VisualDCT
#! View(1278,2553,1.7)
#! Record("FE14I-CS-BEAM-01:BLCON",1020,1156,0,1,"FE14I-CS-BEAM-01:BLCON")
#! Field("FE14I-CS-BEAM-01:BLCON.OUT",16777215,0,"FE14I-CS-BEAM-01:BLCON.OUT")
#! Link("FE14I-CS-BEAM-01:BLCON.OUT","FE14I-CS-BEAM-01:IFCON.A")
#! Field("FE14I-CS-BEAM-01:BLCON.FLNK",16777215,1,"FE14I-CS-BEAM-01:BLCON.FLNK")
#! Link("FE14I-CS-BEAM-01:BLCON.FLNK","FE14I-CS-BEAM-01:SETBUSY")
#! Record("FE14I-CS-BEAM-01:SETBUSY",1320,1321,0,0,"FE14I-CS-BEAM-01:SETBUSY")
#! Field("FE14I-CS-BEAM-01:SETBUSY.OUT",16777215,1,"FE14I-CS-BEAM-01:SETBUSY.OUT")
#! Link("FE14I-CS-BEAM-01:SETBUSY.OUT","FE14I-CS-BEAM-01:BUSY.VAL")
#! Field("FE14I-CS-BEAM-01:SETBUSY.FLNK",16777215,1,"FE14I-CS-BEAM-01:SETBUSY.FLNK")
#! Link("FE14I-CS-BEAM-01:SETBUSY.FLNK","FE14I-CS-BEAM-01:DONECALC")
#! Record("FE14I-CS-BEAM-01:DONECALC",1580,1433,0,0,"FE14I-CS-BEAM-01:DONECALC")
#! Field("FE14I-CS-BEAM-01:DONECALC.INPA",16777215,1,"FE14I-CS-BEAM-01:DONECALC.INPA")
#! Field("FE14I-CS-BEAM-01:DONECALC.OUT",16777215,1,"FE14I-CS-BEAM-01:DONECALC.OUT")
#! Link("FE14I-CS-BEAM-01:DONECALC.OUT","FE14I-CS-BEAM-01:BUSY.VAL")
#! Record("FE14I-CS-BEAM-01:BUSY",1600,1303,0,1,"FE14I-CS-BEAM-01:BUSY")
#! Field("FE14I-CS-BEAM-01:BUSY.VAL",16777215,1,"FE14I-CS-BEAM-01:BUSY.VAL")
#! Record("FE14I-CS-BEAM-01:STA",1900,1379,0,1,"FE14I-CS-BEAM-01:STA")
#! Field("FE14I-CS-BEAM-01:STA.INP",16777215,1,"FE14I-CS-BEAM-01:STA.INP")
#! Record("FE14I-RS-ABSB-01:BLCON",1600,1690,0,1,"FE14I-RS-ABSB-01:BLCON")
#! Field("FE14I-RS-ABSB-01:BLCON.OUT",16777215,0,"FE14I-RS-ABSB-01:BLCON.OUT")
#! Link("FE14I-RS-ABSB-01:BLCON.OUT","FE14I-RS-ABSB-01:IFCON.A")
#! Field("FE14I-RS-ABSB-01:BLCON.FLNK",16777215,1,"FE14I-RS-ABSB-01:BLCON.FLNK")
#! Link("FE14I-RS-ABSB-01:BLCON.FLNK","FE14I-RS-ABSB-01:SETBUSY")
#! Field("FE14I-RS-ABSB-01:BLCON.VAL",16777215,0,"FE14I-RS-ABSB-01:BLCON.VAL")
#! Record("FE14I-RS-ABSB-01:SETBUSY",1880,1841,0,0,"FE14I-RS-ABSB-01:SETBUSY")
#! Field("FE14I-RS-ABSB-01:SETBUSY.OUT",16777215,1,"FE14I-RS-ABSB-01:SETBUSY.OUT")
#! Link("FE14I-RS-ABSB-01:SETBUSY.OUT","FE14I-RS-ABSB-01:BUSY.VAL")
#! Field("FE14I-RS-ABSB-01:SETBUSY.FLNK",16777215,0,"FE14I-RS-ABSB-01:SETBUSY.FLNK")
#! Link("FE14I-RS-ABSB-01:SETBUSY.FLNK","FE14I-RS-ABSB-01:DONECALC")
#! Record("FE14I-RS-ABSB-01:BUSY",2160,2083,0,1,"FE14I-RS-ABSB-01:BUSY")
#! Field("FE14I-RS-ABSB-01:BUSY.VAL",16777215,0,"FE14I-RS-ABSB-01:BUSY.VAL")
#! Record("FE14I-RS-ABSB-01:DONECALC",1620,2090,0,1,"FE14I-RS-ABSB-01:DONECALC")
#! Field("FE14I-RS-ABSB-01:DONECALC.INPA",16777215,0,"FE14I-RS-ABSB-01:DONECALC.INPA")
#! Link("FE14I-RS-ABSB-01:DONECALC.INPA","FE14I-RS-ABSB-01:BLCON.VAL")
#! Field("FE14I-RS-ABSB-01:DONECALC.INPB",16777215,1,"FE14I-RS-ABSB-01:DONECALC.INPB")
#! Field("FE14I-RS-ABSB-01:DONECALC.INPC",16777215,1,"FE14I-RS-ABSB-01:DONECALC.INPC")
#! Field("FE14I-RS-ABSB-01:DONECALC.INPD",16777215,1,"FE14I-RS-ABSB-01:DONECALC.INPD")
#! Field("FE14I-RS-ABSB-01:DONECALC.OUT",16777215,1,"FE14I-RS-ABSB-01:DONECALC.OUT")
#! Link("FE14I-RS-ABSB-01:DONECALC.OUT","FE14I-RS-ABSB-01:BUSY.VAL")
#! Record("FE14I-VA-GROUP-01:BLENABLE",1020,1707,0,1,"FE14I-VA-GROUP-01:BLENABLE")
#! Field("FE14I-VA-GROUP-01:BLENABLE.VAL",16777215,1,"FE14I-VA-GROUP-01:BLENABLE.VAL")
#! Record("FE14I-RS-ABSB-01:IFCON",1300,1785,0,1,"FE14I-RS-ABSB-01:IFCON")
#! Field("FE14I-RS-ABSB-01:IFCON.OUT",16777215,1,"FE14I-RS-ABSB-01:IFCON.OUT")
#! Field("FE14I-RS-ABSB-01:IFCON.SDIS",16777215,0,"FE14I-RS-ABSB-01:IFCON.SDIS")
#! Link("FE14I-RS-ABSB-01:IFCON.SDIS","FE14I-VA-GROUP-01:BLENABLE.VAL")
#! Field("FE14I-RS-ABSB-01:IFCON.A",16777215,1,"FE14I-RS-ABSB-01:IFCON.A")
#! Record("FE14I-CS-BEAM-01:IFCON",740,1185,0,1,"FE14I-CS-BEAM-01:IFCON")
#! Field("FE14I-CS-BEAM-01:IFCON.A",16777215,1,"FE14I-CS-BEAM-01:IFCON.A")
#! Field("FE14I-CS-BEAM-01:IFCON.OUT",16777215,1,"FE14I-CS-BEAM-01:IFCON.OUT")
#! Field("FE14I-CS-BEAM-01:IFCON.SDIS",16777215,1,"FE14I-CS-BEAM-01:IFCON.SDIS")
#! Link("FE14I-CS-BEAM-01:IFCON.SDIS","FE14I-VA-GROUP-01:BLENABLE.VAL")
#
# Standard digital input schema for Insertion Device Front Ends
#
# $Author: ig43 $
# $Date: 2010-02-25 08:34:09 +0000 (Thu, 25 Feb 2010) $
# $Id: dig.template 41755 2010-02-25 08:34:09Z ig43 $
# $Name: post_review_2 $
# $Revision: 41755 $
# % macro,device, Front-end identifier 
#% archiver 3600 Monitor
record(bi,"FE14I-CS-FANC-01:FANALM")
	{
	field(DESC,"Rack fan alarm")
	field(SCAN,"1 second")
	field(DTYP,"Soft Channel")
	field(INP,"FE14I-VA-VLVCC-01:D4IN1")
	field(ZNAM,"FAIL")
	field(ONAM,"HEALTHY")
	field(ZSV,"MAJOR")
	}

#
# Note that water flow status is received on digital input
# 0 -> no flow (alarm state)
# 1 -> flow OK (not alarm state)
#

#% archiver 3600 Monitor
record(bi,"FE14I-CS-PSU-01:STATUS")
    {
    field(DESC,"Server PSU Status")
    field(SCAN,"1 second")
    field(DTYP,"Soft Channel")
    field(INP,"FE14I-VA-VLVCC-01:D4IN0")
    field(ZNAM,"FAIL")
    field(ONAM,"HEALTHY")
    field(ZSV,"MAJOR")
    }

#% archiver 3600 Monitor
record(bi,"FE14I-AL-APTR-02:H2OALM01")
	{
	field(DESC,"Water flow alarm")
	field(SCAN,".1 second")
	field(DTYP,"Soft Channel")
    field(INP,"FE14I-VA-VLVCC-01:D4IN10")
	field(ZNAM,"On")
	field(ONAM,"Off")
	field(ZSV,"MAJOR")
	}

#% archiver 3600 Monitor
record(bi,"FE14I-RS-ABSB-01:H2OALM01")
	{
	field(DESC,"Water flow alarm")
	field(SCAN,".1 second")
	field(DTYP,"Soft Channel")
    field(INP,"FE14I-VA-VLVCC-01:D4IN6")
	field(ZNAM,"On")
	field(ONAM,"Off")
	field(ZSV,"MAJOR")
	}

#% archiver 3600 Monitor
record(bi,"FE14I-DI-PBPM-01:H2OALM01")
	{
	field(DESC,"Water flow alarm")
	field(SCAN,".1 second")
	field(DTYP,"Soft Channel")
    field(INP,"FE14I-VA-VLVCC-01:D4IN4")
	field(ZNAM,"On")
	field(ONAM,"Off")
	field(ZSV,"MAJOR")
	}


#% archiver 3600 Monitor
record(bi,"FE14I-DI-PBPM-02:H2OALM01")
	{
	field(DESC,"Water flow alarm")
	field(SCAN,".1 second")
	field(DTYP,"Soft Channel")
    field(INP,"FE14I-VA-VLVCC-01:D4IN8")
	field(ZNAM,"On")
	field(ONAM,"Off")
	field(ZSV,"MAJOR")
	}

record(calc,"FE14I-DI-PBPM-01:CALCTMPALM01")
    {
    field(DESC,"Temperature alarm")
    field(SCAN,"Passive")
    field(INPA,"FE14I-DI-PBPM-01:TMON01:C.SEVR")
    field(CALC,"A > 0")
    }

#% archiver 3600 Monitor
record(bi,"FE14I-DI-PBPM-01:TMPALM01")
	{
	field(DESC,"Temperature alarm")
	field(SCAN,".1 second")
	field(DTYP,"Soft Channel")
	field(INP,"FE14I-DI-PBPM-01:CALCTMPALM01 PP MS")
	field(ZNAM,"Off")
	field(ONAM,"On")
	field(OSV,"MAJOR")
	field(FLNK,"FE14I-DI-PBPM-01:TMPALM02")
	}


record(calc,"FE14I-DI-PBPM-01:CALCTMPALM02")
    {
    field(DESC,"Temperature alarm")
    field(SCAN,"Passive")
    field(INPA,"FE14I-DI-PBPM-01:TMON02:C.SEVR")
    field(CALC,"A > 0")
    }

#% archiver 3600 Monitor
record(bi,"FE14I-DI-PBPM-01:TMPALM02")
	{
	field(DESC,"Temperature alarm")
	field(SCAN,".1 second")
	field(DTYP,"Soft Channel")
    field(INP,"FE14I-DI-PBPM-01:CALCTMPALM02 PP MS")
    field(ZNAM,"Off")
    field(ONAM,"On")
    field(OSV,"MAJOR")
	field(FLNK,"FE14I-DI-PBPM-02:TMPALM01")
	}

record(calc,"FE14I-DI-PBPM-02:CALCTMPALM01")
    {
    field(DESC,"Temperature alarm")
    field(SCAN,"Passive")
    field(INPA,"FE14I-DI-PBPM-02:TMON01:C.SEVR")
    field(CALC,"A > 0")
    }

#% archiver 3600 Monitor
record(bi,"FE14I-DI-PBPM-02:TMPALM01")
	{
	field(DESC,"Temperature alarm")
	field(DTYP,"Soft Channel")
    field(INP,"FE14I-DI-PBPM-02:CALCTMPALM01 PP MS")
    field(ZNAM,"Off")
    field(ONAM,"On")
    field(OSV,"MAJOR")
	field(FLNK,"FE14I-DI-PBPM-02:TMPALM02")
	}

record(calc,"FE14I-DI-PBPM-02:CALCTMPALM02")
    {
    field(DESC,"Temperature alarm")
    field(SCAN,"Passive")
    field(INPA,"FE14I-DI-PBPM-02:TMON02:C.SEVR")
    field(CALC,"A > 0")
    }

#% archiver 3600 Monitor
record(bi,"FE14I-DI-PBPM-02:TMPALM02")
	{
	field(DESC,"Temperature alarm")
	field(DTYP,"Soft Channel")
    field(INP,"FE14I-DI-PBPM-02:CALCTMPALM02 PP MS")
    field(ZNAM,"Off")
    field(ONAM,"On")
    field(OSV,"MAJOR")
	}

# % macro, name, name for gui elements
# % macro, EDM_FILE, edm screen, defaults to ioc_stats_softdls.edl
# % macro, IOC, ioc name

# % gui, None, edm, ioc_stats_softdls.edl, ioc=FE14I-CS-IOC-01
# % gui, None, edmembed, ioc_embed.edl, ioc=FE14I-CS-IOC-01,EDM_FILE=ioc_stats_softdls.edl



# This associates BOY screens with the template
# % gui, None, boydetail, devIocStatsApp_opi/iocStats_detail.opi, desc=FE14I-CS-IOC-01, IOC=FE14I-CS-IOC-01, name=None
# % gui, None, boyembed, devIocStatsApp_opi/iocStats_embed.opi, desc=FE14I-CS-IOC-01,  IOC=FE14I-CS-IOC-01, name=None
# % gui, None, boyembed, devIocStatsApp_opi/iocStats_embed_box.opi, desc=FE14I-CS-IOC-01,  IOC=FE14I-CS-IOC-01, name=None

# These define what PVs a detail screen should contain
# % gui, None, readback, Startup Time,FE14I-CS-IOC-01:STARTOD
# % gui, None, readback, Current Time,FE14I-CS-IOC-01:TOD
# % gui, None, readback, Up Time,FE14I-CS-IOC-01:UPTIME
# % gui, None, readback, Heartbeat,FE14I-CS-IOC-01:HEARTBEAT
# % gui, None, readback, Records,FE14I-CS-IOC-01:RECORD_CNT
# % gui, None, readback, Host Name,FE14I-CS-IOC-01:HOSTNAME
# % gui, None, readback, User Name,FE14I-CS-IOC-01:ENGINEER
# % gui, None, readback, Location,FE14I-CS-IOC-01:LOCATION
# % gui, None, readback, CA Clients,FE14I-CS-IOC-01:CA_CLNT_CNT
# % gui, None, readback, CA PV Conns,FE14I-CS-IOC-01:CA_CONN_CNT
# % gui, None, readback, Susp Tasks,FE14I-CS-IOC-01:SUSP_TASK_CNT
# % gui, None, readback, EPICS Version,FE14I-CS-IOC-01:EPICS_VERS
# % gui, None, readback, OS Version,FE14I-CS-IOC-01:KERNEL_VERS
# % gui, None, readback, Application Directory,FE14I-CS-IOC-01:APP_DIR1
# % gui, None, readback, Startup Script,FE14I-CS-IOC-01:ST_SCRIPT1
# % gui, None, readback, Memory Free,FE14I-CS-IOC-01:MEM_FREE
# % gui, None, readback, Memory Used,FE14I-CS-IOC-01:MEM_USED
# % gui, None, readback, Memory Max,FE14I-CS-IOC-01:MEM_MAX
# % gui, None, readback, File Handles Free,FE14I-CS-IOC-01:FD_FREE
# % gui, None, readback, File Handles Max,FE14I-CS-IOC-01:FD_MAX
# % gui, None, readback, IOC CPU Load,FE14I-CS-IOC-01:IOC_CPU_LOAD
# % gui, None, readback, All CPUs Load,FE14I-CS-IOC-01:SYS_CPU_LOAD
# % gui, None, readback, System CPUs,FE14I-CS-IOC-01:CPU_CNT

#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

# Used by Channel Access Security to determine access to this IOC.
record(mbbo, "FE14I-CS-IOC-01:ACCESS")
{
  field(DESC, "FE14I-CS-IOC-01 Acc Mode")
  field(PINI, "YES")
  field(ZRST, "Running")
  field(ZRSV, "NO_ALARM")
  field(ONST, "Maintenance")
  field(ONSV, "MINOR")
  field(TWST, "Test")
  field(TWSV, "MINOR")
  field(THST, "OFFLINE")
  field(THSV, "MAJOR")
  info(autosaveFields, "VAL")
}
record(stringin, "FE14I-CS-IOC-01:STARTTOD")
{
    field(DESC, "Time and date of startup")
    field(DTYP, "Soft Timestamp")
    field(PINI, "YES")
    field(INP, "@%Y-%m-%d %H:%M:%S")
}
record(stringin, "FE14I-CS-IOC-01:TOD")
{
    field(DESC, "Current time and date")
    field(DTYP, "Soft Timestamp")
    field(SCAN, "1 second")
    field(INP, "@%Y-%m-%d %H:%M:%S")
}
record(calcout, "FE14I-CS-IOC-01:HEARTBEAT")
{
    field(DESC, "1 Hz counter since startup")
    field(CALC, "(A<2147483647)?A+1:1")
    field(SCAN, "1 second")
    field(INPA, "FE14I-CS-IOC-01:HEARTBEAT")
}
# if autosave is working, START_CNT creates a running count of 
# number of times the IOC was started.
record(calcout, "FE14I-CS-IOC-01:START_CNT")
{
    field(DESC, "Increments at startup")
    field(CALC, "A+1")
    field(PINI, "YES")
    field(INPA, "FE14I-CS-IOC-01:START_CNT")
    info(autosaveFields_pass0, "VAL")
}
#
# Using an existing internal set of subroutines, this
# PV updates the Access Security mechanism dynamically.
# The .acf file is re-read.
#
record( sub, "FE14I-CS-IOC-01:READACF")
{
    field( DESC, "FE14I-CS-IOC-01 ACF Update")
    field( INAM, "asSubInit")
    field( SNAM, "asSubProcess")
    field( BRSV, "INVALID")
}
record(sub, "FE14I-CS-IOC-01:SYSRESET")
{
    alias("FE14I-CS-IOC-01:SysReset")
    field(DESC, "IOC Restart" )
    field(SNAM, "rebootProc")
    field(BRSV,"INVALID")
    field(L,"1")
}

#% archiver 1 Monitor
#% alh
record(ai, "FE14I-CS-IOC-01:CA_CLNT_CNT") {
  field(DESC, "Number of CA Clients")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@ca_clients")
  field(HOPR, "200")
  field(HIHI, "175")
  field(HIGH, "100")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  info(autosaveFields_pass0, "HOPR LOPR HIHI HIGH LOW LOLO HHSV HSV LSV LLSV")
}

#% archiver 1 Monitor
#% alh
record(ai, "FE14I-CS-IOC-01:CA_CONN_CNT") {
  field(DESC, "Number of CA Connections")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@ca_connections")
  field(HOPR, "5000")
  field(HIHI, "4500")
  field(HIGH, "4000")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  info(autosaveFields_pass0, "HOPR LOPR HIHI HIGH LOW LOLO HHSV HSV LSV LLSV")
}

record(ai, "FE14I-CS-IOC-01:RECORD_CNT") {
  field(DESC, "Number of Records")
  field(PINI, "YES")
  field(DTYP, "IOC stats")
  field(INP, "@records")
}

record(ai, "FE14I-CS-IOC-01:FD_MAX") {
  field(DESC, "Max File Descriptors")
  field(PINI, "YES")
  field(DTYP, "IOC stats")
  field(INP, "@maxfd")
}

record(ai, "FE14I-CS-IOC-01:FD_CNT") {
  field(DESC, "Allocated File Descriptors")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(FLNK, "FE14I-CS-IOC-01:FD_FREE  PP MS")
  field(INP, "@fd")
}

#% archiver 1 Monitor
#% alh
record(calc, "FE14I-CS-IOC-01:FD_FREE") {
  field(DESC, "Available FDs")
  field(CALC, "B>0?B-A:C")
  field(INPA, "FE14I-CS-IOC-01:FD_CNT  NPP MS")
  field(INPB, "FE14I-CS-IOC-01:FD_MAX  NPP MS")
  field(INPC, "1000")
  field(HOPR, "150")
  field(LOLO, "5")
  field(LOW, "20")
  field(LLSV, "MAJOR")
  field(LSV, "MINOR")
  info(autosaveFields_pass0, "HOPR LOPR LOW LOLO LSV LLSV")
}

#% archiver 1 Monitor
record(ai, "FE14I-CS-IOC-01:SYS_CPU_LOAD") {
  field(DESC, "System CPU Load")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@sys_cpuload")
  field(EGU, "%")
  field(PREC, "1")
  field(HOPR, "100")
  field(HIHI, "80")
  field(HIGH, "70")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  info(autosaveFields_pass0, "HOPR LOPR HIHI HIGH LOW LOLO HHSV HSV LSV LLSV")
}

#% archiver 1 Monitor
#% alh
record(ai, "FE14I-CS-IOC-01:IOC_CPU_LOAD") {
  alias("FE14I-CS-IOC-01:LOAD")
  field(DESC, "IOC CPU Load")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@ioc_cpuload")
  field(EGU, "%")
  field(PREC, "1")
  field(HOPR, "100")
  field(HIHI, "80")
  field(HIGH, "70")
  field(HHSV, "MAJOR")
  field(HSV, "MINOR")
  info(autosaveFields_pass0, "HOPR LOPR HIHI HIGH LOW LOLO HHSV HSV LSV LLSV")
}

record(ai, "FE14I-CS-IOC-01:CPU_CNT") {
  field(DESC, "Number of CPUs")
  field(DTYP, "IOC stats")
  field(INP, "@no_of_cpus")
  field(PINI, "YES")
}

#% archiver 1 Monitor
#% alh
record(ai, "FE14I-CS-IOC-01:SUSP_TASK_CNT") {
  field(DESC, "Number Suspended Tasks")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@suspended_tasks")
  field(HIHI, "1")
  field(HHSV, "MAJOR")
  info(autosaveFields_pass0, "HOPR LOPR HIHI HIGH LOW LOLO HHSV HSV LSV LLSV")
}

#% archiver 1 Monitor
record(ai, "FE14I-CS-IOC-01:MEM_USED") {
  field(DESC, "Allocated Memory")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@allocated_bytes")
  field(EGU, "byte")
}

#% archiver 1 Monitor
record(ai, "FE14I-CS-IOC-01:MEM_FREE") {
  field(DESC, "Free Memory")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@free_bytes")
  field(EGU, "byte")
  field(LLSV, "MAJOR")
  field(LSV, "MINOR")
  info(autosaveFields_pass0, "HOPR LOPR LOW LOLO LSV LLSV")
}

record(ai, "FE14I-CS-IOC-01:MEM_MAX") {
  field(DESC, "Maximum Memory")
  field(SCAN, "I/O Intr")
  field(DTYP, "IOC stats")
  field(INP, "@total_bytes")
  field(EGU, "byte")
}

record(ao, "FE14I-CS-IOC-01:CA_UPD_TIME") {
  field(DESC, "CA Check Update Period")
  field(DTYP, "IOC stats")
  field(OUT, "@ca_scan_rate")
  field(EGU, "sec")
  field(DRVH, "60")
  field(DRVL, "1")
  field(HOPR, "60")
  field(VAL, "15")
  field(PINI, "YES")
}

record(ao, "FE14I-CS-IOC-01:FD_UPD_TIME") {
  field(DESC, "FD Check Update Period")
  field(DTYP, "IOC stats")
  field(OUT, "@fd_scan_rate")
  field(EGU, "sec")
  field(DRVH, "60")
  field(DRVL, "1")
  field(HOPR, "60")
  field(VAL, "20")
  field(PINI, "YES")
}

record(ao, "FE14I-CS-IOC-01:LOAD_UPD_TIME") {
  field(DESC, "CPU Check Update Period")
  field(DTYP, "IOC stats")
  field(OUT, "@cpu_scan_rate")
  field(EGU, "sec")
  field(DRVH, "60")
  field(DRVL, "1")
  field(HOPR, "60")
  field(VAL, "10")
  field(PINI, "YES")
}

record(ao, "FE14I-CS-IOC-01:MEM_UPD_TIME") {
  field(DESC, "Memory Check Update Period")
  field(DTYP, "IOC stats")
  field(OUT, "@memory_scan_rate")
  field(EGU, "sec")
  field(DRVH, "60")
  field(DRVL, "1")
  field(HOPR, "60")
  field(VAL, "10")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:ST_SCRIPT1") {
  field(DESC, "Startup Script Part1")
  field(DTYP, "IOC stats")
  field(INP, "@startup_script_1")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:ST_SCRIPT2") {
  field(DESC, "Startup Script Part2")
  field(DTYP, "IOC stats")
  field(INP, "@startup_script_2")
  field(PINI, "YES")
}

record(waveform, "FE14I-CS-IOC-01:ST_SCRIPT") {
  field(DESC, "Startup Script")
  field(DTYP, "IOC stats")
  field(INP, "@startup_script")
  field(NELM, "120")
  field(FTVL, "CHAR")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:KERNEL_VERS") {
  field(DESC, "Kernel Version")
  field(DTYP, "IOC stats")
  field(INP, "@kernel_ver")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:EPICS_VERS") {
  field(DESC, "EPICS Version")
  field(DTYP, "IOC stats")
  field(INP, "@epics_ver")
  field(PINI, "YES")
}

record(waveform, "FE14I-CS-IOC-01:EPICS_VERSION") {
  field(DESC, "EPICS Version")
  field(DTYP, "IOC stats")
  field(INP, "@epics_ver")
  field(NELM, "120")
  field(FTVL, "CHAR")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:HOSTNAME") {
  field(DESC, "Host Name")
  field(DTYP, "IOC stats")
  field(INP, "@hostname")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:APP_DIR1") {
  field(DESC, "Application Directory Part 1")
  field(DTYP, "IOC stats")
  field(INP, "@pwd1")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:APP_DIR2") {
  field(DESC, "Application Directory Part 2")
  field(DTYP, "IOC stats")
  field(INP, "@pwd2")
  field(PINI, "YES")
}

record(waveform, "FE14I-CS-IOC-01:APP_DIR") {
  field(DESC, "Application Directory")
  field(DTYP, "IOC stats")
  field(INP, "@pwd")
  field(NELM, "160")
  field(FTVL, "CHAR")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:UPTIME") {
  field(DESC, "Elapsed Time since Start")
  field(SCAN, "1 second")
  field(DTYP, "IOC stats")
  field(INP, "@up_time")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:ENGINEER") {
  field(DESC, "Engineer")
  field(DTYP, "IOC stats")
  field(INP, "@engineer")
  field(PINI, "YES")
}

record(stringin, "FE14I-CS-IOC-01:LOCATION") {
  field(DESC, "Location")
  field(DTYP, "IOC stats")
  field(INP, "@location")
  field(PINI, "YES")
}

record(ai, "FE14I-CS-IOC-01:PROCESS_ID") {
  field(DESC, "Process ID")
  field(PINI, "YES")
  field(DTYP, "IOC stats")
  field(INP, "@proc_id")
}

record(ai, "FE14I-CS-IOC-01:PARENT_ID") {
  field(DESC, "Parent Process ID")
  field(PINI, "YES")
  field(DTYP, "IOC stats")
  field(INP, "@parent_proc_id")
}

record(stringin, "FE14I-CS-IOC-01:DLSVER") {
  field(DESC, "IOC version")
  field(DTYP, "IOC stats")
  field(INP, "@dlsver")
  field(PINI, "YES")
}
record(ai, "FE14I-CS-IOC-01:GTIM_TIME") {
  field(DESC, "Gen Time Secs since 1990")
  field(SCAN, "1 second")
  field(DTYP, "General Time")
  field(PREC, "3")
  field(INP,  "@TIME")
  field(EGU,  "sec")
}

record(bo, "FE14I-CS-IOC-01:GTIM_RESET") {
  field(DESC, "Gen Time Error Reset")
  field(DTYP, "General Time")
  field(OUT,  "@RSTERRCNT")
  field(ZNAM, "Reset")
  field(ONAM, "Reset")
}

record(longin, "FE14I-CS-IOC-01:GTIM_ERR_CNT") {
  field(DESC, "Gen Time Error Count")
  field(DTYP, "General Time")
  field(INP,  "@GETERRCNT")
  field(SCAN, "1 second")
  field(HIHI, "1")
  field(HHSV, "MAJOR")
}

record(stringin, "FE14I-CS-IOC-01:GTIM_CUR_SRC") {
  field(DESC, "Gen Time Current Provider")
  field(DTYP, "General Time")
  field(INP,  "@BESTTCP")
  field(SCAN, "1 second")
}

record(stringin, "FE14I-CS-IOC-01:GTIM_EVT_SRC") {
  field(DESC, "Gen Time Event Provider")
  field(DTYP, "General Time")
  field(INP,  "@BESTTEP")
  field(SCAN, "1 second")
}

record(stringin, "FE14I-CS-IOC-01:GTIM_HI_SRC") {
  field(DESC, "Gen Time Highest Provider")
  field(DTYP, "General Time")
  field(INP,  "@TOPTCP")
  field(SCAN, "1 second")
}
record(stringin, "FE14I-CS-IOC-01:CA_ADDR_LIST") {
  field(DESC, "EPICS_CA_ADDR_LIST")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_ADDR_LIST")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:CA_CONN_TIME") {
  field(DESC, "EPICS_CA_CONN_TMO")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_CONN_TMO")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:CA_AUTO_ADDR") {
  field(DESC, "EPICS_CA_AUTO_ADDR_LIST")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_AUTO_ADDR_LIST")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:CA_RPTR_PORT") {
  field(DESC, "EPICS_CA_REPEATER_PORT")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_REPEATER_PORT")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:CA_SRVR_PORT") {
  field(DESC, "EPICS_CA_SERVER_PORT")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_SERVER_PORT")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:CA_MAX_ARRAY") {
  field(DESC, "EPICS_CA_MAX_ARRAY_BYTES")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_MAX_ARRAY_BYTES")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:CA_SRCH_TIME") {
  field(DESC, "EPICS_CA_MAX_SEARCH_PERIOD")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_MAX_SEARCH_PERIOD")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:CA_BEAC_TIME") {
  field(DESC, "EPICS_CA_BEACON_PERIOD")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_CA_BEACON_PERIOD")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:TIMEZONE") {
  field(DESC, "EPICS_TIMEZONE")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_TIMEZONE")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:TS_NTP_INET") {
  field(DESC, "EPICS_TS_NTP_INET")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_TS_NTP_INET")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:IOC_LOG_PORT") {
  field(DESC, "EPICS_IOC_LOG_PORT")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_IOC_LOG_PORT")
  field(PINI, "YES")
}
record(stringin, "FE14I-CS-IOC-01:IOC_LOG_INET") {
  field(DESC, "EPICS_IOC_LOG_INET")
  field(DTYP, "IOC epics var")
  field(INP, "@EPICS_IOC_LOG_INET")
  field(PINI, "YES")
}
#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

record(bo, "FE14I-CS-IOC-01:01HZ_MODE") {
	field(DESC, "01HZ Mode")
	field(DOL, "1")
	field(PINI, "YES")
	field(ZNAM, "Relative")
	field(ONAM, "Absolute")
}
record(sub, "FE14I-CS-IOC-01:01HZ_UPD_TIME") {
	field(DESC, "01HZ Update Time")
	field(SCAN, "10 second")
	field(EGU, "second")
	field(PREC, "5")
	field(MDEL, "0.00001")
	field(HYST, "0.00002")
	field(INAM, "scanMonInit")
	field(SNAM, "scanMon")
	field(HHSV, "MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV, "MAJOR")
	field(BRSV, "INVALID")
	field(INPA, "FE14I-CS-IOC-01:01HZ_MODE")
	field(B,    "1.0")
	field(C,    "5.0")
}
#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

record(bo, "FE14I-CS-IOC-01:02HZ_MODE") {
	field(DESC, "02HZ Mode")
	field(DOL, "1")
	field(PINI, "YES")
	field(ZNAM, "Relative")
	field(ONAM, "Absolute")
}
record(sub, "FE14I-CS-IOC-01:02HZ_UPD_TIME") {
	field(DESC, "02HZ Update Time")
	field(SCAN, "5 second")
	field(EGU, "second")
	field(PREC, "5")
	field(MDEL, "0.00001")
	field(HYST, "0.00002")
	field(INAM, "scanMonInit")
	field(SNAM, "scanMon")
	field(HHSV, "MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV, "MAJOR")
	field(BRSV, "INVALID")
	field(INPA, "FE14I-CS-IOC-01:02HZ_MODE")
	field(B,    "1.0")
	field(C,    "5.0")
}
#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

record(bo, "FE14I-CS-IOC-01:05HZ_MODE") {
	field(DESC, "05HZ Mode")
	field(DOL, "1")
	field(PINI, "YES")
	field(ZNAM, "Relative")
	field(ONAM, "Absolute")
}
record(sub, "FE14I-CS-IOC-01:05HZ_UPD_TIME") {
	field(DESC, "05HZ Update Time")
	field(SCAN, "2 second")
	field(EGU, "second")
	field(PREC, "5")
	field(MDEL, "0.00001")
	field(HYST, "0.00002")
	field(INAM, "scanMonInit")
	field(SNAM, "scanMon")
	field(HHSV, "MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV, "MAJOR")
	field(BRSV, "INVALID")
	field(INPA, "FE14I-CS-IOC-01:05HZ_MODE")
	field(B,    "1.0")
	field(C,    "5.0")
}
#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

record(bo, "FE14I-CS-IOC-01:1HZ_MODE") {
	field(DESC, "1HZ Mode")
	field(DOL, "1")
	field(PINI, "YES")
	field(ZNAM, "Relative")
	field(ONAM, "Absolute")
}
record(sub, "FE14I-CS-IOC-01:1HZ_UPD_TIME") {
	field(DESC, "1HZ Update Time")
	field(SCAN, "1 second")
	field(EGU, "second")
	field(PREC, "5")
	field(MDEL, "0.00001")
	field(HYST, "0.00002")
	field(INAM, "scanMonInit")
	field(SNAM, "scanMon")
	field(HHSV, "MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV, "MAJOR")
	field(BRSV, "INVALID")
	field(INPA, "FE14I-CS-IOC-01:1HZ_MODE")
	field(B,    "1.0")
	field(C,    "5.0")
}
#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

record(bo, "FE14I-CS-IOC-01:2HZ_MODE") {
	field(DESC, "2HZ Mode")
	field(DOL, "1")
	field(PINI, "YES")
	field(ZNAM, "Relative")
	field(ONAM, "Absolute")
}
record(sub, "FE14I-CS-IOC-01:2HZ_UPD_TIME") {
	field(DESC, "2HZ Update Time")
	field(SCAN, ".5 second")
	field(EGU, "second")
	field(PREC, "5")
	field(MDEL, "0.00001")
	field(HYST, "0.00002")
	field(INAM, "scanMonInit")
	field(SNAM, "scanMon")
	field(HHSV, "MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV, "MAJOR")
	field(BRSV, "INVALID")
	field(INPA, "FE14I-CS-IOC-01:2HZ_MODE")
	field(B,    "1.0")
	field(C,    "5.0")
}
#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

record(bo, "FE14I-CS-IOC-01:5HZ_MODE") {
	field(DESC, "5HZ Mode")
	field(DOL, "1")
	field(PINI, "YES")
	field(ZNAM, "Relative")
	field(ONAM, "Absolute")
}
record(sub, "FE14I-CS-IOC-01:5HZ_UPD_TIME") {
	field(DESC, "5HZ Update Time")
	field(SCAN, ".2 second")
	field(EGU, "second")
	field(PREC, "5")
	field(MDEL, "0.00001")
	field(HYST, "0.00002")
	field(INAM, "scanMonInit")
	field(SNAM, "scanMon")
	field(HHSV, "MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV, "MAJOR")
	field(BRSV, "INVALID")
	field(INPA, "FE14I-CS-IOC-01:5HZ_MODE")
	field(B,    "1.0")
	field(C,    "5.0")
}
#% macro, __doc__, Create some records for reading IOC statistics and details.
#% macro, IOC, Device prefix

record(bo, "FE14I-CS-IOC-01:10HZ_MODE") {
	field(DESC, "10HZ Mode")
	field(DOL, "1")
	field(PINI, "YES")
	field(ZNAM, "Relative")
	field(ONAM, "Absolute")
}
record(sub, "FE14I-CS-IOC-01:10HZ_UPD_TIME") {
	field(DESC, "10HZ Update Time")
	field(SCAN, ".1 second")
	field(EGU, "second")
	field(PREC, "5")
	field(MDEL, "0.00001")
	field(HYST, "0.00002")
	field(INAM, "scanMonInit")
	field(SNAM, "scanMon")
	field(HHSV, "MAJOR")
	field(HSV, "MINOR")
	field(LSV, "MINOR")
	field(LLSV, "MAJOR")
	field(BRSV, "INVALID")
	field(INPA, "FE14I-CS-IOC-01:10HZ_MODE")
	field(B,    "1.0")
	field(C,    "5.0")
}

record(calc, "FE14I-CS-IOC-01:SCANMON_SEVR") {
    field(DESC, "ScanMon Max Severity")
    field(SCAN, "1 second")
    field(CALC, "0")
    field(INPA, "FE14I-CS-IOC-01:01HZ_UPD_TIME.SEVR MS")
    field(INPB, "FE14I-CS-IOC-01:02HZ_UPD_TIME.SEVR MS")
    field(INPC, "FE14I-CS-IOC-01:05HZ_UPD_TIME.SEVR MS")
    field(INPD, "FE14I-CS-IOC-01:1HZ_UPD_TIME.SEVR MS")
    field(INPE, "FE14I-CS-IOC-01:2HZ_UPD_TIME.SEVR MS")
    field(INPF, "FE14I-CS-IOC-01:5HZ_UPD_TIME.SEVR MS")
    field(INPG, "FE14I-CS-IOC-01:10HZ_UPD_TIME.SEVR MS")
}

#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM000..DM099
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM0XX") {
  field(DESC, "Read 100 words starting at 000")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 000, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM100..DM199
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM1XX") {
  field(DESC, "Read 100 words starting at 100")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 100, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM200..DM299
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM2XX") {
  field(DESC, "Read 100 words starting at 200")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 200, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM300..DM399
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM3XX") {
  field(DESC, "Read 100 words starting at 300")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 300, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM400..DM499
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM4XX") {
  field(DESC, "Read 100 words starting at 400")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 400, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM500..DM599
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM5XX") {
  field(DESC, "Read 100 words starting at 500")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 500, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM600..DM699
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM6XX") {
  field(DESC, "Read 100 words starting at 600")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 600, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#% macro, __doc__, Template that reads 100 blocks of memory into records so 
# that it can be used in various templates.
#% macro, device, Device prefix
# % macro, port, asyn port name of FINS driver
#% macro, timeout, Timeout in seconds for the FINS protocol reads/writes
#% macro, century, Read DM1100..DM1199
#% macro, SCAN, Scan rate of read record
record(waveform, "FE14I-VA-VLVCC-01:DM11XX") {
  field(DESC, "Read 100 words starting at 1100")
  field(SCAN, "1 second")
  field(DTYP, "asynInt16ArrayIn")
  field(INP, "@asyn(vlvcc_fins_port, 1100, 0) FINS_DM_READ")
  field(NELM, "100")
  field(FTVL, "USHORT")
  field(PRIO, "MEDIUM")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-AL-APTR-01:TMON01
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-AL-APTR-01:TMON01,label=APTR-01 Temp 1
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-AL-APTR-01,temp=:TMON01,desc=APTR-01 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-AL-APTR-01,temp=:TMON01,desc=APTR-01 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-AL-APTR-01,temp=:TMON01,desc=APTR-01 Temp 1
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-AL-APTR-01:TMON01
# % gui, , demand, Error Level,   FE14I-AL-APTR-01:TMON01:HIHI
# % gui, , readback, Error Level RBV,   FE14I-AL-APTR-01:TMON01:GETCALC
# % gui, , demand, Warning Level,   FE14I-AL-APTR-01:TMON01.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-AL-APTR-01:TMON01:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-AL-APTR-01:TMON01:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-AL-APTR-01:TMON01:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-AL-APTR-01:TMON01.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-AL-APTR-01:TMON01:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-AL-APTR-01:TMON01:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-01:TMON01.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-AL-APTR-01:TMON01:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-AL-APTR-01:TMON01:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-AL-APTR-01:TMON01:ZERO CP")
  field(INPB, "FE14I-AL-APTR-01:TMON01:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-AL-APTR-01:TMON01:SEQ.SELN PP")
}

record(seq, "FE14I-AL-APTR-01:TMON01:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-AL-APTR-01:TMON01:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-AL-APTR-01:TMON01:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-AL-APTR-01:TMON01:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-AL-APTR-01:TMON01:HIHI")
  field(FLNK, "FE14I-AL-APTR-01:TMON01:SETOVER")
}

record(ao, "FE14I-AL-APTR-01:TMON01:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-AL-APTR-01:TMON01:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-01:TMON01:SETHSV")
}

record(stringout, "FE14I-AL-APTR-01:TMON01:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-AL-APTR-01:TMON01.HSV PP")
}

record(calcout, "FE14I-AL-APTR-01:TMON01:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-AL-APTR-01:TMON01:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-01:TMON01:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-01:TMON01:RESTOREHSV")
}

record(stringout, "FE14I-AL-APTR-01:TMON01:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-AL-APTR-01:TMON01.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-AL-APTR-01:TMON01:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-AL-APTR-01:TMON01:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-AL-APTR-01:TMON01:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-AL-APTR-01:TMON01:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-AL-APTR-01:TMON01:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 110, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-AL-APTR-01:TMON01:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-AL-APTR-01:TMON01.HIHI")
  field(OUTB, "FE14I-AL-APTR-01:TMON01:GETCALC.HIGH")
  field(OUTC, "FE14I-AL-APTR-01:TMON01:GETCALC.LOW")
  field(DOL, "FE14I-AL-APTR-01:TMON01:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-AL-APTR-01:TMON01:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-01:TMON01")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-01:TMON01:TEMPINDX") {
  field(CALC, "10")
  field(OUT, "FE14I-AL-APTR-01:TMON01:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-AL-APTR-01:TMON01
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-AL-APTR-01:TMON01") {
  field(DESC, "APTR-01 Temp 1")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-01:TMON01:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-AL-APTR-01:TMON01:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-01:TMON01:GETCALC")
}

record(calcout, "FE14I-AL-APTR-01:TMON01:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-01:TMON01:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-AL-APTR-01:TMON01:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-01:TMON01:LIMITINDX") {
  field(CALC, "10")
  field(OUT, "FE14I-AL-APTR-01:TMON01:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-AL-APTR-01:TMON02
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-AL-APTR-01:TMON02,label=APTR-01 Temp 2
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-AL-APTR-01,temp=:TMON02,desc=APTR-01 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-AL-APTR-01,temp=:TMON02,desc=APTR-01 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-AL-APTR-01,temp=:TMON02,desc=APTR-01 Temp 2
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-AL-APTR-01:TMON02
# % gui, , demand, Error Level,   FE14I-AL-APTR-01:TMON02:HIHI
# % gui, , readback, Error Level RBV,   FE14I-AL-APTR-01:TMON02:GETCALC
# % gui, , demand, Warning Level,   FE14I-AL-APTR-01:TMON02.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-AL-APTR-01:TMON02:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-AL-APTR-01:TMON02:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-AL-APTR-01:TMON02:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-AL-APTR-01:TMON02.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-AL-APTR-01:TMON02:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-AL-APTR-01:TMON02:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-01:TMON02.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-AL-APTR-01:TMON02:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-AL-APTR-01:TMON02:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-AL-APTR-01:TMON02:ZERO CP")
  field(INPB, "FE14I-AL-APTR-01:TMON02:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-AL-APTR-01:TMON02:SEQ.SELN PP")
}

record(seq, "FE14I-AL-APTR-01:TMON02:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-AL-APTR-01:TMON02:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-AL-APTR-01:TMON02:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-AL-APTR-01:TMON02:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-AL-APTR-01:TMON02:HIHI")
  field(FLNK, "FE14I-AL-APTR-01:TMON02:SETOVER")
}

record(ao, "FE14I-AL-APTR-01:TMON02:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-AL-APTR-01:TMON02:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-01:TMON02:SETHSV")
}

record(stringout, "FE14I-AL-APTR-01:TMON02:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-AL-APTR-01:TMON02.HSV PP")
}

record(calcout, "FE14I-AL-APTR-01:TMON02:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-AL-APTR-01:TMON02:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-01:TMON02:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-01:TMON02:RESTOREHSV")
}

record(stringout, "FE14I-AL-APTR-01:TMON02:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-AL-APTR-01:TMON02.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-AL-APTR-01:TMON02:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-AL-APTR-01:TMON02:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-AL-APTR-01:TMON02:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-AL-APTR-01:TMON02:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-AL-APTR-01:TMON02:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 111, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-AL-APTR-01:TMON02:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-AL-APTR-01:TMON02.HIHI")
  field(OUTB, "FE14I-AL-APTR-01:TMON02:GETCALC.HIGH")
  field(OUTC, "FE14I-AL-APTR-01:TMON02:GETCALC.LOW")
  field(DOL, "FE14I-AL-APTR-01:TMON02:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-AL-APTR-01:TMON02:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-01:TMON02")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-01:TMON02:TEMPINDX") {
  field(CALC, "11")
  field(OUT, "FE14I-AL-APTR-01:TMON02:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-AL-APTR-01:TMON02
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-AL-APTR-01:TMON02") {
  field(DESC, "APTR-01 Temp 2")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-01:TMON02:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-AL-APTR-01:TMON02:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-01:TMON02:GETCALC")
}

record(calcout, "FE14I-AL-APTR-01:TMON02:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-01:TMON02:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-AL-APTR-01:TMON02:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-01:TMON02:LIMITINDX") {
  field(CALC, "11")
  field(OUT, "FE14I-AL-APTR-01:TMON02:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-RS-ABSB-01:TMON01
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-RS-ABSB-01:TMON01,label=ABSB-01 Temp 1
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-RS-ABSB-01,temp=:TMON01,desc=ABSB-01 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-RS-ABSB-01,temp=:TMON01,desc=ABSB-01 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-RS-ABSB-01,temp=:TMON01,desc=ABSB-01 Temp 1
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-RS-ABSB-01:TMON01
# % gui, , demand, Error Level,   FE14I-RS-ABSB-01:TMON01:HIHI
# % gui, , readback, Error Level RBV,   FE14I-RS-ABSB-01:TMON01:GETCALC
# % gui, , demand, Warning Level,   FE14I-RS-ABSB-01:TMON01.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-RS-ABSB-01:TMON01:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-RS-ABSB-01:TMON01:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-RS-ABSB-01:TMON01:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-RS-ABSB-01:TMON01.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-RS-ABSB-01:TMON01:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-RS-ABSB-01:TMON01:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON01.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-RS-ABSB-01:TMON01:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-RS-ABSB-01:TMON01:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-RS-ABSB-01:TMON01:ZERO CP")
  field(INPB, "FE14I-RS-ABSB-01:TMON01:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-RS-ABSB-01:TMON01:SEQ.SELN PP")
}

record(seq, "FE14I-RS-ABSB-01:TMON01:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-RS-ABSB-01:TMON01:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-RS-ABSB-01:TMON01:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-RS-ABSB-01:TMON01:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-RS-ABSB-01:TMON01:HIHI")
  field(FLNK, "FE14I-RS-ABSB-01:TMON01:SETOVER")
}

record(ao, "FE14I-RS-ABSB-01:TMON01:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-RS-ABSB-01:TMON01:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON01:SETHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON01:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-RS-ABSB-01:TMON01.HSV PP")
}

record(calcout, "FE14I-RS-ABSB-01:TMON01:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-RS-ABSB-01:TMON01:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON01:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON01:RESTOREHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON01:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-RS-ABSB-01:TMON01.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-RS-ABSB-01:TMON01:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-RS-ABSB-01:TMON01:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-RS-ABSB-01:TMON01:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-RS-ABSB-01:TMON01:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-RS-ABSB-01:TMON01:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 112, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-RS-ABSB-01:TMON01:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-RS-ABSB-01:TMON01.HIHI")
  field(OUTB, "FE14I-RS-ABSB-01:TMON01:GETCALC.HIGH")
  field(OUTC, "FE14I-RS-ABSB-01:TMON01:GETCALC.LOW")
  field(DOL, "FE14I-RS-ABSB-01:TMON01:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-RS-ABSB-01:TMON01:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON01")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON01:TEMPINDX") {
  field(CALC, "12")
  field(OUT, "FE14I-RS-ABSB-01:TMON01:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-RS-ABSB-01:TMON01
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-RS-ABSB-01:TMON01") {
  field(DESC, "ABSB-01 Temp 1")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON01:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-RS-ABSB-01:TMON01:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON01:GETCALC")
}

record(calcout, "FE14I-RS-ABSB-01:TMON01:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON01:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-RS-ABSB-01:TMON01:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON01:LIMITINDX") {
  field(CALC, "12")
  field(OUT, "FE14I-RS-ABSB-01:TMON01:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-RS-ABSB-01:TMON02
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-RS-ABSB-01:TMON02,label=ABSB-01 Temp 2
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-RS-ABSB-01,temp=:TMON02,desc=ABSB-01 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-RS-ABSB-01,temp=:TMON02,desc=ABSB-01 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-RS-ABSB-01,temp=:TMON02,desc=ABSB-01 Temp 2
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-RS-ABSB-01:TMON02
# % gui, , demand, Error Level,   FE14I-RS-ABSB-01:TMON02:HIHI
# % gui, , readback, Error Level RBV,   FE14I-RS-ABSB-01:TMON02:GETCALC
# % gui, , demand, Warning Level,   FE14I-RS-ABSB-01:TMON02.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-RS-ABSB-01:TMON02:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-RS-ABSB-01:TMON02:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-RS-ABSB-01:TMON02:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-RS-ABSB-01:TMON02.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-RS-ABSB-01:TMON02:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-RS-ABSB-01:TMON02:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON02.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-RS-ABSB-01:TMON02:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-RS-ABSB-01:TMON02:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-RS-ABSB-01:TMON02:ZERO CP")
  field(INPB, "FE14I-RS-ABSB-01:TMON02:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-RS-ABSB-01:TMON02:SEQ.SELN PP")
}

record(seq, "FE14I-RS-ABSB-01:TMON02:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-RS-ABSB-01:TMON02:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-RS-ABSB-01:TMON02:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-RS-ABSB-01:TMON02:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-RS-ABSB-01:TMON02:HIHI")
  field(FLNK, "FE14I-RS-ABSB-01:TMON02:SETOVER")
}

record(ao, "FE14I-RS-ABSB-01:TMON02:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-RS-ABSB-01:TMON02:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON02:SETHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON02:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-RS-ABSB-01:TMON02.HSV PP")
}

record(calcout, "FE14I-RS-ABSB-01:TMON02:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-RS-ABSB-01:TMON02:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON02:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON02:RESTOREHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON02:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-RS-ABSB-01:TMON02.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-RS-ABSB-01:TMON02:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-RS-ABSB-01:TMON02:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-RS-ABSB-01:TMON02:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-RS-ABSB-01:TMON02:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-RS-ABSB-01:TMON02:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 113, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-RS-ABSB-01:TMON02:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-RS-ABSB-01:TMON02.HIHI")
  field(OUTB, "FE14I-RS-ABSB-01:TMON02:GETCALC.HIGH")
  field(OUTC, "FE14I-RS-ABSB-01:TMON02:GETCALC.LOW")
  field(DOL, "FE14I-RS-ABSB-01:TMON02:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-RS-ABSB-01:TMON02:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON02")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON02:TEMPINDX") {
  field(CALC, "13")
  field(OUT, "FE14I-RS-ABSB-01:TMON02:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-RS-ABSB-01:TMON02
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-RS-ABSB-01:TMON02") {
  field(DESC, "ABSB-01 Temp 2")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON02:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-RS-ABSB-01:TMON02:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON02:GETCALC")
}

record(calcout, "FE14I-RS-ABSB-01:TMON02:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON02:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-RS-ABSB-01:TMON02:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON02:LIMITINDX") {
  field(CALC, "13")
  field(OUT, "FE14I-RS-ABSB-01:TMON02:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-RS-ABSB-01:TMON03
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-RS-ABSB-01:TMON03,label=ABSB-01 Temp 3
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-RS-ABSB-01,temp=:TMON03,desc=ABSB-01 Temp 3
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-RS-ABSB-01,temp=:TMON03,desc=ABSB-01 Temp 3
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-RS-ABSB-01,temp=:TMON03,desc=ABSB-01 Temp 3
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-RS-ABSB-01:TMON03
# % gui, , demand, Error Level,   FE14I-RS-ABSB-01:TMON03:HIHI
# % gui, , readback, Error Level RBV,   FE14I-RS-ABSB-01:TMON03:GETCALC
# % gui, , demand, Warning Level,   FE14I-RS-ABSB-01:TMON03.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-RS-ABSB-01:TMON03:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-RS-ABSB-01:TMON03:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-RS-ABSB-01:TMON03:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-RS-ABSB-01:TMON03.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-RS-ABSB-01:TMON03:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-RS-ABSB-01:TMON03:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON03.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-RS-ABSB-01:TMON03:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-RS-ABSB-01:TMON03:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-RS-ABSB-01:TMON03:ZERO CP")
  field(INPB, "FE14I-RS-ABSB-01:TMON03:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-RS-ABSB-01:TMON03:SEQ.SELN PP")
}

record(seq, "FE14I-RS-ABSB-01:TMON03:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-RS-ABSB-01:TMON03:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-RS-ABSB-01:TMON03:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-RS-ABSB-01:TMON03:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-RS-ABSB-01:TMON03:HIHI")
  field(FLNK, "FE14I-RS-ABSB-01:TMON03:SETOVER")
}

record(ao, "FE14I-RS-ABSB-01:TMON03:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-RS-ABSB-01:TMON03:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON03:SETHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON03:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-RS-ABSB-01:TMON03.HSV PP")
}

record(calcout, "FE14I-RS-ABSB-01:TMON03:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-RS-ABSB-01:TMON03:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON03:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON03:RESTOREHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON03:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-RS-ABSB-01:TMON03.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-RS-ABSB-01:TMON03:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-RS-ABSB-01:TMON03:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-RS-ABSB-01:TMON03:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-RS-ABSB-01:TMON03:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-RS-ABSB-01:TMON03:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 114, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-RS-ABSB-01:TMON03:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-RS-ABSB-01:TMON03.HIHI")
  field(OUTB, "FE14I-RS-ABSB-01:TMON03:GETCALC.HIGH")
  field(OUTC, "FE14I-RS-ABSB-01:TMON03:GETCALC.LOW")
  field(DOL, "FE14I-RS-ABSB-01:TMON03:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-RS-ABSB-01:TMON03:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON03")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON03:TEMPINDX") {
  field(CALC, "14")
  field(OUT, "FE14I-RS-ABSB-01:TMON03:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-RS-ABSB-01:TMON03
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-RS-ABSB-01:TMON03") {
  field(DESC, "ABSB-01 Temp 3")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON03:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-RS-ABSB-01:TMON03:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON03:GETCALC")
}

record(calcout, "FE14I-RS-ABSB-01:TMON03:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON03:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-RS-ABSB-01:TMON03:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON03:LIMITINDX") {
  field(CALC, "14")
  field(OUT, "FE14I-RS-ABSB-01:TMON03:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-RS-ABSB-01:TMON04
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-RS-ABSB-01:TMON04,label=ABSB-01 Temp 4
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-RS-ABSB-01,temp=:TMON04,desc=ABSB-01 Temp 4
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-RS-ABSB-01,temp=:TMON04,desc=ABSB-01 Temp 4
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-RS-ABSB-01,temp=:TMON04,desc=ABSB-01 Temp 4
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-RS-ABSB-01:TMON04
# % gui, , demand, Error Level,   FE14I-RS-ABSB-01:TMON04:HIHI
# % gui, , readback, Error Level RBV,   FE14I-RS-ABSB-01:TMON04:GETCALC
# % gui, , demand, Warning Level,   FE14I-RS-ABSB-01:TMON04.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-RS-ABSB-01:TMON04:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-RS-ABSB-01:TMON04:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-RS-ABSB-01:TMON04:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-RS-ABSB-01:TMON04.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-RS-ABSB-01:TMON04:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-RS-ABSB-01:TMON04:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON04.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-RS-ABSB-01:TMON04:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-RS-ABSB-01:TMON04:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-RS-ABSB-01:TMON04:ZERO CP")
  field(INPB, "FE14I-RS-ABSB-01:TMON04:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-RS-ABSB-01:TMON04:SEQ.SELN PP")
}

record(seq, "FE14I-RS-ABSB-01:TMON04:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-RS-ABSB-01:TMON04:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-RS-ABSB-01:TMON04:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-RS-ABSB-01:TMON04:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-RS-ABSB-01:TMON04:HIHI")
  field(FLNK, "FE14I-RS-ABSB-01:TMON04:SETOVER")
}

record(ao, "FE14I-RS-ABSB-01:TMON04:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-RS-ABSB-01:TMON04:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON04:SETHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON04:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-RS-ABSB-01:TMON04.HSV PP")
}

record(calcout, "FE14I-RS-ABSB-01:TMON04:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-RS-ABSB-01:TMON04:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-RS-ABSB-01:TMON04:HIHI PP")
  field(FLNK, "FE14I-RS-ABSB-01:TMON04:RESTOREHSV")
}

record(stringout, "FE14I-RS-ABSB-01:TMON04:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-RS-ABSB-01:TMON04.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-RS-ABSB-01:TMON04:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-RS-ABSB-01:TMON04:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-RS-ABSB-01:TMON04:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-RS-ABSB-01:TMON04:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-RS-ABSB-01:TMON04:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 115, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-RS-ABSB-01:TMON04:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-RS-ABSB-01:TMON04.HIHI")
  field(OUTB, "FE14I-RS-ABSB-01:TMON04:GETCALC.HIGH")
  field(OUTC, "FE14I-RS-ABSB-01:TMON04:GETCALC.LOW")
  field(DOL, "FE14I-RS-ABSB-01:TMON04:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-RS-ABSB-01:TMON04:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON04")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON04:TEMPINDX") {
  field(CALC, "15")
  field(OUT, "FE14I-RS-ABSB-01:TMON04:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-RS-ABSB-01:TMON04
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-RS-ABSB-01:TMON04") {
  field(DESC, "ABSB-01 Temp 4")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON04:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-RS-ABSB-01:TMON04:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-RS-ABSB-01:TMON04:GETCALC")
}

record(calcout, "FE14I-RS-ABSB-01:TMON04:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-RS-ABSB-01:TMON04:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-RS-ABSB-01:TMON04:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-RS-ABSB-01:TMON04:LIMITINDX") {
  field(CALC, "15")
  field(OUT, "FE14I-RS-ABSB-01:TMON04:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-AL-APTR-02:TMON01
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-AL-APTR-02:TMON01,label=APTR-02 Temp 1
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-AL-APTR-02,temp=:TMON01,desc=APTR-02 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-AL-APTR-02,temp=:TMON01,desc=APTR-02 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-AL-APTR-02,temp=:TMON01,desc=APTR-02 Temp 1
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-AL-APTR-02:TMON01
# % gui, , demand, Error Level,   FE14I-AL-APTR-02:TMON01:HIHI
# % gui, , readback, Error Level RBV,   FE14I-AL-APTR-02:TMON01:GETCALC
# % gui, , demand, Warning Level,   FE14I-AL-APTR-02:TMON01.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-AL-APTR-02:TMON01:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-AL-APTR-02:TMON01:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-AL-APTR-02:TMON01:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-AL-APTR-02:TMON01.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-AL-APTR-02:TMON01:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-AL-APTR-02:TMON01:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON01.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-AL-APTR-02:TMON01:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-AL-APTR-02:TMON01:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-AL-APTR-02:TMON01:ZERO CP")
  field(INPB, "FE14I-AL-APTR-02:TMON01:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-AL-APTR-02:TMON01:SEQ.SELN PP")
}

record(seq, "FE14I-AL-APTR-02:TMON01:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-AL-APTR-02:TMON01:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-AL-APTR-02:TMON01:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-AL-APTR-02:TMON01:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-AL-APTR-02:TMON01:HIHI")
  field(FLNK, "FE14I-AL-APTR-02:TMON01:SETOVER")
}

record(ao, "FE14I-AL-APTR-02:TMON01:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-AL-APTR-02:TMON01:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON01:SETHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON01:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-AL-APTR-02:TMON01.HSV PP")
}

record(calcout, "FE14I-AL-APTR-02:TMON01:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-AL-APTR-02:TMON01:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON01:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON01:RESTOREHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON01:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-AL-APTR-02:TMON01.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-AL-APTR-02:TMON01:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-AL-APTR-02:TMON01:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-AL-APTR-02:TMON01:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-AL-APTR-02:TMON01:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-AL-APTR-02:TMON01:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 118, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-AL-APTR-02:TMON01:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-AL-APTR-02:TMON01.HIHI")
  field(OUTB, "FE14I-AL-APTR-02:TMON01:GETCALC.HIGH")
  field(OUTC, "FE14I-AL-APTR-02:TMON01:GETCALC.LOW")
  field(DOL, "FE14I-AL-APTR-02:TMON01:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-AL-APTR-02:TMON01:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON01")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON01:TEMPINDX") {
  field(CALC, "18")
  field(OUT, "FE14I-AL-APTR-02:TMON01:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-AL-APTR-02:TMON01
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-AL-APTR-02:TMON01") {
  field(DESC, "APTR-02 Temp 1")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON01:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-AL-APTR-02:TMON01:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON01:GETCALC")
}

record(calcout, "FE14I-AL-APTR-02:TMON01:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON01:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-AL-APTR-02:TMON01:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON01:LIMITINDX") {
  field(CALC, "18")
  field(OUT, "FE14I-AL-APTR-02:TMON01:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-AL-APTR-02:TMON02
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-AL-APTR-02:TMON02,label=APTR-02 Temp 2
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-AL-APTR-02,temp=:TMON02,desc=APTR-02 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-AL-APTR-02,temp=:TMON02,desc=APTR-02 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-AL-APTR-02,temp=:TMON02,desc=APTR-02 Temp 2
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-AL-APTR-02:TMON02
# % gui, , demand, Error Level,   FE14I-AL-APTR-02:TMON02:HIHI
# % gui, , readback, Error Level RBV,   FE14I-AL-APTR-02:TMON02:GETCALC
# % gui, , demand, Warning Level,   FE14I-AL-APTR-02:TMON02.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-AL-APTR-02:TMON02:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-AL-APTR-02:TMON02:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-AL-APTR-02:TMON02:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-AL-APTR-02:TMON02.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-AL-APTR-02:TMON02:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-AL-APTR-02:TMON02:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON02.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-AL-APTR-02:TMON02:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-AL-APTR-02:TMON02:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-AL-APTR-02:TMON02:ZERO CP")
  field(INPB, "FE14I-AL-APTR-02:TMON02:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-AL-APTR-02:TMON02:SEQ.SELN PP")
}

record(seq, "FE14I-AL-APTR-02:TMON02:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-AL-APTR-02:TMON02:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-AL-APTR-02:TMON02:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-AL-APTR-02:TMON02:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-AL-APTR-02:TMON02:HIHI")
  field(FLNK, "FE14I-AL-APTR-02:TMON02:SETOVER")
}

record(ao, "FE14I-AL-APTR-02:TMON02:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-AL-APTR-02:TMON02:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON02:SETHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON02:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-AL-APTR-02:TMON02.HSV PP")
}

record(calcout, "FE14I-AL-APTR-02:TMON02:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-AL-APTR-02:TMON02:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON02:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON02:RESTOREHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON02:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-AL-APTR-02:TMON02.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-AL-APTR-02:TMON02:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-AL-APTR-02:TMON02:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-AL-APTR-02:TMON02:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-AL-APTR-02:TMON02:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-AL-APTR-02:TMON02:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 119, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-AL-APTR-02:TMON02:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-AL-APTR-02:TMON02.HIHI")
  field(OUTB, "FE14I-AL-APTR-02:TMON02:GETCALC.HIGH")
  field(OUTC, "FE14I-AL-APTR-02:TMON02:GETCALC.LOW")
  field(DOL, "FE14I-AL-APTR-02:TMON02:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-AL-APTR-02:TMON02:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON02")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON02:TEMPINDX") {
  field(CALC, "19")
  field(OUT, "FE14I-AL-APTR-02:TMON02:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-AL-APTR-02:TMON02
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-AL-APTR-02:TMON02") {
  field(DESC, "APTR-02 Temp 2")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON02:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-AL-APTR-02:TMON02:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON02:GETCALC")
}

record(calcout, "FE14I-AL-APTR-02:TMON02:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON02:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-AL-APTR-02:TMON02:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON02:LIMITINDX") {
  field(CALC, "19")
  field(OUT, "FE14I-AL-APTR-02:TMON02:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-AL-APTR-02:TMON03
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-AL-APTR-02:TMON03,label=APTR-02 Temp 3
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-AL-APTR-02,temp=:TMON03,desc=APTR-02 Temp 3
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-AL-APTR-02,temp=:TMON03,desc=APTR-02 Temp 3
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-AL-APTR-02,temp=:TMON03,desc=APTR-02 Temp 3
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-AL-APTR-02:TMON03
# % gui, , demand, Error Level,   FE14I-AL-APTR-02:TMON03:HIHI
# % gui, , readback, Error Level RBV,   FE14I-AL-APTR-02:TMON03:GETCALC
# % gui, , demand, Warning Level,   FE14I-AL-APTR-02:TMON03.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-AL-APTR-02:TMON03:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-AL-APTR-02:TMON03:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-AL-APTR-02:TMON03:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-AL-APTR-02:TMON03.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-AL-APTR-02:TMON03:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-AL-APTR-02:TMON03:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON03.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-AL-APTR-02:TMON03:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-AL-APTR-02:TMON03:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-AL-APTR-02:TMON03:ZERO CP")
  field(INPB, "FE14I-AL-APTR-02:TMON03:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-AL-APTR-02:TMON03:SEQ.SELN PP")
}

record(seq, "FE14I-AL-APTR-02:TMON03:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-AL-APTR-02:TMON03:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-AL-APTR-02:TMON03:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-AL-APTR-02:TMON03:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-AL-APTR-02:TMON03:HIHI")
  field(FLNK, "FE14I-AL-APTR-02:TMON03:SETOVER")
}

record(ao, "FE14I-AL-APTR-02:TMON03:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-AL-APTR-02:TMON03:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON03:SETHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON03:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-AL-APTR-02:TMON03.HSV PP")
}

record(calcout, "FE14I-AL-APTR-02:TMON03:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-AL-APTR-02:TMON03:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON03:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON03:RESTOREHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON03:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-AL-APTR-02:TMON03.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-AL-APTR-02:TMON03:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-AL-APTR-02:TMON03:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-AL-APTR-02:TMON03:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-AL-APTR-02:TMON03:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-AL-APTR-02:TMON03:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 120, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-AL-APTR-02:TMON03:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-AL-APTR-02:TMON03.HIHI")
  field(OUTB, "FE14I-AL-APTR-02:TMON03:GETCALC.HIGH")
  field(OUTC, "FE14I-AL-APTR-02:TMON03:GETCALC.LOW")
  field(DOL, "FE14I-AL-APTR-02:TMON03:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-AL-APTR-02:TMON03:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON03")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON03:TEMPINDX") {
  field(CALC, "20")
  field(OUT, "FE14I-AL-APTR-02:TMON03:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-AL-APTR-02:TMON03
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-AL-APTR-02:TMON03") {
  field(DESC, "APTR-02 Temp 3")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON03:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-AL-APTR-02:TMON03:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON03:GETCALC")
}

record(calcout, "FE14I-AL-APTR-02:TMON03:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON03:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-AL-APTR-02:TMON03:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON03:LIMITINDX") {
  field(CALC, "20")
  field(OUT, "FE14I-AL-APTR-02:TMON03:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-AL-APTR-02:TMON04
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-AL-APTR-02:TMON04,label=APTR-02 Temp 4
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-AL-APTR-02,temp=:TMON04,desc=APTR-02 Temp 4
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-AL-APTR-02,temp=:TMON04,desc=APTR-02 Temp 4
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-AL-APTR-02,temp=:TMON04,desc=APTR-02 Temp 4
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-AL-APTR-02:TMON04
# % gui, , demand, Error Level,   FE14I-AL-APTR-02:TMON04:HIHI
# % gui, , readback, Error Level RBV,   FE14I-AL-APTR-02:TMON04:GETCALC
# % gui, , demand, Warning Level,   FE14I-AL-APTR-02:TMON04.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-AL-APTR-02:TMON04:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-AL-APTR-02:TMON04:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-AL-APTR-02:TMON04:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-AL-APTR-02:TMON04.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-AL-APTR-02:TMON04:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-AL-APTR-02:TMON04:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON04.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-AL-APTR-02:TMON04:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-AL-APTR-02:TMON04:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-AL-APTR-02:TMON04:ZERO CP")
  field(INPB, "FE14I-AL-APTR-02:TMON04:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-AL-APTR-02:TMON04:SEQ.SELN PP")
}

record(seq, "FE14I-AL-APTR-02:TMON04:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-AL-APTR-02:TMON04:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-AL-APTR-02:TMON04:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-AL-APTR-02:TMON04:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-AL-APTR-02:TMON04:HIHI")
  field(FLNK, "FE14I-AL-APTR-02:TMON04:SETOVER")
}

record(ao, "FE14I-AL-APTR-02:TMON04:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-AL-APTR-02:TMON04:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON04:SETHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON04:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-AL-APTR-02:TMON04.HSV PP")
}

record(calcout, "FE14I-AL-APTR-02:TMON04:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-AL-APTR-02:TMON04:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-AL-APTR-02:TMON04:HIHI PP")
  field(FLNK, "FE14I-AL-APTR-02:TMON04:RESTOREHSV")
}

record(stringout, "FE14I-AL-APTR-02:TMON04:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-AL-APTR-02:TMON04.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-AL-APTR-02:TMON04:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-AL-APTR-02:TMON04:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-AL-APTR-02:TMON04:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-AL-APTR-02:TMON04:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-AL-APTR-02:TMON04:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 121, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-AL-APTR-02:TMON04:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-AL-APTR-02:TMON04.HIHI")
  field(OUTB, "FE14I-AL-APTR-02:TMON04:GETCALC.HIGH")
  field(OUTC, "FE14I-AL-APTR-02:TMON04:GETCALC.LOW")
  field(DOL, "FE14I-AL-APTR-02:TMON04:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-AL-APTR-02:TMON04:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON04")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON04:TEMPINDX") {
  field(CALC, "21")
  field(OUT, "FE14I-AL-APTR-02:TMON04:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-AL-APTR-02:TMON04
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-AL-APTR-02:TMON04") {
  field(DESC, "APTR-02 Temp 4")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON04:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-AL-APTR-02:TMON04:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-AL-APTR-02:TMON04:GETCALC")
}

record(calcout, "FE14I-AL-APTR-02:TMON04:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-AL-APTR-02:TMON04:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-AL-APTR-02:TMON04:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-AL-APTR-02:TMON04:LIMITINDX") {
  field(CALC, "21")
  field(OUT, "FE14I-AL-APTR-02:TMON04:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-DI-PBPM-01:TMON01:C
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-DI-PBPM-01:TMON01:C,label=PBPM-01 Temp 1
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-DI-PBPM-01,temp=:TMON01:C,desc=PBPM-01 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-DI-PBPM-01,temp=:TMON01:C,desc=PBPM-01 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-DI-PBPM-01,temp=:TMON01:C,desc=PBPM-01 Temp 1
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-DI-PBPM-01:TMON01:C
# % gui, , demand, Error Level,   FE14I-DI-PBPM-01:TMON01:C:HIHI
# % gui, , readback, Error Level RBV,   FE14I-DI-PBPM-01:TMON01:C:GETCALC
# % gui, , demand, Warning Level,   FE14I-DI-PBPM-01:TMON01:C.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-DI-PBPM-01:TMON01:C:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-DI-PBPM-01:TMON01:C:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-DI-PBPM-01:TMON01:C:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-DI-PBPM-01:TMON01:C.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-DI-PBPM-01:TMON01:C:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-DI-PBPM-01:TMON01:C:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-DI-PBPM-01:TMON01:C:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-DI-PBPM-01:TMON01:C:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-DI-PBPM-01:TMON01:C:ZERO CP")
  field(INPB, "FE14I-DI-PBPM-01:TMON01:C:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C:SEQ.SELN PP")
}

record(seq, "FE14I-DI-PBPM-01:TMON01:C:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-DI-PBPM-01:TMON01:C:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-DI-PBPM-01:TMON01:C:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-DI-PBPM-01:TMON01:C:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-DI-PBPM-01:TMON01:C:HIHI")
  field(FLNK, "FE14I-DI-PBPM-01:TMON01:C:SETOVER")
}

record(ao, "FE14I-DI-PBPM-01:TMON01:C:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-01:TMON01:C:SETHSV")
}

record(stringout, "FE14I-DI-PBPM-01:TMON01:C:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C.HSV PP")
}

record(calcout, "FE14I-DI-PBPM-01:TMON01:C:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-DI-PBPM-01:TMON01:C:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-01:TMON01:C:RESTOREHSV")
}

record(stringout, "FE14I-DI-PBPM-01:TMON01:C:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-DI-PBPM-01:TMON01:C:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-DI-PBPM-01:TMON01:C:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-DI-PBPM-01:TMON01:C:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-DI-PBPM-01:TMON01:C:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 116, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-DI-PBPM-01:TMON01:C:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-DI-PBPM-01:TMON01:C.HIHI")
  field(OUTB, "FE14I-DI-PBPM-01:TMON01:C:GETCALC.HIGH")
  field(OUTC, "FE14I-DI-PBPM-01:TMON01:C:GETCALC.LOW")
  field(DOL, "FE14I-DI-PBPM-01:TMON01:C:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-DI-PBPM-01:TMON01:C:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-01:TMON01:C")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-01:TMON01:C:TEMPINDX") {
  field(CALC, "16")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-DI-PBPM-01:TMON01:C
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-DI-PBPM-01:TMON01:C") {
  field(DESC, "PBPM-01 Temp 1")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-01:TMON01:C:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-DI-PBPM-01:TMON01:C:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-01:TMON01:C:GETCALC")
}

record(calcout, "FE14I-DI-PBPM-01:TMON01:C:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-01:TMON01:C:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-DI-PBPM-01:TMON01:C:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-01:TMON01:C:LIMITINDX") {
  field(CALC, "16")
  field(OUT, "FE14I-DI-PBPM-01:TMON01:C:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-DI-PBPM-01:TMON02:C
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-DI-PBPM-01:TMON02:C,label=PBPM-01 Temp 2
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-DI-PBPM-01,temp=:TMON02:C,desc=PBPM-01 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-DI-PBPM-01,temp=:TMON02:C,desc=PBPM-01 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-DI-PBPM-01,temp=:TMON02:C,desc=PBPM-01 Temp 2
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-DI-PBPM-01:TMON02:C
# % gui, , demand, Error Level,   FE14I-DI-PBPM-01:TMON02:C:HIHI
# % gui, , readback, Error Level RBV,   FE14I-DI-PBPM-01:TMON02:C:GETCALC
# % gui, , demand, Warning Level,   FE14I-DI-PBPM-01:TMON02:C.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-DI-PBPM-01:TMON02:C:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-DI-PBPM-01:TMON02:C:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-DI-PBPM-01:TMON02:C:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-DI-PBPM-01:TMON02:C.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-DI-PBPM-01:TMON02:C:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-DI-PBPM-01:TMON02:C:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-DI-PBPM-01:TMON02:C:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-DI-PBPM-01:TMON02:C:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-DI-PBPM-01:TMON02:C:ZERO CP")
  field(INPB, "FE14I-DI-PBPM-01:TMON02:C:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C:SEQ.SELN PP")
}

record(seq, "FE14I-DI-PBPM-01:TMON02:C:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-DI-PBPM-01:TMON02:C:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-DI-PBPM-01:TMON02:C:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-DI-PBPM-01:TMON02:C:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-DI-PBPM-01:TMON02:C:HIHI")
  field(FLNK, "FE14I-DI-PBPM-01:TMON02:C:SETOVER")
}

record(ao, "FE14I-DI-PBPM-01:TMON02:C:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-01:TMON02:C:SETHSV")
}

record(stringout, "FE14I-DI-PBPM-01:TMON02:C:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C.HSV PP")
}

record(calcout, "FE14I-DI-PBPM-01:TMON02:C:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-DI-PBPM-01:TMON02:C:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-01:TMON02:C:RESTOREHSV")
}

record(stringout, "FE14I-DI-PBPM-01:TMON02:C:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-DI-PBPM-01:TMON02:C:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-DI-PBPM-01:TMON02:C:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-DI-PBPM-01:TMON02:C:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-DI-PBPM-01:TMON02:C:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 117, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-DI-PBPM-01:TMON02:C:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-DI-PBPM-01:TMON02:C.HIHI")
  field(OUTB, "FE14I-DI-PBPM-01:TMON02:C:GETCALC.HIGH")
  field(OUTC, "FE14I-DI-PBPM-01:TMON02:C:GETCALC.LOW")
  field(DOL, "FE14I-DI-PBPM-01:TMON02:C:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-DI-PBPM-01:TMON02:C:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-01:TMON02:C")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-01:TMON02:C:TEMPINDX") {
  field(CALC, "17")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-DI-PBPM-01:TMON02:C
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-DI-PBPM-01:TMON02:C") {
  field(DESC, "PBPM-01 Temp 2")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-01:TMON02:C:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-DI-PBPM-01:TMON02:C:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-01:TMON02:C:GETCALC")
}

record(calcout, "FE14I-DI-PBPM-01:TMON02:C:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-01:TMON02:C:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-DI-PBPM-01:TMON02:C:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-01:TMON02:C:LIMITINDX") {
  field(CALC, "17")
  field(OUT, "FE14I-DI-PBPM-01:TMON02:C:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-DI-PBPM-02:TMON01:C
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-DI-PBPM-02:TMON01:C,label=PBPM-02 Temp 1
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-DI-PBPM-02,temp=:TMON01:C,desc=PBPM-02 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-DI-PBPM-02,temp=:TMON01:C,desc=PBPM-02 Temp 1
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-DI-PBPM-02,temp=:TMON01:C,desc=PBPM-02 Temp 1
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-DI-PBPM-02:TMON01:C
# % gui, , demand, Error Level,   FE14I-DI-PBPM-02:TMON01:C:HIHI
# % gui, , readback, Error Level RBV,   FE14I-DI-PBPM-02:TMON01:C:GETCALC
# % gui, , demand, Warning Level,   FE14I-DI-PBPM-02:TMON01:C.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-DI-PBPM-02:TMON01:C:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-DI-PBPM-02:TMON01:C:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-DI-PBPM-02:TMON01:C:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-DI-PBPM-02:TMON01:C.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-DI-PBPM-02:TMON01:C:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-DI-PBPM-02:TMON01:C:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-DI-PBPM-02:TMON01:C:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-DI-PBPM-02:TMON01:C:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-DI-PBPM-02:TMON01:C:ZERO CP")
  field(INPB, "FE14I-DI-PBPM-02:TMON01:C:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C:SEQ.SELN PP")
}

record(seq, "FE14I-DI-PBPM-02:TMON01:C:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-DI-PBPM-02:TMON01:C:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-DI-PBPM-02:TMON01:C:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-DI-PBPM-02:TMON01:C:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-DI-PBPM-02:TMON01:C:HIHI")
  field(FLNK, "FE14I-DI-PBPM-02:TMON01:C:SETOVER")
}

record(ao, "FE14I-DI-PBPM-02:TMON01:C:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-02:TMON01:C:SETHSV")
}

record(stringout, "FE14I-DI-PBPM-02:TMON01:C:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C.HSV PP")
}

record(calcout, "FE14I-DI-PBPM-02:TMON01:C:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-DI-PBPM-02:TMON01:C:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-02:TMON01:C:RESTOREHSV")
}

record(stringout, "FE14I-DI-PBPM-02:TMON01:C:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-DI-PBPM-02:TMON01:C:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-DI-PBPM-02:TMON01:C:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-DI-PBPM-02:TMON01:C:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-DI-PBPM-02:TMON01:C:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 122, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-DI-PBPM-02:TMON01:C:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-DI-PBPM-02:TMON01:C.HIHI")
  field(OUTB, "FE14I-DI-PBPM-02:TMON01:C:GETCALC.HIGH")
  field(OUTC, "FE14I-DI-PBPM-02:TMON01:C:GETCALC.LOW")
  field(DOL, "FE14I-DI-PBPM-02:TMON01:C:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-DI-PBPM-02:TMON01:C:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-02:TMON01:C")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-02:TMON01:C:TEMPINDX") {
  field(CALC, "22")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-DI-PBPM-02:TMON01:C
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-DI-PBPM-02:TMON01:C") {
  field(DESC, "PBPM-02 Temp 1")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-02:TMON01:C:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-DI-PBPM-02:TMON01:C:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-02:TMON01:C:GETCALC")
}

record(calcout, "FE14I-DI-PBPM-02:TMON01:C:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-02:TMON01:C:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-DI-PBPM-02:TMON01:C:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-02:TMON01:C:LIMITINDX") {
  field(CALC, "22")
  field(OUT, "FE14I-DI-PBPM-02:TMON01:C:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

# % macro, __doc__, Template database for an individual temperature on a
# temperature PLC. Requires an instance of dlsPLC_read100 for century=1 and
# century=2
#% macro, device, PV prefix
#% macro, temp, PV suffix
#% macro, desc, Description
#% macro, tmpcc, Parent temperature control crate prefix
# % macro, port, asyn port name of FINS driver
#% macro, offset, 2 digit integer offset of DM variables. E.g. if setpoint is in DM136 and readback in DM236 offset=36
#% macro, lolo, Lolo alarm limit
#% macro, low, Low alarm limit
#% macro, high, High alarm limit
#% macro, hihi, Hihi alarm limit
#% macro, hopr, High operating range
#% macro, lopr, Low operating range
#% macro, llsv, Lolo severity
#% macro, lsv, Low severity
#% macro, hyst, alarm deadband
#% macro, adel, archiver deadband
#% macro, scalefac, scale factor for temperature/setpoint
#% macro, tempcal, temperature calibration offset in egu (default=0)
#% macro, prec, precision for reporting value back
#% macro, name, Object and gui association name
#% macro, gda_name, GDA Name
#% macro, gda_desc, GDA Description
#% macro, timeout, Timeout in seconds for the FINS protocol
#% macro, disable_pv, If set, then this is the value of A in disable_calc
#% macro, disable_calc, If this condition is met then save the current limit and set the limit to 3276.7, disabling the interlock for this PV
#% macro, incentury,  The Century digit(s) for the PLC D address to read temperature values
#% macro, outcentury, The Century digit(s) for the PLC D address to write setpoints
#% macro, egu, Engineering units for temperature
# This associates an edm screen with the template
# % gui, , edm, temperature-config.edl, temp=FE14I-DI-PBPM-02:TMON02:C
# % gui, , edmembed, temperature-embed.edl, temp=FE14I-DI-PBPM-02:TMON02:C,label=PBPM-02 Temp 2
# This associates a BOY screen with the template
# % gui, , boydetail, dlsPLCApp_opi/temperature_detail.opi, device=FE14I-DI-PBPM-02,temp=:TMON02:C,desc=PBPM-02 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed_box.opi, device=FE14I-DI-PBPM-02,temp=:TMON02:C,desc=PBPM-02 Temp 2
# % gui, , boyembed, dlsPLCApp_opi/temperature_embed.opi, device=FE14I-DI-PBPM-02,temp=:TMON02:C,desc=PBPM-02 Temp 2
# These define what PVs a flow detail screen should contain
# % gui, , readback, Current Temp,   FE14I-DI-PBPM-02:TMON02:C
# % gui, , demand, Error Level,   FE14I-DI-PBPM-02:TMON02:C:HIHI
# % gui, , readback, Error Level RBV,   FE14I-DI-PBPM-02:TMON02:C:GETCALC
# % gui, , demand, Warning Level,   FE14I-DI-PBPM-02:TMON02:C.HIGH
# Hihi limit now in a separate record so that limits can be enforced
#% archiver 10 monitor
#% autosave 1 VAL
record(ao, "FE14I-DI-PBPM-02:TMON02:C:HIHI") {
  field(DESC, "Hihi Limit")
  field(DRVH, "3276.7")
  field(DRVL, "-273.15")
  field(VAL, "50")
  field(FLNK, "FE14I-DI-PBPM-02:TMON02:C:SETLIMIT")
  field(PREC, "1")
  field(EGU, "C")
}

# High limit now in a separate record so that its value can be autosaved and archived
#% archiver 10 monitor
#% autosave 1 VAL
record(ai, "FE14I-DI-PBPM-02:TMON02:C:HIGH") {
  field(DESC, "High Limit")
  field(INP, "FE14I-DI-PBPM-02:TMON02:C.HIGH CP")
  field(EGU, "C")
  field(VAL, "45")
}

# This record runs once when the IOC starts to
# write the value of :HIGH restored by autosave
# to the .HIGH field of the temperature record
record(calcout, "FE14I-DI-PBPM-02:TMON02:C:HIGH_INIT") {
  field(DESC, "Write value to HIGH field")
  field(INPA, "FE14I-DI-PBPM-02:TMON02:C:HIGH PP")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C.HIGH PP")
  field(PINI, "YES")
}

record(ai, "FE14I-DI-PBPM-02:TMON02:C:ZERO") {
  field(DESC, "Default limit disabled pv")
  field(PINI, "YES")
  field(VAL, "0")
}

#% archiver 10 monitor
record(calcout, "FE14I-DI-PBPM-02:TMON02:C:DISABLED") {
  field(DESC, "Is limit interlock disabled")
  field(INPA, "FE14I-DI-PBPM-02:TMON02:C:ZERO CP")
  field(INPB, "FE14I-DI-PBPM-02:TMON02:C:DISABLED")
  field(CALC, "A=1")
  field(OOPT, "On Change")
  field(OCAL, "B+1")
  field(DOPT, "Use OCAL")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C:SEQ.SELN PP")
}

record(seq, "FE14I-DI-PBPM-02:TMON02:C:SEQ") {
  field(SELM, "Specified")
  field(LNK1, "FE14I-DI-PBPM-02:TMON02:C:SAVELIMIT.PROC PP")
  field(LNK2, "FE14I-DI-PBPM-02:TMON02:C:RESTORELIMIT.PROC PP")
}

#% archiver 10 monitor
record(ai, "FE14I-DI-PBPM-02:TMON02:C:SAVELIMIT") {
  field(DESC, "Saved interlock limit")
  field(VAL, "50")
  field(INP, "FE14I-DI-PBPM-02:TMON02:C:HIHI")
  field(FLNK, "FE14I-DI-PBPM-02:TMON02:C:SETOVER")
}

record(ao, "FE14I-DI-PBPM-02:TMON02:C:SETOVER") {
  field(VAL, "3276.7")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-02:TMON02:C:SETHSV")
}

record(stringout, "FE14I-DI-PBPM-02:TMON02:C:SETHSV") {
  field(VAL, "NO_ALARM")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C.HSV PP")
}

record(calcout, "FE14I-DI-PBPM-02:TMON02:C:RESTORELIMIT") {
  field(DESC, "Restore saved limit")
  field(INPA, "FE14I-DI-PBPM-02:TMON02:C:SAVELIMIT")
  field(CALC, "A")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C:HIHI PP")
  field(FLNK, "FE14I-DI-PBPM-02:TMON02:C:RESTOREHSV")
}

record(stringout, "FE14I-DI-PBPM-02:TMON02:C:RESTOREHSV") {
  field(VAL, "MINOR")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C.HSV PP")
}

# Set limit on PLC.
# Note value needs to be an unsigned short,
# since we are using double and is converted to an int,
# we cheat by offsetting the value to allow it to be sent.
record(calcout, "FE14I-DI-PBPM-02:TMON02:C:SETLIMIT") {
  field(DESC, "Set limit")
  field(FLNK, "FE14I-DI-PBPM-02:TMON02:C:FAN")
  field(CALC, "(A<0)?((A*10+65536)-0*10):(A*10-0*10)")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C:SETLIMITOUT PP")
  field(PINI, "YES")
  field(INPA, "FE14I-DI-PBPM-02:TMON02:C:HIHI")
  field(PREC, "1")
}

record(ao, "FE14I-DI-PBPM-02:TMON02:C:SETLIMITOUT") {
  field(DESC, "Set limit")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 123, 0) FINS_DM_WRITE")
}

record(dfanout, "FE14I-DI-PBPM-02:TMON02:C:FAN") {
  field(DESC, "Set record limits")
  field(OUTA, "FE14I-DI-PBPM-02:TMON02:C.HIHI")
  field(OUTB, "FE14I-DI-PBPM-02:TMON02:C:GETCALC.HIGH")
  field(OUTC, "FE14I-DI-PBPM-02:TMON02:C:GETCALC.LOW")
  field(DOL, "FE14I-DI-PBPM-02:TMON02:C:SETLIMIT.A")
  field(OMSL, "closed_loop")
}

record(subArray, "FE14I-DI-PBPM-02:TMON02:C:GETTEMP") {
  field(DESC, "Get temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM2XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-02:TMON02:C")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-02:TMON02:C:TEMPINDX") {
  field(CALC, "23")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C:GETTEMP.INDX PP")
  field(PINI, "YES")
}

#% gdatag,template,simplePv,,
#% gdatag,pv,ro,,RECORD,Temperature
# % archiver 10 Monitor
#% alh
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-DI-PBPM-02:TMON02:C
# This makes the component icon reflect the status and severity
# % gui, , sevr
record(calcout, "FE14I-DI-PBPM-02:TMON02:C") {
  field(DESC, "PBPM-02 Temp 2")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-02:TMON02:C:GETTEMP.VAL MS")
  field(HSV, "MINOR")
  field(HOPR, "200")
  field(LOPR, "0")
  field(HHSV, "MAJOR")
  field(LSV, "NO_ALARM")
  field(LOW, "10")
  field(LLSV, "NO_ALARM")
  field(LOLO, "5")
  field(EGU, "C")
  field(PREC, "1")
  field(ADEL, "0.2")
  field(HYST, "0")
}

record(subArray, "FE14I-DI-PBPM-02:TMON02:C:GETLIMIT") {
  field(DESC, "Get limit for temperature")
  field(DTYP, "Soft Channel")
  field(FTVL, "SHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM1XX CP MS")
  field(MALM, "100")
  field(FLNK, "FE14I-DI-PBPM-02:TMON02:C:GETCALC")
}

record(calcout, "FE14I-DI-PBPM-02:TMON02:C:GETCALC") {
  field(DESC, "Scale setpoint")
  field(DTYP, "Soft Channel")
  field(CALC, "(A/10)+0")
  field(INPA, "FE14I-DI-PBPM-02:TMON02:C:GETLIMIT.VAL")
  field(HSV, "INVALID")
  field(LSV, "INVALID")
  field(EGU, "C")
  field(PREC, "1")
}

# A flag that indicates whether the temperature has a calibration
# offset.  The value is set to 1 by the calibrationOverlay template.
record(bo, "FE14I-DI-PBPM-02:TMON02:C:HASOFFSET") {
  field(VAL, "0")
}

# if decade is 0 then EPICS treats INDX as octal, so stick it in a calcout
# record which doesn't interpret 0 prefixed numbers as octal
record(calcout, "FE14I-DI-PBPM-02:TMON02:C:LIMITINDX") {
  field(CALC, "23")
  field(OUT, "FE14I-DI-PBPM-02:TMON02:C:GETLIMIT.INDX PP")
  field(PINI, "YES")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

## ^ Not really - I had to lie to it to get it to flatten this hand-crafted file!
#% macro, __doc__, Template that reads the valve control crate PLC READBACK 
# waveform and extracts the digital input fields in D4 (macro default - can be modified).
# The memory map spreadsheet defines this area as being a list containing
# warning level switches for EPICS to display, but it is a bit more versatile than that
# and in front-ends actually reflects LO and LOLO status.
# A macro is being used instead of hard coding D4, so that other words can be decoded
# if needed.
#
#% macro, device, Device prefix (for valve control crate record instance)
#% macro, address, D address from which to fetch digital input word (Default = 4)
#% macro, znam, Meaning of a zero value (Default = Off)
#% macro, onam, Meaning of a one value (Default = On)
#% macro, zsv , Severity code to associate with zero value (Default = MAJOR)
#% macro, osv , Severity code to associate with one value (Default = NO_ALARM)
#
################################################################################
# Read 1 word of memory from the READBACK waveform
# defaulting to D4 (WFS)
#
#
record(subArray, "FE14I-VA-VLVCC-01:GETD4") {
  field(DESC, "Digital input from PLC")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM0XX CP MS")
  field(MALM, "100")
  field(INDX, "4")
}

record(mbbiDirect, "FE14I-VA-VLVCC-01:D4") {
  field(DESC, "PLC Digital inputs from D4")
  field(SCAN, "1 second")
  field(INP, "FE14I-VA-VLVCC-01:GETD4 PP MS")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN0") {
  field(DESC, "D4 digital input 0")
  field(INP, "FE14I-VA-VLVCC-01:D4.B0 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN1")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN1") {
  field(DESC, "D4 digital input 1")
  field(INP, "FE14I-VA-VLVCC-01:D4.B1 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN2")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN2") {
  field(DESC, "D4 digital input 2")
  field(INP, "FE14I-VA-VLVCC-01:D4.B2 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN3")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN3") {
  field(DESC, "D4 digital input 3")
  field(INP, "FE14I-VA-VLVCC-01:D4.B3 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN4")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN4") {
  field(DESC, "D4 digital input 4")
  field(INP, "FE14I-VA-VLVCC-01:D4.B4 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN5")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN5") {
  field(DESC, "D4 digital input 5")
  field(INP, "FE14I-VA-VLVCC-01:D4.B5 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN6")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN6") {
  field(DESC, "D4 digital input 6")
  field(INP, "FE14I-VA-VLVCC-01:D4.B6 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN7")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN7") {
  field(DESC, "D4 digital input 7")
  field(INP, "FE14I-VA-VLVCC-01:D4.B7 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN8")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN8") {
  field(DESC, "D4 digital input 8")
  field(INP, "FE14I-VA-VLVCC-01:D4.B8 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN9")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN9") {
  field(DESC, "D4 digital input 9")
  field(INP, "FE14I-VA-VLVCC-01:D4.B9 CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN10")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN10") {
  field(DESC, "D4 digital input 10")
  field(INP, "FE14I-VA-VLVCC-01:D4.BA CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN11")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN11") {
  field(DESC, "D4 digital input 11")
  field(INP, "FE14I-VA-VLVCC-01:D4.BB CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN12")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN12") {
  field(DESC, "D4 digital input 12")
  field(INP, "FE14I-VA-VLVCC-01:D4.BC CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN13")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN13") {
  field(DESC, "D4 digital input 13")
  field(INP, "FE14I-VA-VLVCC-01:D4.BD CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN14")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN14") {
  field(DESC, "D4 digital input 14")
  field(INP, "FE14I-VA-VLVCC-01:D4.BE CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
  field(FLNK, "FE14I-VA-VLVCC-01:D4IN15")
}

record(bi, "FE14I-VA-VLVCC-01:D4IN15") {
  field(DESC, "D4 digital input 15")
  field(INP, "FE14I-VA-VLVCC-01:D4.BF CP MS")
  field(ZSV, "MAJOR")
  field(OSV, "NO_ALARM")
  field(ZNAM, "Off")
  field(ONAM, "On")
}
#
# macros: port   => asyn port handle
#         daddr  => D address in PLC to read for frequency
#         device => PV Base name for flow meter
#  e.g. FExxx-HO-FLMTR-01:RATE

record(longin, "FE14I-HO-FLMTR-01:FREQ") 
    {
    field(DTYP, "asynInt32")
    field(INP, "@asyn(vlvcc_fins_port, 310, 0) FINS_DM_READ")
    }

#% archiver 10 Monitor
record(calc, "FE14I-HO-FLMTR-01:RATE") 
    {
    field(DESC, "Flow rate")
    field(CALC, "A*309.09")
    field(INPA, "FE14I-HO-FLMTR-01:FREQ PP MS")
    field(EGU, "l/h")
    field(PREC, "1")
    field(SCAN, "1 second")
    field(HOPR, "5000")
    field(LOPR, "0")
    field(HIHI, "4000")
    field(LOLO, "100")
    field(HHSV, "MINOR")
    field(LLSV, "MAJOR")
    }

 #! Generated by VisualDCT v2.7.1-SNAPSHOT

# dlsPLC_vacValveTcloseValve.template
#% macro, __doc__, Template database for a vacuum valve TCLOSE metrics
#% macro, device, device name
#% macro, vlvcc, device name of valve control crate
# % macro, port, asyn port name of FINS driver
#% macro, century, DM<century>XX (e.g. DM11XX would be century = 11)
#% macro, index, DM<century>XX (e.g. DM1111 would be century = 11 and index = 11)
#% macro, tclose_high, HIGH alarm level for TCLOSE record (Optional - defaults to 0)
#% macro, tclose_hihi, HIHI alarm level for TCLOSE record (Optional - defaults to 0)
#% macro, tclose_hsv,  HSV  HIGH severity level for TCLOSE record (Optional - defaults to NO_ALARM)
#% macro, tclose_hhsv, HHSV HIHI severity level for TCLOSE record (Optional - defaults to NO_ALARM)
record(longin, "FE14I-RS-ABSB-01:INPTCLOSE") {
  field(INP, "FE14I-RS-ABSB-01:GETINPTCLOSE PP MS")
}

record(subArray, "FE14I-RS-ABSB-01:GETINPTCLOSE") {
  field(DTYP, "Soft Channel")
  field(FTVL, "USHORT")
  field(INP, "FE14I-VA-VLVCC-01:DM11XX CP MS")
  field(INDX, "11")
  field(MALM, "100")
}

#
#% archiver 10 Monitor
#% controldesk Current Close Time readback
#% alh $SEVRCOMMAND UP_ANY dls-alh-handler.py FE14I-RS-ABSB-01:TCLOSE
#% alh $SEVRCOMMAND UP_ANY dls-sendsms-alarm.py FE14I-RS-ABSB-01:TCLOSE
#
record(calc, "FE14I-RS-ABSB-01:TCLOSE") {
  field(DESC, "Close Time")
  field(CALC, "A/10.0")
  field(INPA, "FE14I-RS-ABSB-01:INPTCLOSE PP MS")
  field(EGU, "s")
  field(PREC, "1")
  field(SCAN, "1 second")
  field(HOPR, "10")
  field(LOPR, "2")
  field(HIGH, "1.5")
  field(HIHI, "3.0")
  field(HSV, "MINOR")
  field(HHSV, "MAJOR")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

## ^ Not really - I had to lie to it to get it to flatten this hand-crafted file!
# dlsPLC_radmonreset.template
#% macro, __doc__, Template database for a vacuum valve
# Ian Gillingham October 2012
# 
# substitutions:
#% macro, device, device name
#% macro, port, asyn port name
#% macro, radmon_device, full PV name of RAD MON :RESET:OK
################################################################################
# Ian's additions to handle the radmon 4 hour reset signal
# Simon has asked for D109 to be rewritten with a suitable timer count
# periodically (whilst the FE IOC sees valid resets from KARB's PV).
# If a reset is missed, then KARB's PV will indicate this and the FE
# IOC should the cease sending timer updates to the PLC. The PLC will, after reaching
# a countdown of zero, inhibit opening of the FE absorber.
# The nominal countdown timer is 30s (300 x 0.1s)
#
#
# :RADMONRESET periodically issues a command to instruct the PLC to reset its
# countdown timer to 30 seconds. Note the use of FINS_DM_WRITE_NOREAD instead
# of FINS_DM_WRITE, this is to prevent the FINS asyn driver from overwriting
# the desired VAL with zero (because the original content of D109 would be zero).
#
#% archiver 10 Monitor
#
record(ao, "FE14I-RS-RDMON-01:RADMONRESET") {
  field(SCAN, "10 second")
  field(DESC, "RADMON Reset Signal")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn(vlvcc_fins_port, 109, 0) FINS_DM_WRITE_NOREAD")
  field(SDIS, "FE14I-RS-RDMON-01:TIMERRESETDISA")
  field(VAL, "300")
}

#
#% archiver 10 Monitor
#
record(calc, "FE14I-RS-RDMON-01:TIMERRESETDISA") {
  field(DESC, "Disable PLC Reset Timer")
  field(SCAN, "10 second")
  field(CALC, "(A=0)&&(B=0)?1:0")
  field(INPA, "BL14I-RS-RDMON-01:RESET:OK")
  field(INPB, "FE14I-RS-RDMON-01:RADMONOVERRIDE")
}

record(bo, "FE14I-RS-RDMON-01:RADMONOVERRIDE") {
  field(DESC, "Reset DISA Override")
  field(VAL, "0")
  field(ZNAM, "No")
  field(ONAM, "Yes")
}
#! Generated by VisualDCT v2.7.1-SNAPSHOT

#  dlsPLC_CommsStatus.vdb
#  Maintains a view of the valve control crate status, so that problems can be quickly identified by a user.
# % macro, __doc__, Template that reads the overall status of the valve control crate PLC
# % macro, device, Device prefix
# % macro, field (optional), Device PV field to monitor. Defaults to DM0XX
# PINI set to ensure the record is initialised with TIMEOUT status,
# which will only change to OK once communication starts.
record(mbbi, "FE14I-VA-VLVCC-01:COMMS") {
  field(DESC, "Communication Status")
  field(DTYP, "Soft Channel")
  field(SCAN, "Passive")
  field(ZRST, "TIMEOUT")
  field(ONST, "OK")
  field(INP, "0")
  field(PINI, "YES")
}

record(scalcout, "FE14I-VA-VLVCC-01:COMMSMATCH") {
  field(INAA, "FE14I-VA-VLVCC-01:DM0XX.STAT MS CP")
  field(CALC, "printf('%d',AA!='READ'?1:0)")
  field(OOPT, "Every Time")
  field(DOPT, "Use CALC")
  field(OUT, "FE14I-VA-VLVCC-01:COMMS PP MS")
}
